{"version":3,"file":"react-pdf.cjs.development.js","sources":["../src/index.tsx"],"sourcesContent":["import pdfjs from '@bundled-es-modules/pdfjs-dist';\r\nimport React, { useState, useEffect, useRef, useImperativeHandle } from 'react';\r\n\r\nfunction isFunction(value: any): value is Function {\r\n  return typeof value === 'function';\r\n}\r\n\r\ntype ComponentRenderProps = HookReturnValues & {\r\n  canvas: React.ReactElement;\r\n};\r\n\r\ntype ComponentProps = Omit<HookProps, 'canvasRef'> &\r\n  React.CanvasHTMLAttributes<HTMLCanvasElement> & {\r\n    children?: (renderProps: ComponentRenderProps) => React.ReactElement;\r\n  };\r\n\r\nconst Pdf = React.forwardRef<HTMLCanvasElement | null, ComponentProps>(\r\n  (\r\n    {\r\n      file,\r\n      onDocumentLoadSuccess,\r\n      onDocumentLoadFail,\r\n      onPageLoadSuccess,\r\n      onPageLoadFail,\r\n      onPageRenderSuccess,\r\n      onPageRenderFail,\r\n      page,\r\n      scale,\r\n      rotate,\r\n      cMapUrl,\r\n      cMapPacked,\r\n      workerSrc,\r\n      withCredentials,\r\n      children,\r\n      ...canvasProps\r\n    },\r\n    ref\r\n  ) => {\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    useImperativeHandle(ref, () => canvasRef.current);\r\n\r\n    const pdfData = usePdf({\r\n      canvasRef,\r\n      file,\r\n      onDocumentLoadSuccess,\r\n      onDocumentLoadFail,\r\n      onPageLoadSuccess,\r\n      onPageLoadFail,\r\n      onPageRenderSuccess,\r\n      onPageRenderFail,\r\n      page,\r\n      scale,\r\n      rotate,\r\n      cMapUrl,\r\n      cMapPacked,\r\n      workerSrc,\r\n      withCredentials,\r\n    });\r\n\r\n    const canvas = <canvas {...canvasProps} ref={canvasRef} />;\r\n\r\n    if (isFunction(children)) {\r\n      return children({ canvas, ...pdfData });\r\n    }\r\n\r\n    return canvas;\r\n  }\r\n);\r\n\r\ntype HookProps = {\r\n  canvasRef: React.RefObject<HTMLCanvasElement | null>;\r\n  file: string;\r\n  onDocumentLoadSuccess?: (document: pdfjs.PDFDocumentProxy) => void;\r\n  onDocumentLoadFail?: () => void;\r\n  onPageLoadSuccess?: (page: pdfjs.PDFPageProxy) => void;\r\n  onPageLoadFail?: () => void;\r\n  onPageRenderSuccess?: (page: pdfjs.PDFPageProxy) => void;\r\n  onPageRenderFail?: () => void;\r\n  scale?: number;\r\n  rotate?: number;\r\n  page?: number;\r\n  cMapUrl?: string;\r\n  cMapPacked?: boolean;\r\n  workerSrc?: string;\r\n  withCredentials?: boolean;\r\n};\r\n\r\ntype HookReturnValues = {\r\n  pdfDocument: pdfjs.PDFDocumentProxy | undefined;\r\n  pdfPage: pdfjs.PDFPageProxy | undefined;\r\n};\r\n\r\nexport const usePdf = ({\r\n  canvasRef,\r\n  file,\r\n  onDocumentLoadSuccess,\r\n  onDocumentLoadFail,\r\n  onPageLoadSuccess,\r\n  onPageLoadFail,\r\n  onPageRenderSuccess,\r\n  onPageRenderFail,\r\n  scale = 1,\r\n  rotate = 0,\r\n  page = 1,\r\n  cMapUrl,\r\n  cMapPacked,\r\n  workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`,\r\n  withCredentials = false,\r\n}: HookProps): HookReturnValues => {\r\n  const [pdfDocument, setPdfDocument] = useState<pdfjs.PDFDocumentProxy>();\r\n  const [pdfPage, setPdfPage] = useState<pdfjs.PDFPageProxy>();\r\n  const renderTask = useRef<pdfjs.PDFRenderTask | null>(null);\r\n  const onDocumentLoadSuccessRef = useRef(onDocumentLoadSuccess);\r\n  const onDocumentLoadFailRef = useRef(onDocumentLoadFail);\r\n  const onPageLoadSuccessRef = useRef(onPageLoadSuccess);\r\n  const onPageLoadFailRef = useRef(onPageLoadFail);\r\n  const onPageRenderSuccessRef = useRef(onPageRenderSuccess);\r\n  const onPageRenderFailRef = useRef(onPageRenderFail);\r\n\r\n  // assign callbacks to refs to avoid redrawing\r\n  useEffect(() => {\r\n    onDocumentLoadSuccessRef.current = onDocumentLoadSuccess;\r\n  }, [onDocumentLoadSuccess]);\r\n\r\n  useEffect(() => {\r\n    onDocumentLoadFailRef.current = onDocumentLoadFail;\r\n  }, [onDocumentLoadFail]);\r\n\r\n  useEffect(() => {\r\n    onPageLoadSuccessRef.current = onPageLoadSuccess;\r\n  }, [onPageLoadSuccess]);\r\n\r\n  useEffect(() => {\r\n    onPageLoadFailRef.current = onPageLoadFail;\r\n  }, [onPageLoadFail]);\r\n\r\n  useEffect(() => {\r\n    onPageRenderSuccessRef.current = onPageRenderSuccess;\r\n  }, [onPageRenderSuccess]);\r\n\r\n  useEffect(() => {\r\n    onPageRenderFailRef.current = onPageRenderFail;\r\n  }, [onPageRenderFail]);\r\n\r\n  useEffect(() => {\r\n    pdfjs.GlobalWorkerOptions.workerSrc = workerSrc;\r\n  }, [workerSrc]);\r\n\r\n  useEffect(() => {\r\n    const config: pdfjs.PDFSource = { url: file, withCredentials };\r\n    if (cMapUrl) {\r\n      config.cMapUrl = cMapUrl;\r\n      config.cMapPacked = cMapPacked;\r\n    }\r\n    pdfjs.getDocument(config).promise.then(\r\n      loadedPdfDocument => {\r\n        setPdfDocument(loadedPdfDocument);\r\n\r\n        if (isFunction(onDocumentLoadSuccessRef.current)) {\r\n          onDocumentLoadSuccessRef.current(loadedPdfDocument);\r\n        }\r\n      },\r\n      () => {\r\n        if (isFunction(onDocumentLoadFailRef.current)) {\r\n          onDocumentLoadFailRef.current();\r\n        }\r\n      }\r\n    );\r\n  }, [file, withCredentials, cMapUrl, cMapPacked]);\r\n\r\n  useEffect(() => {\r\n    // draw a page of the pdf\r\n    const drawPDF = (page: pdfjs.PDFPageProxy) => {\r\n      // Because this page's rotation option overwrites pdf default rotation value,\r\n      // calculating page rotation option value from pdf default and this component prop rotate.\r\n      const rotation = rotate === 0 ? page.rotate : page.rotate + rotate;\r\n      const dpRatio = window.devicePixelRatio;\r\n      const adjustedScale = scale * dpRatio;\r\n      const viewport = page.getViewport({ scale: adjustedScale, rotation });\r\n      const canvasEl = canvasRef.current;\r\n      if (!canvasEl) {\r\n        return;\r\n      }\r\n\r\n      const canvasContext = canvasEl.getContext('2d');\r\n      if (!canvasContext) {\r\n        return;\r\n      }\r\n\r\n      canvasEl.style.width = `${viewport.width / dpRatio}px`;\r\n      canvasEl.style.height = `${viewport.height / dpRatio}px`;\r\n      canvasEl.height = viewport.height;\r\n      canvasEl.width = viewport.width;\r\n\r\n      // if previous render isn't done yet, we cancel it\r\n      if (renderTask.current) {\r\n        renderTask.current.cancel();\r\n        return;\r\n      }\r\n\r\n      renderTask.current = page.render({\r\n        canvasContext,\r\n        viewport,\r\n      });\r\n\r\n      return renderTask.current.promise.then(\r\n        () => {\r\n          renderTask.current = null;\r\n\r\n          if (isFunction(onPageRenderSuccessRef.current)) {\r\n            onPageRenderSuccessRef.current(page);\r\n          }\r\n        },\r\n        err => {\r\n          renderTask.current = null;\r\n\r\n          // @ts-ignore typings are outdated\r\n          if (err && err.name === 'RenderingCancelledException') {\r\n            drawPDF(page);\r\n          } else if (isFunction(onPageRenderFailRef.current)) {\r\n            onPageRenderFailRef.current();\r\n          }\r\n        }\r\n      );\r\n    };\r\n\r\n    if (pdfDocument) {\r\n      pdfDocument.getPage(page).then(\r\n        loadedPdfPage => {\r\n          setPdfPage(loadedPdfPage);\r\n\r\n          if (isFunction(onPageLoadSuccessRef.current)) {\r\n            onPageLoadSuccessRef.current(loadedPdfPage);\r\n          }\r\n\r\n          drawPDF(loadedPdfPage);\r\n        },\r\n        () => {\r\n          if (isFunction(onPageLoadFailRef.current)) {\r\n            onPageLoadFailRef.current();\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }, [canvasRef, page, pdfDocument, rotate, scale]);\r\n\r\n  return { pdfDocument, pdfPage };\r\n};\r\n\r\nexport default Pdf;\r\n"],"names":["isFunction","value","Pdf","React","forwardRef","ref","file","onDocumentLoadSuccess","onDocumentLoadFail","onPageLoadSuccess","onPageLoadFail","onPageRenderSuccess","onPageRenderFail","page","scale","rotate","cMapUrl","cMapPacked","workerSrc","withCredentials","children","canvasProps","canvasRef","useRef","useImperativeHandle","current","pdfData","usePdf","canvas","pdfjs","version","useState","pdfDocument","setPdfDocument","pdfPage","setPdfPage","renderTask","onDocumentLoadSuccessRef","onDocumentLoadFailRef","onPageLoadSuccessRef","onPageLoadFailRef","onPageRenderSuccessRef","onPageRenderFailRef","useEffect","GlobalWorkerOptions","config","url","getDocument","promise","then","loadedPdfDocument","drawPDF","rotation","dpRatio","window","devicePixelRatio","adjustedScale","viewport","getViewport","canvasEl","canvasContext","getContext","style","width","height","cancel","render","err","name","getPage","loadedPdfPage"],"mappings":"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"}