{"version":3,"file":"react-pdf.cjs.production.min.js","sources":["../src/index.tsx"],"sourcesContent":["import pdfjs from '@bundled-es-modules/pdfjs-dist';\r\nimport React, { useState, useEffect, useRef, useImperativeHandle } from 'react';\r\n\r\nfunction isFunction(value: any): value is Function {\r\n  return typeof value === 'function';\r\n}\r\n\r\ntype ComponentRenderProps = HookReturnValues & {\r\n  canvas: React.ReactElement;\r\n};\r\n\r\ntype ComponentProps = Omit<HookProps, 'canvasRef'> &\r\n  React.CanvasHTMLAttributes<HTMLCanvasElement> & {\r\n    children?: (renderProps: ComponentRenderProps) => React.ReactElement;\r\n  };\r\n\r\nconst Pdf = React.forwardRef<HTMLCanvasElement | null, ComponentProps>(\r\n  (\r\n    {\r\n      file,\r\n      onDocumentLoadSuccess,\r\n      onDocumentLoadFail,\r\n      onPageLoadSuccess,\r\n      onPageLoadFail,\r\n      onPageRenderSuccess,\r\n      onPageRenderFail,\r\n      page,\r\n      scale,\r\n      rotate,\r\n      cMapUrl,\r\n      cMapPacked,\r\n      workerSrc,\r\n      withCredentials,\r\n      children,\r\n      ...canvasProps\r\n    },\r\n    ref\r\n  ) => {\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    useImperativeHandle(ref, () => canvasRef.current);\r\n\r\n    const pdfData = usePdf({\r\n      canvasRef,\r\n      file,\r\n      onDocumentLoadSuccess,\r\n      onDocumentLoadFail,\r\n      onPageLoadSuccess,\r\n      onPageLoadFail,\r\n      onPageRenderSuccess,\r\n      onPageRenderFail,\r\n      page,\r\n      scale,\r\n      rotate,\r\n      cMapUrl,\r\n      cMapPacked,\r\n      workerSrc,\r\n      withCredentials,\r\n    });\r\n\r\n    const canvas = <canvas {...canvasProps} ref={canvasRef} />;\r\n\r\n    if (isFunction(children)) {\r\n      return children({ canvas, ...pdfData });\r\n    }\r\n\r\n    return canvas;\r\n  }\r\n);\r\n\r\ntype HookProps = {\r\n  canvasRef: React.RefObject<HTMLCanvasElement | null>;\r\n  file: string;\r\n  onDocumentLoadSuccess?: (document: pdfjs.PDFDocumentProxy) => void;\r\n  onDocumentLoadFail?: () => void;\r\n  onPageLoadSuccess?: (page: pdfjs.PDFPageProxy) => void;\r\n  onPageLoadFail?: () => void;\r\n  onPageRenderSuccess?: (page: pdfjs.PDFPageProxy) => void;\r\n  onPageRenderFail?: () => void;\r\n  scale?: number;\r\n  rotate?: number;\r\n  page?: number;\r\n  cMapUrl?: string;\r\n  cMapPacked?: boolean;\r\n  workerSrc?: string;\r\n  withCredentials?: boolean;\r\n};\r\n\r\ntype HookReturnValues = {\r\n  pdfDocument: pdfjs.PDFDocumentProxy | undefined;\r\n  pdfPage: pdfjs.PDFPageProxy | undefined;\r\n};\r\n\r\nexport const usePdf = ({\r\n  canvasRef,\r\n  file,\r\n  onDocumentLoadSuccess,\r\n  onDocumentLoadFail,\r\n  onPageLoadSuccess,\r\n  onPageLoadFail,\r\n  onPageRenderSuccess,\r\n  onPageRenderFail,\r\n  scale = 1,\r\n  rotate = 0,\r\n  page = 1,\r\n  cMapUrl,\r\n  cMapPacked,\r\n  workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`,\r\n  withCredentials = false,\r\n}: HookProps): HookReturnValues => {\r\n  const [pdfDocument, setPdfDocument] = useState<pdfjs.PDFDocumentProxy>();\r\n  const [pdfPage, setPdfPage] = useState<pdfjs.PDFPageProxy>();\r\n  const renderTask = useRef<pdfjs.PDFRenderTask | null>(null);\r\n  const onDocumentLoadSuccessRef = useRef(onDocumentLoadSuccess);\r\n  const onDocumentLoadFailRef = useRef(onDocumentLoadFail);\r\n  const onPageLoadSuccessRef = useRef(onPageLoadSuccess);\r\n  const onPageLoadFailRef = useRef(onPageLoadFail);\r\n  const onPageRenderSuccessRef = useRef(onPageRenderSuccess);\r\n  const onPageRenderFailRef = useRef(onPageRenderFail);\r\n\r\n  // assign callbacks to refs to avoid redrawing\r\n  useEffect(() => {\r\n    onDocumentLoadSuccessRef.current = onDocumentLoadSuccess;\r\n  }, [onDocumentLoadSuccess]);\r\n\r\n  useEffect(() => {\r\n    onDocumentLoadFailRef.current = onDocumentLoadFail;\r\n  }, [onDocumentLoadFail]);\r\n\r\n  useEffect(() => {\r\n    onPageLoadSuccessRef.current = onPageLoadSuccess;\r\n  }, [onPageLoadSuccess]);\r\n\r\n  useEffect(() => {\r\n    onPageLoadFailRef.current = onPageLoadFail;\r\n  }, [onPageLoadFail]);\r\n\r\n  useEffect(() => {\r\n    onPageRenderSuccessRef.current = onPageRenderSuccess;\r\n  }, [onPageRenderSuccess]);\r\n\r\n  useEffect(() => {\r\n    onPageRenderFailRef.current = onPageRenderFail;\r\n  }, [onPageRenderFail]);\r\n\r\n  useEffect(() => {\r\n    pdfjs.GlobalWorkerOptions.workerSrc = workerSrc;\r\n  }, [workerSrc]);\r\n\r\n  useEffect(() => {\r\n    const config: pdfjs.PDFSource = { url: file, withCredentials };\r\n    if (cMapUrl) {\r\n      config.cMapUrl = cMapUrl;\r\n      config.cMapPacked = cMapPacked;\r\n    }\r\n    pdfjs.getDocument(config).promise.then(\r\n      loadedPdfDocument => {\r\n        setPdfDocument(loadedPdfDocument);\r\n\r\n        if (isFunction(onDocumentLoadSuccessRef.current)) {\r\n          onDocumentLoadSuccessRef.current(loadedPdfDocument);\r\n        }\r\n      },\r\n      () => {\r\n        if (isFunction(onDocumentLoadFailRef.current)) {\r\n          onDocumentLoadFailRef.current();\r\n        }\r\n      }\r\n    );\r\n  }, [file, withCredentials, cMapUrl, cMapPacked]);\r\n\r\n  useEffect(() => {\r\n    // draw a page of the pdf\r\n    const drawPDF = (page: pdfjs.PDFPageProxy) => {\r\n      // Because this page's rotation option overwrites pdf default rotation value,\r\n      // calculating page rotation option value from pdf default and this component prop rotate.\r\n      const rotation = rotate === 0 ? page.rotate : page.rotate + rotate;\r\n      const dpRatio = window.devicePixelRatio;\r\n      const adjustedScale = scale * dpRatio;\r\n      const viewport = page.getViewport({ scale: adjustedScale, rotation });\r\n      const canvasEl = canvasRef.current;\r\n      if (!canvasEl) {\r\n        return;\r\n      }\r\n\r\n      const canvasContext = canvasEl.getContext('2d');\r\n      if (!canvasContext) {\r\n        return;\r\n      }\r\n\r\n      canvasEl.style.width = `${viewport.width / dpRatio}px`;\r\n      canvasEl.style.height = `${viewport.height / dpRatio}px`;\r\n      canvasEl.height = viewport.height;\r\n      canvasEl.width = viewport.width;\r\n\r\n      // if previous render isn't done yet, we cancel it\r\n      if (renderTask.current) {\r\n        renderTask.current.cancel();\r\n        return;\r\n      }\r\n\r\n      renderTask.current = page.render({\r\n        canvasContext,\r\n        viewport,\r\n      });\r\n\r\n      return renderTask.current.promise.then(\r\n        () => {\r\n          renderTask.current = null;\r\n\r\n          if (isFunction(onPageRenderSuccessRef.current)) {\r\n            onPageRenderSuccessRef.current(page);\r\n          }\r\n        },\r\n        err => {\r\n          renderTask.current = null;\r\n\r\n          // @ts-ignore typings are outdated\r\n          if (err && err.name === 'RenderingCancelledException') {\r\n            drawPDF(page);\r\n          } else if (isFunction(onPageRenderFailRef.current)) {\r\n            onPageRenderFailRef.current();\r\n          }\r\n        }\r\n      );\r\n    };\r\n\r\n    if (pdfDocument) {\r\n      pdfDocument.getPage(page).then(\r\n        loadedPdfPage => {\r\n          setPdfPage(loadedPdfPage);\r\n\r\n          if (isFunction(onPageLoadSuccessRef.current)) {\r\n            onPageLoadSuccessRef.current(loadedPdfPage);\r\n          }\r\n\r\n          drawPDF(loadedPdfPage);\r\n        },\r\n        () => {\r\n          if (isFunction(onPageLoadFailRef.current)) {\r\n            onPageLoadFailRef.current();\r\n          }\r\n        }\r\n      );\r\n    }\r\n  }, [canvasRef, page, pdfDocument, rotate, scale]);\r\n\r\n  return { pdfDocument, pdfPage };\r\n};\r\n\r\nexport default Pdf;\r\n"],"names":["isFunction","value","Pdf","React","forwardRef","ref","file","onDocumentLoadSuccess","onDocumentLoadFail","onPageLoadSuccess","onPageLoadFail","onPageRenderSuccess","onPageRenderFail","page","scale","rotate","cMapUrl","cMapPacked","workerSrc","withCredentials","children","canvasProps","canvasRef","useRef","useImperativeHandle","current","pdfData","usePdf","canvas","pdfjs","version","useState","pdfDocument","setPdfDocument","pdfPage","setPdfPage","renderTask","onDocumentLoadSuccessRef","onDocumentLoadFailRef","onPageLoadSuccessRef","onPageLoadFailRef","onPageRenderSuccessRef","onPageRenderFailRef","useEffect","GlobalWorkerOptions","config","url","getDocument","promise","then","loadedPdfDocument","getPage","loadedPdfPage","drawPDF","dpRatio","window","devicePixelRatio","viewport","getViewport","rotation","canvasEl","canvasContext","getContext","style","width","height","render","err","name","cancel"],"mappings":"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"}