{"ast":null,"code":"import { useEffect, useState, useCallback } from 'react';\nlet unblock;\nexport function usePrompt(onRequestToLeavePage, onRequestToLeaveApp, history, isEnabled = false) {\n  const [location, setLocation] = useState();\n  const [currentLocation, setCurrentLocation] = useState();\n  const enable = useCallback(() => {\n    if (history) {\n      if (unblock) {\n        unblock();\n      }\n\n      unblock = history.block(loc => {\n        setLocation(loc);\n        setCurrentLocation(history.location);\n        return onRequestToLeavePage();\n      });\n    }\n  }, [onRequestToLeavePage, history]);\n  const disable = useCallback(() => {\n    if (unblock) {\n      unblock();\n    }\n  }, []);\n  useEffect(() => {\n    if (isEnabled) {\n      enable();\n      window.addEventListener('beforeunload', handleBeforeUnload);\n    } else {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    }\n\n    return () => {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [isEnabled, enable, disable]);\n  const handleBeforeUnload = useCallback(ev => {\n    if (isEnabled && onRequestToLeaveApp) {\n      ev.preventDefault();\n      const msg = onRequestToLeaveApp();\n      ev.returnValue = msg;\n      return msg;\n    }\n\n    return undefined;\n  }, [isEnabled, onRequestToLeaveApp]);\n\n  const handleContinue = () => {\n    disable();\n\n    if (location && currentLocation && history) {\n      history.push(formUrl(location));\n\n      if (currentLocation.pathname === location.pathname && isEnabled) {\n        enable();\n      }\n    }\n  };\n\n  return [handleContinue, disable];\n}\n\nconst formUrl = ({\n  pathname,\n  search,\n  hash\n}) => `${pathname}${search}${hash}`;","map":{"version":3,"sources":["../../../../src/components/Prompt/usePrompt.ts"],"names":[],"mappings":"AAAA,SAAS,SAAT,EAAoB,QAApB,EAA8B,WAA9B,QAAiD,OAAjD;AAGA,IAAI,OAAJ;AAEA,OAAM,SAAU,SAAV,CACJ,oBADI,EAEJ,mBAFI,EAGJ,OAHI,EAIJ,SAAA,GAAqB,KAJjB,EAIsB;AAE1B,QAAM,CAAC,QAAD,EAAW,WAAX,IAA0B,QAAQ,EAAxC;AACA,QAAM,CAAC,eAAD,EAAkB,kBAAlB,IAAwC,QAAQ,EAAtD;AAEA,QAAM,MAAM,GAAG,WAAW,CAAC,MAAK;AAC9B,QAAI,OAAJ,EAAa;AACX,UAAI,OAAJ,EAAa;AACX,QAAA,OAAO;AACR;;AACD,MAAA,OAAO,GAAG,OAAO,CAAC,KAAR,CAAc,GAAG,IAAG;AAC5B,QAAA,WAAW,CAAC,GAAD,CAAX;AACA,QAAA,kBAAkB,CAAC,OAAO,CAAC,QAAT,CAAlB;AACA,eAAO,oBAAoB,EAA3B;AACD,OAJS,CAAV;AAKD;AACF,GAXyB,EAWvB,CAAC,oBAAD,EAAuB,OAAvB,CAXuB,CAA1B;AAaA,QAAM,OAAO,GAAG,WAAW,CAAC,MAAK;AAC/B,QAAI,OAAJ,EAAa;AACX,MAAA,OAAO;AACR;AACF,GAJ0B,EAIxB,EAJwB,CAA3B;AAMA,EAAA,SAAS,CAAC,MAAK;AACb,QAAI,SAAJ,EAAe;AACb,MAAA,MAAM;AACN,MAAA,MAAM,CAAC,gBAAP,CAAwB,cAAxB,EAAwC,kBAAxC;AACD,KAHD,MAGO;AACL,MAAA,OAAO;AACP,MAAA,MAAM,CAAC,mBAAP,CAA2B,cAA3B,EAA2C,kBAA3C;AACD;;AACD,WAAO,MAAK;AACV,MAAA,OAAO;AACP,MAAA,MAAM,CAAC,mBAAP,CAA2B,cAA3B,EAA2C,kBAA3C;AACD,KAHD;AAID,GAZQ,EAYN,CAAC,SAAD,EAAY,MAAZ,EAAoB,OAApB,CAZM,CAAT;AAcA,QAAM,kBAAkB,GAAG,WAAW,CACnC,EAAD,IAA0B;AACxB,QAAI,SAAS,IAAI,mBAAjB,EAAsC;AACpC,MAAA,EAAE,CAAC,cAAH;AACA,YAAM,GAAG,GAAG,mBAAmB,EAA/B;AACA,MAAA,EAAE,CAAC,WAAH,GAAiB,GAAjB;AACA,aAAO,GAAP;AACD;;AACD,WAAO,SAAP;AACD,GATmC,EAUpC,CAAC,SAAD,EAAY,mBAAZ,CAVoC,CAAtC;;AAaA,QAAM,cAAc,GAAG,MAAK;AAC1B,IAAA,OAAO;;AACP,QAAI,QAAQ,IAAI,eAAZ,IAA+B,OAAnC,EAA4C;AAC1C,MAAA,OAAO,CAAC,IAAR,CAAa,OAAO,CAAC,QAAD,CAApB;;AACA,UAAI,eAAe,CAAC,QAAhB,KAA6B,QAAQ,CAAC,QAAtC,IAAkD,SAAtD,EAAiE;AAC/D,QAAA,MAAM;AACP;AACF;AACF,GARD;;AAUA,SAAO,CAAC,cAAD,EAAiB,OAAjB,CAAP;AACD;;AAED,MAAM,OAAO,GAAG,CAAC;AAAE,EAAA,QAAF;AAAY,EAAA,MAAZ;AAAoB,EAAA;AAApB,CAAD,KAAgD,GAAG,QAAQ,GAAG,MAAM,GAAG,IAAI,EAA3F","sourcesContent":["import { useEffect, useState, useCallback } from 'react';\nimport { PromptHistory, PromptLocation, PromptCallback } from './Prompt.types';\n\nlet unblock: any;\n\nexport function usePrompt(\n  onRequestToLeavePage: PromptCallback,\n  onRequestToLeaveApp?: PromptCallback,\n  history?: PromptHistory,\n  isEnabled: boolean = false,\n) {\n  const [location, setLocation] = useState<PromptLocation>();\n  const [currentLocation, setCurrentLocation] = useState<PromptLocation>();\n\n  const enable = useCallback(() => {\n    if (history) {\n      if (unblock) {\n        unblock();\n      }\n      unblock = history.block(loc => {\n        setLocation(loc);\n        setCurrentLocation(history.location);\n        return onRequestToLeavePage();\n      });\n    }\n  }, [onRequestToLeavePage, history]);\n\n  const disable = useCallback(() => {\n    if (unblock) {\n      unblock();\n    }\n  }, []);\n\n  useEffect(() => {\n    if (isEnabled) {\n      enable();\n      window.addEventListener('beforeunload', handleBeforeUnload);\n    } else {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    }\n    return () => {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [isEnabled, enable, disable]);\n\n  const handleBeforeUnload = useCallback(\n    (ev: BeforeUnloadEvent) => {\n      if (isEnabled && onRequestToLeaveApp) {\n        ev.preventDefault();\n        const msg = onRequestToLeaveApp();\n        ev.returnValue = msg;\n        return msg;\n      }\n      return undefined;\n    },\n    [isEnabled, onRequestToLeaveApp],\n  );\n\n  const handleContinue = () => {\n    disable();\n    if (location && currentLocation && history) {\n      history.push(formUrl(location));\n      if (currentLocation.pathname === location.pathname && isEnabled) {\n        enable();\n      }\n    }\n  };\n\n  return [handleContinue, disable];\n}\n\nconst formUrl = ({ pathname, search, hash }: PromptLocation) => `${pathname}${search}${hash}`;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}