{"ast":null,"code":"import _slicedToArray from \"/mnt/d/thinkpad_desktop_files/portfolio_web/react-portfolio-site/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { useEffect, useState, useCallback } from 'react';\nvar unblock;\nexport function usePrompt(onRequestToLeavePage, onRequestToLeaveApp, history) {\n  var isEnabled = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      location = _useState2[0],\n      setLocation = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentLocation = _useState4[0],\n      setCurrentLocation = _useState4[1];\n\n  var enable = useCallback(function () {\n    if (history) {\n      if (unblock) {\n        unblock();\n      }\n\n      unblock = history.block(function (loc) {\n        setLocation(loc);\n        setCurrentLocation(history.location);\n        return onRequestToLeavePage();\n      });\n    }\n  }, [onRequestToLeavePage, history]);\n  var disable = useCallback(function () {\n    if (unblock) {\n      unblock();\n    }\n  }, []);\n  useEffect(function () {\n    if (isEnabled) {\n      enable();\n      window.addEventListener('beforeunload', handleBeforeUnload);\n    } else {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    }\n\n    return function () {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [isEnabled, enable, disable]);\n  var handleBeforeUnload = useCallback(function (ev) {\n    if (isEnabled && onRequestToLeaveApp) {\n      ev.preventDefault();\n      var msg = onRequestToLeaveApp();\n      ev.returnValue = msg;\n      return msg;\n    }\n\n    return undefined;\n  }, [isEnabled, onRequestToLeaveApp]);\n\n  var handleContinue = function handleContinue() {\n    disable();\n\n    if (location && currentLocation && history) {\n      history.push(formUrl(location));\n\n      if (currentLocation.pathname === location.pathname && isEnabled) {\n        enable();\n      }\n    }\n  };\n\n  return [handleContinue, disable];\n}\n\nvar formUrl = function formUrl(_ref) {\n  var pathname = _ref.pathname,\n      search = _ref.search,\n      hash = _ref.hash;\n  return \"\".concat(pathname).concat(search).concat(hash);\n};","map":{"version":3,"sources":["../../../../src/components/Prompt/usePrompt.ts"],"names":[],"mappings":";AAAA,SAAS,SAAT,EAAoB,QAApB,EAA8B,WAA9B,QAAiD,OAAjD;AAGA,IAAI,OAAJ;AAEA,OAAM,SAAU,SAAV,CACJ,oBADI,EAEJ,mBAFI,EAGJ,OAHI,EAIsB;AAAA,MAA1B,SAA0B,uEAAL,KAAK;;AAAA,kBAEM,QAAQ,EAFd;AAAA;AAAA,MAEnB,QAFmB;AAAA,MAET,WAFS;;AAAA,mBAGoB,QAAQ,EAH5B;AAAA;AAAA,MAGnB,eAHmB;AAAA,MAGF,kBAHE;;AAK1B,MAAM,MAAM,GAAG,WAAW,CAAC,YAAK;AAC9B,QAAI,OAAJ,EAAa;AACX,UAAI,OAAJ,EAAa;AACX,QAAA,OAAO;AACR;;AACD,MAAA,OAAO,GAAG,OAAO,CAAC,KAAR,CAAc,UAAA,GAAG,EAAG;AAC5B,QAAA,WAAW,CAAC,GAAD,CAAX;AACA,QAAA,kBAAkB,CAAC,OAAO,CAAC,QAAT,CAAlB;AACA,eAAO,oBAAoB,EAA3B;AACD,OAJS,CAAV;AAKD;AACF,GAXyB,EAWvB,CAAC,oBAAD,EAAuB,OAAvB,CAXuB,CAA1B;AAaA,MAAM,OAAO,GAAG,WAAW,CAAC,YAAK;AAC/B,QAAI,OAAJ,EAAa;AACX,MAAA,OAAO;AACR;AACF,GAJ0B,EAIxB,EAJwB,CAA3B;AAMA,EAAA,SAAS,CAAC,YAAK;AACb,QAAI,SAAJ,EAAe;AACb,MAAA,MAAM;AACN,MAAA,MAAM,CAAC,gBAAP,CAAwB,cAAxB,EAAwC,kBAAxC;AACD,KAHD,MAGO;AACL,MAAA,OAAO;AACP,MAAA,MAAM,CAAC,mBAAP,CAA2B,cAA3B,EAA2C,kBAA3C;AACD;;AACD,WAAO,YAAK;AACV,MAAA,OAAO;AACP,MAAA,MAAM,CAAC,mBAAP,CAA2B,cAA3B,EAA2C,kBAA3C;AACD,KAHD;AAID,GAZQ,EAYN,CAAC,SAAD,EAAY,MAAZ,EAAoB,OAApB,CAZM,CAAT;AAcA,MAAM,kBAAkB,GAAG,WAAW,CACpC,UAAC,EAAD,EAA0B;AACxB,QAAI,SAAS,IAAI,mBAAjB,EAAsC;AACpC,MAAA,EAAE,CAAC,cAAH;AACA,UAAM,GAAG,GAAG,mBAAmB,EAA/B;AACA,MAAA,EAAE,CAAC,WAAH,GAAiB,GAAjB;AACA,aAAO,GAAP;AACD;;AACD,WAAO,SAAP;AACD,GATmC,EAUpC,CAAC,SAAD,EAAY,mBAAZ,CAVoC,CAAtC;;AAaA,MAAM,cAAc,GAAG,SAAjB,cAAiB,GAAK;AAC1B,IAAA,OAAO;;AACP,QAAI,QAAQ,IAAI,eAAZ,IAA+B,OAAnC,EAA4C;AAC1C,MAAA,OAAO,CAAC,IAAR,CAAa,OAAO,CAAC,QAAD,CAApB;;AACA,UAAI,eAAe,CAAC,QAAhB,KAA6B,QAAQ,CAAC,QAAtC,IAAkD,SAAtD,EAAiE;AAC/D,QAAA,MAAM;AACP;AACF;AACF,GARD;;AAUA,SAAO,CAAC,cAAD,EAAiB,OAAjB,CAAP;AACD;;AAED,IAAM,OAAO,GAAG,SAAV,OAAU;AAAA,MAAG,QAAH,QAAG,QAAH;AAAA,MAAa,MAAb,QAAa,MAAb;AAAA,MAAqB,IAArB,QAAqB,IAArB;AAAA,mBAAmD,QAAnD,SAA8D,MAA9D,SAAuE,IAAvE;AAAA,CAAhB","sourcesContent":["import { useEffect, useState, useCallback } from 'react';\nimport { PromptHistory, PromptLocation, PromptCallback } from './Prompt.types';\n\nlet unblock: any;\n\nexport function usePrompt(\n  onRequestToLeavePage: PromptCallback,\n  onRequestToLeaveApp?: PromptCallback,\n  history?: PromptHistory,\n  isEnabled: boolean = false,\n) {\n  const [location, setLocation] = useState<PromptLocation>();\n  const [currentLocation, setCurrentLocation] = useState<PromptLocation>();\n\n  const enable = useCallback(() => {\n    if (history) {\n      if (unblock) {\n        unblock();\n      }\n      unblock = history.block(loc => {\n        setLocation(loc);\n        setCurrentLocation(history.location);\n        return onRequestToLeavePage();\n      });\n    }\n  }, [onRequestToLeavePage, history]);\n\n  const disable = useCallback(() => {\n    if (unblock) {\n      unblock();\n    }\n  }, []);\n\n  useEffect(() => {\n    if (isEnabled) {\n      enable();\n      window.addEventListener('beforeunload', handleBeforeUnload);\n    } else {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    }\n    return () => {\n      disable();\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, [isEnabled, enable, disable]);\n\n  const handleBeforeUnload = useCallback(\n    (ev: BeforeUnloadEvent) => {\n      if (isEnabled && onRequestToLeaveApp) {\n        ev.preventDefault();\n        const msg = onRequestToLeaveApp();\n        ev.returnValue = msg;\n        return msg;\n      }\n      return undefined;\n    },\n    [isEnabled, onRequestToLeaveApp],\n  );\n\n  const handleContinue = () => {\n    disable();\n    if (location && currentLocation && history) {\n      history.push(formUrl(location));\n      if (currentLocation.pathname === location.pathname && isEnabled) {\n        enable();\n      }\n    }\n  };\n\n  return [handleContinue, disable];\n}\n\nconst formUrl = ({ pathname, search, hash }: PromptLocation) => `${pathname}${search}${hash}`;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}