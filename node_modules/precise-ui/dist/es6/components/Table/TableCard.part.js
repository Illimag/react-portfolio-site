var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { themed, css } from '../../utils/styled';
import { List } from '../List';
import { ListItem } from '../ListItem';
import { defaultCellRenderer, handleDataClickedEvent } from './TableShared.part';
import { distance } from '../../distance';
import { getFontStyle } from '../../textStyles';
const Container = styled.div(themed(({ theme: { ui4, text1 } }) => css `
      ${getFontStyle({ size: 'medium' })}

      position: relative;
      border: 1px solid ${ui4};
      color: ${text1};
    `));
const ContentContainer = styled.div `
  padding: ${distance.medium} ${distance.medium} ${distance.large};
`;
const PropContainer = styled.div `
  margin-bottom: ${distance.medium};

  &:last-child {
    margin-bottom: 0;
  }
`;
PropContainer.displayName = 'PropContainer';
const PropName = styled.div `
  ${getFontStyle({ size: 'xSmall' })}
`;
const PropValue = styled.div `
  ${getFontStyle({ weight: 'medium' })}
`;
const PlaceholderContainer = styled.div `
  text-align: center;
`;
const StyledListItem = styled(ListItem) `
  padding: 0;
  margin-bottom: ${distance.xlarge};
  border: none;

  &:last-child {
    margin-bottom: 0;
  }
`;
export function defaultBodyRenderer(e) {
    const CardBody = e.table;
    return React.createElement(CardBody, null, e.rows);
}
const TableCardHost = Object.assign((props => React.createElement(List, Object.assign({}, props))), { inner: {
        get List() { return List; }
    } });
export class TableCard extends React.Component {
    constructor(props) {
        super(props);
        this.renderItem = ({ item, index, keys }) => {
            const { theme } = this.props;
            return (React.createElement(StyledListItem, { theme: theme, key: index },
                React.createElement(Container, { theme: theme },
                    React.createElement(ContentContainer, { theme: theme }, this.renderItemProps(item, index, keys)))));
        };
    }
    getHeader(key) {
        const { columns } = this.props;
        if (columns) {
            const column = columns[key];
            return typeof column === 'string' ? column : column.header;
        }
        return key;
    }
    renderItemProps(item, rowIndex, keys) {
        const { columns, cellRenderer = defaultCellRenderer, data, onDataClick } = this.props;
        return keys
            .map((key, colIndex) => {
            const column = columns ? columns[key] : key;
            if (typeof column === 'string' || !column.hidden) {
                const propKey = this.getHeader(key);
                const value = cellRenderer({
                    column: colIndex,
                    row: rowIndex,
                    key,
                    value: item[key],
                    data: item,
                    render: defaultCellRenderer,
                });
                return (React.createElement(PropContainer, { key: colIndex, onClick: handleDataClickedEvent({ row: rowIndex, column: colIndex, key, data: data[rowIndex] }, onDataClick) },
                    React.createElement(PropName, null, propKey),
                    React.createElement(PropValue, null, value)));
            }
            return undefined;
        })
            .filter(m => !!m);
    }
    render() {
        const _a = this.props, { data = [], columns, placeholder, theme, cardRenderer = this.renderItem, bodyRenderer = defaultBodyRenderer } = _a, props = __rest(_a, ["data", "columns", "placeholder", "theme", "cardRenderer", "bodyRenderer"]);
        const keys = Object.keys(columns || data[0] || {});
        const rows = data.length === 0
            ? placeholder
                ? [
                    React.createElement(StyledListItem, { theme: theme, key: 0 },
                        React.createElement(PlaceholderContainer, { theme: theme }, placeholder)),
                ]
                : []
            : data.map((item, index) => cardRenderer({ item, index, keys }));
        return bodyRenderer({
            table: TableCardHost,
            props: Object.assign({ theme, borderless: true }, props),
            rows,
            mode: 'card',
        });
    }
}
TableCard.inner = {
    get StyledListItem() { return StyledListItem; },
    get Container() { return Container; },
    get ContentContainer() { return ContentContainer; },
    get PropContainer() { return PropContainer; },
    get PropName() { return PropName; },
    get PropValue() { return PropValue; },
    get PlaceholderContainer() { return PlaceholderContainer; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGFibGVDYXJkLnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9UYWJsZS9UYWJsZUNhcmQucGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDekQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUMvQixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxzQkFBc0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDaEQsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUM7UUFDL0QsWUFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDOzs7MEJBR2QsR0FBRztlQUNkLEtBQUs7S0FDZixDQUFDLENBQUMsQ0FBQztBQUNSLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQzthQUN2QixRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxNQUFNLElBQUksUUFBUSxDQUFDLEtBQUs7Q0FDaEUsQ0FBQztBQUNGLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7bUJBQ2QsUUFBUSxDQUFDLE1BQU07Ozs7O0NBS2pDLENBQUM7QUFDRixhQUFhLENBQUMsV0FB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QUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUM7d0JBQ3hDLG9CQUFDLG9CQUFvQixJQUFDLEtBQUssRUFBRSxLQUFLLElBQUcsV0FBVyxDQUF3QixDQUN6RDtpQkFDZDtnQkFDRCxDQUFDLENBQUMsRUFBRTtZQUNSLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDckUsT0FBTyxZQUFZLENBQUM7WUFDaEIsS0FBSyxFQUFFLGFBQWE7WUFDcEIsS0FBSyxrQkFDRCxLQUFLLEVBQ0wsVUFBVSxFQUFFLElBQUksSUFDYixLQUFLLENBQ1g7WUFDRCxJQUFJO1lBQ0osSUFBSSxFQUFFLE1BQU07U0FDZixDQUFDLENBQUM7SUFDUCxDQUFDOztBQUNNLGVBQUssR0FBRztJQUNYLElBQUksY0FBYyxLQUFLLE9BQU8sY0FBdUMsQ0FBQyxDQUFDLENBQUM7SUFDeEUsSUFBSSxTQUFTLEtBQUssT0FBTyxTQUE2QixDQUFDLENBQUMsQ0FBQztJQUN6RCxJQUFJLGdCQUFnQixLQUFLLE9BQU8sZ0JBQTJDLENBQUMsQ0FBQyxDQUFDO0lBQzlFLElBQUksYUFBYSxLQUFLLE9BQU8sYUFBcUMsQ0FBQyxDQUFDLENBQUM7SUFDckUsSUFBSSxRQUFRLEtBQUssT0FBTyxRQUEyQixDQUFDLENBQUMsQ0FBQztJQUN0RCxJQUFJLFNBQVMsS0FBSyxPQUFPLFNBQTZCLENBQUMsQ0FBQyxDQUFDO0lBQ3pELElBQUksb0JBQW9CLEtBQUssT0FBTyxvQkFBbUQsQ0FBQyxDQUFDLENBQUM7Q0FDN0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkLCBjc3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgTGlzdCB9IGZyb20gJy4uL0xpc3QnO1xuaW1wb3J0IHsgTGlzdEl0ZW0gfSBmcm9tICcuLi9MaXN0SXRlbSc7XG5pbXBvcnQgeyBUYWJsZVByb3BzLCBUYWJsZUNhcmRSZW5kZXJlckV2ZW50LCBUYWJsZUJvZHlSZW5kZXJFdmVudCB9IGZyb20gJy4vVGFibGUudHlwZXMucGFydCc7XG5pbXBvcnQgeyBkZWZhdWx0Q2VsbFJlbmRlcmVyLCBoYW5kbGVEYXRhQ2xpY2tlZEV2ZW50IH0gZnJvbSAnLi9UYWJsZVNoYXJlZC5wYXJ0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgZ2V0Rm9udFN0eWxlIH0gZnJvbSAnLi4vLi4vdGV4dFN0eWxlcyc7XG5jb25zdCBDb250YWluZXIgPSBzdHlsZWQuZGl2KHRoZW1lZCgoeyB0aGVtZTogeyB1aTQsIHRleHQxIH0gfSkgPT4gY3NzIGBcbiAgICAgICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ21lZGl1bScgfSl9XG5cbiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7dWk0fTtcbiAgICAgIGNvbG9yOiAke3RleHQxfTtcbiAgICBgKSk7XG5jb25zdCBDb250ZW50Q29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7ZGlzdGFuY2UubWVkaXVtfSAke2Rpc3RhbmNlLm1lZGl1bX0gJHtkaXN0YW5jZS5sYXJnZX07XG5gO1xuY29uc3QgUHJvcENvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBtYXJnaW4tYm90dG9tOiAke2Rpc3RhbmNlLm1lZGl1bX07XG5cbiAgJjpsYXN0LWNoaWxkIHtcbiAgICBtYXJnaW4tYm90dG9tOiAwO1xuICB9XG5gO1xuUHJvcENvbnRhaW5lci5kaXNwbGF5TmFtZSA9ICdQcm9wQ29udGFpbmVyJztcbmNvbnN0IFByb3BOYW1lID0gc3R5bGVkLmRpdiBgXG4gICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ3hTbWFsbCcgfSl9XG5gO1xuY29uc3QgUHJvcFZhbHVlID0gc3R5bGVkLmRpdiBgXG4gICR7Z2V0Rm9udFN0eWxlKHsgd2VpZ2h0OiAnbWVkaXVtJyB9KX1cbmA7XG5jb25zdCBQbGFjZWhvbGRlckNvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG5gO1xuY29uc3QgU3R5bGVkTGlzdEl0ZW0gPSBzdHlsZWQoTGlzdEl0ZW0pIGBcbiAgcGFkZGluZzogMDtcbiAgbWFyZ2luLWJvdHRvbTogJHtkaXN0YW5jZS54bGFyZ2V9O1xuICBib3JkZXI6IG5vbmU7XG5cbiAgJjpsYXN0LWNoaWxkIHtcbiAgICBtYXJnaW4tYm90dG9tOiAwO1xuICB9XG5gO1xuZXhwb3J0IGZ1bmN0aW9uIGRlZmF1bHRCb2R5UmVuZGVyZXIoZTogVGFibGVCb2R5UmVuZGVyRXZlbnQpIHtcbiAgICBjb25zdCBDYXJkQm9keSA9IGUudGFibGU7XG4gICAgcmV0dXJuIDxDYXJkQm9keT57ZS5yb3dzfTwvQ2FyZEJvZHk+O1xufVxuaW50ZXJmYWNlIFRhYmxlQ2FyZEhvc3RQcm9wcyB7XG4gICAgYm9yZGVybGVzczogYm9vbGVhbjtcbn1cbmNvbnN0IFRhYmxlQ2FyZEhvc3QgPSBPYmplY3QuYXNzaWduKCgocHJvcHMgPT4gPExpc3Qgey4uLnByb3BzfS8+KSBhcyBSZWFjdC5TRkM8VGFibGVDYXJkSG9zdFByb3BzPiksIHsgaW5uZXI6IHtcbiAgICAgICAgZ2V0IExpc3QoKSB7IHJldHVybiBMaXN0IGFzIHR5cGVvZiBMaXN0OyB9XG4gICAgfSB9KTtcbmV4cG9ydCBjbGFzcyBUYWJsZUNhcmQ8VD4gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8VGFibGVQcm9wczxUPj4ge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBUYWJsZVByb3BzPFQ+KSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICB9XG4gICAgcHJpdmF0ZSByZW5kZXJJdGVtID0gKHsgaXRlbSwgaW5kZXgsIGtleXMgfTogVGFibGVDYXJkUmVuZGVyZXJFdmVudDxUPikgPT4ge1xuICAgICAgICBjb25zdCB7IHRoZW1lIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gKDxTdHlsZWRMaXN0SXRlbSB0aGVtZT17dGhlbWV9IGtleT17aW5kZXh9PlxuICAgICAgICA8Q29udGFpbmVyIHRoZW1lPXt0aGVtZX0+XG4gICAgICAgICAgPENvbnRlbnRDb250YWluZXIgdGhlbWU9e3RoZW1lfT57dGhpcy5yZW5kZXJJdGVtUHJvcHMoaXRlbSwgaW5kZXgsIGtleXMpfTwvQ29udGVudENvbnRhaW5lcj5cbiAgICAgICAgPC9Db250YWluZXI+XG4gICAgICA8L1N0eWxlZExpc3RJdGVtPik7XG4gICAgfTtcbiAgICBwcml2YXRlIGdldEhlYWRlcihrZXk6IHN0cmluZykge1xuICAgICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChjb2x1bW5zKSB7XG4gICAgICAgICAgICBjb25zdCBjb2x1bW4gPSBjb2x1bW5zW2tleV07XG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIGNvbHVtbiA9PT0gJ3N0cmluZycgPyBjb2x1bW4gOiBjb2x1bW4uaGVhZGVyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBrZXk7XG4gICAgfVxuICAgIHByaXZhdGUgcmVuZGVySXRlbVByb3BzKGl0ZW06IFQsIHJvd0luZGV4OiBudW1iZXIsIGtleXM6IEFycmF5PHN0cmluZz4pIHtcbiAgICAgICAgY29uc3QgeyBjb2x1bW5zLCBjZWxsUmVuZGVyZXIgPSBkZWZhdWx0Q2VsbFJlbmRlcmVyLCBkYXRhLCBvbkRhdGFDbGljayB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgcmV0dXJuIGtleXNcbiAgICAgICAgICAgIC5tYXAoKGtleSwgY29sSW5kZXgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IGNvbHVtbnMgPyBjb2x1bW5zW2tleV0gOiBrZXk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbHVtbiA9PT0gJ3N0cmluZycgfHwgIWNvbHVtbi5oaWRkZW4pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwcm9wS2V5ID0gdGhpcy5nZXRIZWFkZXIoa2V5KTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGNlbGxSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbjogY29sSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIHJvdzogcm93SW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0ZW1ba2V5XSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogaXRlbSxcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyOiBkZWZhdWx0Q2VsbFJlbmRlcmVyLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiAoPFByb3BDb250YWluZXIga2V5PXtjb2xJbmRleH0gb25DbGljaz17aGFuZGxlRGF0YUNsaWNrZWRFdmVudCh7IHJvdzogcm93SW5kZXgsIGNvbHVtbjogY29sSW5kZXgsIGtleSwgZGF0YTogZGF0YVtyb3dJbmRleF0gfSwgb25EYXRhQ2xpY2spfT5cbiAgICAgICAgICAgICAgPFByb3BOYW1lPntwcm9wS2V5fTwvUHJvcE5hbWU+XG4gICAgICAgICAgICAgIDxQcm9wVmFsdWU+e3ZhbHVlfTwvUHJvcFZhbHVlPlxuICAgICAgICAgICAgPC9Qcm9wQ29udGFpbmVyPik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmZpbHRlcihtID0+ICEhbSk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhID0gW10sIGNvbHVtbnMsIHBsYWNlaG9sZGVyLCB0aGVtZSwgY2FyZFJlbmRlcmVyID0gdGhpcy5yZW5kZXJJdGVtLCBib2R5UmVuZGVyZXIgPSBkZWZhdWx0Qm9keVJlbmRlcmVyLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGNvbHVtbnMgfHwgZGF0YVswXSB8fCB7fSk7XG4gICAgICAgIGNvbnN0IHJvd3MgPSBkYXRhLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgPyBwbGFjZWhvbGRlclxuICAgICAgICAgICAgICAgID8gW1xuICAgICAgICAgICAgICAgICAgICA8U3R5bGVkTGlzdEl0ZW0gdGhlbWU9e3RoZW1lfSBrZXk9ezB9PlxuICAgICAgICAgICAgICAgIDxQbGFjZWhvbGRlckNvbnRhaW5lciB0aGVtZT17dGhlbWV9PntwbGFjZWhvbGRlcn08L1BsYWNlaG9sZGVyQ29udGFpbmVyPlxuICAgICAgICAgICAgICA8L1N0eWxlZExpc3RJdGVtPixcbiAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgOiBbXVxuICAgICAgICAgICAgOiBkYXRhLm1hcCgoaXRlbSwgaW5kZXgpID0+IGNhcmRSZW5kZXJlcih7IGl0ZW0sIGluZGV4LCBrZXlzIH0pKTtcbiAgICAgICAgcmV0dXJuIGJvZHlSZW5kZXJlcih7XG4gICAgICAgICAgICB0YWJsZTogVGFibGVDYXJkSG9zdCxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgICAgdGhlbWUsXG4gICAgICAgICAgICAgICAgYm9yZGVybGVzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByb3dzLFxuICAgICAgICAgICAgbW9kZTogJ2NhcmQnLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgU3R5bGVkTGlzdEl0ZW0oKSB7IHJldHVybiBTdHlsZWRMaXN0SXRlbSBhcyB0eXBlb2YgU3R5bGVkTGlzdEl0ZW07IH0sXG4gICAgICAgIGdldCBDb250YWluZXIoKSB7IHJldHVybiBDb250YWluZXIgYXMgdHlwZW9mIENvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IENvbnRlbnRDb250YWluZXIoKSB7IHJldHVybiBDb250ZW50Q29udGFpbmVyIGFzIHR5cGVvZiBDb250ZW50Q29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgUHJvcENvbnRhaW5lcigpIHsgcmV0dXJuIFByb3BDb250YWluZXIgYXMgdHlwZW9mIFByb3BDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBQcm9wTmFtZSgpIHsgcmV0dXJuIFByb3BOYW1lIGFzIHR5cGVvZiBQcm9wTmFtZTsgfSxcbiAgICAgICAgZ2V0IFByb3BWYWx1ZSgpIHsgcmV0dXJuIFByb3BWYWx1ZSBhcyB0eXBlb2YgUHJvcFZhbHVlOyB9LFxuICAgICAgICBnZXQgUGxhY2Vob2xkZXJDb250YWluZXIoKSB7IHJldHVybiBQbGFjZWhvbGRlckNvbnRhaW5lciBhcyB0eXBlb2YgUGxhY2Vob2xkZXJDb250YWluZXI7IH1cbiAgICB9O1xufVxuIl19