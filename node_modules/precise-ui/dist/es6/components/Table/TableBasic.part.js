var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import memoize from 'memoize-one';
import styled, { themed, css } from '../../utils/styled';
import { sortObjectList } from '../../utils/sort';
import { distance } from '../../distance';
import { defaultCellRenderer, StyledTableHead, StyledTableHeaderRow, StyledTableHeader, StyledTableRow, StyledTableFoot, defaultBodyRenderer, getColumns, getDefaultHeaderCellRenderer, handleDataClickedEvent, } from './TableShared.part';
import { getFontStyle } from '../../textStyles';
const StyledTable = styled.table(themed(({ theme, borderless, condensed }) => css `
    ${getFontStyle({ size: 'small', lineHeight: 'xSmall' })}

    table-layout: ${theme.tableLayout};
    border-collapse: collapse;
    width: 100%;
    color: ${theme.text6};
    border: ${borderless ? 'none' : theme.tableBorder};

    > thead > tr > th,
    > tbody > tr > td {
      padding: ${condensed ? `${distance.small} ${distance.large}` : theme.tableHeadPadding};

      &:not(:last-child) {
        padding-right: 0;
      }
    }
    `));
const StyledTableBody = styled.tbody ``;
const TableHost = Object.assign(((_a) => {
    var { head, foot, theme, children } = _a, props = __rest(_a, ["head", "foot", "theme", "children"]);
    return (React.createElement(StyledTable, Object.assign({ theme: theme }, props),
        head,
        React.createElement(StyledTableBody, { theme: theme }, children),
        foot));
}), { inner: {
        get StyledTable() { return StyledTable; },
        get StyledTableBody() { return StyledTableBody; }
    } });
const HiddenCell = styled.td `
  display: none;
`;
const StyledTableCell = styled.td `
  text-align: left;
`;
const StyledPlaceholderCell = styled(StyledTableCell) `
  text-align: center;
`;
function defaultRowKeyGetter({ key }) {
    return key;
}
function normalizeSortBy(sortBy) {
    if (!sortBy) {
        return undefined;
    }
    if (typeof sortBy === 'string') {
        if (sortBy[0] === '-') {
            return {
                columnKey: sortBy.substr(1),
                order: 'descending',
            };
        }
        else {
            return {
                columnKey: sortBy,
                order: 'ascending',
            };
        }
    }
    return {
        columnKey: sortBy.columnKey,
        order: sortBy.order || 'ascending',
    };
}
export class TableBasic extends React.Component {
    constructor(props) {
        super(props);
        this.getIndices = memoize((data, grouping, sorting) => sorting
            ? sortObjectList(data, sorting.columnKey, sorting.order, grouping)
            : sortObjectList(data, undefined, undefined, grouping));
        this.defaultHeadRenderer = ({ columns, sortBy, keys }) => {
            const { onSort } = this.props;
            const defaultHeaderCellRenderer = getDefaultHeaderCellRenderer((columnKey, order) => {
                this.setState({
                    sorting: {
                        columnKey,
                        order,
                    },
                }, () => {
                    if (typeof onSort === 'function') {
                        onSort({
                            column: keys.indexOf(columnKey),
                            key: columnKey,
                            order,
                        });
                    }
                });
            });
            const { indexed, theme, headerCellRenderer = defaultHeaderCellRenderer } = this.props;
            return (React.createElement(StyledTableHead, { theme: theme },
                React.createElement(StyledTableHeaderRow, { theme: theme },
                    indexed && (React.createElement(StyledTableHeader, { onClick: e => this.headerClicked(e, -1, '#'), theme: theme }, headerCellRenderer({
                        column: -1,
                        key: '',
                        row: -1,
                        value: '#',
                        render: defaultHeaderCellRenderer,
                    }))),
                    keys.map((key, cell) => {
                        const column = columns[key];
                        const hidden = typeof column !== 'string' && column.hidden;
                        if (!hidden) {
                            const name = typeof column === 'string' ? column : column.header;
                            const width = typeof column === 'string' ? undefined : column.width;
                            const sortable = this.isSortable(key, columns);
                            const direction = sortable && sortBy && (sortBy.columnKey !== key ? undefined : sortBy.order);
                            return (React.createElement(StyledTableHeader, { sortable: sortable, width: width, key: key, onClick: e => this.headerClicked(e, cell, key), theme: theme }, headerCellRenderer({
                                column: cell,
                                key,
                                row: -1,
                                sorting: direction,
                                value: name,
                                render: defaultHeaderCellRenderer,
                            })));
                        }
                        return React.createElement(HiddenCell, { key: key });
                    }))));
        };
        this.defaultFootRenderer = ({ columns, keys, sortBy }) => {
            const { indexed, theme, footerCellRenderer = defaultCellRenderer } = this.props;
            return (React.createElement(StyledTableFoot, { theme: theme },
                React.createElement(StyledTableRow, { theme: theme },
                    indexed && (React.createElement(StyledTableCell, { onClick: e => this.footerClicked(e, -1, '#'), theme: theme }, footerCellRenderer({
                        column: -1,
                        key: '',
                        row: -1,
                        value: '',
                        render: defaultCellRenderer,
                    }))),
                    keys.map((key, i) => {
                        const column = columns[key];
                        const sortable = this.isSortable(key, columns);
                        const direction = sortable && sortBy && (sortBy.columnKey !== key ? undefined : sortBy.order);
                        const hidden = typeof column !== 'string' && column.hidden;
                        if (!hidden) {
                            const name = typeof column === 'string' ? undefined : column.footer;
                            return (React.createElement(StyledTableCell, { key: key, theme: theme, onClick: e => this.footerClicked(e, i, key) }, footerCellRenderer({
                                column: i,
                                key,
                                row: -1,
                                value: name,
                                sorting: direction,
                                render: defaultCellRenderer,
                            })));
                        }
                        return React.createElement(HiddenCell, { key: key });
                    }))));
        };
        this.defaultRowRenderer = ({ cells, index }) => {
            const { theme } = this.props;
            return (React.createElement(StyledTableRow, { key: index, theme: theme }, cells));
        };
        this.state = {
            controlledSorting: false,
        };
    }
    static getDerivedStateFromProps(props, state) {
        const controlledSorting = props.sortBy !== undefined || state.controlledSorting;
        if (controlledSorting) {
            return {
                sorting: normalizeSortBy(props.sortBy),
                controlledSorting,
            };
        }
        return state;
    }
    isSortable(key, cols) {
        const { sortBy } = this.props;
        const col = cols[key];
        return !sortBy && (!col || (typeof col !== 'string' && col.sortable));
    }
    headerClicked(e, column, key) {
        const { onHeaderClick, onSort, data = [], columns } = this.props;
        e.preventDefault();
        if (typeof onHeaderClick === 'function') {
            onHeaderClick({
                column,
                key,
                row: -1,
            });
        }
        else if (this.isSortable(key, getColumns(data, columns))) {
            this.setState(({ sorting }) => {
                const isAscending = sorting && sorting.order === 'descending' && sorting.columnKey === key;
                const order = sorting && sorting.columnKey === key ? 'descending' : 'ascending';
                let newSortingValue = undefined;
                if (!isAscending && column !== -1) {
                    newSortingValue = {
                        columnKey: key,
                        order,
                    };
                }
                return { sorting: newSortingValue };
            }, () => {
                if (typeof onSort === 'function') {
                    onSort({
                        column,
                        key,
                        order: this.state.sorting && this.state.sorting.order,
                    });
                }
            });
        }
    }
    footerClicked(e, column, key) {
        e.preventDefault();
        const { onFooterClick } = this.props;
        if (typeof onFooterClick === 'function') {
            onFooterClick({
                column,
                key,
                row: -1,
            });
        }
    }
    renderCells(keys, rowIndex) {
        const { data = [], cellRenderer = defaultCellRenderer, indexed, theme, columns, onDataClick } = this.props;
        const cols = getColumns(data, columns);
        const row = data[rowIndex];
        const cells = keys.map((key, cell) => {
            const column = cols[key];
            const hidden = typeof column !== 'string' && column.hidden;
            if (!hidden) {
                return (React.createElement(StyledTableCell, { key: key, onClick: handleDataClickedEvent({ row: rowIndex, column: cell, key, data: row }, onDataClick), theme: theme }, cellRenderer({
                    column: cell,
                    key,
                    data: row,
                    row: rowIndex,
                    value: row[key],
                    render: defaultCellRenderer,
                })));
            }
            return React.createElement(HiddenCell, { key: key });
        });
        if (indexed) {
            cells.unshift(React.createElement(StyledTableCell, { key: "index#", onClick: handleDataClickedEvent({ row: rowIndex, column: -1, key: '__indexed', data: row }, onDataClick), theme: theme }, rowIndex + 1));
        }
        return cells;
    }
    renderRows(keys) {
        const { data, groupBy, indexed, placeholder, rowRenderer = this.defaultRowRenderer, getRowKey = defaultRowKeyGetter, theme, } = this.props;
        const indices = this.getIndices(data, groupBy, this.state.sorting);
        const cols = keys.length + (indexed ? 1 : 0);
        const state = {};
        if (indices.length === 0) {
            return placeholder
                ? [
                    React.createElement(StyledTableRow, { theme: theme, key: "placeholder" },
                        React.createElement(StyledPlaceholderCell, { colSpan: cols, theme: theme }, placeholder)),
                ]
                : [];
        }
        else {
            return indices.map(index => {
                const cells = this.renderCells(keys, index);
                const renderData = { theme, index, cells, data: data[index], key: index.toString(), state };
                renderData.key = getRowKey(renderData);
                return rowRenderer(renderData);
            });
        }
    }
    renderHead(keys) {
        const { headRenderer = this.defaultHeadRenderer, groupBy, data = [], columns } = this.props;
        const { sorting } = this.state;
        return headRenderer({
            columns: getColumns(data, columns),
            sortBy: sorting,
            groupBy,
            data,
            keys,
        });
    }
    renderFoot(keys) {
        const { footRenderer = this.defaultFootRenderer, groupBy, data = [], columns } = this.props;
        const { sorting } = this.state;
        return footRenderer({
            columns: getColumns(data, columns),
            sortBy: sorting,
            groupBy,
            data,
            keys,
        });
    }
    render() {
        const _a = this.props, { data = [], columns, noHeader, theme, bodyRenderer = defaultBodyRenderer, cellRenderer: _1, indexed: _2, sortBy: _3, onDataClick: _4, onFooterClick: _5, onHeaderClick: _6, placeholder: _7, columns: _8, groupBy: _9, headRenderer: _10, footRenderer: _11, headerCellRenderer: _12, footerCellRenderer: _13, onSort: _14 } = _a, props = __rest(_a, ["data", "columns", "noHeader", "theme", "bodyRenderer", "cellRenderer", "indexed", "sortBy", "onDataClick", "onFooterClick", "onHeaderClick", "placeholder", "columns", "groupBy", "headRenderer", "footRenderer", "headerCellRenderer", "footerCellRenderer", "onSort"]);
        const cols = getColumns(data, columns);
        const keys = Object.keys(cols);
        const showFooter = keys.filter(key => {
            const col = cols[key];
            return typeof col === 'object' && !!col.footer && !col.hidden;
        }).length > 0;
        const rows = this.renderRows(keys);
        return bodyRenderer({
            table: TableHost,
            props: Object.assign({ theme, head: !noHeader && this.renderHead(keys), foot: showFooter && this.renderFoot(keys) }, props),
            rows,
            mode: 'table',
        });
    }
}
TableBasic.inner = {
    get StyledTableHead() { return StyledTableHead; },
    get StyledTableHeaderRow() { return StyledTableHeaderRow; },
    get StyledTableHeader() { return StyledTableHeader; },
    get HiddenCell() { return HiddenCell; },
    get StyledTableFoot() { return StyledTableFoot; },
    get StyledTableRow() { return StyledTableRow; },
    get StyledTableCell() { return StyledTableCell; },
    get StyledPlaceholderCell() { return StyledPlaceholderCell; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGFibGVCYXNpYy5wYXJ0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVGFibGUvVGFibGVCYXNpYy5wYXJ0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLE9BQU8sTUFBTSxhQUFhLENBQUM7QUFDbEMsT0FBTyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDekQsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUcxQyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsZUFBZSxFQUFFLG9CQUFvQixFQUFFLGlCQUFpQixFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsbUJBQW1CLEVBQUUsVUFBVSxFQUFFLDRCQUE0QixFQUFFLHNCQUFzQixHQUFHLE1BQU0sb0JBQW9CLENBQUM7QUFDNU8sT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBU2hELE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQW1CLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDO01BQzlGLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFDOztvQkFFdkMsS0FBSyxDQUFDLFdBQVc7OzthQUd4QixLQUFLLENBQUMsS0FBSztjQUNWLFVBQVUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVzs7OztpQkFJcEMsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxLQUFLLElB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VUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLE9BQU8sWUFBWSxDQUFDO1lBQ2hCLEtBQUssRUFBRSxTQUFTO1lBQ2hCLEtBQUssa0JBQ0QsS0FBSyxFQUNMLElBQUksRUFBRSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUN4QyxJQUFJLEVBQUUsVUFBVSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQ3RDLEtBQUssQ0FDWDtZQUNELElBQUk7WUFDSixJQUFJLEVBQUUsT0FBTztTQUNoQixDQUFDLENBQUM7SUFDUCxDQUFDOztBQUNNLGdCQUFLLEdBQUc7SUFDWCxJQUFJLGVBQWUsS0FBSyxPQUFPLGVBQXlDLENBQUMsQ0FBQyxDQUFDO0lBQzNFLElBQUksb0JBQW9CLEtBQUssT0FBTyxvQkFBbUQsQ0FBQyxDQUFDLENBQUM7SUFDMUYsSUFBSSxpQkFBaUIsS0FBSyxPQUFPLGlCQUE2QyxDQUFDLENBQUMsQ0FBQztJQUNqRixJQUFJLFVBQVUsS0FBSyxPQUFPLFVBQStCLENBQUMsQ0FBQyxDQUFDO0lBQzVELElBQUksZUFBZSxLQUFLLE9BQU8sZUFBeUMsQ0FBQyxDQUFDLENBQUM7SUFDM0UsSUFBSSxjQUFjLEtBQUssT0FBTyxjQUF1QyxDQUFDLENBQUMsQ0FBQztJQUN4RSxJQUFJLGVBQWUsS0FBSyxPQUFPLGVBQXlDLENBQUMsQ0FBQyxDQUFDO0lBQzNFLElBQUkscUJBQXFCLEtBQUssT0FBTyxxQkFBcUQsQ0FBQyxDQUFDLENBQUM7Q0FDaEcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBtZW1vaXplIGZyb20gJ21lbW9pemUtb25lJztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkLCBjc3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgc29ydE9iamVjdExpc3QgfSBmcm9tICcuLi8uLi91dGlscy9zb3J0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgUmVmUHJvcHMsIFN0YW5kYXJkUHJvcHMgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgVGFibGVSb3dFdmVudCwgVGFibGVQcm9wcywgVGFibGVTb3J0aW5nLCBUYWJsZUNvbHVtbnMsIFRhYmxlU2VjdGlvblJlbmRlckV2ZW50IH0gZnJvbSAnLi9UYWJsZS50eXBlcy5wYXJ0JztcbmltcG9ydCB7IGRlZmF1bHRDZWxsUmVuZGVyZXIsIFN0eWxlZFRhYmxlSGVhZCwgU3R5bGVkVGFibGVIZWFkZXJSb3csIFN0eWxlZFRhYmxlSGVhZGVyLCBTdHlsZWRUYWJsZVJvdywgU3R5bGVkVGFibGVGb290LCBkZWZhdWx0Qm9keVJlbmRlcmVyLCBnZXRDb2x1bW5zLCBnZXREZWZhdWx0SGVhZGVyQ2VsbFJlbmRlcmVyLCBoYW5kbGVEYXRhQ2xpY2tlZEV2ZW50LCB9IGZyb20gJy4vVGFibGVTaGFyZWQucGFydCc7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmV4cG9ydCBpbnRlcmZhY2UgVGFibGVCYXNpY1N0YXRlIHtcbiAgICBzb3J0aW5nPzogVGFibGVTb3J0aW5nO1xuICAgIGNvbnRyb2xsZWRTb3J0aW5nOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIFN0eWxlZFRhYmxlUHJvcHMge1xuICAgIGNvbmRlbnNlZD86IGJvb2xlYW47XG4gICAgYm9yZGVybGVzcz86IGJvb2xlYW47XG59XG5jb25zdCBTdHlsZWRUYWJsZSA9IHN0eWxlZC50YWJsZTxTdHlsZWRUYWJsZVByb3BzPih0aGVtZWQoKHsgdGhlbWUsIGJvcmRlcmxlc3MsIGNvbmRlbnNlZCB9KSA9PiBjc3MgYFxuICAgICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ3NtYWxsJywgbGluZUhlaWdodDogJ3hTbWFsbCcgfSl9XG5cbiAgICB0YWJsZS1sYXlvdXQ6ICR7dGhlbWUudGFibGVMYXlvdXR9O1xuICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7XG4gICAgd2lkdGg6IDEwMCU7XG4gICAgY29sb3I6ICR7dGhlbWUudGV4dDZ9O1xuICAgIGJvcmRlcjogJHtib3JkZXJsZXNzID8gJ25vbmUnIDogdGhlbWUudGFibGVCb3JkZXJ9O1xuXG4gICAgPiB0aGVhZCA+IHRyID4gdGgsXG4gICAgPiB0Ym9keSA+IHRyID4gdGQge1xuICAgICAgcGFkZGluZzogJHtjb25kZW5zZWQgPyBgJHtkaXN0YW5jZS5zbWFsbH0gJHtkaXN0YW5jZS5sYXJnZX1gIDogdGhlbWUudGFibGVIZWFkUGFkZGluZ307XG5cbiAgICAgICY6bm90KDpsYXN0LWNoaWxkKSB7XG4gICAgICAgIHBhZGRpbmctcmlnaHQ6IDA7XG4gICAgICB9XG4gICAgfVxuICAgIGApKTtcbmNvbnN0IFN0eWxlZFRhYmxlQm9keSA9IHN0eWxlZC50Ym9keSBgYDtcbmludGVyZmFjZSBUYWJsZUhvc3RQcm9wcyBleHRlbmRzIFN0YW5kYXJkUHJvcHMge1xuICAgIGhlYWQ6IFJlYWN0LlJlYWN0Tm9kZTtcbiAgICBmb290OiBSZWFjdC5SZWFjdE5vZGU7XG59XG5jb25zdCBUYWJsZUhvc3QgPSBPYmplY3QuYXNzaWduKCgoKHsgaGVhZCwgZm9vdCwgdGhlbWUsIGNoaWxkcmVuLCAuLi5wcm9wcyB9KSA9PiAoPFN0eWxlZFRhYmxlIHRoZW1lPXt0aGVtZX0gey4uLnByb3BzfT5cbiAgICB7aGVhZH1cbiAgICA8U3R5bGVkVGFibGVCb2R5IHRoZW1lPXt0aGVtZX0+e2NoaWxkcmVufTwvU3R5bGVkVGFibGVCb2R5PlxuICAgIHtmb290fVxuICA8L1N0eWxlZFRhYmxlPikpIGFzIFJlYWN0LlNGQzxUYWJsZUhvc3RQcm9wcz4pLCB7IGlubmVyOiB7XG4gICAgICAgIGdldCBTdHlsZWRUYWJsZSgpIHsgcmV0dXJuIFN0eWxlZFRhYmxlIGFzIHR5cGVvZiBTdHlsZWRUYWJsZTsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZFRhYmxlQm9keSgpIHsgcmV0dXJuIFN0eWxlZFRhYmxlQm9keSBhcyB0eXBlb2YgU3R5bGVkVGFibGVCb2R5OyB9XG4gICAgfSB9KTtcbmNvbnN0IEhpZGRlbkNlbGwgPSBzdHlsZWQudGQgYFxuICBkaXNwbGF5OiBub25lO1xuYDtcbmNvbnN0IFN0eWxlZFRhYmxlQ2VsbCA9IHN0eWxlZC50ZCBgXG4gIHRleHQtYWxpZ246IGxlZnQ7XG5gO1xuY29uc3QgU3R5bGVkUGxhY2Vob2xkZXJDZWxsID0gc3R5bGVkKFN0eWxlZFRhYmxlQ2VsbCkgYFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG5gO1xuZnVuY3Rpb24gZGVmYXVsdFJvd0tleUdldHRlcjxUPih7IGtleSB9OiBUYWJsZVJvd0V2ZW50PFQ+KSB7XG4gICAgcmV0dXJuIGtleTtcbn1cbmZ1bmN0aW9uIG5vcm1hbGl6ZVNvcnRCeShzb3J0Qnk/OiBUYWJsZVNvcnRpbmcgfCBzdHJpbmcpOiBUYWJsZVNvcnRpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmICghc29ydEJ5KSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygc29ydEJ5ID09PSAnc3RyaW5nJykge1xuICAgICAgICBpZiAoc29ydEJ5WzBdID09PSAnLScpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgY29sdW1uS2V5OiBzb3J0Qnkuc3Vic3RyKDEpLFxuICAgICAgICAgICAgICAgIG9yZGVyOiAnZGVzY2VuZGluZycsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBjb2x1bW5LZXk6IHNvcnRCeSxcbiAgICAgICAgICAgICAgICBvcmRlcjogJ2FzY2VuZGluZycsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGNvbHVtbktleTogc29ydEJ5LmNvbHVtbktleSxcbiAgICAgICAgb3JkZXI6IHNvcnRCeS5vcmRlciB8fCAnYXNjZW5kaW5nJyxcbiAgICB9O1xufVxuZXhwb3J0IGNsYXNzIFRhYmxlQmFzaWM8VD4gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8VGFibGVQcm9wczxUPiAmIFJlZlByb3BzLCBUYWJsZUJhc2ljU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVGFibGVQcm9wczxUPiAmIFJlZlByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZWRTb3J0aW5nOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wczogVGFibGVQcm9wczxhbnk+LCBzdGF0ZTogVGFibGVCYXNpY1N0YXRlKSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZWRTb3J0aW5nID0gcHJvcHMuc29ydEJ5ICE9PSB1bmRlZmluZWQgfHwgc3RhdGUuY29udHJvbGxlZFNvcnRpbmc7XG4gICAgICAgIGlmIChjb250cm9sbGVkU29ydGluZykge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzb3J0aW5nOiBub3JtYWxpemVTb3J0QnkocHJvcHMuc29ydEJ5KSxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVkU29ydGluZyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cbiAgICBwcml2YXRlIGdldEluZGljZXMgPSBtZW1vaXplKChkYXRhOiBBcnJheTxUPiwgZ3JvdXBpbmc/OiBrZXlvZiBULCBzb3J0aW5nPzogVGFibGVTb3J0aW5nKSA9PiBzb3J0aW5nXG4gICAgICAgID8gc29ydE9iamVjdExpc3QoZGF0YSwgc29ydGluZy5jb2x1bW5LZXkgYXMga2V5b2YgVCwgc29ydGluZy5vcmRlciwgZ3JvdXBpbmcpXG4gICAgICAgIDogc29ydE9iamVjdExpc3QoZGF0YSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGdyb3VwaW5nKSk7XG4gICAgcHJpdmF0ZSBpc1NvcnRhYmxlKGtleTogc3RyaW5nLCBjb2xzOiBUYWJsZUNvbHVtbnMpIHtcbiAgICAgICAgY29uc3QgeyBzb3J0QnkgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGNvbCA9IGNvbHNba2V5XTtcbiAgICAgICAgcmV0dXJuICFzb3J0QnkgJiYgKCFjb2wgfHwgKHR5cGVvZiBjb2wgIT09ICdzdHJpbmcnICYmIGNvbC5zb3J0YWJsZSkpO1xuICAgIH1cbiAgICBwcml2YXRlIGhlYWRlckNsaWNrZWQoZTogUmVhY3QuTW91c2VFdmVudDxIVE1MVGFibGVDZWxsRWxlbWVudD4sIGNvbHVtbjogbnVtYmVyLCBrZXk6IHN0cmluZykge1xuICAgICAgICBjb25zdCB7IG9uSGVhZGVyQ2xpY2ssIG9uU29ydCwgZGF0YSA9IFtdLCBjb2x1bW5zIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICh0eXBlb2Ygb25IZWFkZXJDbGljayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25IZWFkZXJDbGljayh7XG4gICAgICAgICAgICAgICAgY29sdW1uLFxuICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICByb3c6IC0xLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5pc1NvcnRhYmxlKGtleSwgZ2V0Q29sdW1ucyhkYXRhLCBjb2x1bW5zKSkpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoKHsgc29ydGluZyB9KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNBc2NlbmRpbmcgPSBzb3J0aW5nICYmIHNvcnRpbmcub3JkZXIgPT09ICdkZXNjZW5kaW5nJyAmJiBzb3J0aW5nLmNvbHVtbktleSA9PT0ga2V5O1xuICAgICAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gc29ydGluZyAmJiBzb3J0aW5nLmNvbHVtbktleSA9PT0ga2V5ID8gJ2Rlc2NlbmRpbmcnIDogJ2FzY2VuZGluZyc7XG4gICAgICAgICAgICAgICAgbGV0IG5ld1NvcnRpbmdWYWx1ZTogVGFibGVTb3J0aW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmICghaXNBc2NlbmRpbmcgJiYgY29sdW1uICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBuZXdTb3J0aW5nVmFsdWUgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5LZXk6IGtleSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yZGVyLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4geyBzb3J0aW5nOiBuZXdTb3J0aW5nVmFsdWUgfTtcbiAgICAgICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9uU29ydCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBvblNvcnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXI6IHRoaXMuc3RhdGUuc29ydGluZyAmJiB0aGlzLnN0YXRlLnNvcnRpbmcub3JkZXIsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgZm9vdGVyQ2xpY2tlZChlOiBSZWFjdC5Nb3VzZUV2ZW50PEhUTUxUYWJsZUNlbGxFbGVtZW50PiwgY29sdW1uOiBudW1iZXIsIGtleTogc3RyaW5nKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgeyBvbkZvb3RlckNsaWNrIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAodHlwZW9mIG9uRm9vdGVyQ2xpY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uRm9vdGVyQ2xpY2soe1xuICAgICAgICAgICAgICAgIGNvbHVtbixcbiAgICAgICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAgICAgcm93OiAtMSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgZGVmYXVsdEhlYWRSZW5kZXJlciA9ICh7IGNvbHVtbnMsIHNvcnRCeSwga2V5cyB9OiBUYWJsZVNlY3Rpb25SZW5kZXJFdmVudDxUPikgPT4ge1xuICAgICAgICBjb25zdCB7IG9uU29ydCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgZGVmYXVsdEhlYWRlckNlbGxSZW5kZXJlciA9IGdldERlZmF1bHRIZWFkZXJDZWxsUmVuZGVyZXIoKGNvbHVtbktleSwgb3JkZXIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHNvcnRpbmc6IHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uS2V5LFxuICAgICAgICAgICAgICAgICAgICBvcmRlcixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb25Tb3J0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uU29ydCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46IGtleXMuaW5kZXhPZihjb2x1bW5LZXkpLFxuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBjb2x1bW5LZXksXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmRlcixcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB7IGluZGV4ZWQsIHRoZW1lLCBoZWFkZXJDZWxsUmVuZGVyZXIgPSBkZWZhdWx0SGVhZGVyQ2VsbFJlbmRlcmVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gKDxTdHlsZWRUYWJsZUhlYWQgdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgPFN0eWxlZFRhYmxlSGVhZGVyUm93IHRoZW1lPXt0aGVtZX0+XG4gICAgICAgICAge2luZGV4ZWQgJiYgKDxTdHlsZWRUYWJsZUhlYWRlciBvbkNsaWNrPXtlID0+IHRoaXMuaGVhZGVyQ2xpY2tlZChlLCAtMSwgJyMnKX0gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgICAge2hlYWRlckNlbGxSZW5kZXJlcih7XG4gICAgICAgICAgICBjb2x1bW46IC0xLFxuICAgICAgICAgICAga2V5OiAnJyxcbiAgICAgICAgICAgIHJvdzogLTEsXG4gICAgICAgICAgICB2YWx1ZTogJyMnLFxuICAgICAgICAgICAgcmVuZGVyOiBkZWZhdWx0SGVhZGVyQ2VsbFJlbmRlcmVyLFxuICAgICAgICB9KX1cbiAgICAgICAgICAgIDwvU3R5bGVkVGFibGVIZWFkZXI+KX1cbiAgICAgICAgICB7a2V5cy5tYXAoKGtleSwgY2VsbCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29sdW1uID0gY29sdW1uc1trZXldO1xuICAgICAgICAgICAgY29uc3QgaGlkZGVuID0gdHlwZW9mIGNvbHVtbiAhPT0gJ3N0cmluZycgJiYgY29sdW1uLmhpZGRlbjtcbiAgICAgICAgICAgIGlmICghaGlkZGVuKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHR5cGVvZiBjb2x1bW4gPT09ICdzdHJpbmcnID8gY29sdW1uIDogY29sdW1uLmhlYWRlcjtcbiAgICAgICAgICAgICAgICBjb25zdCB3aWR0aCA9IHR5cGVvZiBjb2x1bW4gPT09ICdzdHJpbmcnID8gdW5kZWZpbmVkIDogY29sdW1uLndpZHRoO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRhYmxlID0gdGhpcy5pc1NvcnRhYmxlKGtleSwgY29sdW1ucyk7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gc29ydGFibGUgJiYgc29ydEJ5ICYmIChzb3J0QnkuY29sdW1uS2V5ICE9PSBrZXkgPyB1bmRlZmluZWQgOiBzb3J0Qnkub3JkZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiAoPFN0eWxlZFRhYmxlSGVhZGVyIHNvcnRhYmxlPXtzb3J0YWJsZX0gd2lkdGg9e3dpZHRofSBrZXk9e2tleX0gb25DbGljaz17ZSA9PiB0aGlzLmhlYWRlckNsaWNrZWQoZSwgY2VsbCwga2V5KX0gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgICAgICAgIHtoZWFkZXJDZWxsUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW46IGNlbGwsXG4gICAgICAgICAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICAgICAgICAgcm93OiAtMSxcbiAgICAgICAgICAgICAgICAgICAgc29ydGluZzogZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyOiBkZWZhdWx0SGVhZGVyQ2VsbFJlbmRlcmVyLFxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgIDwvU3R5bGVkVGFibGVIZWFkZXI+KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiA8SGlkZGVuQ2VsbCBrZXk9e2tleX0vPjtcbiAgICAgICAgfSl9XG4gICAgICAgIDwvU3R5bGVkVGFibGVIZWFkZXJSb3c+XG4gICAgICA8L1N0eWxlZFRhYmxlSGVhZD4pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBkZWZhdWx0Rm9vdFJlbmRlcmVyID0gKHsgY29sdW1ucywga2V5cywgc29ydEJ5IH06IFRhYmxlU2VjdGlvblJlbmRlckV2ZW50PFQ+KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaW5kZXhlZCwgdGhlbWUsIGZvb3RlckNlbGxSZW5kZXJlciA9IGRlZmF1bHRDZWxsUmVuZGVyZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHJldHVybiAoPFN0eWxlZFRhYmxlRm9vdCB0aGVtZT17dGhlbWV9PlxuICAgICAgICA8U3R5bGVkVGFibGVSb3cgdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICB7aW5kZXhlZCAmJiAoPFN0eWxlZFRhYmxlQ2VsbCBvbkNsaWNrPXtlID0+IHRoaXMuZm9vdGVyQ2xpY2tlZChlLCAtMSwgJyMnKX0gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgICAge2Zvb3RlckNlbGxSZW5kZXJlcih7XG4gICAgICAgICAgICBjb2x1bW46IC0xLFxuICAgICAgICAgICAga2V5OiAnJyxcbiAgICAgICAgICAgIHJvdzogLTEsXG4gICAgICAgICAgICB2YWx1ZTogJycsXG4gICAgICAgICAgICByZW5kZXI6IGRlZmF1bHRDZWxsUmVuZGVyZXIsXG4gICAgICAgIH0pfVxuICAgICAgICAgICAgPC9TdHlsZWRUYWJsZUNlbGw+KX1cbiAgICAgICAgICB7a2V5cy5tYXAoKGtleSwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29sdW1uID0gY29sdW1uc1trZXldO1xuICAgICAgICAgICAgY29uc3Qgc29ydGFibGUgPSB0aGlzLmlzU29ydGFibGUoa2V5LCBjb2x1bW5zKTtcbiAgICAgICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHNvcnRhYmxlICYmIHNvcnRCeSAmJiAoc29ydEJ5LmNvbHVtbktleSAhPT0ga2V5ID8gdW5kZWZpbmVkIDogc29ydEJ5Lm9yZGVyKTtcbiAgICAgICAgICAgIGNvbnN0IGhpZGRlbiA9IHR5cGVvZiBjb2x1bW4gIT09ICdzdHJpbmcnICYmIGNvbHVtbi5oaWRkZW47XG4gICAgICAgICAgICBpZiAoIWhpZGRlbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0eXBlb2YgY29sdW1uID09PSAnc3RyaW5nJyA/IHVuZGVmaW5lZCA6IGNvbHVtbi5mb290ZXI7XG4gICAgICAgICAgICAgICAgcmV0dXJuICg8U3R5bGVkVGFibGVDZWxsIGtleT17a2V5fSB0aGVtZT17dGhlbWV9IG9uQ2xpY2s9e2UgPT4gdGhpcy5mb290ZXJDbGlja2VkKGUsIGksIGtleSl9PlxuICAgICAgICAgICAgICAgICAge2Zvb3RlckNlbGxSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbjogaSxcbiAgICAgICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgICAgICByb3c6IC0xLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc29ydGluZzogZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICByZW5kZXI6IGRlZmF1bHRDZWxsUmVuZGVyZXIsXG4gICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgPC9TdHlsZWRUYWJsZUNlbGw+KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiA8SGlkZGVuQ2VsbCBrZXk9e2tleX0vPjtcbiAgICAgICAgfSl9XG4gICAgICAgIDwvU3R5bGVkVGFibGVSb3c+XG4gICAgICA8L1N0eWxlZFRhYmxlRm9vdD4pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBkZWZhdWx0Um93UmVuZGVyZXIgPSAoeyBjZWxscywgaW5kZXggfTogVGFibGVSb3dFdmVudDxUPikgPT4ge1xuICAgICAgICBjb25zdCB7IHRoZW1lIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gKDxTdHlsZWRUYWJsZVJvdyBrZXk9e2luZGV4fSB0aGVtZT17dGhlbWV9PlxuICAgICAgICB7Y2VsbHN9XG4gICAgICA8L1N0eWxlZFRhYmxlUm93Pik7XG4gICAgfTtcbiAgICBwcml2YXRlIHJlbmRlckNlbGxzKGtleXM6IEFycmF5PHN0cmluZz4sIHJvd0luZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhID0gW10sIGNlbGxSZW5kZXJlciA9IGRlZmF1bHRDZWxsUmVuZGVyZXIsIGluZGV4ZWQsIHRoZW1lLCBjb2x1bW5zLCBvbkRhdGFDbGljayB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgY29scyA9IGdldENvbHVtbnMoZGF0YSwgY29sdW1ucyk7XG4gICAgICAgIGNvbnN0IHJvdyA9IGRhdGFbcm93SW5kZXhdO1xuICAgICAgICBjb25zdCBjZWxscyA9IGtleXMubWFwKChrZXksIGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IGNvbHNba2V5XTtcbiAgICAgICAgICAgIGNvbnN0IGhpZGRlbiA9IHR5cGVvZiBjb2x1bW4gIT09ICdzdHJpbmcnICYmIGNvbHVtbi5oaWRkZW47XG4gICAgICAgICAgICBpZiAoIWhpZGRlbikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoPFN0eWxlZFRhYmxlQ2VsbCBrZXk9e2tleX0gb25DbGljaz17aGFuZGxlRGF0YUNsaWNrZWRFdmVudCh7IHJvdzogcm93SW5kZXgsIGNvbHVtbjogY2VsbCwga2V5LCBkYXRhOiByb3cgfSwgb25EYXRhQ2xpY2spfSB0aGVtZT17dGhlbWV9PlxuICAgICAgICAgICAge2NlbGxSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbjogY2VsbCxcbiAgICAgICAgICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiByb3csXG4gICAgICAgICAgICAgICAgICAgIHJvdzogcm93SW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiByb3dba2V5XSxcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyOiBkZWZhdWx0Q2VsbFJlbmRlcmVyLFxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgIDwvU3R5bGVkVGFibGVDZWxsPik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gPEhpZGRlbkNlbGwga2V5PXtrZXl9Lz47XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoaW5kZXhlZCkge1xuICAgICAgICAgICAgY2VsbHMudW5zaGlmdCg8U3R5bGVkVGFibGVDZWxsIGtleT1cImluZGV4I1wiIG9uQ2xpY2s9e2hhbmRsZURhdGFDbGlja2VkRXZlbnQoeyByb3c6IHJvd0luZGV4LCBjb2x1bW46IC0xLCBrZXk6ICdfX2luZGV4ZWQnLCBkYXRhOiByb3cgfSwgb25EYXRhQ2xpY2spfSB0aGVtZT17dGhlbWV9PlxuICAgICAgICAgIHtyb3dJbmRleCArIDF9XG4gICAgICAgIDwvU3R5bGVkVGFibGVDZWxsPik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNlbGxzO1xuICAgIH1cbiAgICBwcml2YXRlIHJlbmRlclJvd3Moa2V5czogQXJyYXk8c3RyaW5nPikge1xuICAgICAgICBjb25zdCB7IGRhdGEsIGdyb3VwQnksIGluZGV4ZWQsIHBsYWNlaG9sZGVyLCByb3dSZW5kZXJlciA9IHRoaXMuZGVmYXVsdFJvd1JlbmRlcmVyLCBnZXRSb3dLZXkgPSBkZWZhdWx0Um93S2V5R2V0dGVyLCB0aGVtZSwgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGluZGljZXMgPSB0aGlzLmdldEluZGljZXMoZGF0YSwgZ3JvdXBCeSwgdGhpcy5zdGF0ZS5zb3J0aW5nKTtcbiAgICAgICAgY29uc3QgY29scyA9IGtleXMubGVuZ3RoICsgKGluZGV4ZWQgPyAxIDogMCk7XG4gICAgICAgIGNvbnN0IHN0YXRlID0ge307XG4gICAgICAgIGlmIChpbmRpY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHBsYWNlaG9sZGVyXG4gICAgICAgICAgICAgICAgPyBbXG4gICAgICAgICAgICAgICAgICAgIDxTdHlsZWRUYWJsZVJvdyB0aGVtZT17dGhlbWV9IGtleT1cInBsYWNlaG9sZGVyXCI+XG4gICAgICAgICAgICAgIDxTdHlsZWRQbGFjZWhvbGRlckNlbGwgY29sU3Bhbj17Y29sc30gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgICAgICB7cGxhY2Vob2xkZXJ9XG4gICAgICAgICAgICAgIDwvU3R5bGVkUGxhY2Vob2xkZXJDZWxsPlxuICAgICAgICAgICAgPC9TdHlsZWRUYWJsZVJvdz4sXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIDogW107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gaW5kaWNlcy5tYXAoaW5kZXggPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxzID0gdGhpcy5yZW5kZXJDZWxscyhrZXlzLCBpbmRleCk7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyRGF0YSA9IHsgdGhlbWUsIGluZGV4LCBjZWxscywgZGF0YTogZGF0YVtpbmRleF0sIGtleTogaW5kZXgudG9TdHJpbmcoKSwgc3RhdGUgfTtcbiAgICAgICAgICAgICAgICByZW5kZXJEYXRhLmtleSA9IGdldFJvd0tleShyZW5kZXJEYXRhKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcm93UmVuZGVyZXIocmVuZGVyRGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIHJlbmRlckhlYWQoa2V5czogQXJyYXk8c3RyaW5nPikge1xuICAgICAgICBjb25zdCB7IGhlYWRSZW5kZXJlciA9IHRoaXMuZGVmYXVsdEhlYWRSZW5kZXJlciwgZ3JvdXBCeSwgZGF0YSA9IFtdLCBjb2x1bW5zIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHNvcnRpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiBoZWFkUmVuZGVyZXIoe1xuICAgICAgICAgICAgY29sdW1uczogZ2V0Q29sdW1ucyhkYXRhLCBjb2x1bW5zKSxcbiAgICAgICAgICAgIHNvcnRCeTogc29ydGluZyxcbiAgICAgICAgICAgIGdyb3VwQnksXG4gICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAga2V5cyxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgcmVuZGVyRm9vdChrZXlzOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgICAgIGNvbnN0IHsgZm9vdFJlbmRlcmVyID0gdGhpcy5kZWZhdWx0Rm9vdFJlbmRlcmVyLCBncm91cEJ5LCBkYXRhID0gW10sIGNvbHVtbnMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgc29ydGluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuIGZvb3RSZW5kZXJlcih7XG4gICAgICAgICAgICBjb2x1bW5zOiBnZXRDb2x1bW5zKGRhdGEsIGNvbHVtbnMpLFxuICAgICAgICAgICAgc29ydEJ5OiBzb3J0aW5nLFxuICAgICAgICAgICAgZ3JvdXBCeSxcbiAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICBrZXlzLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGRhdGEgPSBbXSwgY29sdW1ucywgbm9IZWFkZXIsIHRoZW1lLCBib2R5UmVuZGVyZXIgPSBkZWZhdWx0Qm9keVJlbmRlcmVyLCBjZWxsUmVuZGVyZXI6IF8xLCBpbmRleGVkOiBfMiwgc29ydEJ5OiBfMywgb25EYXRhQ2xpY2s6IF80LCBvbkZvb3RlckNsaWNrOiBfNSwgb25IZWFkZXJDbGljazogXzYsIHBsYWNlaG9sZGVyOiBfNywgY29sdW1uczogXzgsIGdyb3VwQnk6IF85LCBoZWFkUmVuZGVyZXI6IF8xMCwgZm9vdFJlbmRlcmVyOiBfMTEsIGhlYWRlckNlbGxSZW5kZXJlcjogXzEyLCBmb290ZXJDZWxsUmVuZGVyZXI6IF8xMywgb25Tb3J0OiBfMTQsIC4uLnByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBjb2xzID0gZ2V0Q29sdW1ucyhkYXRhLCBjb2x1bW5zKTtcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGNvbHMpO1xuICAgICAgICBjb25zdCBzaG93Rm9vdGVyID0ga2V5cy5maWx0ZXIoa2V5ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbCA9IGNvbHNba2V5XTtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgY29sID09PSAnb2JqZWN0JyAmJiAhIWNvbC5mb290ZXIgJiYgIWNvbC5oaWRkZW47XG4gICAgICAgIH0pLmxlbmd0aCA+IDA7XG4gICAgICAgIGNvbnN0IHJvd3MgPSB0aGlzLnJlbmRlclJvd3Moa2V5cyk7XG4gICAgICAgIHJldHVybiBib2R5UmVuZGVyZXIoe1xuICAgICAgICAgICAgdGFibGU6IFRhYmxlSG9zdCxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgICAgdGhlbWUsXG4gICAgICAgICAgICAgICAgaGVhZDogIW5vSGVhZGVyICYmIHRoaXMucmVuZGVySGVhZChrZXlzKSxcbiAgICAgICAgICAgICAgICBmb290OiBzaG93Rm9vdGVyICYmIHRoaXMucmVuZGVyRm9vdChrZXlzKSxcbiAgICAgICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByb3dzLFxuICAgICAgICAgICAgbW9kZTogJ3RhYmxlJyxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFN0eWxlZFRhYmxlSGVhZCgpIHsgcmV0dXJuIFN0eWxlZFRhYmxlSGVhZCBhcyB0eXBlb2YgU3R5bGVkVGFibGVIZWFkOyB9LFxuICAgICAgICBnZXQgU3R5bGVkVGFibGVIZWFkZXJSb3coKSB7IHJldHVybiBTdHlsZWRUYWJsZUhlYWRlclJvdyBhcyB0eXBlb2YgU3R5bGVkVGFibGVIZWFkZXJSb3c7IH0sXG4gICAgICAgIGdldCBTdHlsZWRUYWJsZUhlYWRlcigpIHsgcmV0dXJuIFN0eWxlZFRhYmxlSGVhZGVyIGFzIHR5cGVvZiBTdHlsZWRUYWJsZUhlYWRlcjsgfSxcbiAgICAgICAgZ2V0IEhpZGRlbkNlbGwoKSB7IHJldHVybiBIaWRkZW5DZWxsIGFzIHR5cGVvZiBIaWRkZW5DZWxsOyB9LFxuICAgICAgICBnZXQgU3R5bGVkVGFibGVGb290KCkgeyByZXR1cm4gU3R5bGVkVGFibGVGb290IGFzIHR5cGVvZiBTdHlsZWRUYWJsZUZvb3Q7IH0sXG4gICAgICAgIGdldCBTdHlsZWRUYWJsZVJvdygpIHsgcmV0dXJuIFN0eWxlZFRhYmxlUm93IGFzIHR5cGVvZiBTdHlsZWRUYWJsZVJvdzsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZFRhYmxlQ2VsbCgpIHsgcmV0dXJuIFN0eWxlZFRhYmxlQ2VsbCBhcyB0eXBlb2YgU3R5bGVkVGFibGVDZWxsOyB9LFxuICAgICAgICBnZXQgU3R5bGVkUGxhY2Vob2xkZXJDZWxsKCkgeyByZXR1cm4gU3R5bGVkUGxhY2Vob2xkZXJDZWxsIGFzIHR5cGVvZiBTdHlsZWRQbGFjZWhvbGRlckNlbGw7IH1cbiAgICB9O1xufVxuIl19