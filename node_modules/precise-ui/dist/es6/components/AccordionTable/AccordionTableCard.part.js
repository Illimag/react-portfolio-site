var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled from '../../utils/styled';
import { normalizeIndex, toggleIndex, hasIndex } from './helpers/indexHelper';
import { defaultCellRenderer } from '../Table/TableShared.part';
import { defaultBodyRenderer } from '../Table/TableCard.part';
import { AccordionCard } from '../AccordionCard';
import { ListItem } from '../ListItem';
import { List } from '../List';
import { distance } from '../../distance';
import { getFontStyle } from '../../textStyles';
const PropContainer = styled.div `
  margin-bottom: ${distance.medium};

  &:last-child {
    margin-bottom: 0;
  }
`;
const PropName = styled.div `
  ${getFontStyle({ size: 'xSmall' })}
`;
const PropValue = styled.div `
  ${getFontStyle({ weight: 'medium' })}
`;
const PlaceholderContainer = styled.div `
  text-align: center;
`;
const StyledList = styled(List) `
  overflow: visible;
`;
const StyledListItem = styled(ListItem) `
  padding: 0;
  margin-bottom: ${distance.xlarge};
  border: none;

  &:last-child {
    margin-bottom: 0;
  }
`;
const AccordionTableCardHost = Object.assign((props => React.createElement(StyledList, Object.assign({}, props))), { inner: {
        get StyledList() { return StyledList; }
    } });
export class AccordionTableCard extends React.Component {
    constructor(props) {
        super(props);
        this.renderItem = ({ item, index, open, keys, closeLabel, openLabel }) => {
            const { detailsRenderer, theme } = this.props;
            return (React.createElement(StyledListItem, { theme: theme, key: index },
                React.createElement(AccordionCard, { openLabel: openLabel, closeLabel: closeLabel, theme: theme, header: this.renderItemProps(item, keys, index), opened: open, onActionClick: () => this.handleClick(index, item) }, open && detailsRenderer && detailsRenderer({ data: item, index }))));
        };
        this.state = {
            selectedIndexes: normalizeIndex(props.selectedIndex),
            controlled: props.selectedIndex !== undefined,
        };
    }
    static getDerivedStateFromProps(props, state) {
        const { selectedIndex } = props;
        if (state.controlled && selectedIndex !== undefined) {
            return {
                selectedIndexes: normalizeIndex(props.selectedIndex),
            };
        }
        return state;
    }
    handleClick(target, data) {
        const { onChange, multiple } = this.props;
        const { controlled, selectedIndexes } = this.state;
        const nextIndexes = toggleIndex(selectedIndexes, target, multiple);
        if (typeof onChange === 'function') {
            onChange({
                selectedIndex: multiple ? nextIndexes : nextIndexes[0] !== undefined ? nextIndexes[0] : -1,
                previousIndex: multiple ? selectedIndexes : selectedIndexes[0] !== undefined ? selectedIndexes[0] : -1,
                data,
            });
        }
        if (!controlled) {
            this.setState({
                selectedIndexes: nextIndexes,
            });
        }
    }
    getHeader(key) {
        const { columns } = this.props;
        if (columns) {
            const column = columns[key];
            return typeof column === 'string' ? column : column.header;
        }
        return key;
    }
    renderItemProps(item, keys, row) {
        return keys.map((key, index) => this.renderItemProp(key, item[key], index, row));
    }
    renderItemProp(key, propValue, index, row) {
        const { cellRenderer = defaultCellRenderer } = this.props;
        const propKey = this.getHeader(key);
        return (React.createElement(PropContainer, { key: index },
            React.createElement(PropName, null, propKey),
            React.createElement(PropValue, null, cellRenderer({
                row,
                column: index,
                key,
                value: propValue,
                render: defaultCellRenderer,
            }))));
    }
    render() {
        const _a = this.props, { data = [], columns, placeholder, theme, cardRenderer = this.renderItem, bodyRenderer = defaultBodyRenderer, openLabel, closeLabel } = _a, props = __rest(_a, ["data", "columns", "placeholder", "theme", "cardRenderer", "bodyRenderer", "openLabel", "closeLabel"]);
        const keys = Object.keys(columns || data[0] || {});
        const rows = data.length === 0
            ? placeholder
                ? [
                    React.createElement(StyledListItem, { theme: theme, key: 0 },
                        React.createElement(PlaceholderContainer, { theme: theme }, placeholder)),
                ]
                : []
            : data.map((item, index) => cardRenderer({
                item,
                index,
                open: hasIndex(this.state.selectedIndexes, index),
                keys,
                openLabel,
                closeLabel,
            }));
        return bodyRenderer({
            rows,
            mode: 'card',
            props: Object.assign({ theme, borderless: true }, props),
            table: AccordionTableCardHost,
        });
    }
}
AccordionTableCard.inner = {
    get StyledListItem() { return StyledListItem; },
    get AccordionCard() { return AccordionCard; },
    get PropContainer() { return PropContainer; },
    get PropName() { return PropName; },
    get PropValue() { return PropValue; },
    get PlaceholderContainer() { return PlaceholderContainer; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjb3JkaW9uVGFibGVDYXJkLnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9BY2NvcmRpb25UYWJsZS9BY2NvcmRpb25UYWJsZUNhcmQucGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxNQUFNLE1BQU0sb0JBQW9CLENBQUM7QUFDeEMsT0FBTyxFQUFFLGNBQWMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFOUUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDaEUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDdkMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUMvQixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBV2hELE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7bUJBQ2QsUUFBUSxDQUFDLE1BQU07Ozs7O0NBS2pDLENBQUM7QUFDRixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO0lBQ3hCLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQztDQUNuQyxDQUFDO0FBQ0YsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQztJQUN6QixZQUFZLENBQUMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLENBQUM7Q0FDckMsQ0FBQztBQUNGLE1BQU0sb0JBQW9C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QUksQ0FBQyxLQUFLLENBQUMsZUFBZSxFQUFFLEtBQUssQ0FBQztnQkFDakQsSUFBSTtnQkFDSixTQUFTO2dCQUNULFVBQVU7YUFDYixDQUFDLENBQUMsQ0FBQztRQUNSLE9BQU8sWUFBWSxDQUFDO1lBQ2hCLElBQUk7WUFDSixJQUFJLEVBQUUsTUFBTTtZQUNaLEtBQUssa0JBQ0QsS0FBSyxFQUNMLFVBQVUsRUFBRSxJQUFJLElBQ2IsS0FBSyxDQUNYO1lBQ0QsS0FBSyxFQUFFLHNCQUFzQjtTQUNoQyxDQUFDLENBQUM7SUFDUCxDQUFDOztBQUNNLHdCQUFLLEdBQUc7SUFDWCxJQUFJLGNBQWMsS0FBSyxPQUFPLGNBQXVDLENBQUMsQ0FBQyxDQUFDO0lBQ3hFLElBQUksYUFBYSxLQUFLLE9BQU8sYUFBcUMsQ0FBQyxDQUFDLENBQUM7SUFDckUsSUFBSSxhQUFhLEtBQUssT0FBTyxhQUFxQyxDQUFDLENBQUMsQ0FBQztJQUNyRSxJQUFJLFFBQVEsS0FBSyxPQUFPLFFBQTJCLENBQUMsQ0FBQyxDQUFDO0lBQ3RELElBQUksU0FBUyxLQUFLLE9BQU8sU0FBNkIsQ0FBQyxDQUFDLENBQUM7SUFDekQsSUFBSSxvQkFBb0IsS0FBSyxPQUFPLG9CQUFtRCxDQUFDLENBQUMsQ0FBQztDQUM3RixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgbm9ybWFsaXplSW5kZXgsIHRvZ2dsZUluZGV4LCBoYXNJbmRleCB9IGZyb20gJy4vaGVscGVycy9pbmRleEhlbHBlcic7XG5pbXBvcnQgeyBBY2NvcmRpb25UYWJsZVByb3BzLCBBY2NvcmRpb25UYWJsZUNhcmRSZW5kZXJlckV2ZW50IH0gZnJvbSAnLi9BY2NvcmRpb25UYWJsZS50eXBlcy5wYXJ0JztcbmltcG9ydCB7IGRlZmF1bHRDZWxsUmVuZGVyZXIgfSBmcm9tICcuLi9UYWJsZS9UYWJsZVNoYXJlZC5wYXJ0JztcbmltcG9ydCB7IGRlZmF1bHRCb2R5UmVuZGVyZXIgfSBmcm9tICcuLi9UYWJsZS9UYWJsZUNhcmQucGFydCc7XG5pbXBvcnQgeyBBY2NvcmRpb25DYXJkIH0gZnJvbSAnLi4vQWNjb3JkaW9uQ2FyZCc7XG5pbXBvcnQgeyBMaXN0SXRlbSB9IGZyb20gJy4uL0xpc3RJdGVtJztcbmltcG9ydCB7IExpc3QgfSBmcm9tICcuLi9MaXN0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgZ2V0Rm9udFN0eWxlIH0gZnJvbSAnLi4vLi4vdGV4dFN0eWxlcyc7XG5leHBvcnQgaW50ZXJmYWNlIEFjY29yZGlvblRhYmxlQ2FyZFN0YXRlIHtcbiAgICAvKipcbiAgICAgKiBDdXJyZW50bHkgc2VsZWN0ZWQgcm93cyBpbmRpY2VzLlxuICAgICAqL1xuICAgIHNlbGVjdGVkSW5kZXhlczogQXJyYXk8bnVtYmVyPjtcbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSBhY2NvcmRpb24gdGFibGUgY29tcG9uZW50IGlzIGNvbnRyb2xsZWQgZnJvbSB0aGUgb3V0c2lkZSBvciBub3QuXG4gICAgICovXG4gICAgY29udHJvbGxlZDogYm9vbGVhbjtcbn1cbmNvbnN0IFByb3BDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgbWFyZ2luLWJvdHRvbTogJHtkaXN0YW5jZS5tZWRpdW19O1xuXG4gICY6bGFzdC1jaGlsZCB7XG4gICAgbWFyZ2luLWJvdHRvbTogMDtcbiAgfVxuYDtcbmNvbnN0IFByb3BOYW1lID0gc3R5bGVkLmRpdiBgXG4gICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ3hTbWFsbCcgfSl9XG5gO1xuY29uc3QgUHJvcFZhbHVlID0gc3R5bGVkLmRpdiBgXG4gICR7Z2V0Rm9udFN0eWxlKHsgd2VpZ2h0OiAnbWVkaXVtJyB9KX1cbmA7XG5jb25zdCBQbGFjZWhvbGRlckNvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG5gO1xuY29uc3QgU3R5bGVkTGlzdCA9IHN0eWxlZChMaXN0KSBgXG4gIG92ZXJmbG93OiB2aXNpYmxlO1xuYDtcbmNvbnN0IFN0eWxlZExpc3RJdGVtID0gc3R5bGVkKExpc3RJdGVtKSBgXG4gIHBhZGRpbmc6IDA7XG4gIG1hcmdpbi1ib3R0b206ICR7ZGlzdGFuY2UueGxhcmdlfTtcbiAgYm9yZGVyOiBub25lO1xuXG4gICY6bGFzdC1jaGlsZCB7XG4gICAgbWFyZ2luLWJvdHRvbTogMDtcbiAgfVxuYDtcbmludGVyZmFjZSBBY2NvcmRpb25UYWJsZUNhcmRIb3N0UHJvcHMge1xuICAgIGJvcmRlcmxlc3M6IGJvb2xlYW47XG59XG5jb25zdCBBY2NvcmRpb25UYWJsZUNhcmRIb3N0ID0gT2JqZWN0LmFzc2lnbigoKHByb3BzID0+IDxTdHlsZWRMaXN0IHsuLi5wcm9wc30vPikgYXMgUmVhY3QuU0ZDPEFjY29yZGlvblRhYmxlQ2FyZEhvc3RQcm9wcz4pLCB7IGlubmVyOiB7XG4gICAgICAgIGdldCBTdHlsZWRMaXN0KCkgeyByZXR1cm4gU3R5bGVkTGlzdCBhcyB0eXBlb2YgU3R5bGVkTGlzdDsgfVxuICAgIH0gfSk7XG5leHBvcnQgY2xhc3MgQWNjb3JkaW9uVGFibGVDYXJkPFQ+IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PEFjY29yZGlvblRhYmxlUHJvcHM8VD4sIEFjY29yZGlvblRhYmxlQ2FyZFN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IEFjY29yZGlvblRhYmxlUHJvcHM8VD4pIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBub3JtYWxpemVJbmRleChwcm9wcy5zZWxlY3RlZEluZGV4KSxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLnNlbGVjdGVkSW5kZXggIT09IHVuZGVmaW5lZCxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wczogQWNjb3JkaW9uVGFibGVQcm9wczxhbnk+LCBzdGF0ZTogQWNjb3JkaW9uVGFibGVDYXJkU3RhdGUpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZEluZGV4IH0gPSBwcm9wcztcbiAgICAgICAgaWYgKHN0YXRlLmNvbnRyb2xsZWQgJiYgc2VsZWN0ZWRJbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXhlczogbm9ybWFsaXplSW5kZXgocHJvcHMuc2VsZWN0ZWRJbmRleCksXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG4gICAgcHJpdmF0ZSBoYW5kbGVDbGljayh0YXJnZXQ6IG51bWJlciwgZGF0YTogVCkge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBtdWx0aXBsZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkLCBzZWxlY3RlZEluZGV4ZXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IG5leHRJbmRleGVzID0gdG9nZ2xlSW5kZXgoc2VsZWN0ZWRJbmRleGVzLCB0YXJnZXQsIG11bHRpcGxlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IG11bHRpcGxlID8gbmV4dEluZGV4ZXMgOiBuZXh0SW5kZXhlc1swXSAhPT0gdW5kZWZpbmVkID8gbmV4dEluZGV4ZXNbMF0gOiAtMSxcbiAgICAgICAgICAgICAgICBwcmV2aW91c0luZGV4OiBtdWx0aXBsZSA/IHNlbGVjdGVkSW5kZXhlcyA6IHNlbGVjdGVkSW5kZXhlc1swXSAhPT0gdW5kZWZpbmVkID8gc2VsZWN0ZWRJbmRleGVzWzBdIDogLTEsXG4gICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBuZXh0SW5kZXhlcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgcmVuZGVySXRlbSA9ICh7IGl0ZW0sIGluZGV4LCBvcGVuLCBrZXlzLCBjbG9zZUxhYmVsLCBvcGVuTGFiZWwgfTogQWNjb3JkaW9uVGFibGVDYXJkUmVuZGVyZXJFdmVudDxUPikgPT4ge1xuICAgICAgICBjb25zdCB7IGRldGFpbHNSZW5kZXJlciwgdGhlbWUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHJldHVybiAoPFN0eWxlZExpc3RJdGVtIHRoZW1lPXt0aGVtZX0ga2V5PXtpbmRleH0+XG4gICAgICAgIDxBY2NvcmRpb25DYXJkIG9wZW5MYWJlbD17b3BlbkxhYmVsfSBjbG9zZUxhYmVsPXtjbG9zZUxhYmVsfSB0aGVtZT17dGhlbWV9IGhlYWRlcj17dGhpcy5yZW5kZXJJdGVtUHJvcHMoaXRlbSwga2V5cywgaW5kZXgpfSBvcGVuZWQ9e29wZW59IG9uQWN0aW9uQ2xpY2s9eygpID0+IHRoaXMuaGFuZGxlQ2xpY2soaW5kZXgsIGl0ZW0pfT5cbiAgICAgICAgICB7b3BlbiAmJiBkZXRhaWxzUmVuZGVyZXIgJiYgZGV0YWlsc1JlbmRlcmVyKHsgZGF0YTogaXRlbSwgaW5kZXggfSl9XG4gICAgICAgIDwvQWNjb3JkaW9uQ2FyZD5cbiAgICAgIDwvU3R5bGVkTGlzdEl0ZW0+KTtcbiAgICB9O1xuICAgIHByaXZhdGUgZ2V0SGVhZGVyKGtleTogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHsgY29sdW1ucyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKGNvbHVtbnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IGNvbHVtbnNba2V5XTtcbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgY29sdW1uID09PSAnc3RyaW5nJyA/IGNvbHVtbiA6IGNvbHVtbi5oZWFkZXI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGtleTtcbiAgICB9XG4gICAgcHJpdmF0ZSByZW5kZXJJdGVtUHJvcHMoaXRlbTogVCwga2V5czogQXJyYXk8c3RyaW5nPiwgcm93OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIGtleXMubWFwKChrZXksIGluZGV4KSA9PiB0aGlzLnJlbmRlckl0ZW1Qcm9wKGtleSwgaXRlbVtrZXldLCBpbmRleCwgcm93KSk7XG4gICAgfVxuICAgIHByaXZhdGUgcmVuZGVySXRlbVByb3Aoa2V5OiBzdHJpbmcsIHByb3BWYWx1ZTogYW55LCBpbmRleDogbnVtYmVyLCByb3c6IG51bWJlcikge1xuICAgICAgICBjb25zdCB7IGNlbGxSZW5kZXJlciA9IGRlZmF1bHRDZWxsUmVuZGVyZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHByb3BLZXkgPSB0aGlzLmdldEhlYWRlcihrZXkpO1xuICAgICAgICByZXR1cm4gKDxQcm9wQ29udGFpbmVyIGtleT17aW5kZXh9PlxuICAgICAgICA8UHJvcE5hbWU+e3Byb3BLZXl9PC9Qcm9wTmFtZT5cbiAgICAgICAgPFByb3BWYWx1ZT5cbiAgICAgICAgICB7Y2VsbFJlbmRlcmVyKHtcbiAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgIGNvbHVtbjogaW5kZXgsXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICB2YWx1ZTogcHJvcFZhbHVlLFxuICAgICAgICAgICAgcmVuZGVyOiBkZWZhdWx0Q2VsbFJlbmRlcmVyLFxuICAgICAgICB9KX1cbiAgICAgICAgPC9Qcm9wVmFsdWU+XG4gICAgICA8L1Byb3BDb250YWluZXI+KTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGRhdGEgPSBbXSwgY29sdW1ucywgcGxhY2Vob2xkZXIsIHRoZW1lLCBjYXJkUmVuZGVyZXIgPSB0aGlzLnJlbmRlckl0ZW0sIGJvZHlSZW5kZXJlciA9IGRlZmF1bHRCb2R5UmVuZGVyZXIsIG9wZW5MYWJlbCwgY2xvc2VMYWJlbCwgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhjb2x1bW5zIHx8IGRhdGFbMF0gfHwge30pO1xuICAgICAgICBjb25zdCByb3dzID0gZGF0YS5sZW5ndGggPT09IDBcbiAgICAgICAgICAgID8gcGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgICAgICAgPFN0eWxlZExpc3RJdGVtIHRoZW1lPXt0aGVtZX0ga2V5PXswfT5cbiAgICAgICAgICAgICAgICA8UGxhY2Vob2xkZXJDb250YWluZXIgdGhlbWU9e3RoZW1lfT57cGxhY2Vob2xkZXJ9PC9QbGFjZWhvbGRlckNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgPC9TdHlsZWRMaXN0SXRlbT4sXG4gICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgIDogW11cbiAgICAgICAgICAgIDogZGF0YS5tYXAoKGl0ZW0sIGluZGV4KSA9PiBjYXJkUmVuZGVyZXIoe1xuICAgICAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgICAgb3BlbjogaGFzSW5kZXgodGhpcy5zdGF0ZS5zZWxlY3RlZEluZGV4ZXMsIGluZGV4KSxcbiAgICAgICAgICAgICAgICBrZXlzLFxuICAgICAgICAgICAgICAgIG9wZW5MYWJlbCxcbiAgICAgICAgICAgICAgICBjbG9zZUxhYmVsLFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gYm9keVJlbmRlcmVyKHtcbiAgICAgICAgICAgIHJvd3MsXG4gICAgICAgICAgICBtb2RlOiAnY2FyZCcsXG4gICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAgIHRoZW1lLFxuICAgICAgICAgICAgICAgIGJvcmRlcmxlc3M6IHRydWUsXG4gICAgICAgICAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdGFibGU6IEFjY29yZGlvblRhYmxlQ2FyZEhvc3QsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWRMaXN0SXRlbSgpIHsgcmV0dXJuIFN0eWxlZExpc3RJdGVtIGFzIHR5cGVvZiBTdHlsZWRMaXN0SXRlbTsgfSxcbiAgICAgICAgZ2V0IEFjY29yZGlvbkNhcmQoKSB7IHJldHVybiBBY2NvcmRpb25DYXJkIGFzIHR5cGVvZiBBY2NvcmRpb25DYXJkOyB9LFxuICAgICAgICBnZXQgUHJvcENvbnRhaW5lcigpIHsgcmV0dXJuIFByb3BDb250YWluZXIgYXMgdHlwZW9mIFByb3BDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBQcm9wTmFtZSgpIHsgcmV0dXJuIFByb3BOYW1lIGFzIHR5cGVvZiBQcm9wTmFtZTsgfSxcbiAgICAgICAgZ2V0IFByb3BWYWx1ZSgpIHsgcmV0dXJuIFByb3BWYWx1ZSBhcyB0eXBlb2YgUHJvcFZhbHVlOyB9LFxuICAgICAgICBnZXQgUGxhY2Vob2xkZXJDb250YWluZXIoKSB7IHJldHVybiBQbGFjZWhvbGRlckNvbnRhaW5lciBhcyB0eXBlb2YgUGxhY2Vob2xkZXJDb250YWluZXI7IH1cbiAgICB9O1xufVxuIl19