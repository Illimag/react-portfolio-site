var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
/**
 * The functional component to handle tabs.
 * DEPRECATED: Please use `withTabControl` instead.
 * @deprecated
 */
export class TabControl extends React.PureComponent {
    constructor(props) {
        super(props);
        this.selects = [];
        this.changeIndex = (target) => {
            const change = this.props.onTabChange;
            if (typeof change === 'function') {
                change({
                    previousIndex: this.state.selectedIndex,
                    selectedIndex: target,
                });
            }
            if (!this.state.controlled) {
                this.setState({
                    selectedIndex: target,
                });
            }
        };
        this.state = {
            selectedIndex: props.selectedIndex || props.defaultIndex || 0,
            controlled: props.selectedIndex !== undefined,
        };
    }
    UNSAFE_componentWillReceiveProps(nextProps) {
        const selectedIndex = nextProps.selectedIndex;
        if (this.state.controlled && typeof selectedIndex === 'number') {
            this.setState({
                selectedIndex,
            });
        }
    }
    render() {
        const selectedIndex = this.state.selectedIndex;
        const { children, render } = this.props;
        const items = [];
        const selects = this.selects;
        React.Children.forEach(children, (element, index) => {
            if (element && React.isValidElement(element)) {
                const active = index === selectedIndex;
                if (selects[index] === undefined) {
                    selects[index] = () => this.changeIndex(index);
                }
                items.push({
                    onSelect: selects[index],
                    active,
                    element,
                });
            }
        });
        return render(items);
    }
}
function isTabPage(child) {
    return !!child;
}
function useTabControl({ children, selectedIndex, defaultIndex, onTabChange }) {
    const [controlled] = React.useState(selectedIndex !== undefined);
    const [activeTabIndex, setActiveTabIndex] = React.useState(selectedIndex || defaultIndex || 0);
    React.useEffect(() => {
        if (controlled && typeof selectedIndex === 'number') {
            setActiveTabIndex(selectedIndex);
        }
    }, [selectedIndex]);
    const elements = React.useMemo(() => (React.Children.map(children, child => (React.isValidElement(child) ? child : undefined)) || []).filter(isTabPage), [children]);
    const headers = React.useMemo(() => elements.map(child => child.props.header), [elements]);
    const onSelect = React.useCallback((selectedIndex) => {
        setActiveTabIndex(previousIndex => {
            if (typeof onTabChange === 'function') {
                onTabChange({
                    previousIndex,
                    selectedIndex,
                });
            }
            return controlled ? previousIndex : selectedIndex;
        });
    }, [onTabChange, controlled]);
    return {
        elements,
        headers,
        activeTabIndex,
        onSelect,
        isActive(index) {
            return activeTabIndex === index;
        },
    };
}
export function withTabControl(Component) {
    const TabControl = Object.assign(((_a) => {
        var { children, tabItemRenderer: Element } = _a, rest = __rest(_a, ["children", "tabItemRenderer"]);
        const { elements, headers, activeTabIndex, isActive, onSelect } = useTabControl(Object.assign({ children }, rest));
        return (React.createElement(Component, Object.assign({}, rest, { headers: headers, activeIndex: activeTabIndex, onSelect: onSelect }), elements.map((child, i) => (React.createElement(Element, { key: `item-${i}`, active: isActive(i) }, child)))));
    }), { inner: {
            get Component() { return Component; }
        } });
    return TabControl;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9UYWJDb250cm9sL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQWdFL0I7Ozs7R0FJRztBQUNILE1BQU0sT0FBTyxVQUFXLFNBQVEsS0FBSyxDQUFDLGFBQStDO0lBRWpGLFlBQVksS0FBc0I7UUFDOUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRlQsWUFBTyxHQUFzQixFQUFFLENBQUM7UUFnQmhDLGdCQUFXLEdBQUcsQ0FBQyxNQUFjLEVBQUUsRUFBRTtZQUNyQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQztZQUN0QyxJQUFJLE9BQU8sTUFBTSxLQUFLLFVBQVUsRUFBRTtnQkFDOUIsTUFBTSxDQUFDO29CQUNILGFBQWEsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWE7b0JBQ3ZDLGFBQWEsRUFBRSxNQUFNO2lCQUN4QixDQUFDLENBQUM7YUFDTjtZQUNELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRTtnQkFDeEIsSUFBSSxDQUFDLFFBQVEsQ0FBQztvQkFDVixhQUFhLEVBQUUsTUFBTTtpQkFDeEIsQ0FBQyxDQUFDO2FBQ047UUFDTCxDQUFDLENBQUM7UUExQkUsSUFBSSxDQUFDLEtBQUssR0FBRztZQUNULGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYSxJQUFJLEtBQUssQ0FBQyxZQUFZLElBQUksQ0FBQztZQUM3RCxVQUFVLEVBQUUsS0FBSyxDQUFDLGFBQWEsS0FBSyxTQUFTO1NBQ2hELENBQUM7SUFDTixDQUFDO0lBQ0QsZ0NBQWdDLENBQUMsU0FBMEI7UUFDdkQsTUFBTSxhQUFhLEdBQUcsU0FBUyxDQUFDLGFBQWEsQ0FBQztRQUM5QyxJQUFJLElBQUksQ0FBQyxLQUFL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QXVGLEVBQUUsRUFBRSxLQUFLLEVBQUU7WUFDM0YsSUFBSSxTQUFTLEtBQUssT0FBTyxTQUE2QixDQUFDLENBQUMsQ0FBQztTQUM1RCxFQUFFLENBQUMsQ0FBQztJQUNULE9BQU8sVUFBVSxDQUFDO0FBQ3RCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBUYWJQYWdlUHJvcHMgfSBmcm9tICcuLi9UYWJQYWdlJztcbmltcG9ydCB7IE9taXQgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgVGFiSXRlbVByb3BzIH0gZnJvbSAnLi4vQ29udGVudFN3aXRjaC9Db250ZW50U3dpdGNoLnBhcnQnO1xuZXhwb3J0IGludGVyZmFjZSBUYWJDb250cm9sSXRlbSB7XG4gICAgLyoqXG4gICAgICogVGhlIGVsZW1lbnQgdG8gYmUgc2hvd24uXG4gICAgICovXG4gICAgZWxlbWVudDogUmVhY3QuUmVhY3ROb2RlO1xuICAgIC8qKlxuICAgICAqIEdldHMgaWYgdGhlIGl0ZW0gaXMgY3VycmVudGx5IGFjdGl2ZS5cbiAgICAgKi9cbiAgICBhY3RpdmU6IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgdG8gdXNlIHdoZW4gdGhlIGl0ZW0gc2hvdWxkIGJlIGFjdGl2ZS5cbiAgICAgKi9cbiAgICBvblNlbGVjdCgpOiB2b2lkO1xufVxuZXhwb3J0IGludGVyZmFjZSBUYWJDaGFuZ2VFdmVudCB7XG4gICAgLyoqXG4gICAgICogVGhlIHByZXZpb3VzbHkgc2VsZWN0ZWQgdGFiIC8gaW5kZXguXG4gICAgICovXG4gICAgcHJldmlvdXNJbmRleDogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgdGFiIC8gaW5kZXguXG4gICAgICovXG4gICAgc2VsZWN0ZWRJbmRleDogbnVtYmVyO1xufVxuZXhwb3J0IGludGVyZmFjZSBUYWJPcHRpb25zIHtcbiAgICAvKipcbiAgICAgKiBUaGUgZGVmYXVsdCBpbmRleCAtIG9ubHkgc2V0IGZvciB1c2UgaW4gYXV0b21hdGljIG1vZGUuXG4gICAgICovXG4gICAgZGVmYXVsdEluZGV4PzogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgaW5kZXggLSB1c2VkIGluIHRoZSBjb250cm9sbGVkIG1vZGUuXG4gICAgICovXG4gICAgc2VsZWN0ZWRJbmRleD86IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBOb3RpZmljYXRpb24gY2FsbGJhY2sgaWYgdGhlIHNlbGVjdGVkIHRhYiBpbmRleCBzaG91bGQgY2hhbmdlLlxuICAgICAqL1xuICAgIG9uVGFiQ2hhbmdlPyhlOiBUYWJDaGFuZ2VFdmVudCk6IHZvaWQ7XG59XG4vKipcbiAqIEBkZXByZWNhdGVkXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVGFiQ29udHJvbFByb3BzIGV4dGVuZHMgVGFiT3B0aW9ucyB7XG4gICAgLyoqXG4gICAgICogVGhlIGNoaWxkcmVuLCB1c3VhbGx5IHBhc3NlZCBhcyBhIGNvbGxlY3Rpb24gb2YgVGFiUGFnZSBlbGVtZW50cy5cbiAgICAgKi9cbiAgICByZW5kZXIoaXRlbXM6IEFycmF5PFRhYkNvbnRyb2xJdGVtPik6IFJlYWN0LlJlYWN0Tm9kZTtcbn1cbi8qKlxuICogQGRlcHJlY2F0ZWRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUYWJDb250cm9sU3RhdGUge1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgaW5kZXguXG4gICAgICovXG4gICAgc2VsZWN0ZWRJbmRleDogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIHRhYiBjb21wb25lbnQgaXMgY29udHJvbGxlZCBmcm9tIHRoZSBvdXRzaWRlIG9yIG5vdC5cbiAgICAgKi9cbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuLyoqXG4gKiBUaGUgZnVuY3Rpb25hbCBjb21wb25lbnQgdG8gaGFuZGxlIHRhYnMuXG4gKiBERVBSRUNBVEVEOiBQbGVhc2UgdXNlIGB3aXRoVGFiQ29udHJvbGAgaW5zdGVhZC5cbiAqIEBkZXByZWNhdGVkXG4gKi9cbmV4cG9ydCBjbGFzcyBUYWJDb250cm9sIGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxUYWJDb250cm9sUHJvcHMsIFRhYkNvbnRyb2xTdGF0ZT4ge1xuICAgIHByaXZhdGUgc2VsZWN0czogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVGFiQ29udHJvbFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IHByb3BzLnNlbGVjdGVkSW5kZXggfHwgcHJvcHMuZGVmYXVsdEluZGV4IHx8IDAsXG4gICAgICAgICAgICBjb250cm9sbGVkOiBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wczogVGFiQ29udHJvbFByb3BzKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkSW5kZXggPSBuZXh0UHJvcHMuc2VsZWN0ZWRJbmRleDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY29udHJvbGxlZCAmJiB0eXBlb2Ygc2VsZWN0ZWRJbmRleCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXgsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZUluZGV4ID0gKHRhcmdldDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IGNoYW5nZSA9IHRoaXMucHJvcHMub25UYWJDaGFuZ2U7XG4gICAgICAgIGlmICh0eXBlb2YgY2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBjaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHByZXZpb3VzSW5kZXg6IHRoaXMuc3RhdGUuc2VsZWN0ZWRJbmRleCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4OiB0YXJnZXQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogdGFyZ2V0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRJbmRleCA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRJbmRleDtcbiAgICAgICAgY29uc3QgeyBjaGlsZHJlbiwgcmVuZGVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBpdGVtczogQXJyYXk8VGFiQ29udHJvbEl0ZW0+ID0gW107XG4gICAgICAgIGNvbnN0IHNlbGVjdHMgPSB0aGlzLnNlbGVjdHM7XG4gICAgICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIChlbGVtZW50OiBSZWFjdC5SZWFjdEVsZW1lbnQ8YW55PiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIFJlYWN0LmlzVmFsaWRFbGVtZW50KGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlID0gaW5kZXggPT09IHNlbGVjdGVkSW5kZXg7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdHNbaW5kZXhdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0c1tpbmRleF0gPSAoKSA9PiB0aGlzLmNoYW5nZUluZGV4KGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG9uU2VsZWN0OiBzZWxlY3RzW2luZGV4XSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlbmRlcihpdGVtcyk7XG4gICAgfVxufVxuZnVuY3Rpb24gaXNUYWJQYWdlKGNoaWxkOiBSZWFjdC5SZWFjdEVsZW1lbnQ8VGFiUGFnZVByb3BzPik6IGNoaWxkIGlzIFJlYWN0LlJlYWN0RWxlbWVudDxUYWJQYWdlUHJvcHM+IHtcbiAgICByZXR1cm4gISFjaGlsZDtcbn1cbmludGVyZmFjZSBVc2VUYWJTd2l0Y2hlclBhcmFtcyB7XG4gICAgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZTtcbiAgICBzZWxlY3RlZEluZGV4PzogbnVtYmVyO1xuICAgIGRlZmF1bHRJbmRleD86IG51bWJlcjtcbiAgICBvblRhYkNoYW5nZT8oZTogVGFiQ2hhbmdlRXZlbnQpOiB2b2lkO1xufVxuZnVuY3Rpb24gdXNlVGFiQ29udHJvbCh7IGNoaWxkcmVuLCBzZWxlY3RlZEluZGV4LCBkZWZhdWx0SW5kZXgsIG9uVGFiQ2hhbmdlIH06IFVzZVRhYlN3aXRjaGVyUGFyYW1zKSB7XG4gICAgY29uc3QgW2NvbnRyb2xsZWRdID0gUmVhY3QudXNlU3RhdGUoc2VsZWN0ZWRJbmRleCAhPT0gdW5kZWZpbmVkKTtcbiAgICBjb25zdCBbYWN0aXZlVGFiSW5kZXgsIHNldEFjdGl2ZVRhYkluZGV4XSA9IFJlYWN0LnVzZVN0YXRlKHNlbGVjdGVkSW5kZXggfHwgZGVmYXVsdEluZGV4IHx8IDApO1xuICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChjb250cm9sbGVkICYmIHR5cGVvZiBzZWxlY3RlZEluZGV4ID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgc2V0QWN0aXZlVGFiSW5kZXgoc2VsZWN0ZWRJbmRleCk7XG4gICAgICAgIH1cbiAgICB9LCBbc2VsZWN0ZWRJbmRleF0pO1xuICAgIGNvbnN0IGVsZW1lbnRzID0gUmVhY3QudXNlTWVtbygoKSA9PiAoUmVhY3QuQ2hpbGRyZW4ubWFwKGNoaWxkcmVuLCBjaGlsZCA9PiAoUmVhY3QuaXNWYWxpZEVsZW1lbnQoY2hpbGQpID8gY2hpbGQgOiB1bmRlZmluZWQpKSB8fCBbXSkuZmlsdGVyKGlzVGFiUGFnZSksIFtjaGlsZHJlbl0pO1xuICAgIGNvbnN0IGhlYWRlcnMgPSBSZWFjdC51c2VNZW1vKCgpID0+IGVsZW1lbnRzLm1hcChjaGlsZCA9PiBjaGlsZC5wcm9wcy5oZWFkZXIpLCBbZWxlbWVudHNdKTtcbiAgICBjb25zdCBvblNlbGVjdCA9IFJlYWN0LnVzZUNhbGxiYWNrKChzZWxlY3RlZEluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgc2V0QWN0aXZlVGFiSW5kZXgocHJldmlvdXNJbmRleCA9PiB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uVGFiQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb25UYWJDaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBwcmV2aW91c0luZGV4LFxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbnRyb2xsZWQgPyBwcmV2aW91c0luZGV4IDogc2VsZWN0ZWRJbmRleDtcbiAgICAgICAgfSk7XG4gICAgfSwgW29uVGFiQ2hhbmdlLCBjb250cm9sbGVkXSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZWxlbWVudHMsXG4gICAgICAgIGhlYWRlcnMsXG4gICAgICAgIGFjdGl2ZVRhYkluZGV4LFxuICAgICAgICBvblNlbGVjdCxcbiAgICAgICAgaXNBY3RpdmUoaW5kZXg6IG51bWJlcikge1xuICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZVRhYkluZGV4ID09PSBpbmRleDtcbiAgICAgICAgfSxcbiAgICB9O1xufVxuZXhwb3J0IGludGVyZmFjZSBUYWJDb250cm9sSG9sZGVyUHJvcHMge1xuICAgIGhlYWRlcnM6IEFycmF5PFJlYWN0LlJlYWN0Q2hpbGQ+O1xuICAgIGFjdGl2ZUluZGV4PzogbnVtYmVyO1xuICAgIG9uU2VsZWN0KGluZGV4OiBudW1iZXIpOiB2b2lkO1xufVxuZXhwb3J0IGludGVyZmFjZSBXaXRoVGFiQ29udHJvbFByb3BzIHtcbiAgICB0YWJJdGVtUmVuZGVyZXI6IFJlYWN0LkVsZW1lbnRUeXBlPFRhYkl0ZW1Qcm9wcz47XG59XG5leHBvcnQgZnVuY3Rpb24gd2l0aFRhYkNvbnRyb2w8VCBleHRlbmRzIFRhYkNvbnRyb2xIb2xkZXJQcm9wcz4oQ29tcG9uZW50OiBSZWFjdC5Db21wb25lbnRUeXBlPFQ+KSB7XG4gICAgY29uc3QgVGFiQ29udHJvbCA9IE9iamVjdC5hc3NpZ24oKCgoeyBjaGlsZHJlbiwgdGFiSXRlbVJlbmRlcmVyOiBFbGVtZW50LCAuLi5yZXN0IH0pID0+IHtcbiAgICAgICAgY29uc3QgeyBlbGVtZW50cywgaGVhZGVycywgYWN0aXZlVGFiSW5kZXgsIGlzQWN0aXZlLCBvblNlbGVjdCB9ID0gdXNlVGFiQ29udHJvbCh7XG4gICAgICAgICAgICBjaGlsZHJlbixcbiAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKDxDb21wb25lbnQgey4uLnJlc3QgYXMgYW55fSBoZWFkZXJzPXtoZWFkZXJzfSBhY3RpdmVJbmRleD17YWN0aXZlVGFiSW5kZXh9IG9uU2VsZWN0PXtvblNlbGVjdH0+XG4gICAgICAgIHtlbGVtZW50cy5tYXAoKGNoaWxkLCBpKSA9PiAoPEVsZW1lbnQga2V5PXtgaXRlbS0ke2l9YH0gYWN0aXZlPXtpc0FjdGl2ZShpKX0+XG4gICAgICAgICAgICB7Y2hpbGR9XG4gICAgICAgICAgPC9FbGVtZW50PikpfVxuICAgICAgPC9Db21wb25lbnQ+KTtcbiAgICB9KSBhcyBSZWFjdC5GQzxUYWJPcHRpb25zICYgV2l0aFRhYkNvbnRyb2xQcm9wcyAmIE9taXQ8VCwga2V5b2YgVGFiQ29udHJvbEhvbGRlclByb3BzPj4pLCB7IGlubmVyOiB7XG4gICAgICAgICAgICBnZXQgQ29tcG9uZW50KCkgeyByZXR1cm4gQ29tcG9uZW50IGFzIHR5cGVvZiBDb21wb25lbnQ7IH1cbiAgICAgICAgfSB9KTtcbiAgICByZXR1cm4gVGFiQ29udHJvbDtcbn1cbiJdfQ==