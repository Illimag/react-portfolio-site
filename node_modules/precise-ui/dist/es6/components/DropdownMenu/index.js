var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import * as colors from '../../colors';
import onClickOutside from 'react-onclickoutside';
import styled, { themed } from '../../utils/styled';
import { Icon } from '../Icon';
import { InteractiveList } from '../InteractiveList';
import { distance } from '../../distance';
import { Flyout } from '../Flyout';
import { getFontStyle } from '../../textStyles';
const RootContainer = styled.div `
  position: relative;
  margin-right: ${distance.xlarge};
  &:last-child {
    margin-right: 0;
  }
`;
const StyledInteractiveList = styled(InteractiveList) `
  position: static;
  white-space: nowrap;

  ul {
    background: ${themed(props => props.theme.ui1)};
  }
`;
const DropdownButton = styled.div `
  color: ${props => (props.open ? colors.cyan : colors.grey2)};
  ${({ menuSize }) => getFontStyle({ size: menuSize })};
  cursor: pointer;
  display: flex;
  align-items: center;
  span {
    margin-left: ${distance.small};
  }
  &:hover {
    color: ${colors.cyan};
  }
`;
class DropdownMenuInt extends React.PureComponent {
    constructor(props) {
        super(props);
        this.handleClickOutside = () => {
            this.container && this.state.open && this.toggleOpen();
        };
        this.setContainer = (el) => {
            this.container = el;
        };
        this.handleKeyDown = (e) => {
            switch (e.keyCode) {
                case 32 /* space */:
                case 13 /* enter */:
                case 40 /* down */:
                    this.toggleOpen();
                    break;
            }
        };
        this.handleButtonMouseDown = (e) => {
            this.toggleOpen();
            e.preventDefault();
        };
        this.handleBlur = () => {
            this.toggleOpen(false);
        };
        this.handleChange = (e) => {
            const { onChange, keepOpen } = this.props;
            if (typeof onChange === 'function') {
                onChange({
                    indices: e.value,
                });
            }
            if (!keepOpen) {
                this.toggleOpen(false);
            }
        };
        this.state = {
            open: false,
        };
    }
    toggleOpen(force) {
        const { open } = this.state;
        const { items, onToggle } = this.props;
        const newState = force ? force : !open;
        this.setState({
            open: newState && !!items.length,
        }, () => {
            if (typeof onToggle === 'function') {
                onToggle({
                    open: this.state.open,
                });
            }
        });
    }
    render() {
        const _a = this.props, { items = [], text = '', icon, onChange: _0, menuSize = 'normal', iconSize = 1 } = _a, rest = __rest(_a, ["items", "text", "icon", "onChange", "menuSize", "iconSize"]);
        const { open } = this.state;
        return (React.createElement(RootContainer, { ref: this.setContainer },
            React.createElement(Flyout, { open: open, noGutter: true, content: React.createElement(StyledInteractiveList, { borderless: true, open: open, data: items, autoFocus: true, onBlur: this.handleBlur, onChange: this.handleChange }) },
                React.createElement(DropdownButton, Object.assign({ tabIndex: 0, onKeyDown: this.handleKeyDown, onMouseDown: this.handleButtonMouseDown, open: open, menuSize: menuSize }, rest),
                    icon && React.createElement(Icon, { name: icon, size: iconSize }),
                    React.createElement("span", null, text)))));
    }
}
DropdownMenuInt.inner = {
    get RootContainer() { return RootContainer; },
    get Flyout() { return Flyout; },
    get DropdownButton() { return DropdownButton; },
    get Icon() { return Icon; }
};
/**
 * A dropdown menu for displaying menu items.
 */
export const DropdownMenu = onClickOutside(DropdownMenuInt);
DropdownMenu.displayName = 'DropdownMenu';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Ecm9wZG93bk1lbnUvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sS0FBSyxNQUFNLE1BQU0sY0FBYyxDQUFDO0FBQ3ZDLE9BQU8sY0FBbUMsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RSxPQUFPLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxJQUFJLEVBQVksTUFBTSxTQUFTLENBQUM7QUFDekMsT0FBTyxFQUFFLGVBQWUsRUFBbUQsTUFBTSxvQkFBb0IsQ0FBQztBQUd0RyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQVksWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUEyRDFELE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7O2tCQUVmLFFBQVEsQ0FBQyxNQUFNOzs7O0NBSWhDLENBQUM7QUFDRixNQUFNLHFCQUFxQixHQUFHLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQzs7Ozs7a0JBS3BDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDOztDQUVqRCxDQUFDO0FBQ0YsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBc0I7V0FDNUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDekQsQ0FBQyxFQUFFLFFBQVEsRUFBRSxF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cm9tICdyZWFjdCc7XG5pbXBvcnQgKiBhcyBjb2xvcnMgZnJvbSAnLi4vLi4vY29sb3JzJztcbmltcG9ydCBvbkNsaWNrT3V0c2lkZSwgeyBBZGRpdGlvbmFsUHJvcHMgfSBmcm9tICdyZWFjdC1vbmNsaWNrb3V0c2lkZSc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBJY29uLCBJY29uTmFtZSB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgSW50ZXJhY3RpdmVMaXN0LCBJbnRlcmFjdGl2ZUxpc3RJdGVtLCBJbnRlcmFjdGl2ZUxpc3RDaGFuZ2VFdmVudCB9IGZyb20gJy4uL0ludGVyYWN0aXZlTGlzdCc7XG5pbXBvcnQgeyBTdGFuZGFyZFByb3BzIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IEtleUNvZGVzIH0gZnJvbSAnLi4vLi4vdXRpbHMva2V5Q29kZXMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBGbHlvdXQgfSBmcm9tICcuLi9GbHlvdXQnO1xuaW1wb3J0IHsgRm9udFNpemUsIGdldEZvbnRTdHlsZSB9IGZyb20gJy4uLy4uL3RleHRTdHlsZXMnO1xuZXhwb3J0IGludGVyZmFjZSBEcm9wZG93bk1lbnVDaGFuZ2VFdmVudCB7XG4gICAgLyoqXG4gICAgICogVGhlIGluZGljZXMgb2YgdGhlIGl0ZW1zIHRoYXQgaGF2ZSBiZWVuIHNlbGVjdGVkLlxuICAgICAqL1xuICAgIGluZGljZXM6IEFycmF5PG51bWJlcj47XG59XG5leHBvcnQgaW50ZXJmYWNlIERyb3Bkb3duTWVudVRvZ2dsZUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBUaGUgbWVudSBpcyBjdXJyZW50bHkgY2xvc2VkIG9yIG9wZW5lZC5cbiAgICAgKi9cbiAgICBvcGVuOiBib29sZWFuO1xufVxuZXhwb3J0IGludGVyZmFjZSBEcm9wZG93bk1lbnVQcm9wcyBleHRlbmRzIFN0YW5kYXJkUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRoZSB0ZXh0IHRvIGRpc3BsYXkuXG4gICAgICovXG4gICAgdGV4dD86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBUaGUgb3B0aW9uYWwgaWNvbiAobmFtZSkgdG8gdXNlLlxuICAgICAqL1xuICAgIGljb24/OiBJY29uTmFtZTtcbiAgICAvKipcbiAgICAgKiBUaGUgaXRlbXMgb2YgdGhlIG1lbnUuXG4gICAgICovXG4gICAgaXRlbXM6IEFycmF5PEludGVyYWN0aXZlTGlzdEl0ZW0+O1xuICAgIC8qKlxuICAgICAqIERlZmluZXMgdGhlIHNpemUgb2YgdGhlIG1lbnUuXG4gICAgICogQGRlZmF1bHQgJ25vcm1hbFxuICAgICAqL1xuICAgIG1lbnVTaXplPzogRm9udFNpemU7XG4gICAgLyoqXG4gICAgICogU2hvdWxkIHRoZSBtZW51IGJlIGtlcHQgb3BlbiB3aGVuIGxvc2luZyBmb2N1cy5cbiAgICAgKi9cbiAgICBrZWVwT3Blbj86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRXZlbnQgZmlyZWQgd2hlbiB0aGUgc2VsZWN0ZWQgaXRlbSBjaGFuZ2VzLlxuICAgICAqL1xuICAgIG9uQ2hhbmdlPyhlOiBEcm9wZG93bk1lbnVDaGFuZ2VFdmVudCk6IHZvaWQ7XG4gICAgLyoqXG4gICAgICogVGhlIGljb24gc2l6ZSB0byB1c2UuXG4gICAgICovXG4gICAgaWNvblNpemU/OiBudW1iZXIgfCBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogRXZlbnQgZmlyZWQgd2hlbiBtZW51IG9wZW5lZCB8IGNsb3NlZC5cbiAgICAgKi9cbiAgICBvblRvZ2dsZT8oZTogRHJvcGRvd25NZW51VG9nZ2xlRXZlbnQpOiB2b2lkO1xuICAgIC8qKlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBjaGlsZHJlbj86IHZvaWQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIERyb3Bkb3duTWVudVN0YXRlIHtcbiAgICBvcGVuOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIERyb3Bkb3duQnV0dG9uUHJvcHMge1xuICAgIG9wZW46IGJvb2xlYW47XG4gICAgbWVudVNpemU6IEZvbnRTaXplO1xufVxuY29uc3QgUm9vdENvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1hcmdpbi1yaWdodDogJHtkaXN0YW5jZS54bGFyZ2V9O1xuICAmOmxhc3QtY2hpbGQge1xuICAgIG1hcmdpbi1yaWdodDogMDtcbiAgfVxuYDtcbmNvbnN0IFN0eWxlZEludGVyYWN0aXZlTGlzdCA9IHN0eWxlZChJbnRlcmFjdGl2ZUxpc3QpIGBcbiAgcG9zaXRpb246IHN0YXRpYztcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcblxuICB1bCB7XG4gICAgYmFja2dyb3VuZDogJHt0aGVtZWQocHJvcHMgPT4gcHJvcHMudGhlbWUudWkxKX07XG4gIH1cbmA7XG5jb25zdCBEcm9wZG93bkJ1dHRvbiA9IHN0eWxlZC5kaXY8RHJvcGRvd25CdXR0b25Qcm9wcz4gYFxuICBjb2xvcjogJHtwcm9wcyA9PiAocHJvcHMub3BlbiA/IGNvbG9ycy5jeWFuIDogY29sb3JzLmdyZXkyKX07XG4gICR7KHsgbWVudVNpemUgfSkgPT4gZ2V0Rm9udFN0eWxlKHsgc2l6ZTogbWVudVNpemUgfSl9O1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIHNwYW4ge1xuICAgIG1hcmdpbi1sZWZ0OiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgfVxuICAmOmhvdmVyIHtcbiAgICBjb2xvcjogJHtjb2xvcnMuY3lhbn07XG4gIH1cbmA7XG5jbGFzcyBEcm9wZG93bk1lbnVJbnQgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PERyb3Bkb3duTWVudVByb3BzLCBEcm9wZG93bk1lbnVTdGF0ZT4ge1xuICAgIHByaXZhdGUgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCB8IG51bGw7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IERyb3Bkb3duTWVudVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIG9wZW46IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBoYW5kbGVDbGlja091dHNpZGUgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyICYmIHRoaXMuc3RhdGUub3BlbiAmJiB0aGlzLnRvZ2dsZU9wZW4oKTtcbiAgICB9O1xuICAgIHByaXZhdGUgc2V0Q29udGFpbmVyID0gKGVsOiBIVE1MRGl2RWxlbWVudCkgPT4ge1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGVsO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVLZXlEb3duID0gKGU6IFJlYWN0LktleWJvYXJkRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnNwYWNlOlxuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZG93bjpcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZU9wZW4oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVCdXR0b25Nb3VzZURvd24gPSAoZTogUmVhY3QuTW91c2VFdmVudDxIVE1MRGl2RWxlbWVudD4gfCBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLnRvZ2dsZU9wZW4oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH07XG4gICAgcHJpdmF0ZSB0b2dnbGVPcGVuKGZvcmNlPzogYm9vbGVhbikge1xuICAgICAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaXRlbXMsIG9uVG9nZ2xlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IGZvcmNlID8gZm9yY2UgOiAhb3BlbjtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBvcGVuOiBuZXdTdGF0ZSAmJiAhIWl0ZW1zLmxlbmd0aCxcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvblRvZ2dsZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uVG9nZ2xlKHtcbiAgICAgICAgICAgICAgICAgICAgb3BlbjogdGhpcy5zdGF0ZS5vcGVuLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBoYW5kbGVCbHVyID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnRvZ2dsZU9wZW4oZmFsc2UpO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVDaGFuZ2UgPSAoZTogSW50ZXJhY3RpdmVMaXN0Q2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwga2VlcE9wZW4gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICBpbmRpY2VzOiBlLnZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFrZWVwT3Blbikge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVPcGVuKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGl0ZW1zID0gW10sIHRleHQgPSAnJywgaWNvbiwgb25DaGFuZ2U6IF8wLCBtZW51U2l6ZSA9ICdub3JtYWwnIGFzIEZvbnRTaXplLCBpY29uU2l6ZSA9IDEsIC4uLnJlc3QgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgb3BlbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuICg8Um9vdENvbnRhaW5lciByZWY9e3RoaXMuc2V0Q29udGFpbmVyfT5cbiAgICAgICAgPEZseW91dCBvcGVuPXtvcGVufSBub0d1dHRlciBjb250ZW50PXs8U3R5bGVkSW50ZXJhY3RpdmVMaXN0IGJvcmRlcmxlc3Mgb3Blbj17b3Blbn0gZGF0YT17aXRlbXN9IGF1dG9Gb2N1cyBvbkJsdXI9e3RoaXMuaGFuZGxlQmx1cn0gb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlfS8+fT5cbiAgICAgICAgICA8RHJvcGRvd25CdXR0b24gdGFiSW5kZXg9ezB9IG9uS2V5RG93bj17dGhpcy5oYW5kbGVLZXlEb3dufSBvbk1vdXNlRG93bj17dGhpcy5oYW5kbGVCdXR0b25Nb3VzZURvd259IG9wZW49e29wZW59IG1lbnVTaXplPXttZW51U2l6ZX0gey4uLnJlc3R9PlxuICAgICAgICAgICAge2ljb24gJiYgPEljb24gbmFtZT17aWNvbn0gc2l6ZT17aWNvblNpemV9Lz59XG4gICAgICAgICAgICA8c3Bhbj57dGV4dH08L3NwYW4+XG4gICAgICAgICAgPC9Ecm9wZG93bkJ1dHRvbj5cbiAgICAgICAgPC9GbHlvdXQ+XG4gICAgICA8L1Jvb3RDb250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgUm9vdENvbnRhaW5lcigpIHsgcmV0dXJuIFJvb3RDb250YWluZXIgYXMgdHlwZW9mIFJvb3RDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBGbHlvdXQoKSB7IHJldHVybiBGbHlvdXQgYXMgdHlwZW9mIEZseW91dDsgfSxcbiAgICAgICAgZ2V0IERyb3Bkb3duQnV0dG9uKCkgeyByZXR1cm4gRHJvcGRvd25CdXR0b24gYXMgdHlwZW9mIERyb3Bkb3duQnV0dG9uOyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH1cbiAgICB9O1xufVxuLyoqXG4gKiBBIGRyb3Bkb3duIG1lbnUgZm9yIGRpc3BsYXlpbmcgbWVudSBpdGVtcy5cbiAqL1xuZXhwb3J0IGNvbnN0IERyb3Bkb3duTWVudTogUmVhY3QuQ29tcG9uZW50Q2xhc3M8RHJvcGRvd25NZW51UHJvcHMgJiBBZGRpdGlvbmFsUHJvcHM+ID0gb25DbGlja091dHNpZGUoRHJvcGRvd25NZW51SW50KTtcbkRyb3Bkb3duTWVudS5kaXNwbGF5TmFtZSA9ICdEcm9wZG93bk1lbnUnO1xuIl19