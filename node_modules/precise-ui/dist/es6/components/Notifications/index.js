import * as React from 'react';
import styled, { css } from '../../utils/styled';
import { NotificationAction, } from './types';
import { eventManagers } from '../../utils/eventManager';
import { capitalizeFirst } from '../../utils/text';
import { ToastNotification } from './ToastNotification.part';
export { NotificationAction, } from './types';
export { notify } from './notifier';
const defaultProps = {
    width: 320,
};
const getNotificationPositionStyle = (pos) => {
    let positionStyle = `${pos.split('-')[0]}:1rem;`;
    if (pos.indexOf('center') !== -1) {
        positionStyle += `left:50%;transform:translateX(-50%);`;
    }
    else {
        positionStyle += `${pos.split('-')[1]}:1rem;`;
    }
    return positionStyle;
};
const AbsoluteContainer = css `
  z-index: 10001;
  position: fixed;
  ${props => getNotificationPositionStyle(props.position)};
  width: ${props => (props.width ? props.width : defaultProps.width)}px;
  @media (max-width: 480px) {
    width: 100vw;
    padding: 0;
    right: 0;
    margin: 0;
    position: fixed;
    ${props => (props.position.substring(0, 3) === 'top' ? 'top: 0' : 'bottom: 0')};
  }
`;
const StyledNotifications = styled.div `
  box-sizing: border-box;
  width: ${props => (!props.width ? 'auto' : `${props.width}px`)};
  ${props => (props.disablePointer ? `pointer-events: none` : ``)};
  @media (max-width: 480px) {
    padding: 0;
    margin: 0;
  }
  ${props => (props.position !== 'relative' ? AbsoluteContainer : '')};
`;
/**
 * The host element for arbitrary notifications. Use as a singleton only.
 */
export class Notifications extends React.Component {
    constructor(props) {
        super(props);
        this.collection = [];
        this.hide = (id) => {
            if (typeof id === 'string') {
                this.removeNotification(id);
            }
            else {
                this.clearNotifications();
            }
        };
        this.show = (payload) => {
            const { content, options = {} } = payload;
            const { position, autoClose } = this.props;
            const { notifications } = this.state;
            const id = options.id || `${~~(Math.random() * 1000000)}`;
            const opts = {
                id,
                type: options.type || 'none',
                onClose: () => this.removeNotification(id),
                position: options.position || position,
                title: options.title || capitalizeFirst(options.type || ''),
                actionRenderer: options.actionRenderer,
                autoClose: typeof options.autoClose === 'number' ? options.autoClose : autoClose,
            };
            this.collection.push({
                name: id,
                options: opts,
                content: this.getNotificationContent(content, opts.onClose),
            });
            this.setState({
                notifications: [...notifications, id],
            });
        };
        const { events } = props;
        this.eventManager = events || eventManagers[0];
        this.state = {
            notifications: [],
        };
    }
    componentDidMount() {
        const em = this.eventManager;
        em.on(NotificationAction.showNotification, this.show);
        em.on(NotificationAction.clearNotification, this.hide);
        eventManagers.push(em);
    }
    componentWillUnmount() {
        const em = this.eventManager;
        em.off(NotificationAction.showNotification, this.show);
        em.off(NotificationAction.clearNotification, this.hide);
        eventManagers.splice(eventManagers.lastIndexOf(em), 1);
    }
    removeNotification(id) {
        this.setState({
            notifications: this.state.notifications.filter(v => v !== id),
        });
    }
    clearNotifications() {
        this.setState({
            notifications: [],
        });
    }
    getNotificationContent(content, onClose) {
        if (React.isValidElement(content)) {
            return React.cloneElement(content, { onClose });
        }
        else if (typeof content === 'function') {
            return content({ onClose });
        }
        return content;
    }
    defaultNotificationRenderer(payload) {
        const { content, options = {} } = payload;
        return (React.createElement(ToastNotification, Object.assign({}, options, { title: options.title, key: `notification-${options.id}` }), content));
    }
    makeNotification(payload) {
        const { notificationRenderer } = this.props;
        const renderer = notificationRenderer || this.defaultNotificationRenderer;
        return renderer(payload);
    }
    render() {
        const { position = 'relative', width, newestOnTop = false } = this.props;
        const { notifications } = this.state;
        const notificationsToRender = {};
        const collection = this.collection.map((item, i) => ({
            id: item.name,
            item: item,
            index: i,
        }));
        if (newestOnTop) {
            collection.reverse();
        }
        collection.forEach(({ id, item, index }) => {
            const options = item.options || {};
            const itemPosition = options.position || position;
            notificationsToRender[itemPosition] || (notificationsToRender[itemPosition] = []);
            if (notifications.indexOf(id) !== -1) {
                notificationsToRender[itemPosition].push(this.makeNotification(item));
            }
            else {
                notificationsToRender[itemPosition].push(undefined);
                this.collection.splice(index, 1);
            }
        });
        return (React.createElement("div", null, Object.keys(notificationsToRender).map((position) => {
            const disablePointer = notificationsToRender[position].length === 1 && notificationsToRender[position][0] === null;
            return (React.createElement(StyledNotifications, { key: `notification-container-${position}`, width: width, position: position, disablePointer: disablePointer }, notificationsToRender[position]));
        })));
    }
}
Notifications.inner = {
    get ToastNotification() { return ToastNotification; },
    get StyledNotifications() { return StyledNotifications; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Ob3RpZmljYXRpb25zL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLE1BQU0sRUFBRSxFQUFFLEdBQUcsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2pELE9BQU8sRUFBZ0Usa0JBQWtCLEdBQTZDLE1BQU0sU0FBUyxDQUFDO0FBQ3RKLE9BQU8sRUFBZ0IsYUFBYSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDdkUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzdELE9BQU8sRUFBb0Ysa0JBQWtCLEdBQUcsTUFBTSxTQUFTLENBQUM7QUFDaEksT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFlBQVksQ0FBQztBQW9EcEMsTUFBTSxZQUFZLEdBQUc7SUFDakIsS0FBSyxFQUFFLEdBQUc7Q0FDYixDQUFDO0FBQ0YsTUFBTSw0QkFBNEIsR0FBRyxDQUFDLEdBQTBCLEVBQUUsRUFBRTtJQUNoRSxJQUFJLGFBQWEsR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztJQUNqRCxJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7UUFDOUIsYUFBYSxJQUFJLHNDQUFzQyxDQUFDO0tBQzNEO1NBQ0k7UUFDRCxhQUFhLElBQUksR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7S0FDakQ7SUFDRCxPQUFPLGFBQWEsQ0FBQztBQUN6QixDQUFDLENBQUM7QUFDRixNQUFNLGlCQUFpQixHQUFH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QUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ3BELElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQzthQUNwQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxDQUFDLGlDQUNQLE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUErQixFQUFFLEVBQUU7WUFDeEUsTUFBTSxjQUFjLEdBQUcscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUM7WUFDbkgsT0FBTyxDQUFDLG9CQUFDLG1CQUFtQixJQUFDLEdBQUcsRUFBRSwwQkFBMEIsUUFBUSxFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxjQUFjLElBQ3JJLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUNaLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FDRSxDQUFDLENBQUM7SUFDVixDQUFDOztBQUNNLG1CQUFLLEdBQUc7SUFDWCxJQUFJLGlCQUFpQixLQUFLLE9BQU8saUJBQTZDLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLElBQUksbUJBQW1CLEtBQUssT0FBTyxtQkFBaUQsQ0FBQyxDQUFDLENBQUM7Q0FDMUYsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgY3NzIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbk9wdGlvbiwgTm90aWZpY2F0aW9uUHJvcHMsIE5vdGlmaWNhdGlvbnNQb3NpdGlvbiwgTm90aWZpY2F0aW9uQWN0aW9uLCBOb3RpZmljYXRpb25PcHRpb25zLCBOb3RpZmljYXRpb25Db250ZW50LCB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyLCBldmVudE1hbmFnZXJzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXZlbnRNYW5hZ2VyJztcbmltcG9ydCB7IGNhcGl0YWxpemVGaXJzdCB9IGZyb20gJy4uLy4uL3V0aWxzL3RleHQnO1xuaW1wb3J0IHsgVG9hc3ROb3RpZmljYXRpb24gfSBmcm9tICcuL1RvYXN0Tm90aWZpY2F0aW9uLnBhcnQnO1xuZXhwb3J0IHsgTm90aWZpY2F0aW9uc1Bvc2l0aW9uLCBOb3RpZmljYXRpb25PcHRpb24sIE5vdGlmaWNhdGlvblR5cGUsIE5vdGlmaWNhdGlvbk9wdGlvbnMsIE5vdGlmaWNhdGlvbkFjdGlvbiwgfSBmcm9tICcuL3R5cGVzJztcbmV4cG9ydCB7IG5vdGlmeSB9IGZyb20gJy4vbm90aWZpZXInO1xuZXhwb3J0IGludGVyZmFjZSBOb3RpZmljYXRpb25zUHJvcHMge1xuICAgIC8qKlxuICAgICAqIEN1c3RvbSBub3RpZmljYXRpb24gcmVuZGVyZXIgY29tcG9uZW50LlxuICAgICAqL1xuICAgIG5vdGlmaWNhdGlvblJlbmRlcmVyPyhlOiBOb3RpZmljYXRpb25PcHRpb25zKTogUmVhY3QuUmVhY3RDaGlsZDtcbiAgICAvKipcbiAgICAgKiBUaGUgZGVmYXVsdCBwb3NpdGlvbiBmb3IgbmV3IG5vdGlmaWNhdGlvbnMuIEJ5IGRlZmF1bHQgcmVsYXRpdmUuXG4gICAgICogQGRlZmF1bHQgcmVsYXRpdmVcbiAgICAgKi9cbiAgICBwb3NpdGlvbj86IE5vdGlmaWNhdGlvbnNQb3NpdGlvbjtcbiAgICAvKipcbiAgICAgKiBEaXNhYmxlIHRoZSBwb2ludGVyIHN5bWJvbC4gQnkgZGVmYXVsdCBlbmFibGVkLlxuICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICovXG4gICAgZGlzYWJsZVBvaW50ZXI/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIFRoZSB3aWR0aCB0byBiZSB1c2VkLCBieSBkZWZhdWx0IGF1dG8uXG4gICAgICogQGRlZmF1bHQgYXV0b1xuICAgICAqL1xuICAgIHdpZHRoPzogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIEF1dG9tYXRpY2FsbHkgY2xvc2VzIG5vdGlmaWNhdGlvbnMgYWZ0ZXIgYSBjZXJ0YWluIHRpbWUuIEJ5IGRlZmF1bHRcbiAgICAgKiB0aGUgbm90aWZpY2F0aW9ucyBhcmUgbm90IGNsb3NlZC5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIGF1dG9DbG9zZT86IGZhbHNlIHwgbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIGxhdGVzdCBvbiB0b3AuIEJ5IGRlZmF1bHQgbGF0ZXN0IG5vdGlmaWNhdGlvbnMgYXJlIHNob3duIGJlbG93LlxuICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICovXG4gICAgbmV3ZXN0T25Ub3A/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGV2ZW50IG1hbmFnZXIgdG8gdXNlLiBCeSBkZWZhdWx0IGEgc3RhbmRhcmQgZXZlbnQgbWFuYWdlciBpcyB1c2VkLlxuICAgICAqL1xuICAgIGV2ZW50cz86IEV2ZW50TWFuYWdlcjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgTm90aWZpY2F0aW9uc1N0YXRlIHtcbiAgICBub3RpZmljYXRpb25zOiBBcnJheTxzdHJpbmc+O1xufVxuZXhwb3J0IGludGVyZmFjZSBTdHlsZWROb3RpZmljYXRpb25zUHJvcHMge1xuICAgIHBvc2l0aW9uPzogTm90aWZpY2F0aW9uc1Bvc2l0aW9uO1xuICAgIGRpc2FibGVQb2ludGVyPzogYm9vbGVhbjtcbiAgICB3aWR0aD86IG51bWJlcjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgQWJzb2x1dGVDb250YWluZXJQcm9wcyB7XG4gICAgcG9zaXRpb246IE5vdGlmaWNhdGlvbnNQb3NpdGlvbjtcbiAgICB3aWR0aDogbnVtYmVyO1xufVxuaW50ZXJmYWNlIE5vdGlmaWNhdGlvbkVudHJ5IGV4dGVuZHMgTm90aWZpY2F0aW9uT3B0aW9ucyB7XG4gICAgbmFtZTogc3RyaW5nO1xufVxuY29uc3QgZGVmYXVsdFByb3BzID0ge1xuICAgIHdpZHRoOiAzMjAsXG59O1xuY29uc3QgZ2V0Tm90aWZpY2F0aW9uUG9zaXRpb25TdHlsZSA9IChwb3M6IE5vdGlmaWNhdGlvbnNQb3NpdGlvbikgPT4ge1xuICAgIGxldCBwb3NpdGlvblN0eWxlID0gYCR7cG9zLnNwbGl0KCctJylbMF19OjFyZW07YDtcbiAgICBpZiAocG9zLmluZGV4T2YoJ2NlbnRlcicpICE9PSAtMSkge1xuICAgICAgICBwb3NpdGlvblN0eWxlICs9IGBsZWZ0OjUwJTt0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTtgO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcG9zaXRpb25TdHlsZSArPSBgJHtwb3Muc3BsaXQoJy0nKVsxXX06MXJlbTtgO1xuICAgIH1cbiAgICByZXR1cm4gcG9zaXRpb25TdHlsZTtcbn07XG5jb25zdCBBYnNvbHV0ZUNvbnRhaW5lciA9IGNzczxBYnNvbHV0ZUNvbnRhaW5lclByb3BzPiBgXG4gIHotaW5kZXg6IDEwMDAxO1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gICR7cHJvcHMgPT4gZ2V0Tm90aWZpY2F0aW9uUG9zaXRpb25TdHlsZShwcm9wcy5wb3NpdGlvbil9O1xuICB3aWR0aDogJHtwcm9wcyA9PiAocHJvcHMud2lkdGggPyBwcm9wcy53aWR0aCA6IGRlZmF1bHRQcm9wcy53aWR0aCl9cHg7XG4gIEBtZWRpYSAobWF4LXdpZHRoOiA0ODBweCkge1xuICAgIHdpZHRoOiAxMDB2dztcbiAgICBwYWRkaW5nOiAwO1xuICAgIHJpZ2h0OiAwO1xuICAgIG1hcmdpbjogMDtcbiAgICBwb3NpdGlvbjogZml4ZWQ7XG4gICAgJHtwcm9wcyA9PiAocHJvcHMucG9zaXRpb24uc3Vic3RyaW5nKDAsIDMpID09PSAndG9wJyA/ICd0b3A6IDAnIDogJ2JvdHRvbTogMCcpfTtcbiAgfVxuYDtcbmNvbnN0IFN0eWxlZE5vdGlmaWNhdGlvbnMgPSBzdHlsZWQuZGl2PFN0eWxlZE5vdGlmaWNhdGlvbnNQcm9wcz4gYFxuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICB3aWR0aDogJHtwcm9wcyA9PiAoIXByb3BzLndpZHRoID8gJ2F1dG8nIDogYCR7cHJvcHMud2lkdGh9cHhgKX07XG4gICR7cHJvcHMgPT4gKHByb3BzLmRpc2FibGVQb2ludGVyID8gYHBvaW50ZXItZXZlbnRzOiBub25lYCA6IGBgKX07XG4gIEBtZWRpYSAobWF4LXdpZHRoOiA0ODBweCkge1xuICAgIHBhZGRpbmc6IDA7XG4gICAgbWFyZ2luOiAwO1xuICB9XG4gICR7cHJvcHMgPT4gKHByb3BzLnBvc2l0aW9uICE9PSAncmVsYXRpdmUnID8gQWJzb2x1dGVDb250YWluZXIgOiAnJyl9O1xuYDtcbmludGVyZmFjZSBOb3RpZmljYXRpb25DbG9zZSB7XG4gICAgKCk6IHZvaWQ7XG59XG4vKipcbiAqIFRoZSBob3N0IGVsZW1lbnQgZm9yIGFyYml0cmFyeSBub3RpZmljYXRpb25zLiBVc2UgYXMgYSBzaW5nbGV0b24gb25seS5cbiAqL1xuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvbnMgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8Tm90aWZpY2F0aW9uc1Byb3BzLCBOb3RpZmljYXRpb25zU3RhdGU+IHtcbiAgICBwcml2YXRlIGNvbGxlY3Rpb246IEFycmF5PE5vdGlmaWNhdGlvbkVudHJ5PiA9IFtdO1xuICAgIHByaXZhdGUgZXZlbnRNYW5hZ2VyOiBFdmVudE1hbmFnZXI7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IE5vdGlmaWNhdGlvbnNQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIGNvbnN0IHsgZXZlbnRzIH0gPSBwcm9wcztcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSBldmVudHMgfHwgZXZlbnRNYW5hZ2Vyc1swXTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnM6IFtdLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgZW0gPSB0aGlzLmV2ZW50TWFuYWdlcjtcbiAgICAgICAgZW0ub24oTm90aWZpY2F0aW9uQWN0aW9uLnNob3dOb3RpZmljYXRpb24sIHRoaXMuc2hvdyk7XG4gICAgICAgIGVtLm9uKE5vdGlmaWNhdGlvbkFjdGlvbi5jbGVhck5vdGlmaWNhdGlvbiwgdGhpcy5oaWRlKTtcbiAgICAgICAgZXZlbnRNYW5hZ2Vycy5wdXNoKGVtKTtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IGVtID0gdGhpcy5ldmVudE1hbmFnZXI7XG4gICAgICAgIGVtLm9mZihOb3RpZmljYXRpb25BY3Rpb24uc2hvd05vdGlmaWNhdGlvbiwgdGhpcy5zaG93KTtcbiAgICAgICAgZW0ub2ZmKE5vdGlmaWNhdGlvbkFjdGlvbi5jbGVhck5vdGlmaWNhdGlvbiwgdGhpcy5oaWRlKTtcbiAgICAgICAgZXZlbnRNYW5hZ2Vycy5zcGxpY2UoZXZlbnRNYW5hZ2Vycy5sYXN0SW5kZXhPZihlbSksIDEpO1xuICAgIH1cbiAgICBwcml2YXRlIHJlbW92ZU5vdGlmaWNhdGlvbihpZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uczogdGhpcy5zdGF0ZS5ub3RpZmljYXRpb25zLmZpbHRlcih2ID0+IHYgIT09IGlkKSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgY2xlYXJOb3RpZmljYXRpb25zKCkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnM6IFtdLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBnZXROb3RpZmljYXRpb25Db250ZW50KGNvbnRlbnQ6IE5vdGlmaWNhdGlvbkNvbnRlbnQsIG9uQ2xvc2U/OiBOb3RpZmljYXRpb25DbG9zZSkge1xuICAgICAgICBpZiAoUmVhY3QuaXNWYWxpZEVsZW1lbnQoY29udGVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY29udGVudCwgeyBvbkNsb3NlIH0gYXMgTm90aWZpY2F0aW9uUHJvcHMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBjb250ZW50ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udGVudCh7IG9uQ2xvc2UgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XG4gICAgfVxuICAgIHByaXZhdGUgaGlkZSA9IChpZDogc3RyaW5nKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgaWQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZU5vdGlmaWNhdGlvbihpZCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyTm90aWZpY2F0aW9ucygpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIHNob3cgPSAocGF5bG9hZDogTm90aWZpY2F0aW9uT3B0aW9ucykgPT4ge1xuICAgICAgICBjb25zdCB7IGNvbnRlbnQsIG9wdGlvbnMgPSB7fSB9ID0gcGF5bG9hZDtcbiAgICAgICAgY29uc3QgeyBwb3NpdGlvbiwgYXV0b0Nsb3NlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IG5vdGlmaWNhdGlvbnMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IGlkID0gb3B0aW9ucy5pZCB8fCBgJHt+fihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCl9YDtcbiAgICAgICAgY29uc3Qgb3B0czogTm90aWZpY2F0aW9uT3B0aW9uID0ge1xuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB0eXBlOiBvcHRpb25zLnR5cGUgfHwgJ25vbmUnLFxuICAgICAgICAgICAgb25DbG9zZTogKCkgPT4gdGhpcy5yZW1vdmVOb3RpZmljYXRpb24oaWQpLFxuICAgICAgICAgICAgcG9zaXRpb246IG9wdGlvbnMucG9zaXRpb24gfHwgcG9zaXRpb24sXG4gICAgICAgICAgICB0aXRsZTogb3B0aW9ucy50aXRsZSB8fCBjYXBpdGFsaXplRmlyc3Qob3B0aW9ucy50eXBlIHx8ICcnKSxcbiAgICAgICAgICAgIGFjdGlvblJlbmRlcmVyOiBvcHRpb25zLmFjdGlvblJlbmRlcmVyLFxuICAgICAgICAgICAgYXV0b0Nsb3NlOiB0eXBlb2Ygb3B0aW9ucy5hdXRvQ2xvc2UgPT09ICdudW1iZXInID8gb3B0aW9ucy5hdXRvQ2xvc2UgOiBhdXRvQ2xvc2UsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbi5wdXNoKHtcbiAgICAgICAgICAgIG5hbWU6IGlkLFxuICAgICAgICAgICAgb3B0aW9uczogb3B0cyxcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMuZ2V0Tm90aWZpY2F0aW9uQ29udGVudChjb250ZW50LCBvcHRzLm9uQ2xvc2UpLFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBub3RpZmljYXRpb25zOiBbLi4ubm90aWZpY2F0aW9ucywgaWRdLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHByaXZhdGUgZGVmYXVsdE5vdGlmaWNhdGlvblJlbmRlcmVyKHBheWxvYWQ6IE5vdGlmaWNhdGlvbk9wdGlvbnMpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50LCBvcHRpb25zID0ge30gfSA9IHBheWxvYWQ7XG4gICAgICAgIHJldHVybiAoPFRvYXN0Tm90aWZpY2F0aW9uIHsuLi5vcHRpb25zfSB0aXRsZT17b3B0aW9ucy50aXRsZX0ga2V5PXtgbm90aWZpY2F0aW9uLSR7b3B0aW9ucy5pZH1gfT5cbiAgICAgICAge2NvbnRlbnR9XG4gICAgICA8L1RvYXN0Tm90aWZpY2F0aW9uPik7XG4gICAgfVxuICAgIHByaXZhdGUgbWFrZU5vdGlmaWNhdGlvbihwYXlsb2FkOiBOb3RpZmljYXRpb25PcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHsgbm90aWZpY2F0aW9uUmVuZGVyZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHJlbmRlcmVyID0gbm90aWZpY2F0aW9uUmVuZGVyZXIgfHwgdGhpcy5kZWZhdWx0Tm90aWZpY2F0aW9uUmVuZGVyZXI7XG4gICAgICAgIHJldHVybiByZW5kZXJlcihwYXlsb2FkKTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHBvc2l0aW9uID0gJ3JlbGF0aXZlJywgd2lkdGgsIG5ld2VzdE9uVG9wID0gZmFsc2UgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgbm90aWZpY2F0aW9ucyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uc1RvUmVuZGVyID0ge307XG4gICAgICAgIGNvbnN0IGNvbGxlY3Rpb24gPSB0aGlzLmNvbGxlY3Rpb24ubWFwKChpdGVtLCBpKSA9PiAoe1xuICAgICAgICAgICAgaWQ6IGl0ZW0ubmFtZSxcbiAgICAgICAgICAgIGl0ZW06IGl0ZW0sXG4gICAgICAgICAgICBpbmRleDogaSxcbiAgICAgICAgfSkpO1xuICAgICAgICBpZiAobmV3ZXN0T25Ub3ApIHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb24ucmV2ZXJzZSgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbGxlY3Rpb24uZm9yRWFjaCgoeyBpZCwgaXRlbSwgaW5kZXggfSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGl0ZW0ub3B0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1Qb3NpdGlvbiA9IG9wdGlvbnMucG9zaXRpb24gfHwgcG9zaXRpb247XG4gICAgICAgICAgICBub3RpZmljYXRpb25zVG9SZW5kZXJbaXRlbVBvc2l0aW9uXSB8fCAobm90aWZpY2F0aW9uc1RvUmVuZGVyW2l0ZW1Qb3NpdGlvbl0gPSBbXSk7XG4gICAgICAgICAgICBpZiAobm90aWZpY2F0aW9ucy5pbmRleE9mKGlkKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zVG9SZW5kZXJbaXRlbVBvc2l0aW9uXS5wdXNoKHRoaXMubWFrZU5vdGlmaWNhdGlvbihpdGVtKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zVG9SZW5kZXJbaXRlbVBvc2l0aW9uXS5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgIHtPYmplY3Qua2V5cyhub3RpZmljYXRpb25zVG9SZW5kZXIpLm1hcCgocG9zaXRpb246IE5vdGlmaWNhdGlvbnNQb3NpdGlvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGlzYWJsZVBvaW50ZXIgPSBub3RpZmljYXRpb25zVG9SZW5kZXJbcG9zaXRpb25dLmxlbmd0aCA9PT0gMSAmJiBub3RpZmljYXRpb25zVG9SZW5kZXJbcG9zaXRpb25dWzBdID09PSBudWxsO1xuICAgICAgICAgICAgcmV0dXJuICg8U3R5bGVkTm90aWZpY2F0aW9ucyBrZXk9e2Bub3RpZmljYXRpb24tY29udGFpbmVyLSR7cG9zaXRpb259YH0gd2lkdGg9e3dpZHRofSBwb3NpdGlvbj17cG9zaXRpb259IGRpc2FibGVQb2ludGVyPXtkaXNhYmxlUG9pbnRlcn0+XG4gICAgICAgICAgICAgIHtub3RpZmljYXRpb25zVG9SZW5kZXJbcG9zaXRpb25dfVxuICAgICAgICAgICAgPC9TdHlsZWROb3RpZmljYXRpb25zPik7XG4gICAgICAgIH0pfVxuICAgICAgPC9kaXY+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgVG9hc3ROb3RpZmljYXRpb24oKSB7IHJldHVybiBUb2FzdE5vdGlmaWNhdGlvbiBhcyB0eXBlb2YgVG9hc3ROb3RpZmljYXRpb247IH0sXG4gICAgICAgIGdldCBTdHlsZWROb3RpZmljYXRpb25zKCkgeyByZXR1cm4gU3R5bGVkTm90aWZpY2F0aW9ucyBhcyB0eXBlb2YgU3R5bGVkTm90aWZpY2F0aW9uczsgfVxuICAgIH07XG59XG4iXX0=