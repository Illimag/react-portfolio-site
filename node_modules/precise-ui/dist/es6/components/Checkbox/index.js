var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { css, themed } from '../../utils/styled';
import { light } from '../../themes';
import { Label } from '../Label';
import { Icon } from '../Icon';
import { withFormContext } from '../../hoc';
import { withGroupContext } from '../../hoc/withGroupContext';
import { InputNotification } from '../InputNotification';
import { PaddedContainer } from '../PaddedContainer';
const CheckboxContainer = styled('div') `
  position: relative;
  display: inline-block;
  opacity: ${props => (props.disabled ? '0.5' : '1.0')};
  cursor: ${props => (props.disabled ? 'not-allowed' : 'pointer')};
`;
const CheckboxBox = styled('div')(themed(({ disabled, checked, theme: { ui0, ui1, ui4, ui5 } }) => css `
      outline: 0;
      flex: 0 0 1.0625em;
      max-width: 1.0625em;
      height: 1.0625em;
      position: relative;
      background: ${checked ? ui5 : ui1};
      transition: all 0.2s cubic-bezier(0, 0, 0.25, 1);
      overflow: hidden;
      border-radius: 2px;
      border: 2px solid ${disabled ? (checked ? ui5 : ui4) : ui5};
      box-sizing: border-box;

      &:focus {
        outline: ${ui0} solid 2px;
      }

      > i {
        position: relative;
        top: -2px;
        left: -2px;
        transition: all 0.2s;
        opacity: ${checked ? '1' : '0'};
        transform: ${checked ? 'scale(1)' : 'scale(0)'};
      }
    `));
const RealCheckbox = styled.input `
  display: none;
`;
const FlexContainer = styled.div `
  display: flex;
  padding-right: 0.25em;
  align-items: ${({ withInputInfo }) => (withInputInfo ? 'start' : 'center')};
`;
export class CheckboxInt extends React.PureComponent {
    constructor(props) {
        super(props);
        this.setValue = (value) => {
            const { onChange } = this.props;
            this.setState({
                value,
            });
            if (typeof onChange === 'function') {
                onChange({
                    value,
                });
            }
        };
        this.toggle = () => {
            const { onChange, disabled, form, group, name = '' } = this.props;
            if (!disabled) {
                const { controlled, value } = this.state;
                const checked = !value;
                if (!controlled) {
                    if (group) {
                        group.select(this);
                    }
                    else if (form) {
                        form.change({
                            name,
                            value: checked,
                        });
                    }
                    else {
                        this.setState({
                            value: checked,
                        });
                    }
                }
                if (typeof onChange === 'function') {
                    onChange({
                        value: checked,
                    });
                }
            }
        };
        this.changeValue = (e) => {
            this.toggle();
            e.preventDefault();
        };
        this.control = (e) => {
            switch (e.keyCode) {
                case 13 /* enter */:
                case 32 /* space */:
                    this.toggle();
                    break;
                default:
                    return;
            }
            e.stopPropagation();
            e.preventDefault();
        };
        this.name = props.name;
        this.state = {
            controlled: typeof props.value !== 'undefined',
            value: props.value || props.defaultValue || false,
            error: props.error,
        };
    }
    UNSAFE_componentWillReceiveProps({ value = false, error }) {
        if (this.state.controlled) {
            this.setState({ value });
        }
        this.setState({ error });
    }
    componentDidMount() {
        const { group, form } = this.props;
        const { controlled } = this.state;
        if (!controlled) {
            if (group) {
                group.subscribe(this);
            }
            else if (form) {
                form.subscribe(this);
            }
        }
    }
    componentWillUnmount() {
        const { group, form } = this.props;
        const { controlled } = this.state;
        if (!controlled) {
            if (group) {
                group.unsubscribe(this);
            }
            else if (form) {
                form.unsubscribe(this);
            }
        }
    }
    render() {
        const _a = this.props, { children, disabled, theme, value: _0, defaultValue: _1, onChange: _2, onInput: _3, info } = _a, props = __rest(_a, ["children", "disabled", "theme", "value", "defaultValue", "onChange", "onInput", "info"]);
        const { value, error } = this.state;
        const containerProps = Object.assign({}, props, { theme, onClick: this.changeValue, disabled });
        const boxProps = {
            checked: value,
            disabled: !!disabled,
            onKeyDown: this.control,
            theme,
            tabIndex: disabled ? undefined : 0,
        };
        const InputInfo = (error || info) && (React.createElement(PaddedContainer, { top: "xsmall", bottom: "xsmall" },
            React.createElement(InputNotification, { error: error, info: info })));
        return (React.createElement(CheckboxContainer, Object.assign({}, containerProps),
            React.createElement(RealCheckbox, { type: "checkbox", defaultChecked: value }),
            React.createElement(FlexContainer, { withInputInfo: !!(error || info) },
                React.createElement(CheckboxBox, Object.assign({}, boxProps),
                    React.createElement(Icon, { name: "Check", color: theme ? theme.ui1 : light.ui1, size: 1.0625 })),
                children && (React.createElement(Label, { attached: true, theme: theme },
                    children,
                    InputInfo))),
            !children && InputInfo));
    }
}
CheckboxInt.inner = {
    get PaddedContainer() { return PaddedContainer; },
    get InputNotification() { return InputNotification; },
    get CheckboxContainer() { return CheckboxContainer; },
    get RealCheckbox() { return RealCheckbox; },
    get FlexContainer() { return FlexContainer; },
    get CheckboxBox() { return CheckboxBox; },
    get Icon() { return Icon; },
    get Label() { return Label; }
};
/**
 * The checkbox input field.
 */
export const Checkbox = withFormContext(withGroupContext(CheckboxInt));
Checkbox.displayName = 'Checkbox';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9DaGVja2JveC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDekQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNyQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFL0IsT0FBTyxFQUFvQixlQUFlLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDOUQsT0FBTyxFQUFxQixnQkFBZ0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBRWpGLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQXFCckQsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQXlCOzs7YUFHbkQsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQzFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztDQUNoRSxDQUFDO0FBQ0YsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFtQixNQUFNLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDOzs7Ozs7b0JBTXJHLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHOzs7OzBCQUliLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUc7Ozs7bUJBSTdDLEdBQUc7Ozs7Ozs7O21CQVFILE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHO3FCQUNqQixPQUFPLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVTs7S0FFakQsQ0FBQyxDQUFDLENBQUM7QUFDUixNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDOztDQUVqQyxDQUFDO0FBQ0YsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FFN0I7OztpQkFHYyxDQUFDLEVBQUUsYUFBYSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztDQUMzRSxDQUFDO0FBQ0YsTUFBTSxPQUFPLFdBQVksU0FBUSxLQUFLLENBQUMsYUFBMkM7SUFFOUUsWUFBWSxLQUFvQjtRQUM1QixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFzQ2pCLGFBQVEsR0FBRyxDQUFDLEtBQWMsRUFBRSxFQUFFO1lBQzFCLE1BQU0sRUFBRSxRQUFRLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ2hDLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQ1YsS0FBSzthQUNSLENBQUMsQ0FBQztZQUNILElBQUksT0FBTyxRQUFRLEtBQUssVUFBVSxFQUFFO2dCQUNoQyxRQUFRLENBQUM7b0JBQ0wsS0FBSztpQkFDUixDQUFDLENBQUM7YUFDTjtRQUNMLENBQUMsQ0FBQztRQUNNLFdBQU0sR0FBRyxHQUFHLEVBQUU7WUFDbEIsTUFBTSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUNsRSxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNYLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztnQkFDekMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxVQUFVLEVBQUU7b0JBQ2IsSUFBSSxLQUFLLEVBQUU7d0JBQ1AsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztxQkFDdEI7eUJBQ0ksSUFBSSxJQUFJLEVBQUU7d0JBQ1gsSUFBSSxDQUFDLE1BQU0sQ0FBQzs0QkFDUixJQUFJOzRCQUNKLEtBQUssRUFBRSxPQUFPO3lCQUNqQixDQUFDLENBQUM7cUJBQ047eUJBQ0k7d0JBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQzs0QkFDVixLQUFLLEVBQUUsT0FBTzt5QkFDakIsQ0FBQyxDQUFDO3FCQUNOO2lCQUNKO2dCQUNELElBQUksT0FBTyxRQUFRLEtBQUssVUFBVSxFQUFFO29CQUNoQyxRQUFRLENBQUM7d0JBQ0wsS0FBSyxFQUFFLE9BQU87cUJBQ2pCLENBQUMsQ0FBQztpQkFDTjthQUNKO1FBQ0wsQ0FBQyxDQUFDO1FBQ00sZ0JBQVcsR0FBRyxDQUFDLENBQW1DLEVBQUUsRUFBRTtZQUMxRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDZCxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdkIsQ0FBQyxDQUFDO1FBQ00sWUFBTyxHQUFHLENBQUMsQ0FBc0MsRUFBRSxFQUFFO1lBQ3pELFFBQVEsQ0FBQyxDQUFDLE9BQU8sRUFBRTtnQkFDZixvQkFBb0I7Z0JBQ3BCO29CQUNJLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztvQkFDZCxNQUFNO2dCQUNWO29CQUNJLE9BQU87YUFDZDtZQUNELENBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUNwQixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdkIsQ0FBQyxDQUFDO1FBM0ZFLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1QsVUFBVSxFQUFFLE9BQU8sS0FBSyxDQUFDLEtBQUssS0FBSyxXQUFXO1lBQzlDLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxZQUFZLElBQUksS0FBSztZQUNqRCxLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7U0FDckIsQ0FBQztJQUNOLENBQUM7SUFDRCxnQ0FBZ0MsQ0FBQyxFQUFFLEtBQUssR0FBRyxLQUFLLEVBQUUsS0FBSyxFQUFpQjtRQUNwRSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFO1lBQ3ZCLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1NBQzVCO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNELGlCQUFpQjtRQUNiLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNuQyxNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNsQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2IsSUFBSSxLQUFLLEVBQUU7Z0JBQ1AsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN6QjtpQkFDSSxJQUFJLElBQUksRUFBRTtnQkFDWCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3hCO1NBQ0o7SUFDTCxDQUFDO0lBQ0Qsb0JBQW9CO1FBQ2hCLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNuQyxNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNsQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2IsSUFBSSxLQUFLLEVBQUU7Z0JBQ1AsS0FBSyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUMzQjtpQkFDSSxJQUFJLElBQUksRUFBRTtnQkFDWCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQzFCO1NBQ0o7SUFDTCxDQUFDO0lBd0RELE1BQU07UUFDRixNQUFNLGVBQWtILEVBQWxILEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxJQUFJLE9BQXlCLEVBQXZCLDZHQUF1QixDQUFDO1FBQ3pILE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNwQyxNQUFNLGNBQWMscUJBQ2IsS0FBSyxJQUNSLEtBQUssRUFDTCxPQUFPLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFDekIsUUFBUSxHQUNYLENBQUM7UUFDRixNQUFNLFFBQVEsR0FBRztZQUNiLE9BQU8sRUFBRSxLQUFLO1lBQ2QsUUFBUSxFQUFFLENBQUMsQ0FBQyxRQUFRO1lBQ3BCLFNBQVMsRUFBRSxJQUFJLENBQUMsT0FBTztZQUN2QixLQUFLO1lBQ0wsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3JDLENBQUM7UUFDRixNQUFNLFNBQVMsR0FBRyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFDLGVBQWUsSUFBQyxHQUFHLEVBQUMsUUFBUSxFQUFDLE1BQU0sRUFBQyxRQUFRO1lBQ25GLG9CQUFDLGlCQUFpQixJQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksR0FBRyxDQUM5QixDQUFDLENBQUM7UUFDbEIsT0FBTyxDQUFDLG9CQUFDLGlCQUFpQixvQkFBSyxjQUFjO1lBQzdDLG9CQUFDLFlBQVksSUFBQyxJQUFJLEVBQUMsVUFBVSxFQUFDLGNBQWMsRUFBRSxLQUFLLEdBQUc7WUFDdEQsb0JBQUMsYUFBYSxJQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDO2dCQUM3QyxvQkFBQyxXQUFXLG9CQUFLLFFBQVE7b0JBQ3ZCLG9CQUFDLElBQUksSUFBQyxJQUFJLEVBQUMsT0FBTyxFQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sR0FBRyxDQUM1RDtnQkFDYixRQUFRLElBQUksQ0FBQyxvQkFBQyxLQUFLLElBQUMsUUFBUSxRQUFDLEtBQUssRUFBRSxLQUFLO29CQUNyQyxRQUFRO29CQUNSLFNBQVMsQ0FDSixDQUFDLENBQ0c7WUFDZixDQUFDLFFBQVEsSUFBSSxTQUFTLENBQ0wsQ0FBQyxDQUFDO0lBQ3hCLENBQUM7O0FBQ00saUJBQUssR0FBRztJQUNYLElBQUksZUFBZSxLQUFLLE9BQU8sZUFBeUMsQ0FBQyxDQUFDLENBQUM7SUFDM0UsSUFBSSxpQkFBaUIsS0FBSyxPQUFPLGlCQUE2QyxDQUFDLENBQUMsQ0FBQztJQUNqRixJQUFJLGlCQUFpQixLQUFLLE9BQU8saUJBQTZDLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLElBQUksWUFBWSxLQUFLLE9BQU8sWUFBbUMsQ0FBQyxDQUFDLENBQUM7SUFDbEUsSUFBSSxhQUFhLEtBQUssT0FBTyxhQUFxQyxDQUFDLENBQUMsQ0FBQztJQUNyRSxJQUFJLFdBQVcsS0FBSyxPQUFPLFdBQWlDLENBQUMsQ0FBQyxDQUFDO0lBQy9ELElBQUksSUFBSSxLQUFLLE9BQU8sSUFBbUIsQ0FBQyxDQUFDLENBQUM7SUFDMUMsSUFBSSxLQUFLLEtBQUssT0FBTyxLQUFxQixDQUFDLENBQUMsQ0FBQztDQUNoRCxDQUFDO0FBRU47O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsZUFBZSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7QUFDdkUsUUFBUSxDQUFDLFdBQVcsR0FBRyxVQUFVLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IGNzcywgdGhlbWVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IGxpZ2h0IH0gZnJvbSAnLi4vLi4vdGhlbWVzJztcbmltcG9ydCB7IExhYmVsIH0gZnJvbSAnLi4vTGFiZWwnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgSW5wdXRDaGFuZ2VFdmVudCwgSW5wdXRQcm9wcyB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5pbXBvcnQgeyBGb3JtQ29udGV4dFByb3BzLCB3aXRoRm9ybUNvbnRleHQgfSBmcm9tICcuLi8uLi9ob2MnO1xuaW1wb3J0IHsgR3JvdXBDb250ZXh0UHJvcHMsIHdpdGhHcm91cENvbnRleHQgfSBmcm9tICcuLi8uLi9ob2Mvd2l0aEdyb3VwQ29udGV4dCc7XG5pbXBvcnQgeyBLZXlDb2RlcyB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7IElucHV0Tm90aWZpY2F0aW9uIH0gZnJvbSAnLi4vSW5wdXROb3RpZmljYXRpb24nO1xuaW1wb3J0IHsgUGFkZGVkQ29udGFpbmVyIH0gZnJvbSAnLi4vUGFkZGVkQ29udGFpbmVyJztcbmV4cG9ydCB0eXBlIENoZWNrYm94Q2hhbmdlRXZlbnQgPSBJbnB1dENoYW5nZUV2ZW50PGJvb2xlYW4+O1xuZXhwb3J0IGludGVyZmFjZSBDaGVja2JveFByb3BzIGV4dGVuZHMgSW5wdXRQcm9wczxib29sZWFuPiwgRm9ybUNvbnRleHRQcm9wcywgR3JvdXBDb250ZXh0UHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IG9mIHRoZSBjaGVja2JveC5cbiAgICAgKi9cbiAgICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgQ2hlY2tib3hTdGF0ZSB7XG4gICAgdmFsdWU6IGJvb2xlYW47XG4gICAgZXJyb3I/OiBSZWFjdC5SZWFjdENoaWxkO1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG59XG5pbnRlcmZhY2UgQ2hlY2tib3hDb250YWluZXJQcm9wcyB7XG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xufVxuaW50ZXJmYWNlIENoZWNrYm94Qm94UHJvcHMge1xuICAgIGNoZWNrZWQ6IGJvb2xlYW47XG4gICAgZGlzYWJsZWQ6IGJvb2xlYW47XG4gICAgdGhlbWU6IGFueTtcbn1cbmNvbnN0IENoZWNrYm94Q29udGFpbmVyID0gc3R5bGVkKCdkaXYnKTxDaGVja2JveENvbnRhaW5lclByb3BzPiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBvcGFjaXR5OiAke3Byb3BzID0+IChwcm9wcy5kaXNhYmxlZCA/ICcwLjUnIDogJzEuMCcpfTtcbiAgY3Vyc29yOiAke3Byb3BzID0+IChwcm9wcy5kaXNhYmxlZCA/ICdub3QtYWxsb3dlZCcgOiAncG9pbnRlcicpfTtcbmA7XG5jb25zdCBDaGVja2JveEJveCA9IHN0eWxlZCgnZGl2Jyk8Q2hlY2tib3hCb3hQcm9wcz4odGhlbWVkKCh7IGRpc2FibGVkLCBjaGVja2VkLCB0aGVtZTogeyB1aTAsIHVpMSwgdWk0LCB1aTUgfSB9KSA9PiBjc3MgYFxuICAgICAgb3V0bGluZTogMDtcbiAgICAgIGZsZXg6IDAgMCAxLjA2MjVlbTtcbiAgICAgIG1heC13aWR0aDogMS4wNjI1ZW07XG4gICAgICBoZWlnaHQ6IDEuMDYyNWVtO1xuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgYmFja2dyb3VuZDogJHtjaGVja2VkID8gdWk1IDogdWkxfTtcbiAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzIGN1YmljLWJlemllcigwLCAwLCAwLjI1LCAxKTtcbiAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICBib3JkZXItcmFkaXVzOiAycHg7XG4gICAgICBib3JkZXI6IDJweCBzb2xpZCAke2Rpc2FibGVkID8gKGNoZWNrZWQgPyB1aTUgOiB1aTQpIDogdWk1fTtcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG5cbiAgICAgICY6Zm9jdXMge1xuICAgICAgICBvdXRsaW5lOiAke3VpMH0gc29saWQgMnB4O1xuICAgICAgfVxuXG4gICAgICA+IGkge1xuICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICAgIHRvcDogLTJweDtcbiAgICAgICAgbGVmdDogLTJweDtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnM7XG4gICAgICAgIG9wYWNpdHk6ICR7Y2hlY2tlZCA/ICcxJyA6ICcwJ307XG4gICAgICAgIHRyYW5zZm9ybTogJHtjaGVja2VkID8gJ3NjYWxlKDEpJyA6ICdzY2FsZSgwKSd9O1xuICAgICAgfVxuICAgIGApKTtcbmNvbnN0IFJlYWxDaGVja2JveCA9IHN0eWxlZC5pbnB1dCBgXG4gIGRpc3BsYXk6IG5vbmU7XG5gO1xuY29uc3QgRmxleENvbnRhaW5lciA9IHN0eWxlZC5kaXY8e1xuICAgIHdpdGhJbnB1dEluZm8/OiBib29sZWFuO1xufT4gYFxuICBkaXNwbGF5OiBmbGV4O1xuICBwYWRkaW5nLXJpZ2h0OiAwLjI1ZW07XG4gIGFsaWduLWl0ZW1zOiAkeyh7IHdpdGhJbnB1dEluZm8gfSkgPT4gKHdpdGhJbnB1dEluZm8gPyAnc3RhcnQnIDogJ2NlbnRlcicpfTtcbmA7XG5leHBvcnQgY2xhc3MgQ2hlY2tib3hJbnQgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PENoZWNrYm94UHJvcHMsIENoZWNrYm94U3RhdGU+IHtcbiAgICByZWFkb25seSBuYW1lPzogc3RyaW5nO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBDaGVja2JveFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5uYW1lID0gcHJvcHMubmFtZTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHR5cGVvZiBwcm9wcy52YWx1ZSAhPT0gJ3VuZGVmaW5lZCcsXG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlIHx8IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IHByb3BzLmVycm9yLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyh7IHZhbHVlID0gZmFsc2UsIGVycm9yIH06IENoZWNrYm94UHJvcHMpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvciB9KTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZ3JvdXAsIGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICBpZiAoZ3JvdXApIHtcbiAgICAgICAgICAgICAgICBncm91cC5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgZm9ybS5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZ3JvdXAsIGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICBpZiAoZ3JvdXApIHtcbiAgICAgICAgICAgICAgICBncm91cC51bnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICBmb3JtLnVuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHNldFZhbHVlID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSB0b2dnbGUgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIGRpc2FibGVkLCBmb3JtLCBncm91cCwgbmFtZSA9ICcnIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIWRpc2FibGVkKSB7XG4gICAgICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQsIHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgY2hlY2tlZCA9ICF2YWx1ZTtcbiAgICAgICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgICAgIGlmIChncm91cCkge1xuICAgICAgICAgICAgICAgICAgICBncm91cC5zZWxlY3QodGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjaGVja2VkLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNoZWNrZWQsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjaGVja2VkLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIGNoYW5nZVZhbHVlID0gKGU6IFJlYWN0Lk1vdXNlRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHByaXZhdGUgY29udHJvbCA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuc3BhY2U6XG4gICAgICAgICAgICAgICAgdGhpcy50b2dnbGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBjaGlsZHJlbiwgZGlzYWJsZWQsIHRoZW1lLCB2YWx1ZTogXzAsIGRlZmF1bHRWYWx1ZTogXzEsIG9uQ2hhbmdlOiBfMiwgb25JbnB1dDogXzMsIGluZm8sIC4uLnByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBlcnJvciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgY29udGFpbmVyUHJvcHMgPSB7XG4gICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgIHRoZW1lLFxuICAgICAgICAgICAgb25DbGljazogdGhpcy5jaGFuZ2VWYWx1ZSxcbiAgICAgICAgICAgIGRpc2FibGVkLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBib3hQcm9wcyA9IHtcbiAgICAgICAgICAgIGNoZWNrZWQ6IHZhbHVlLFxuICAgICAgICAgICAgZGlzYWJsZWQ6ICEhZGlzYWJsZWQsXG4gICAgICAgICAgICBvbktleURvd246IHRoaXMuY29udHJvbCxcbiAgICAgICAgICAgIHRoZW1lLFxuICAgICAgICAgICAgdGFiSW5kZXg6IGRpc2FibGVkID8gdW5kZWZpbmVkIDogMCxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgSW5wdXRJbmZvID0gKGVycm9yIHx8IGluZm8pICYmICg8UGFkZGVkQ29udGFpbmVyIHRvcD1cInhzbWFsbFwiIGJvdHRvbT1cInhzbWFsbFwiPlxuICAgICAgICA8SW5wdXROb3RpZmljYXRpb24gZXJyb3I9e2Vycm9yfSBpbmZvPXtpbmZvfS8+XG4gICAgICA8L1BhZGRlZENvbnRhaW5lcj4pO1xuICAgICAgICByZXR1cm4gKDxDaGVja2JveENvbnRhaW5lciB7Li4uY29udGFpbmVyUHJvcHN9PlxuICAgICAgICA8UmVhbENoZWNrYm94IHR5cGU9XCJjaGVja2JveFwiIGRlZmF1bHRDaGVja2VkPXt2YWx1ZX0vPlxuICAgICAgICA8RmxleENvbnRhaW5lciB3aXRoSW5wdXRJbmZvPXshIShlcnJvciB8fCBpbmZvKX0+XG4gICAgICAgICAgPENoZWNrYm94Qm94IHsuLi5ib3hQcm9wc30+XG4gICAgICAgICAgICA8SWNvbiBuYW1lPVwiQ2hlY2tcIiBjb2xvcj17dGhlbWUgPyB0aGVtZS51aTEgOiBsaWdodC51aTF9IHNpemU9ezEuMDYyNX0vPlxuICAgICAgICAgIDwvQ2hlY2tib3hCb3g+XG4gICAgICAgICAge2NoaWxkcmVuICYmICg8TGFiZWwgYXR0YWNoZWQgdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgICAgICB7SW5wdXRJbmZvfVxuICAgICAgICAgICAgPC9MYWJlbD4pfVxuICAgICAgICA8L0ZsZXhDb250YWluZXI+XG4gICAgICAgIHshY2hpbGRyZW4gJiYgSW5wdXRJbmZvfVxuICAgICAgPC9DaGVja2JveENvbnRhaW5lcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBQYWRkZWRDb250YWluZXIoKSB7IHJldHVybiBQYWRkZWRDb250YWluZXIgYXMgdHlwZW9mIFBhZGRlZENvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IElucHV0Tm90aWZpY2F0aW9uKCkgeyByZXR1cm4gSW5wdXROb3RpZmljYXRpb24gYXMgdHlwZW9mIElucHV0Tm90aWZpY2F0aW9uOyB9LFxuICAgICAgICBnZXQgQ2hlY2tib3hDb250YWluZXIoKSB7IHJldHVybiBDaGVja2JveENvbnRhaW5lciBhcyB0eXBlb2YgQ2hlY2tib3hDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBSZWFsQ2hlY2tib3goKSB7IHJldHVybiBSZWFsQ2hlY2tib3ggYXMgdHlwZW9mIFJlYWxDaGVja2JveDsgfSxcbiAgICAgICAgZ2V0IEZsZXhDb250YWluZXIoKSB7IHJldHVybiBGbGV4Q29udGFpbmVyIGFzIHR5cGVvZiBGbGV4Q29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgQ2hlY2tib3hCb3goKSB7IHJldHVybiBDaGVja2JveEJveCBhcyB0eXBlb2YgQ2hlY2tib3hCb3g7IH0sXG4gICAgICAgIGdldCBJY29uKCkgeyByZXR1cm4gSWNvbiBhcyB0eXBlb2YgSWNvbjsgfSxcbiAgICAgICAgZ2V0IExhYmVsKCkgeyByZXR1cm4gTGFiZWwgYXMgdHlwZW9mIExhYmVsOyB9XG4gICAgfTtcbn1cbi8qKlxuICogVGhlIGNoZWNrYm94IGlucHV0IGZpZWxkLlxuICovXG5leHBvcnQgY29uc3QgQ2hlY2tib3ggPSB3aXRoRm9ybUNvbnRleHQod2l0aEdyb3VwQ29udGV4dChDaGVja2JveEludCkpO1xuQ2hlY2tib3guZGlzcGxheU5hbWUgPSAnQ2hlY2tib3gnO1xuIl19