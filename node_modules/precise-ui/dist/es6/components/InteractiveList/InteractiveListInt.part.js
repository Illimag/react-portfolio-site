var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { themed, css } from '../../utils/styled';
import { InteractiveListDirection, } from './InteractiveList.types.part';
import { Icon } from '../Icon';
import { Checkbox } from '../Checkbox';
import { pacificBlue, transparent } from '../../colors';
import { distance } from '../../distance';
import { getFontStyle } from '../../textStyles';
const InteractiveListContainer = styled.div `
  position: relative;
  outline: none;
`;
const ListWrapper = styled('ul')(themed(({ open, border, direction, theme: { ui4 } }) => css `
      display: ${open ? 'block' : 'none'};
      list-style: none;
      width: 100%;
      position: relative;
      transform: translateY(${direction === InteractiveListDirection.normal ? 0 : -100}%);
      box-sizing: border-box;
      box-shadow: none;
      margin: 0;
      padding: 0;
      background: ${transparent};
      border: 1px solid ${border === 0 /* none */ ? transparent : ui4};
      ${direction === InteractiveListDirection.normal ? 'border-top: none' : 'border-bottom: none'};
      max-height: 100%;
      overflow-y: auto;
      z-index: 100;
    `));
const ListItem = styled.li(themed(({ hovered, theme: { ui3, text2 }, disabled }) => css `
      ${getFontStyle({ size: 'medium' })}
      
      background: ${hovered ? ui3 : transparent};
      color: ${text2};
      list-style: none;
      box-sizing: border-box;
      opacity: ${disabled ? '0.5' : '1.0'};
      cursor: ${disabled ? 'not-allowed' : 'pointer'};
      display: block;
      width: 100%;
      height: auto;
      position: relative;

      a {
        color: inherit;
        display: block;
        text-decoration: none;

        &:hover {
          text-decoration: none;
        }
      }
    `));
const ListItemInnerContainer = styled.div `
  display: flex;
  align-items: center;
`;
const ListItemContent = styled.div `
  width: 100%;
`;
const ListItemContentPadding = styled('div') `
  padding: ${props => (props.condensed ? `${distance.small} ${distance.medium}` : distance.medium)};
  ${props => (props.showTick ? 'padding-right: 0;' : '')};
`;
const ListItemContentComponentPadding = styled('div') `
  > * {
    padding: ${props => (props.condensed ? `${distance.small} ${distance.medium}` : distance.medium)};
    ${props => (props.showTick ? 'padding-right: 0;' : '')};
  }
`;
const StyledCheckbox = styled(Checkbox) `
  display: block;
`;
const ListItemIconPadding = styled('div') `
  padding: 0 ${distance.medium};

  i {
    display: block;
  }
`;
const ListDivider = styled.hr `
  margin: ${distance.xsmall} ${distance.small};
  border: none;
  border-top: 1px solid ${themed(props => props.theme.textDisabled)};
`;
const ListHeader = styled.span `
  ${getFontStyle({ size: 'medium' })}
  
  padding: ${distance.medium} ${distance.small};
  width: 100%;
  display: block;
  height: auto;
  min-height: 1em;
  box-sizing: border-box;
  color: ${themed(props => props.theme.primary)};
`;
function getChosen(selected, multiple) {
    if (multiple) {
        return Array.isArray(selected) ? selected : [selected];
    }
    else {
        return [Array.isArray(selected) ? selected[0] : selected];
    }
}
function getIndices(data, selected, multiple) {
    const chosen = getChosen(selected, multiple);
    const indices = [];
    for (let i = 0; i < data.length; i++) {
        const item = data[i];
        if (!item) {
            continue;
        }
        const key = typeof item === 'string' ? item : item.key;
        if (chosen.indexOf(key) !== -1) {
            indices.push(i);
        }
    }
    if (!multiple && indices.length > 1) {
        indices.splice(1);
    }
    return indices;
}
function autoSelect(element) {
    const child = element && element.querySelector('a');
    if (child) {
        child.click();
    }
}
export class InteractiveListInt extends React.PureComponent {
    constructor(props) {
        super(props);
        this.selects = [];
        this.elements = [];
        this.defaultHandleClickOutside = () => {
            const { open, onBlur } = this.props;
            if (open) {
                if (typeof onBlur === 'function') {
                    onBlur();
                }
                this.setState({
                    selected: undefined,
                });
            }
        };
        this.handleClickOutside = () => {
            if (this.props.open) {
                this.props.onClickOutside ? this.props.onClickOutside() : this.defaultHandleClickOutside();
            }
        };
        this.control = (e) => {
            const { data, onBlur, disabled, onKeyDown } = this.props;
            if (!disabled) {
                const { selected } = this.state;
                if (typeof onKeyDown === 'function') {
                    onKeyDown(e);
                }
                switch (e.keyCode) {
                    case 40 /* down */:
                        this.setState({
                            selected: this.getNext(selected === undefined ? 0 : (selected + 1) % data.length, 1),
                        });
                        break;
                    case 38 /* up */:
                        this.setState({
                            selected: this.getNext(((selected || data.length) - 1) % data.length, -1),
                        });
                        break;
                    case 36 /* home */:
                        this.setState({
                            selected: this.getNext(0, 1),
                        });
                        break;
                    case 35 /* end */:
                        this.setState({
                            selected: this.getNext(data.length - 1, -1),
                        });
                        break;
                    case 13 /* enter */:
                    case 32 /* space */:
                        if (typeof selected === 'number') {
                            autoSelect(this.elements[selected]);
                        }
                        this.done();
                        break;
                    case 27 /* escape */:
                        if (typeof onBlur === 'function') {
                            onBlur();
                        }
                        break;
                    default:
                        this.jumpTo(e.key.toLowerCase());
                        return;
                }
            }
            e.stopPropagation();
            e.preventDefault();
        };
        this.getItemDetails = (item) => {
            let key = '';
            let content;
            if (typeof item === 'string') {
                key = item;
                content = item;
            }
            else {
                key = item.key;
                content = item.content || item.key;
            }
            return {
                key,
                content,
            };
        };
        this.createSingleItem = (item, index) => {
            const { key, content } = this.getItemDetails(item);
            return this.createItem(key, index, content);
        };
        this.createMultipleItem = (item, index) => {
            const { disabledItems } = this.props;
            const { value } = this.state;
            const { key, content } = this.getItemDetails(item);
            const isItemDisabled = disabledItems && disabledItems.indexOf(key) !== -1;
            const newContent = (React.createElement(StyledCheckbox, { value: value.indexOf(index) >= 0, disabled: isItemDisabled }, content));
            return this.createItem(key, index, newContent);
        };
        this.done = () => {
            const { multiple, onChange, disabled, data, disabledItems = [] } = this.props;
            const { value, controlled, selected } = this.state;
            const item = data && selected !== undefined && data[selected];
            const key = item && this.getItemDetails(item).key;
            const isItemDisabled = key && disabledItems.indexOf(key) !== -1;
            if (!disabled && !isItemDisabled && selected !== undefined) {
                const newValue = multiple
                    ? value.indexOf(selected) === -1
                        ? [...value, selected]
                        : value.filter(i => i !== selected)
                    : [selected];
                if (!controlled) {
                    this.setState({
                        value: newValue,
                    });
                }
                if (typeof onChange === 'function') {
                    onChange({
                        value: newValue,
                    });
                }
            }
        };
        this.setNode = (ref) => {
            this.interactiveList = ref;
        };
        const value = props.value || props.defaultValue || [];
        this.state = {
            value: props.indices || getIndices(props.data || [], value, props.multiple),
            controlled: props.indices !== undefined || props.value !== undefined,
            selected: undefined,
            direction: props.direction || InteractiveListDirection.normal,
        };
    }
    UNSAFE_componentWillReceiveProps(nextProps) {
        const { open, autoPosition, focus } = this.props;
        if (this.state.controlled) {
            const { indices, value, data = [], multiple } = nextProps;
            this.setState({
                value: indices || getIndices(data, value || [], multiple),
            });
        }
        const componentIsNotFocused = nextProps.focus !== focus || (this.interactiveList && document.activeElement !== this.interactiveList);
        if (componentIsNotFocused && nextProps.focus) {
            if (open && nextProps.open) {
                this.interactiveList && this.interactiveList.focus();
                this.setState({
                    selected: 0,
                });
            }
        }
        if (autoPosition && !open && nextProps.open && this.interactiveList) {
            const windowHeight = window.innerHeight;
            const { top } = this.interactiveList.getBoundingClientRect();
            if (top > windowHeight / 2) {
                this.setState(() => ({
                    direction: InteractiveListDirection.reverse,
                }));
            }
            else {
                this.setState(() => ({
                    direction: InteractiveListDirection.normal,
                }));
            }
        }
    }
    componentDidUpdate() {
        const { open, autoFocus } = this.props;
        if (open && autoFocus && this.interactiveList) {
            this.interactiveList.focus();
        }
    }
    getNext(proposed, dir) {
        const { data } = this.props;
        const max = data.length;
        for (let i = 0; i < max; i++) {
            const item = data[proposed];
            if (!item) {
                continue;
            }
            if (typeof item === 'string' || (item.type !== 'divider' && item.type !== 'header')) {
                return proposed;
            }
            proposed += dir;
            if (proposed < 0) {
                proposed = max - 1;
            }
            else if (proposed === max) {
                proposed = 0;
            }
        }
        return 0;
    }
    jumpTo(part) {
        const { data } = this.props;
        const { selected } = this.state;
        const start = selected ? (selected === data.length - 1 ? 0 : selected) : 0;
        let index = start;
        for (let i = start; i < start + data.length; i++, index = i === data.length ? 0 : index + 1) {
            const item = data[index];
            if (!item) {
                continue;
            }
            const lookup = typeof item === 'string' ? item : item.searchText || item.content || item.key;
            if (typeof lookup === 'string' && lookup.substr(0, part.length).toLowerCase() === part && selected !== index) {
                this.setState({
                    selected: index,
                });
                break;
            }
        }
    }
    createItem(key, index, content) {
        const { value, selected } = this.state;
        const { disabled, showTick = false, multiple = false, condensed = false, disabledItems } = this.props;
        const isItemDisabled = disabledItems && disabledItems.indexOf(key) !== -1;
        const isHovered = !disabled && selected === index;
        const isSelected = value.indexOf(index) >= 0;
        const selects = this.selects;
        const ContentWrapper = typeof content === 'string' ? ListItemContentPadding : ListItemContentComponentPadding;
        if (selects[index] === undefined) {
            selects[index] = () => this.select(index);
        }
        return (React.createElement(ListItem, { key: `${key}-${index}`, onClick: this.done, onMouseMove: selects[index], selected: isSelected, hovered: isHovered, disabled: isItemDisabled, ref: (node) => {
                this.elements[index] = node;
                if (isHovered && node) {
                    const parent = node.parentElement;
                    if (parent) {
                        const height = parent.clientHeight;
                        const position = parent.scrollTop;
                        const y0 = node.offsetTop - position;
                        const y1 = y0 + node.offsetHeight - height;
                        if (y0 < 0) {
                            parent.scrollTop = node.offsetTop;
                        }
                        else if (y1 > 0) {
                            parent.scrollTop += y1;
                        }
                    }
                }
            } },
            React.createElement(ListItemInnerContainer, null,
                React.createElement(ListItemContent, null,
                    React.createElement(ContentWrapper, { condensed: condensed, showTick: isSelected && showTick }, content)),
                isSelected && !multiple && showTick && (React.createElement(ListItemIconPadding, { condensed: condensed },
                    React.createElement(Icon, { name: "Check", color: pacificBlue, size: 1.375 }))))));
    }
    select(index) {
        const { disabled } = this.props;
        if (!disabled && this.state.selected !== index) {
            this.setState({
                selected: index,
            });
        }
    }
    render() {
        const _a = this.props, { onChange: _0, indices: _1, disabled: _2, onKeyDown: _3, onClickOutside: _4, data = [], theme, borderless = false, children, multiple = false, open = false, onBlur, customWrapper, onClick } = _a, props = __rest(_a, ["onChange", "indices", "disabled", "onKeyDown", "onClickOutside", "data", "theme", "borderless", "children", "multiple", "open", "onBlur", "customWrapper", "onClick"]);
        const border = borderless ? 0 /* none */ : 1 /* normal */;
        const createItem = multiple ? this.createMultipleItem : this.createSingleItem;
        const Wrapper = customWrapper || ListWrapper;
        return (React.createElement(InteractiveListContainer, Object.assign({ ref: this.setNode }, (open ? { tabIndex: 0 } : undefined), { onKeyDown: this.control }, props),
            React.createElement(Wrapper, { open: open, border: border, direction: this.state.direction, onClick: onClick }, open &&
                data.map((item, index) => {
                    if (item) {
                        if (typeof item !== 'string') {
                            switch (item.type) {
                                case 'divider':
                                    return React.createElement(ListDivider, { key: item.key });
                                case 'header':
                                    return React.createElement(ListHeader, { key: item.key }, item.content || item.key);
                            }
                        }
                        return createItem(item, index);
                    }
                    return undefined;
                }))));
    }
}
InteractiveListInt.inner = {
    get StyledCheckbox() { return StyledCheckbox; },
    get ListItem() { return ListItem; },
    get ListItemInnerContainer() { return ListItemInnerContainer; },
    get ListItemContent() { return ListItemContent; },
    get ListItemIconPadding() { return ListItemIconPadding; },
    get Icon() { return Icon; },
    get InteractiveListContainer() { return InteractiveListContainer; },
    get ListDivider() { return ListDivider; },
    get ListHeader() { return ListHeader; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3RpdmVMaXN0SW50LnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9JbnRlcmFjdGl2ZUxpc3QvSW50ZXJhY3RpdmVMaXN0SW50LnBhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3pELE9BQU8sRUFBK0Isd0JBQXdCLEdBQStGLE1BQU0sOEJBQThCLENBQUM7QUFDbE0sT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUMvQixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3hELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMxQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFlaEQsTUFBTSx3QkFBd0IsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDOzs7Q0FHM0MsQ0FBQztBQUNGLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBOEIsTUFBTSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUM7aUJBQ3pHLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNOzs7OzhCQUlWLFNBQVMsS0FBSyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHOzs7OztvQkFLbEUsV0FB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QUF1QyxDQUFDLENBQUMsQ0FBQztJQUN4RSxJQUFJLFFBQVEsS0FBSyxPQUFPLFFBQTJCLENBQUMsQ0FBQyxDQUFDO0lBQ3RELElBQUksc0JBQXNCLEtBQUssT0FBTyxzQkFBdUQsQ0FBQyxDQUFDLENBQUM7SUFDaEcsSUFBSSxlQUFlLEtBQUssT0FBTyxlQUF5QyxDQUFDLENBQUMsQ0FBQztJQUMzRSxJQUFJLG1CQUFtQixLQUFLLE9BQU8sbUJBQWlELENBQUMsQ0FBQyxDQUFDO0lBQ3ZGLElBQUksSUFBSSxLQUFLLE9BQU8sSUFBbUIsQ0FBQyxDQUFDLENBQUM7SUFDMUMsSUFBSSx3QkFBd0IsS0FBSyxPQUFPLHdCQUEyRCxDQUFDLENBQUMsQ0FBQztJQUN0RyxJQUFJLFdBQVcsS0FBSyxPQUFPLFdBQWlDLENBQUMsQ0FBQyxDQUFDO0lBQy9ELElBQUksVUFBVSxLQUFLLE9BQU8sVUFBK0IsQ0FBQyxDQUFDLENBQUM7Q0FDL0QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkLCBjc3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgSW50ZXJhY3RpdmVMaXN0V3JhcHBlclByb3BzLCBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24sIEludGVyYWN0aXZlTGlzdEJvcmRlclR5cGUsIEludGVyYWN0aXZlTGlzdEl0ZW0sIEludGVyYWN0aXZlTGlzdFByb3BzLCBJbnRlcmFjdGl2ZUxpc3RTdGF0ZSwgfSBmcm9tICcuL0ludGVyYWN0aXZlTGlzdC50eXBlcy5wYXJ0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9JY29uJztcbmltcG9ydCB7IENoZWNrYm94IH0gZnJvbSAnLi4vQ2hlY2tib3gnO1xuaW1wb3J0IHsgS2V5Q29kZXMgfSBmcm9tICcuLi8uLi91dGlscy9rZXlDb2Rlcyc7XG5pbXBvcnQgeyBwYWNpZmljQmx1ZSwgdHJhbnNwYXJlbnQgfSBmcm9tICcuLi8uLi9jb2xvcnMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmludGVyZmFjZSBMaXN0SXRlbVByb3BzIHtcbiAgICBzZWxlY3RlZDogYm9vbGVhbjtcbiAgICBob3ZlcmVkOiBib29sZWFuO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgICBvbkNsaWNrPyhlOiBSZWFjdC5Nb3VzZUV2ZW50KTogdm9pZDtcbiAgICBvbk1vdXNlTW92ZT8oZTogUmVhY3QuTW91c2VFdmVudCk6IHZvaWQ7XG59XG5pbnRlcmZhY2UgTGlzdEl0ZW1Db250ZW50UHJvcHMge1xuICAgIGNvbmRlbnNlZDogYm9vbGVhbjtcbiAgICBzaG93VGljazogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBMaXN0SXRlbUljb25Qcm9wcyB7XG4gICAgY29uZGVuc2VkOiBib29sZWFuO1xufVxuY29uc3QgSW50ZXJhY3RpdmVMaXN0Q29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgb3V0bGluZTogbm9uZTtcbmA7XG5jb25zdCBMaXN0V3JhcHBlciA9IHN0eWxlZCgndWwnKTxJbnRlcmFjdGl2ZUxpc3RXcmFwcGVyUHJvcHM+KHRoZW1lZCgoeyBvcGVuLCBib3JkZXIsIGRpcmVjdGlvbiwgdGhlbWU6IHsgdWk0IH0gfSkgPT4gY3NzIGBcbiAgICAgIGRpc3BsYXk6ICR7b3BlbiA/ICdibG9jaycgOiAnbm9uZSd9O1xuICAgICAgbGlzdC1zdHlsZTogbm9uZTtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKCR7ZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsID8gMCA6IC0xMDB9JSk7XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgYm94LXNoYWRvdzogbm9uZTtcbiAgICAgIG1hcmdpbjogMDtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgICBiYWNrZ3JvdW5kOiAke3RyYW5zcGFyZW50fTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7Ym9yZGVyID09PSBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlLm5vbmUgPyB0cmFuc3BhcmVudCA6IHVpNH07XG4gICAgICAke2RpcmVjdGlvbiA9PT0gSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLm5vcm1hbCA/ICdib3JkZXItdG9wOiBub25lJyA6ICdib3JkZXItYm90dG9tOiBub25lJ307XG4gICAgICBtYXgtaGVpZ2h0OiAxMDAlO1xuICAgICAgb3ZlcmZsb3cteTogYXV0bztcbiAgICAgIHotaW5kZXg6IDEwMDtcbiAgICBgKSk7XG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5saTxMaXN0SXRlbVByb3BzPih0aGVtZWQoKHsgaG92ZXJlZCwgdGhlbWU6IHsgdWkzLCB0ZXh0MiB9LCBkaXNhYmxlZCB9KSA9PiBjc3MgYFxuICAgICAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnbWVkaXVtJyB9KX1cbiAgICAgIFxuICAgICAgYmFja2dyb3VuZDogJHtob3ZlcmVkID8gdWkzIDogdHJhbnNwYXJlbnR9O1xuICAgICAgY29sb3I6ICR7dGV4dDJ9O1xuICAgICAgbGlzdC1zdHlsZTogbm9uZTtcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gICAgICBvcGFjaXR5OiAke2Rpc2FibGVkID8gJzAuNScgOiAnMS4wJ307XG4gICAgICBjdXJzb3I6ICR7ZGlzYWJsZWQgPyAnbm90LWFsbG93ZWQnIDogJ3BvaW50ZXInfTtcbiAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IGF1dG87XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG5cbiAgICAgIGEge1xuICAgICAgICBjb2xvcjogaW5oZXJpdDtcbiAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcblxuICAgICAgICAmOmhvdmVyIHtcbiAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgKSk7XG5jb25zdCBMaXN0SXRlbUlubmVyQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5gO1xuY29uc3QgTGlzdEl0ZW1Db250ZW50ID0gc3R5bGVkLmRpdiBgXG4gIHdpZHRoOiAxMDAlO1xuYDtcbmNvbnN0IExpc3RJdGVtQ29udGVudFBhZGRpbmcgPSBzdHlsZWQoJ2RpdicpPExpc3RJdGVtQ29udGVudFByb3BzPiBgXG4gIHBhZGRpbmc6ICR7cHJvcHMgPT4gKHByb3BzLmNvbmRlbnNlZCA/IGAke2Rpc3RhbmNlLnNtYWxsfSAke2Rpc3RhbmNlLm1lZGl1bX1gIDogZGlzdGFuY2UubWVkaXVtKX07XG4gICR7cHJvcHMgPT4gKHByb3BzLnNob3dUaWNrID8gJ3BhZGRpbmctcmlnaHQ6IDA7JyA6ICcnKX07XG5gO1xuY29uc3QgTGlzdEl0ZW1Db250ZW50Q29tcG9uZW50UGFkZGluZyA9IHN0eWxlZCgnZGl2Jyk8TGlzdEl0ZW1Db250ZW50UHJvcHM+IGBcbiAgPiAqIHtcbiAgICBwYWRkaW5nOiAke3Byb3BzID0+IChwcm9wcy5jb25kZW5zZWQgPyBgJHtkaXN0YW5jZS5zbWFsbH0gJHtkaXN0YW5jZS5tZWRpdW19YCA6IGRpc3RhbmNlLm1lZGl1bSl9O1xuICAgICR7cHJvcHMgPT4gKHByb3BzLnNob3dUaWNrID8gJ3BhZGRpbmctcmlnaHQ6IDA7JyA6ICcnKX07XG4gIH1cbmA7XG5jb25zdCBTdHlsZWRDaGVja2JveCA9IHN0eWxlZChDaGVja2JveCkgYFxuICBkaXNwbGF5OiBibG9jaztcbmA7XG5jb25zdCBMaXN0SXRlbUljb25QYWRkaW5nID0gc3R5bGVkKCdkaXYnKTxMaXN0SXRlbUljb25Qcm9wcz4gYFxuICBwYWRkaW5nOiAwICR7ZGlzdGFuY2UubWVkaXVtfTtcblxuICBpIHtcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgfVxuYDtcbmNvbnN0IExpc3REaXZpZGVyID0gc3R5bGVkLmhyIGBcbiAgbWFyZ2luOiAke2Rpc3RhbmNlLnhzbWFsbH0gJHtkaXN0YW5jZS5zbWFsbH07XG4gIGJvcmRlcjogbm9uZTtcbiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICR7dGhlbWVkKHByb3BzID0+IHByb3BzLnRoZW1lLnRleHREaXNhYmxlZCl9O1xuYDtcbmNvbnN0IExpc3RIZWFkZXIgPSBzdHlsZWQuc3BhbiBgXG4gICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ21lZGl1bScgfSl9XG4gIFxuICBwYWRkaW5nOiAke2Rpc3RhbmNlLm1lZGl1bX0gJHtkaXN0YW5jZS5zbWFsbH07XG4gIHdpZHRoOiAxMDAlO1xuICBkaXNwbGF5OiBibG9jaztcbiAgaGVpZ2h0OiBhdXRvO1xuICBtaW4taGVpZ2h0OiAxZW07XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGNvbG9yOiAke3RoZW1lZChwcm9wcyA9PiBwcm9wcy50aGVtZS5wcmltYXJ5KX07XG5gO1xuZnVuY3Rpb24gZ2V0Q2hvc2VuKHNlbGVjdGVkOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBtdWx0aXBsZT86IGJvb2xlYW4pIHtcbiAgICBpZiAobXVsdGlwbGUpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoc2VsZWN0ZWQpID8gc2VsZWN0ZWQgOiBbc2VsZWN0ZWRdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFtBcnJheS5pc0FycmF5KHNlbGVjdGVkKSA/IHNlbGVjdGVkWzBdIDogc2VsZWN0ZWRdO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldEluZGljZXMoZGF0YTogQXJyYXk8SW50ZXJhY3RpdmVMaXN0SXRlbSB8IHVuZGVmaW5lZD4sIHNlbGVjdGVkOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBtdWx0aXBsZT86IGJvb2xlYW4pIHtcbiAgICBjb25zdCBjaG9zZW4gPSBnZXRDaG9zZW4oc2VsZWN0ZWQsIG11bHRpcGxlKTtcbiAgICBjb25zdCBpbmRpY2VzOiBBcnJheTxudW1iZXI+ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2ldO1xuICAgICAgICBpZiAoIWl0ZW0pIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGtleSA9IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLmtleTtcbiAgICAgICAgaWYgKGNob3Nlbi5pbmRleE9mKGtleSkgIT09IC0xKSB7XG4gICAgICAgICAgICBpbmRpY2VzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFtdWx0aXBsZSAmJiBpbmRpY2VzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgaW5kaWNlcy5zcGxpY2UoMSk7XG4gICAgfVxuICAgIHJldHVybiBpbmRpY2VzO1xufVxuZnVuY3Rpb24gYXV0b1NlbGVjdChlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGNoaWxkID0gZWxlbWVudCAmJiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2EnKTtcbiAgICBpZiAoY2hpbGQpIHtcbiAgICAgICAgY2hpbGQuY2xpY2soKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgSW50ZXJhY3RpdmVMaXN0SW50IGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxJbnRlcmFjdGl2ZUxpc3RQcm9wcywgSW50ZXJhY3RpdmVMaXN0U3RhdGU+IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNlbGVjdHM6IEFycmF5PCgpID0+IHZvaWQ+ID0gW107XG4gICAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50czogQXJyYXk8SFRNTEVsZW1lbnQ+ID0gW107XG4gICAgcHJpdmF0ZSBpbnRlcmFjdGl2ZUxpc3Q6IEhUTUxFbGVtZW50IHwgbnVsbDtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSW50ZXJhY3RpdmVMaXN0UHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BzLnZhbHVlIHx8IHByb3BzLmRlZmF1bHRWYWx1ZSB8fCBbXTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy5pbmRpY2VzIHx8IGdldEluZGljZXMocHJvcHMuZGF0YSB8fCBbXSwgdmFsdWUsIHByb3BzLm11bHRpcGxlKSxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLmluZGljZXMgIT09IHVuZGVmaW5lZCB8fCBwcm9wcy52YWx1ZSAhPT0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRpcmVjdGlvbjogcHJvcHMuZGlyZWN0aW9uIHx8IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbi5ub3JtYWwsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHByaXZhdGUgZGVmYXVsdEhhbmRsZUNsaWNrT3V0c2lkZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvcGVuLCBvbkJsdXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChvcGVuKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uQmx1ciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uQmx1cigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBoYW5kbGVDbGlja091dHNpZGUgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9wZW4pIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25DbGlja091dHNpZGUgPyB0aGlzLnByb3BzLm9uQ2xpY2tPdXRzaWRlKCkgOiB0aGlzLmRlZmF1bHRIYW5kbGVDbGlja091dHNpZGUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBJbnRlcmFjdGl2ZUxpc3RQcm9wcykge1xuICAgICAgICBjb25zdCB7IG9wZW4sIGF1dG9Qb3NpdGlvbiwgZm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaW5kaWNlcywgdmFsdWUsIGRhdGEgPSBbXSwgbXVsdGlwbGUgfSA9IG5leHRQcm9wcztcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBpbmRpY2VzIHx8IGdldEluZGljZXMoZGF0YSwgdmFsdWUgfHwgW10sIG11bHRpcGxlKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudElzTm90Rm9jdXNlZCA9IG5leHRQcm9wcy5mb2N1cyAhPT0gZm9jdXMgfHwgKHRoaXMuaW50ZXJhY3RpdmVMaXN0ICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRoaXMuaW50ZXJhY3RpdmVMaXN0KTtcbiAgICAgICAgaWYgKGNvbXBvbmVudElzTm90Rm9jdXNlZCAmJiBuZXh0UHJvcHMuZm9jdXMpIHtcbiAgICAgICAgICAgIGlmIChvcGVuICYmIG5leHRQcm9wcy5vcGVuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcmFjdGl2ZUxpc3QgJiYgdGhpcy5pbnRlcmFjdGl2ZUxpc3QuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IDAsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGF1dG9Qb3NpdGlvbiAmJiAhb3BlbiAmJiBuZXh0UHJvcHMub3BlbiAmJiB0aGlzLmludGVyYWN0aXZlTGlzdCkge1xuICAgICAgICAgICAgY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICAgICAgY29uc3QgeyB0b3AgfSA9IHRoaXMuaW50ZXJhY3RpdmVMaXN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgaWYgKHRvcCA+IHdpbmRvd0hlaWdodCAvIDIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLnJldmVyc2UsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbi5ub3JtYWwsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgICAgY29uc3QgeyBvcGVuLCBhdXRvRm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChvcGVuICYmIGF1dG9Gb2N1cyAmJiB0aGlzLmludGVyYWN0aXZlTGlzdCkge1xuICAgICAgICAgICAgdGhpcy5pbnRlcmFjdGl2ZUxpc3QuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGdldE5leHQocHJvcG9zZWQ6IG51bWJlciwgZGlyOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBtYXggPSBkYXRhLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRhdGFbcHJvcG9zZWRdO1xuICAgICAgICAgICAgaWYgKCFpdGVtKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnIHx8IChpdGVtLnR5cGUgIT09ICdkaXZpZGVyJyAmJiBpdGVtLnR5cGUgIT09ICdoZWFkZXInKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wb3NlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb3Bvc2VkICs9IGRpcjtcbiAgICAgICAgICAgIGlmIChwcm9wb3NlZCA8IDApIHtcbiAgICAgICAgICAgICAgICBwcm9wb3NlZCA9IG1heCAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwcm9wb3NlZCA9PT0gbWF4KSB7XG4gICAgICAgICAgICAgICAgcHJvcG9zZWQgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBwcml2YXRlIGp1bXBUbyhwYXJ0OiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBzdGFydCA9IHNlbGVjdGVkID8gKHNlbGVjdGVkID09PSBkYXRhLmxlbmd0aCAtIDEgPyAwIDogc2VsZWN0ZWQpIDogMDtcbiAgICAgICAgbGV0IGluZGV4ID0gc3RhcnQ7XG4gICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHN0YXJ0ICsgZGF0YS5sZW5ndGg7IGkrKywgaW5kZXggPSBpID09PSBkYXRhLmxlbmd0aCA/IDAgOiBpbmRleCArIDEpIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2luZGV4XTtcbiAgICAgICAgICAgIGlmICghaXRlbSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbG9va3VwID0gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnID8gaXRlbSA6IGl0ZW0uc2VhcmNoVGV4dCB8fCBpdGVtLmNvbnRlbnQgfHwgaXRlbS5rZXk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGxvb2t1cCA9PT0gJ3N0cmluZycgJiYgbG9va3VwLnN1YnN0cigwLCBwYXJ0Lmxlbmd0aCkudG9Mb3dlckNhc2UoKSA9PT0gcGFydCAmJiBzZWxlY3RlZCAhPT0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGluZGV4LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgY29udHJvbCA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxFbGVtZW50PikgPT4ge1xuICAgICAgICBjb25zdCB7IGRhdGEsIG9uQmx1ciwgZGlzYWJsZWQsIG9uS2V5RG93biB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkaXNhYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgeyBzZWxlY3RlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25LZXlEb3duID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb25LZXlEb3duKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLmRvd246XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRoaXMuZ2V0TmV4dChzZWxlY3RlZCA9PT0gdW5kZWZpbmVkID8gMCA6IChzZWxlY3RlZCArIDEpICUgZGF0YS5sZW5ndGgsIDEpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy51cDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhpcy5nZXROZXh0KCgoc2VsZWN0ZWQgfHwgZGF0YS5sZW5ndGgpIC0gMSkgJSBkYXRhLmxlbmd0aCwgLTEpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5ob21lOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0aGlzLmdldE5leHQoMCwgMSksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLmVuZDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhpcy5nZXROZXh0KGRhdGEubGVuZ3RoIC0gMSwgLTEpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLnNwYWNlOlxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNlbGVjdGVkID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1NlbGVjdCh0aGlzLmVsZW1lbnRzW3NlbGVjdGVkXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZXNjYXBlOlxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9uQmx1ciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25CbHVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5qdW1wVG8oZS5rZXkudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGdldEl0ZW1EZXRhaWxzID0gKGl0ZW06IEludGVyYWN0aXZlTGlzdEl0ZW0pID0+IHtcbiAgICAgICAgbGV0IGtleSA9ICcnO1xuICAgICAgICBsZXQgY29udGVudDogUmVhY3QuUmVhY3RDaGlsZDtcbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAga2V5ID0gaXRlbTtcbiAgICAgICAgICAgIGNvbnRlbnQgPSBpdGVtO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAga2V5ID0gaXRlbS5rZXk7XG4gICAgICAgICAgICBjb250ZW50ID0gaXRlbS5jb250ZW50IHx8IGl0ZW0ua2V5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICB9O1xuICAgIH07XG4gICAgcHJpdmF0ZSBjcmVhdGVTaW5nbGVJdGVtID0gKGl0ZW06IEludGVyYWN0aXZlTGlzdEl0ZW0sIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgeyBrZXksIGNvbnRlbnQgfSA9IHRoaXMuZ2V0SXRlbURldGFpbHMoaXRlbSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUl0ZW0oa2V5LCBpbmRleCwgY29udGVudCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNyZWF0ZU11bHRpcGxlSXRlbSA9IChpdGVtOiBJbnRlcmFjdGl2ZUxpc3RJdGVtLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZGlzYWJsZWRJdGVtcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBrZXksIGNvbnRlbnQgfSA9IHRoaXMuZ2V0SXRlbURldGFpbHMoaXRlbSk7XG4gICAgICAgIGNvbnN0IGlzSXRlbURpc2FibGVkID0gZGlzYWJsZWRJdGVtcyAmJiBkaXNhYmxlZEl0ZW1zLmluZGV4T2Yoa2V5KSAhPT0gLTE7XG4gICAgICAgIGNvbnN0IG5ld0NvbnRlbnQgPSAoPFN0eWxlZENoZWNrYm94IHZhbHVlPXt2YWx1ZS5pbmRleE9mKGluZGV4KSA+PSAwfSBkaXNhYmxlZD17aXNJdGVtRGlzYWJsZWR9PlxuICAgICAgICB7Y29udGVudH1cbiAgICAgIDwvU3R5bGVkQ2hlY2tib3g+KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlSXRlbShrZXksIGluZGV4LCBuZXdDb250ZW50KTtcbiAgICB9O1xuICAgIHByaXZhdGUgZG9uZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBtdWx0aXBsZSwgb25DaGFuZ2UsIGRpc2FibGVkLCBkYXRhLCBkaXNhYmxlZEl0ZW1zID0gW10gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIGNvbnRyb2xsZWQsIHNlbGVjdGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBpdGVtID0gZGF0YSAmJiBzZWxlY3RlZCAhPT0gdW5kZWZpbmVkICYmIGRhdGFbc2VsZWN0ZWRdO1xuICAgICAgICBjb25zdCBrZXkgPSBpdGVtICYmIHRoaXMuZ2V0SXRlbURldGFpbHMoaXRlbSkua2V5O1xuICAgICAgICBjb25zdCBpc0l0ZW1EaXNhYmxlZCA9IGtleSAmJiBkaXNhYmxlZEl0ZW1zLmluZGV4T2Yoa2V5KSAhPT0gLTE7XG4gICAgICAgIGlmICghZGlzYWJsZWQgJiYgIWlzSXRlbURpc2FibGVkICYmIHNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gbXVsdGlwbGVcbiAgICAgICAgICAgICAgICA/IHZhbHVlLmluZGV4T2Yoc2VsZWN0ZWQpID09PSAtMVxuICAgICAgICAgICAgICAgICAgICA/IFsuLi52YWx1ZSwgc2VsZWN0ZWRdXG4gICAgICAgICAgICAgICAgICAgIDogdmFsdWUuZmlsdGVyKGkgPT4gaSAhPT0gc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgOiBbc2VsZWN0ZWRdO1xuICAgICAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBuZXdWYWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBuZXdWYWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBjcmVhdGVJdGVtKGtleTogc3RyaW5nLCBpbmRleDogbnVtYmVyLCBjb250ZW50OiBSZWFjdC5SZWFjdENoaWxkKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIHNlbGVjdGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGRpc2FibGVkLCBzaG93VGljayA9IGZhbHNlLCBtdWx0aXBsZSA9IGZhbHNlLCBjb25kZW5zZWQgPSBmYWxzZSwgZGlzYWJsZWRJdGVtcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgaXNJdGVtRGlzYWJsZWQgPSBkaXNhYmxlZEl0ZW1zICYmIGRpc2FibGVkSXRlbXMuaW5kZXhPZihrZXkpICE9PSAtMTtcbiAgICAgICAgY29uc3QgaXNIb3ZlcmVkID0gIWRpc2FibGVkICYmIHNlbGVjdGVkID09PSBpbmRleDtcbiAgICAgICAgY29uc3QgaXNTZWxlY3RlZCA9IHZhbHVlLmluZGV4T2YoaW5kZXgpID49IDA7XG4gICAgICAgIGNvbnN0IHNlbGVjdHMgPSB0aGlzLnNlbGVjdHM7XG4gICAgICAgIGNvbnN0IENvbnRlbnRXcmFwcGVyID0gdHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnID8gTGlzdEl0ZW1Db250ZW50UGFkZGluZyA6IExpc3RJdGVtQ29udGVudENvbXBvbmVudFBhZGRpbmc7XG4gICAgICAgIGlmIChzZWxlY3RzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzZWxlY3RzW2luZGV4XSA9ICgpID0+IHRoaXMuc2VsZWN0KGluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxMaXN0SXRlbSBrZXk9e2Ake2tleX0tJHtpbmRleH1gfSBvbkNsaWNrPXt0aGlzLmRvbmV9IG9uTW91c2VNb3ZlPXtzZWxlY3RzW2luZGV4XX0gc2VsZWN0ZWQ9e2lzU2VsZWN0ZWR9IGhvdmVyZWQ9e2lzSG92ZXJlZH0gZGlzYWJsZWQ9e2lzSXRlbURpc2FibGVkfSByZWY9eyhub2RlOiBIVE1MTElFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzW2luZGV4XSA9IG5vZGU7XG4gICAgICAgICAgICBpZiAoaXNIb3ZlcmVkICYmIG5vZGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBub2RlLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBwYXJlbnQuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHBhcmVudC5zY3JvbGxUb3A7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHkwID0gbm9kZS5vZmZzZXRUb3AgLSBwb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeTEgPSB5MCArIG5vZGUub2Zmc2V0SGVpZ2h0IC0gaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBpZiAoeTAgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wID0gbm9kZS5vZmZzZXRUb3A7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeTEgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wICs9IHkxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9fT5cbiAgICAgICAgPExpc3RJdGVtSW5uZXJDb250YWluZXI+XG4gICAgICAgICAgPExpc3RJdGVtQ29udGVudD5cbiAgICAgICAgICAgIDxDb250ZW50V3JhcHBlciBjb25kZW5zZWQ9e2NvbmRlbnNlZH0gc2hvd1RpY2s9e2lzU2VsZWN0ZWQgJiYgc2hvd1RpY2t9PlxuICAgICAgICAgICAgICB7Y29udGVudH1cbiAgICAgICAgICAgIDwvQ29udGVudFdyYXBwZXI+XG4gICAgICAgICAgPC9MaXN0SXRlbUNvbnRlbnQ+XG4gICAgICAgICAge2lzU2VsZWN0ZWQgJiYgIW11bHRpcGxlICYmIHNob3dUaWNrICYmICg8TGlzdEl0ZW1JY29uUGFkZGluZyBjb25kZW5zZWQ9e2NvbmRlbnNlZH0+XG4gICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJDaGVja1wiIGNvbG9yPXtwYWNpZmljQmx1ZX0gc2l6ZT17MS4zNzV9Lz5cbiAgICAgICAgICAgIDwvTGlzdEl0ZW1JY29uUGFkZGluZz4pfVxuICAgICAgICA8L0xpc3RJdGVtSW5uZXJDb250YWluZXI+XG4gICAgICA8L0xpc3RJdGVtPik7XG4gICAgfVxuICAgIHByaXZhdGUgc2VsZWN0KGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBkaXNhYmxlZCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkaXNhYmxlZCAmJiB0aGlzLnN0YXRlLnNlbGVjdGVkICE9PSBpbmRleCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGluZGV4LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZXROb2RlID0gKHJlZjogSFRNTEVsZW1lbnQgfCBudWxsKSA9PiB7XG4gICAgICAgIHRoaXMuaW50ZXJhY3RpdmVMaXN0ID0gcmVmO1xuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlOiBfMCwgaW5kaWNlczogXzEsIGRpc2FibGVkOiBfMiwgb25LZXlEb3duOiBfMywgb25DbGlja091dHNpZGU6IF80LCBkYXRhID0gW10sIHRoZW1lLCBib3JkZXJsZXNzID0gZmFsc2UsIGNoaWxkcmVuLCBtdWx0aXBsZSA9IGZhbHNlLCBvcGVuID0gZmFsc2UsIG9uQmx1ciwgY3VzdG9tV3JhcHBlciwgb25DbGljaywgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGJvcmRlciA9IGJvcmRlcmxlc3MgPyBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlLm5vbmUgOiBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlLm5vcm1hbDtcbiAgICAgICAgY29uc3QgY3JlYXRlSXRlbSA9IG11bHRpcGxlID8gdGhpcy5jcmVhdGVNdWx0aXBsZUl0ZW0gOiB0aGlzLmNyZWF0ZVNpbmdsZUl0ZW07XG4gICAgICAgIGNvbnN0IFdyYXBwZXIgPSBjdXN0b21XcmFwcGVyIHx8IExpc3RXcmFwcGVyO1xuICAgICAgICByZXR1cm4gKDxJbnRlcmFjdGl2ZUxpc3RDb250YWluZXIgcmVmPXt0aGlzLnNldE5vZGV9IHsuLi4ob3BlbiA/IHsgdGFiSW5kZXg6IDAgfSA6IHVuZGVmaW5lZCl9IG9uS2V5RG93bj17dGhpcy5jb250cm9sfSB7Li4ucHJvcHN9PlxuICAgICAgICA8V3JhcHBlciBvcGVuPXtvcGVufSBib3JkZXI9e2JvcmRlcn0gZGlyZWN0aW9uPXt0aGlzLnN0YXRlLmRpcmVjdGlvbn0gb25DbGljaz17b25DbGlja30+XG4gICAgICAgICAge29wZW4gJiZcbiAgICAgICAgICAgIGRhdGEubWFwKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaXRlbS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGl2aWRlcic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA8TGlzdERpdmlkZXIga2V5PXtpdGVtLmtleX0vPjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdoZWFkZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPExpc3RIZWFkZXIga2V5PXtpdGVtLmtleX0+e2l0ZW0uY29udGVudCB8fCBpdGVtLmtleX08L0xpc3RIZWFkZXI+O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVtKGl0ZW0sIGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0pfVxuICAgICAgICA8L1dyYXBwZXI+XG4gICAgICA8L0ludGVyYWN0aXZlTGlzdENvbnRhaW5lcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWRDaGVja2JveCgpIHsgcmV0dXJuIFN0eWxlZENoZWNrYm94IGFzIHR5cGVvZiBTdHlsZWRDaGVja2JveDsgfSxcbiAgICAgICAgZ2V0IExpc3RJdGVtKCkgeyByZXR1cm4gTGlzdEl0ZW0gYXMgdHlwZW9mIExpc3RJdGVtOyB9LFxuICAgICAgICBnZXQgTGlzdEl0ZW1Jbm5lckNvbnRhaW5lcigpIHsgcmV0dXJuIExpc3RJdGVtSW5uZXJDb250YWluZXIgYXMgdHlwZW9mIExpc3RJdGVtSW5uZXJDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBMaXN0SXRlbUNvbnRlbnQoKSB7IHJldHVybiBMaXN0SXRlbUNvbnRlbnQgYXMgdHlwZW9mIExpc3RJdGVtQ29udGVudDsgfSxcbiAgICAgICAgZ2V0IExpc3RJdGVtSWNvblBhZGRpbmcoKSB7IHJldHVybiBMaXN0SXRlbUljb25QYWRkaW5nIGFzIHR5cGVvZiBMaXN0SXRlbUljb25QYWRkaW5nOyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH0sXG4gICAgICAgIGdldCBJbnRlcmFjdGl2ZUxpc3RDb250YWluZXIoKSB7IHJldHVybiBJbnRlcmFjdGl2ZUxpc3RDb250YWluZXIgYXMgdHlwZW9mIEludGVyYWN0aXZlTGlzdENvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IExpc3REaXZpZGVyKCkgeyByZXR1cm4gTGlzdERpdmlkZXIgYXMgdHlwZW9mIExpc3REaXZpZGVyOyB9LFxuICAgICAgICBnZXQgTGlzdEhlYWRlcigpIHsgcmV0dXJuIExpc3RIZWFkZXIgYXMgdHlwZW9mIExpc3RIZWFkZXI7IH1cbiAgICB9O1xufVxuIl19