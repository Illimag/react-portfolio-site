var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { themed } from '../../utils/styled';
import { showInputInfo } from '../../utils/input';
import { InputIcon } from '../InputIcon';
import { transparent } from '../../colors';
import { distance } from '../../distance';
import { light } from '../../themes';
import { Icon } from '../Icon';
import { Responsive } from '../Responsive';
import { WindowPopup } from '../WindowPopup';
import { InteractiveList, InteractiveListDirection, } from '../InteractiveList';
import { StyledInputRow, StyledInputBox, getTextFieldBorderType, StyledTagItem, StyledIconContainer, } from '../../quarks';
import { getFontStyle } from '../../textStyles';
const DropdownContainer = styled.div `
  position: relative;
  outline: 0;
`;
export const DropdownSelect = styled.div `
  display: flex;
`;
const DropdownInputBox = styled(StyledInputBox) `
  border: 1px solid ${themed(({ focused, theme: { ui4 } }) => (focused ? ui4 : transparent))};
`;
const DropdownOptionText = styled.div `
  ${getFontStyle({ size: 'medium' })}
  padding: ${props => !props.labelShown ? `${distance.medium}` : `${distance.large} ${distance.medium} ${distance.small}`};
  margin: 0;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  color: ${themed(({ theme, disabled }) => (disabled ? theme.text3 : theme.text1))};
  font-family: inherit;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
  cursor: ${props => (props.disabled ? 'not-allowed' : 'auto')};
`;
const SingleDropdownItem = styled.span `
  display: inline-block;
  line-height: normal;
  border: 0;
  color: ${themed(props => props.theme.text6)};
`;
const StyledStandardWrapper = styled('ul') `
  list-style: none;
  width: 100%;
  position: absolute;
  transform: translateY(${props => (props.direction === InteractiveListDirection.normal ? 0 : -100)}%);
  box-sizing: border-box;
  box-shadow: none;
  margin: 0;
  padding: 0;
  background: ${themed(props => props.theme.ui1)};
  border: 1px solid
    ${themed(({ border, theme: { ui0, ui4 } }) => (border === 0 /* none */ ? ui0 : ui4))};
  max-height: 50vh;
  ${props => props.direction === InteractiveListDirection.normal
    ? 'border-top-color: transparent'
    : 'border-bottom-color: transparent'};
  top: ${props => (props.direction === InteractiveListDirection.normal ? -1 : -53)}px;
  overflow-y: auto;
  z-index: 100;
`;
const StyledLabel = styled.div `
  padding-left: ${distance.medium};
`;
const DropdownPopup = styled(WindowPopup) `
  border: 2em solid transparent;
`;
// tslint:disable-next-line
const NotOpenComponent = null;
const StandardWrapper = Object.assign(((_a) => {
    var { open } = _a, props = __rest(_a, ["open"]);
    return open ? React.createElement(StyledStandardWrapper, Object.assign({}, props)) : NotOpenComponent;
}), { inner: {
        get StyledStandardWrapper() { return StyledStandardWrapper; }
    } });
StandardWrapper.displayName = 'StandardWrapper';
const getMobileWrapper = (label) => ({ onClick, children, open, }) => open ? (React.createElement(DropdownPopup, { onClose: onClick, label: label }, children)) : (NotOpenComponent);
function getChosen(selected, multiple) {
    if (multiple) {
        return Array.isArray(selected) ? selected : [selected];
    }
    else {
        return [Array.isArray(selected) ? selected[0] : selected];
    }
}
function getKeys(data, selected) {
    return selected.map(index => {
        const item = data[index];
        return typeof item === 'string' ? item : item.key;
    });
}
function getIndices(data, selected, multiple) {
    const chosen = getChosen(selected, multiple);
    const indices = [];
    for (let i = 0; i < data.length; i++) {
        const item = data[i];
        const key = typeof item === 'string' ? item : item.key;
        if (chosen.indexOf(key) !== -1) {
            indices.push(i);
        }
    }
    if (!multiple && indices.length > 1) {
        indices.splice(1);
    }
    return indices;
}
function getContent(item) {
    if (typeof item !== 'string') {
        return item.content || item.key;
    }
    return item;
}
function getSingleContent(item, theme) {
    const key = typeof item === 'string' ? item : item.key;
    return (React.createElement(SingleDropdownItem, { theme: theme, key: key }, getContent(item)));
}
const MultipleDropdownItem = styled(StyledTagItem) `
  margin: 0 ${distance.small} 0 0;
`;
function getMultipleContent(item, theme) {
    const key = typeof item === 'string' ? item : item.key;
    return (React.createElement(MultipleDropdownItem, { theme: theme, key: key }, getContent(item)));
}
export class DropdownFieldInt extends React.Component {
    constructor(props) {
        super(props);
        this.show = () => new Promise(resolve => {
            this.setState({ open: true }, resolve);
        });
        this.hide = () => new Promise(resolve => {
            this.setState({ open: false }, resolve);
        });
        this.handleClickOutside = this.hide;
        this.toggle = () => __awaiter(this, void 0, void 0, function* () {
            const { onToggle, disabled } = this.props;
            if (!disabled) {
                const { open } = this.state;
                if (typeof onToggle === 'function') {
                    onToggle({
                        state: open ? 'close' : 'open',
                    });
                }
                if (open) {
                    yield this.hide();
                }
                else {
                    yield this.show();
                }
            }
        });
        this.control = (e) => {
            switch (e.keyCode) {
                case 13 /* enter */:
                case 32 /* space */:
                    this.show();
                    break;
                case 27 /* escape */:
                    this.hide();
                    break;
                case 38 /* up */:
                case 40 /* down */:
                    if (!this.state.open) {
                        this.show();
                    }
                    return;
                default:
                    return;
            }
            e.stopPropagation();
            e.preventDefault();
        };
        this.handleMouseDown = (e) => {
            this.toggle();
            e.preventDefault();
        };
        this.handleChange = ({ value }) => {
            const { controlled } = this.state;
            const { onChange, data, multiple, form, name = '' } = this.props;
            if (!multiple) {
                this.hide();
            }
            if (!controlled) {
                if (form) {
                    form.change({
                        name,
                        value,
                    });
                }
                else {
                    this.setState({
                        value: value,
                    });
                }
            }
            if (typeof onChange === 'function') {
                onChange({
                    value: value.length ? getKeys(data, value) : [],
                });
            }
        };
        this.renderList = (screenSize) => {
            const { data = [], theme, disabled, multiple, direction, disabledItems } = this.props;
            const { open, value } = this.state;
            const mobile = screenSize === 'small';
            const wrapper = mobile ? getMobileWrapper(React.createElement(StyledLabel, null, this.props.label)) : StandardWrapper;
            return (React.createElement(InteractiveList, { theme: theme, data: data, multiple: multiple, open: open && !disabled, onChange: this.handleChange, onClick: mobile ? this.toggle : undefined, onBlur: mobile ? undefined : this.hide, onKeyDown: mobile ? this.control : undefined, indices: value, customWrapper: wrapper, onClickOutside: () => { }, direction: direction, autoPosition: undefined === direction, disabledItems: disabledItems, autoFocus: true }));
        };
        const data = props.data || [];
        let value = [];
        if (typeof props.value === 'string' || Array.isArray(props.value)) {
            value = props.value;
        }
        else if (typeof props.defaultValue === 'string' || Array.isArray(props.defaultValue)) {
            value = props.defaultValue;
        }
        this.state = {
            value: getIndices(data, value, props.multiple),
            open: props.open === true,
            controlled: props.value !== undefined,
            error: props.error,
        };
    }
    componentDidMount() {
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.subscribe(this);
        }
    }
    componentWillUnmount() {
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    }
    UNSAFE_componentWillReceiveProps({ data = [], value = [], error, multiple }) {
        const { controlled } = this.state;
        if (controlled) {
            this.setState({
                value: getIndices(data, value, multiple),
            });
        }
        this.setState({ error });
    }
    render() {
        const _a = this.props, { borderless, children: _0, value: _1, defaultValue: _2, onInput: _3, data = [], theme, className: classNameProp, label, placeholder, maxSelectedShown = 8, disabled, multiple, info, onChange, disabledItems } = _a, other = __rest(_a, ["borderless", "children", "value", "defaultValue", "onInput", "data", "theme", "className", "label", "placeholder", "maxSelectedShown", "disabled", "multiple", "info", "onChange", "disabledItems"]);
        const { open: openState, value, error } = this.state;
        const open = openState && !disabled;
        const getContent = multiple ? getMultipleContent : getSingleContent;
        const hasValue = !!value.length;
        const border = getTextFieldBorderType(borderless, !!error, open);
        const items = value.map(i => data[i]);
        const th = theme || light;
        if (value.length > maxSelectedShown) {
            const rest = 1 + value.length - maxSelectedShown;
            items.splice(maxSelectedShown - 1, rest, `+ ${rest}`);
        }
        return (React.createElement(DropdownContainer, Object.assign({}, other),
            React.createElement(DropdownSelect, { onMouseDown: this.handleMouseDown, tabIndex: 0, onKeyDown: this.control },
                React.createElement(DropdownInputBox, { disabled: disabled, hasValue: hasValue, border: border, focused: open, theme: theme },
                    React.createElement(StyledInputRow, { label: label, placeholder: placeholder, error: !!error, focused: open, hasValue: hasValue },
                        React.createElement(DropdownOptionText, { labelShown: label !== undefined, disabled: disabled }, hasValue || label ? items.map(item => getContent(item, theme)) : placeholder)),
                    React.createElement(InputIcon, { disabled: disabled, theme: theme, error: error, hasValue: hasValue }),
                    React.createElement(StyledIconContainer, null,
                        React.createElement(Icon, { name: open ? 'KeyboardArrowUp' : 'KeyboardArrowDown', color: disabled ? th.ui4 : th.ui5, size: "22px" })))),
            React.createElement(Responsive, { render: this.renderList }),
            showInputInfo(error, info)));
    }
}
DropdownFieldInt.inner = {
    get StyledLabel() { return StyledLabel; },
    get InteractiveList() { return InteractiveList; },
    get DropdownContainer() { return DropdownContainer; },
    get DropdownSelect() { return DropdownSelect; },
    get DropdownInputBox() { return DropdownInputBox; },
    get StyledInputRow() { return StyledInputRow; },
    get DropdownOptionText() { return DropdownOptionText; },
    get InputIcon() { return InputIcon; },
    get StyledIconContainer() { return StyledIconContainer; },
    get Icon() { return Icon; },
    get Responsive() { return Responsive; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHJvcGRvd25GaWVsZEludC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0Ryb3Bkb3duRmllbGQvRHJvcGRvd25GaWVsZEludC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXBELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRXpDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDM0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDckMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUMvQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsZUFBZSxFQUEyRCx3QkFBd0IsR0FBOEIsTUFBTSxvQkFBb0IsQ0FBQztBQUNwSyxPQUFPLEVBQUUsY0FBYyxFQUFFLGNBQWMsRUFBRSxzQkFBc0IsRUFBRSxhQUFhLEVBQUUsbUJBQW1CLEdBQUcsTUFBTSxjQUFjLENBQUM7QUFDM0gsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRWhELE1BQU0saUJBQWlCLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQzs7O0NBR3BDLENBQUM7QUFDRixNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQzs7Q0FFeEMsQ0FBQztB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LElBQW1CLENBQUMsQ0FBQyxDQUFDO0lBQzFDLElBQUksVUFBVSxLQUFLLE9BQU8sVUFBK0IsQ0FBQyxDQUFDLENBQUM7Q0FDL0QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IEtleUNvZGVzIH0gZnJvbSAnLi4vLi4vdXRpbHMva2V5Q29kZXMnO1xuaW1wb3J0IHsgc2hvd0lucHV0SW5mbyB9IGZyb20gJy4uLy4uL3V0aWxzL2lucHV0JztcbmltcG9ydCB7IFNjcmVlblNpemUgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgSW5wdXRJY29uIH0gZnJvbSAnLi4vSW5wdXRJY29uJztcbmltcG9ydCB7IEZvcm1Db250ZXh0UHJvcHMgfSBmcm9tICcuLi8uLi9ob2Mvd2l0aEZvcm1Db250ZXh0JztcbmltcG9ydCB7IHRyYW5zcGFyZW50IH0gZnJvbSAnLi4vLi4vY29sb3JzJztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgbGlnaHQgfSBmcm9tICcuLi8uLi90aGVtZXMnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgUmVzcG9uc2l2ZSB9IGZyb20gJy4uL1Jlc3BvbnNpdmUnO1xuaW1wb3J0IHsgV2luZG93UG9wdXAgfSBmcm9tICcuLi9XaW5kb3dQb3B1cCc7XG5pbXBvcnQgeyBJbnRlcmFjdGl2ZUxpc3QsIEludGVyYWN0aXZlTGlzdENoYW5nZUV2ZW50LCBJbnRlcmFjdGl2ZUxpc3RXcmFwcGVyUHJvcHMsIEludGVyYWN0aXZlTGlzdERpcmVjdGlvbiwgSW50ZXJhY3RpdmVMaXN0Qm9yZGVyVHlwZSwgfSBmcm9tICcuLi9JbnRlcmFjdGl2ZUxpc3QnO1xuaW1wb3J0IHsgU3R5bGVkSW5wdXRSb3csIFN0eWxlZElucHV0Qm94LCBnZXRUZXh0RmllbGRCb3JkZXJUeXBlLCBTdHlsZWRUYWdJdGVtLCBTdHlsZWRJY29uQ29udGFpbmVyLCB9IGZyb20gJy4uLy4uL3F1YXJrcyc7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmltcG9ydCB7IERyb3Bkb3duRmllbGRJdGVtLCBEcm9wZG93bkZpZWxkUHJvcHMgfSBmcm9tICcuL0Ryb3Bkb3duRmllbGQudHlwZXMucGFydCc7XG5jb25zdCBEcm9wZG93bkNvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG91dGxpbmU6IDA7XG5gO1xuZXhwb3J0IGNvbnN0IERyb3Bkb3duU2VsZWN0ID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG5gO1xuaW50ZXJmYWNlIERyb3BEb3duT3B0aW9uc1RleHRQcm9wcyB7XG4gICAgbGFiZWxTaG93bjogYm9vbGVhbjtcbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XG59XG5jb25zdCBEcm9wZG93bklucHV0Qm94ID0gc3R5bGVkKFN0eWxlZElucHV0Qm94KSBgXG4gIGJvcmRlcjogMXB4IHNvbGlkICR7dGhlbWVkKCh7IGZvY3VzZWQsIHRoZW1lOiB7IHVpNCB9IH0pID0+IChmb2N1c2VkID8gdWk0IDogdHJhbnNwYXJlbnQpKX07XG5gO1xuY29uc3QgRHJvcGRvd25PcHRpb25UZXh0ID0gc3R5bGVkLmRpdjxEcm9wRG93bk9wdGlvbnNUZXh0UHJvcHM+IGBcbiAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnbWVkaXVtJyB9KX1cbiAgcGFkZGluZzogJHtwcm9wcyA9PiAhcHJvcHMubGFiZWxTaG93biA/IGAke2Rpc3RhbmNlLm1lZGl1bX1gIDogYCR7ZGlzdGFuY2UubGFyZ2V9ICR7ZGlzdGFuY2UubWVkaXVtfSAke2Rpc3RhbmNlLnNtYWxsfWB9O1xuICBtYXJnaW46IDA7XG4gIHdpZHRoOiAxMDAlO1xuICBoZWlnaHQ6IDEwMCU7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGNvbG9yOiAke3RoZW1lZCgoeyB0aGVtZSwgZGlzYWJsZWQgfSkgPT4gKGRpc2FibGVkID8gdGhlbWUudGV4dDMgOiB0aGVtZS50ZXh0MSkpfTtcbiAgZm9udC1mYW1pbHk6IGluaGVyaXQ7XG4gIHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICBjdXJzb3I6ICR7cHJvcHMgPT4gKHByb3BzLmRpc2FibGVkID8gJ25vdC1hbGxvd2VkJyA6ICdhdXRvJyl9O1xuYDtcbmNvbnN0IFNpbmdsZURyb3Bkb3duSXRlbSA9IHN0eWxlZC5zcGFuIGBcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBsaW5lLWhlaWdodDogbm9ybWFsO1xuICBib3JkZXI6IDA7XG4gIGNvbG9yOiAke3RoZW1lZChwcm9wcyA9PiBwcm9wcy50aGVtZS50ZXh0Nil9O1xuYDtcbmludGVyZmFjZSBTdHlsZWRTdGFuZGFyZFdyYXBwZXJQcm9wcyB7XG4gICAgZGlyZWN0aW9uOiBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb247XG4gICAgYm9yZGVyOiBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlO1xufVxuY29uc3QgU3R5bGVkU3RhbmRhcmRXcmFwcGVyID0gc3R5bGVkKCd1bCcpPFN0eWxlZFN0YW5kYXJkV3JhcHBlclByb3BzPiBgXG4gIGxpc3Qtc3R5bGU6IG5vbmU7XG4gIHdpZHRoOiAxMDAlO1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgke3Byb3BzID0+IChwcm9wcy5kaXJlY3Rpb24gPT09IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbi5ub3JtYWwgPyAwIDogLTEwMCl9JSk7XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGJveC1zaGFkb3c6IG5vbmU7XG4gIG1hcmdpbjogMDtcbiAgcGFkZGluZzogMDtcbiAgYmFja2dyb3VuZDogJHt0aGVtZWQocHJvcHMgPT4gcHJvcHMudGhlbWUudWkxKX07XG4gIGJvcmRlcjogMXB4IHNvbGlkXG4gICAgJHt0aGVtZWQoKHsgYm9yZGVyLCB0aGVtZTogeyB1aTAsIHVpNCB9IH0pID0+IChib3JkZXIgPT09IEludGVyYWN0aXZlTGlzdEJvcmRlclR5cGUubm9uZSA/IHVpMCA6IHVpNCkpfTtcbiAgbWF4LWhlaWdodDogNTB2aDtcbiAgJHtwcm9wcyA9PiBwcm9wcy5kaXJlY3Rpb24gPT09IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbi5ub3JtYWxcbiAgICA/ICdib3JkZXItdG9wLWNvbG9yOiB0cmFuc3BhcmVudCdcbiAgICA6ICdib3JkZXItYm90dG9tLWNvbG9yOiB0cmFuc3BhcmVudCd9O1xuICB0b3A6ICR7cHJvcHMgPT4gKHByb3BzLmRpcmVjdGlvbiA9PT0gSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLm5vcm1hbCA/IC0xIDogLTUzKX1weDtcbiAgb3ZlcmZsb3cteTogYXV0bztcbiAgei1pbmRleDogMTAwO1xuYDtcbmNvbnN0IFN0eWxlZExhYmVsID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmctbGVmdDogJHtkaXN0YW5jZS5tZWRpdW19O1xuYDtcbmNvbnN0IERyb3Bkb3duUG9wdXAgPSBzdHlsZWQoV2luZG93UG9wdXApIGBcbiAgYm9yZGVyOiAyZW0gc29saWQgdHJhbnNwYXJlbnQ7XG5gO1xuLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lXG5jb25zdCBOb3RPcGVuQ29tcG9uZW50ID0gbnVsbDtcbmNvbnN0IFN0YW5kYXJkV3JhcHBlciA9IE9iamVjdC5hc3NpZ24oKCgoeyBvcGVuLCAuLi5wcm9wcyB9KSA9PiBvcGVuID8gPFN0eWxlZFN0YW5kYXJkV3JhcHBlciB7Li4ucHJvcHN9Lz4gOiBOb3RPcGVuQ29tcG9uZW50KSBhcyBSZWFjdC5TRkM8SW50ZXJhY3RpdmVMaXN0V3JhcHBlclByb3BzPiksIHsgaW5uZXI6IHtcbiAgICAgICAgZ2V0IFN0eWxlZFN0YW5kYXJkV3JhcHBlcigpIHsgcmV0dXJuIFN0eWxlZFN0YW5kYXJkV3JhcHBlciBhcyB0eXBlb2YgU3R5bGVkU3RhbmRhcmRXcmFwcGVyOyB9XG4gICAgfSB9KTtcblN0YW5kYXJkV3JhcHBlci5kaXNwbGF5TmFtZSA9ICdTdGFuZGFyZFdyYXBwZXInO1xuY29uc3QgZ2V0TW9iaWxlV3JhcHBlciA9IChsYWJlbD86IFJlYWN0LlJlYWN0Q2hpbGQpID0+ICh7IG9uQ2xpY2ssIGNoaWxkcmVuLCBvcGVuLCB9OiBJbnRlcmFjdGl2ZUxpc3RXcmFwcGVyUHJvcHMgJiB7XG4gICAgY2hpbGRyZW4/OiBSZWFjdC5SZWFjdE5vZGU7XG59KSA9PiBvcGVuID8gKDxEcm9wZG93blBvcHVwIG9uQ2xvc2U9e29uQ2xpY2t9IGxhYmVsPXtsYWJlbH0+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9Ecm9wZG93blBvcHVwPikgOiAoTm90T3BlbkNvbXBvbmVudCk7XG5mdW5jdGlvbiBnZXRDaG9zZW4oc2VsZWN0ZWQ6IHN0cmluZyB8IEFycmF5PHN0cmluZz4sIG11bHRpcGxlPzogYm9vbGVhbikge1xuICAgIGlmIChtdWx0aXBsZSkge1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShzZWxlY3RlZCkgPyBzZWxlY3RlZCA6IFtzZWxlY3RlZF07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gW0FycmF5LmlzQXJyYXkoc2VsZWN0ZWQpID8gc2VsZWN0ZWRbMF0gOiBzZWxlY3RlZF07XG4gICAgfVxufVxuZnVuY3Rpb24gZ2V0S2V5cyhkYXRhOiBBcnJheTxzdHJpbmcgfCBEcm9wZG93bkZpZWxkSXRlbT4sIHNlbGVjdGVkOiBBcnJheTxudW1iZXI+KSB7XG4gICAgcmV0dXJuIHNlbGVjdGVkLm1hcChpbmRleCA9PiB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2luZGV4XTtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLmtleTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldEluZGljZXMoZGF0YTogQXJyYXk8c3RyaW5nIHwgRHJvcGRvd25GaWVsZEl0ZW0+LCBzZWxlY3RlZDogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiwgbXVsdGlwbGU/OiBib29sZWFuKSB7XG4gICAgY29uc3QgY2hvc2VuID0gZ2V0Q2hvc2VuKHNlbGVjdGVkLCBtdWx0aXBsZSk7XG4gICAgY29uc3QgaW5kaWNlczogQXJyYXk8bnVtYmVyPiA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBpdGVtID0gZGF0YVtpXTtcbiAgICAgICAgY29uc3Qga2V5ID0gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnID8gaXRlbSA6IGl0ZW0ua2V5O1xuICAgICAgICBpZiAoY2hvc2VuLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGluZGljZXMucHVzaChpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW11bHRpcGxlICYmIGluZGljZXMubGVuZ3RoID4gMSkge1xuICAgICAgICBpbmRpY2VzLnNwbGljZSgxKTtcbiAgICB9XG4gICAgcmV0dXJuIGluZGljZXM7XG59XG5mdW5jdGlvbiBnZXRDb250ZW50KGl0ZW06IHN0cmluZyB8IERyb3Bkb3duRmllbGRJdGVtKSB7XG4gICAgaWYgKHR5cGVvZiBpdGVtICE9PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gaXRlbS5jb250ZW50IHx8IGl0ZW0ua2V5O1xuICAgIH1cbiAgICByZXR1cm4gaXRlbTtcbn1cbmZ1bmN0aW9uIGdldFNpbmdsZUNvbnRlbnQoaXRlbTogc3RyaW5nIHwgRHJvcGRvd25GaWVsZEl0ZW0sIHRoZW1lPzogYW55KSB7XG4gICAgY29uc3Qga2V5ID0gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnID8gaXRlbSA6IGl0ZW0ua2V5O1xuICAgIHJldHVybiAoPFNpbmdsZURyb3Bkb3duSXRlbSB0aGVtZT17dGhlbWV9IGtleT17a2V5fT5cbiAgICAgIHtnZXRDb250ZW50KGl0ZW0pfVxuICAgIDwvU2luZ2xlRHJvcGRvd25JdGVtPik7XG59XG5jb25zdCBNdWx0aXBsZURyb3Bkb3duSXRlbSA9IHN0eWxlZChTdHlsZWRUYWdJdGVtIGFzIGFueSkgYFxuICBtYXJnaW46IDAgJHtkaXN0YW5jZS5zbWFsbH0gMCAwO1xuYDtcbmZ1bmN0aW9uIGdldE11bHRpcGxlQ29udGVudChpdGVtOiBzdHJpbmcgfCBEcm9wZG93bkZpZWxkSXRlbSwgdGhlbWU/OiBhbnkpIHtcbiAgICBjb25zdCBrZXkgPSB0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycgPyBpdGVtIDogaXRlbS5rZXk7XG4gICAgcmV0dXJuICg8TXVsdGlwbGVEcm9wZG93bkl0ZW0gdGhlbWU9e3RoZW1lfSBrZXk9e2tleX0+XG4gICAgICB7Z2V0Q29udGVudChpdGVtKX1cbiAgICA8L011bHRpcGxlRHJvcGRvd25JdGVtPik7XG59XG5pbnRlcmZhY2UgRHJvcGRvd25TdGF0ZSB7XG4gICAgdmFsdWU6IEFycmF5PG51bWJlcj47XG4gICAgZXJyb3I/OiBSZWFjdC5SZWFjdENoaWxkO1xuICAgIG9wZW46IGJvb2xlYW47XG4gICAgY29udHJvbGxlZDogYm9vbGVhbjtcbn1cbmV4cG9ydCBjbGFzcyBEcm9wZG93bkZpZWxkSW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PERyb3Bkb3duRmllbGRQcm9wcyAmIEZvcm1Db250ZXh0UHJvcHMsIERyb3Bkb3duU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogRHJvcGRvd25GaWVsZFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgY29uc3QgZGF0YSA9IHByb3BzLmRhdGEgfHwgW107XG4gICAgICAgIGxldCB2YWx1ZTogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiA9IFtdO1xuICAgICAgICBpZiAodHlwZW9mIHByb3BzLnZhbHVlID09PSAnc3RyaW5nJyB8fCBBcnJheS5pc0FycmF5KHByb3BzLnZhbHVlKSkge1xuICAgICAgICAgICAgdmFsdWUgPSBwcm9wcy52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgcHJvcHMuZGVmYXVsdFZhbHVlID09PSAnc3RyaW5nJyB8fCBBcnJheS5pc0FycmF5KHByb3BzLmRlZmF1bHRWYWx1ZSkpIHtcbiAgICAgICAgICAgIHZhbHVlID0gcHJvcHMuZGVmYXVsdFZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICB2YWx1ZTogZ2V0SW5kaWNlcyhkYXRhLCB2YWx1ZSwgcHJvcHMubXVsdGlwbGUpLFxuICAgICAgICAgICAgb3BlbjogcHJvcHMub3BlbiA9PT0gdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLnZhbHVlICE9PSB1bmRlZmluZWQsXG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyBkYXRhID0gW10sIHZhbHVlID0gW10sIGVycm9yLCBtdWx0aXBsZSB9OiBEcm9wZG93bkZpZWxkUHJvcHMpIHtcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGdldEluZGljZXMoZGF0YSwgdmFsdWUsIG11bHRpcGxlKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvciB9KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBzaG93ID0gKCkgPT4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBvcGVuOiB0cnVlIH0sIHJlc29sdmUpO1xuICAgIH0pO1xuICAgIHByaXZhdGUgaGlkZSA9ICgpID0+IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgb3BlbjogZmFsc2UgfSwgcmVzb2x2ZSk7XG4gICAgfSk7XG4gICAgaGFuZGxlQ2xpY2tPdXRzaWRlID0gdGhpcy5oaWRlO1xuICAgIHByaXZhdGUgdG9nZ2xlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB7IG9uVG9nZ2xlLCBkaXNhYmxlZCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkaXNhYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgeyBvcGVuIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvblRvZ2dsZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uVG9nZ2xlKHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IG9wZW4gPyAnY2xvc2UnIDogJ29wZW4nLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9wZW4pIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIGNvbnRyb2wgPSAoZTogUmVhY3QuS2V5Ym9hcmRFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZW50ZXI6XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnNwYWNlOlxuICAgICAgICAgICAgICAgIHRoaXMuc2hvdygpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lc2NhcGU6XG4gICAgICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnVwOlxuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5kb3duOlxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5vcGVuKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvdygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGhhbmRsZU1vdXNlRG93biA9IChlOiBSZWFjdC5Nb3VzZUV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLnRvZ2dsZSgpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGhhbmRsZUNoYW5nZSA9ICh7IHZhbHVlIH06IEludGVyYWN0aXZlTGlzdENoYW5nZUV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgZGF0YSwgbXVsdGlwbGUsIGZvcm0sIG5hbWUgPSAnJyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFtdWx0aXBsZSkge1xuICAgICAgICAgICAgdGhpcy5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm0uY2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUubGVuZ3RoID8gZ2V0S2V5cyhkYXRhLCB2YWx1ZSkgOiBbXSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIHJlbmRlckxpc3QgPSAoc2NyZWVuU2l6ZT86IFNjcmVlblNpemUpID0+IHtcbiAgICAgICAgY29uc3QgeyBkYXRhID0gW10sIHRoZW1lLCBkaXNhYmxlZCwgbXVsdGlwbGUsIGRpcmVjdGlvbiwgZGlzYWJsZWRJdGVtcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBvcGVuLCB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgbW9iaWxlID0gc2NyZWVuU2l6ZSA9PT0gJ3NtYWxsJztcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IG1vYmlsZSA/IGdldE1vYmlsZVdyYXBwZXIoPFN0eWxlZExhYmVsPnt0aGlzLnByb3BzLmxhYmVsfTwvU3R5bGVkTGFiZWw+KSA6IFN0YW5kYXJkV3JhcHBlcjtcbiAgICAgICAgcmV0dXJuICg8SW50ZXJhY3RpdmVMaXN0IHRoZW1lPXt0aGVtZX0gZGF0YT17ZGF0YX0gbXVsdGlwbGU9e211bHRpcGxlfSBvcGVuPXtvcGVuICYmICFkaXNhYmxlZH0gb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlfSBvbkNsaWNrPXttb2JpbGUgPyB0aGlzLnRvZ2dsZSA6IHVuZGVmaW5lZH0gb25CbHVyPXttb2JpbGUgPyB1bmRlZmluZWQgOiB0aGlzLmhpZGV9IG9uS2V5RG93bj17bW9iaWxlID8gdGhpcy5jb250cm9sIDogdW5kZWZpbmVkfSBpbmRpY2VzPXt2YWx1ZX0gY3VzdG9tV3JhcHBlcj17d3JhcHBlcn0gb25DbGlja091dHNpZGU9eygpID0+IHsgfX0gZGlyZWN0aW9uPXtkaXJlY3Rpb259IGF1dG9Qb3NpdGlvbj17dW5kZWZpbmVkID09PSBkaXJlY3Rpb259IGRpc2FibGVkSXRlbXM9e2Rpc2FibGVkSXRlbXN9IGF1dG9Gb2N1cy8+KTtcbiAgICB9O1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBib3JkZXJsZXNzLCBjaGlsZHJlbjogXzAsIHZhbHVlOiBfMSwgZGVmYXVsdFZhbHVlOiBfMiwgb25JbnB1dDogXzMsIGRhdGEgPSBbXSwgdGhlbWUsIGNsYXNzTmFtZTogY2xhc3NOYW1lUHJvcCwgbGFiZWwsIHBsYWNlaG9sZGVyLCBtYXhTZWxlY3RlZFNob3duID0gOCwgZGlzYWJsZWQsIG11bHRpcGxlLCBpbmZvLCBvbkNoYW5nZSwgZGlzYWJsZWRJdGVtcywgLi4ub3RoZXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgb3Blbjogb3BlblN0YXRlLCB2YWx1ZSwgZXJyb3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IG9wZW4gPSBvcGVuU3RhdGUgJiYgIWRpc2FibGVkO1xuICAgICAgICBjb25zdCBnZXRDb250ZW50ID0gbXVsdGlwbGUgPyBnZXRNdWx0aXBsZUNvbnRlbnQgOiBnZXRTaW5nbGVDb250ZW50O1xuICAgICAgICBjb25zdCBoYXNWYWx1ZSA9ICEhdmFsdWUubGVuZ3RoO1xuICAgICAgICBjb25zdCBib3JkZXIgPSBnZXRUZXh0RmllbGRCb3JkZXJUeXBlKGJvcmRlcmxlc3MsICEhZXJyb3IsIG9wZW4pO1xuICAgICAgICBjb25zdCBpdGVtcyA9IHZhbHVlLm1hcChpID0+IGRhdGFbaV0pO1xuICAgICAgICBjb25zdCB0aCA9IHRoZW1lIHx8IGxpZ2h0O1xuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID4gbWF4U2VsZWN0ZWRTaG93bikge1xuICAgICAgICAgICAgY29uc3QgcmVzdCA9IDEgKyB2YWx1ZS5sZW5ndGggLSBtYXhTZWxlY3RlZFNob3duO1xuICAgICAgICAgICAgaXRlbXMuc3BsaWNlKG1heFNlbGVjdGVkU2hvd24gLSAxLCByZXN0LCBgKyAke3Jlc3R9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICg8RHJvcGRvd25Db250YWluZXIgey4uLm90aGVyfT5cbiAgICAgICAgPERyb3Bkb3duU2VsZWN0IG9uTW91c2VEb3duPXt0aGlzLmhhbmRsZU1vdXNlRG93bn0gdGFiSW5kZXg9ezB9IG9uS2V5RG93bj17dGhpcy5jb250cm9sfT5cbiAgICAgICAgICA8RHJvcGRvd25JbnB1dEJveCBkaXNhYmxlZD17ZGlzYWJsZWR9IGhhc1ZhbHVlPXtoYXNWYWx1ZX0gYm9yZGVyPXtib3JkZXJ9IGZvY3VzZWQ9e29wZW59IHRoZW1lPXt0aGVtZX0+XG4gICAgICAgICAgICA8U3R5bGVkSW5wdXRSb3cgbGFiZWw9e2xhYmVsfSBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9IGVycm9yPXshIWVycm9yfSBmb2N1c2VkPXtvcGVufSBoYXNWYWx1ZT17aGFzVmFsdWV9PlxuICAgICAgICAgICAgICA8RHJvcGRvd25PcHRpb25UZXh0IGxhYmVsU2hvd249e2xhYmVsICE9PSB1bmRlZmluZWR9IGRpc2FibGVkPXtkaXNhYmxlZH0+XG4gICAgICAgICAgICAgICAge2hhc1ZhbHVlIHx8IGxhYmVsID8gaXRlbXMubWFwKGl0ZW0gPT4gZ2V0Q29udGVudChpdGVtLCB0aGVtZSkpIDogcGxhY2Vob2xkZXJ9XG4gICAgICAgICAgICAgIDwvRHJvcGRvd25PcHRpb25UZXh0PlxuICAgICAgICAgICAgPC9TdHlsZWRJbnB1dFJvdz5cbiAgICAgICAgICAgIDxJbnB1dEljb24gZGlzYWJsZWQ9e2Rpc2FibGVkfSB0aGVtZT17dGhlbWV9IGVycm9yPXtlcnJvcn0gaGFzVmFsdWU9e2hhc1ZhbHVlfS8+XG4gICAgICAgICAgICA8U3R5bGVkSWNvbkNvbnRhaW5lcj5cbiAgICAgICAgICAgICAgPEljb24gbmFtZT17b3BlbiA/ICdLZXlib2FyZEFycm93VXAnIDogJ0tleWJvYXJkQXJyb3dEb3duJ30gY29sb3I9e2Rpc2FibGVkID8gdGgudWk0IDogdGgudWk1fSBzaXplPVwiMjJweFwiLz5cbiAgICAgICAgICAgIDwvU3R5bGVkSWNvbkNvbnRhaW5lcj5cbiAgICAgICAgICA8L0Ryb3Bkb3duSW5wdXRCb3g+XG4gICAgICAgIDwvRHJvcGRvd25TZWxlY3Q+XG4gICAgICAgIDxSZXNwb25zaXZlIHJlbmRlcj17dGhpcy5yZW5kZXJMaXN0fS8+XG4gICAgICAgIHtzaG93SW5wdXRJbmZvKGVycm9yLCBpbmZvKX1cbiAgICAgIDwvRHJvcGRvd25Db250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgU3R5bGVkTGFiZWwoKSB7IHJldHVybiBTdHlsZWRMYWJlbCBhcyB0eXBlb2YgU3R5bGVkTGFiZWw7IH0sXG4gICAgICAgIGdldCBJbnRlcmFjdGl2ZUxpc3QoKSB7IHJldHVybiBJbnRlcmFjdGl2ZUxpc3QgYXMgdHlwZW9mIEludGVyYWN0aXZlTGlzdDsgfSxcbiAgICAgICAgZ2V0IERyb3Bkb3duQ29udGFpbmVyKCkgeyByZXR1cm4gRHJvcGRvd25Db250YWluZXIgYXMgdHlwZW9mIERyb3Bkb3duQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgRHJvcGRvd25TZWxlY3QoKSB7IHJldHVybiBEcm9wZG93blNlbGVjdCBhcyB0eXBlb2YgRHJvcGRvd25TZWxlY3Q7IH0sXG4gICAgICAgIGdldCBEcm9wZG93bklucHV0Qm94KCkgeyByZXR1cm4gRHJvcGRvd25JbnB1dEJveCBhcyB0eXBlb2YgRHJvcGRvd25JbnB1dEJveDsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZElucHV0Um93KCkgeyByZXR1cm4gU3R5bGVkSW5wdXRSb3cgYXMgdHlwZW9mIFN0eWxlZElucHV0Um93OyB9LFxuICAgICAgICBnZXQgRHJvcGRvd25PcHRpb25UZXh0KCkgeyByZXR1cm4gRHJvcGRvd25PcHRpb25UZXh0IGFzIHR5cGVvZiBEcm9wZG93bk9wdGlvblRleHQ7IH0sXG4gICAgICAgIGdldCBJbnB1dEljb24oKSB7IHJldHVybiBJbnB1dEljb24gYXMgdHlwZW9mIElucHV0SWNvbjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZEljb25Db250YWluZXIoKSB7IHJldHVybiBTdHlsZWRJY29uQ29udGFpbmVyIGFzIHR5cGVvZiBTdHlsZWRJY29uQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH0sXG4gICAgICAgIGdldCBSZXNwb25zaXZlKCkgeyByZXR1cm4gUmVzcG9uc2l2ZSBhcyB0eXBlb2YgUmVzcG9uc2l2ZTsgfVxuICAgIH07XG59XG4iXX0=