var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { themed } from '../../utils/styled';
import { Label } from '../Label';
import { InputError } from '../InputError';
import { FormContext, RadioButtonGroupContext } from '../../contexts';
import { distance } from '../../distance';
import { PaddedContainer } from '../PaddedContainer';
const RadioButtonContainer = styled('div') `
  position: relative;
  display: inline-block;
  opacity: ${props => (props.disabled ? '0.5' : '1.0')};
  cursor: ${props => (props.disabled ? 'not-allowed' : 'pointer')};

  + div {
    margin-left: ${distance.large};
  }
`;
const RadioButtonCircle = styled.div(({ theme: { ui0, ui5 } }) => `
  outline: 0;
  display: inline-block;
  vertical-align: middle;
  position: relative;
  overflow: hidden;
  flex: 0 0 auto;
  padding: 0.1875em;
  border: 2px solid ${ui5};
  border-radius: 100%;

  &:focus {
    box-shadow: 0px 0px 0px 2px ${ui0};
  }

  + label {
    vertical-align: middle;
  }
`);
const SelectMark = styled('div') `
  width: 0.5em;
  height: 0.5em;
  border-radius: 50%;
  outline: 0;
  background: ${themed(({ theme }) => theme.ui5)};
  transition: all 0.2s;
  opacity: ${props => (props.selected ? '1' : '0')};
  transform: ${props => (props.selected ? 'scale(1)' : 'scale(0)')};
`;
const FlexContainer = styled.div `
  display: flex;
  align-items: ${({ withError }) => (withError ? 'start' : 'center')};
`;
/**
 * The RadioButton input.
 */
export class RadioButton extends React.PureComponent {
    render() {
        const _a = this.props, { children } = _a, props = __rest(_a, ["children"]);
        return (React.createElement(FormContext.Consumer, null, form => (React.createElement(RadioButtonGroupContext.Consumer, null, ctx => (React.createElement(RadioButtonInt, Object.assign({ group: ctx, form: form }, props), children))))));
    }
}
RadioButton.inner = {
    get RadioButtonInt() { return RadioButtonInt; }
};
export class RadioButtonInt extends React.PureComponent {
    constructor(props) {
        super(props);
        this.setValue = (value) => {
            const { onChange } = this.props;
            this.setState({
                value,
            });
            if (typeof onChange === 'function') {
                onChange({
                    value,
                });
            }
        };
        this.select = () => {
            const { onChange, disabled, group, form, name = '' } = this.props;
            const { controlled, value } = this.state;
            if (!disabled && !value) {
                if (!controlled) {
                    if (group) {
                        group.select(this);
                    }
                    else if (form) {
                        form.change({
                            name,
                            value,
                        });
                    }
                    else {
                        this.setState({
                            value: true,
                        });
                    }
                }
                if (typeof onChange === 'function') {
                    onChange({
                        value: true,
                    });
                }
            }
        };
        this.onSelected = (e) => {
            this.select();
            e.preventDefault();
        };
        this.control = (e) => {
            switch (e.keyCode) {
                case 13 /* enter */:
                case 32 /* space */:
                    this.select();
                    break;
                default:
                    return;
            }
            e.stopPropagation();
            e.preventDefault();
        };
        this.name = props.name;
        this.state = {
            controlled: props.value !== undefined,
            value: props.value || props.defaultValue || false,
            error: props.error,
        };
    }
    UNSAFE_componentWillReceiveProps({ value = false, error }) {
        if (this.state.controlled) {
            this.setState({ value });
        }
        this.setState({ error });
    }
    componentDidMount() {
        const { group, form } = this.props;
        const { controlled } = this.state;
        if (!controlled) {
            if (group) {
                group.subscribe(this);
            }
            else if (form) {
                form.subscribe(this);
            }
        }
    }
    componentWillUnmount() {
        const { group, form } = this.props;
        const { controlled } = this.state;
        if (!controlled) {
            if (group) {
                group.unsubscribe(this);
            }
            else if (form) {
                form.unsubscribe(this);
            }
        }
    }
    render() {
        const _a = this.props, { children, disabled, theme, value: _0, defaultValue: _1, onChange: _2, group: _3, form: _4, name: _5 } = _a, props = __rest(_a, ["children", "disabled", "theme", "value", "defaultValue", "onChange", "group", "form", "name"]);
        const { value, error } = this.state;
        const containerProps = Object.assign({}, props, { theme, onClick: this.onSelected, disabled });
        const circleProps = {
            selected: value,
            disabled: !!disabled,
            onKeyDown: this.control,
            theme,
            tabIndex: disabled ? undefined : 0,
        };
        const Error = error && (React.createElement(PaddedContainer, { top: "xsmall", bottom: "xsmall" },
            React.createElement(InputError, null, error)));
        return (React.createElement(RadioButtonContainer, Object.assign({}, containerProps),
            React.createElement(FlexContainer, { withError: !!error },
                React.createElement(RadioButtonCircle, Object.assign({}, circleProps),
                    React.createElement(SelectMark, Object.assign({}, circleProps))),
                children && (React.createElement(Label, { attached: true, theme: theme },
                    children,
                    Error))),
            !children && Error));
    }
}
RadioButtonInt.inner = {
    get PaddedContainer() { return PaddedContainer; },
    get InputError() { return InputError; },
    get RadioButtonContainer() { return RadioButtonContainer; },
    get FlexContainer() { return FlexContainer; },
    get RadioButtonCircle() { return RadioButtonCircle; },
    get SelectMark() { return SelectMark; },
    get Label() { return Label; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9SYWRpb0J1dHRvbi9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWpDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSx1QkFBdUIsRUFBK0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUduRyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFMUMsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBcURyRCxNQUFNLG9CQUFvQixHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBNEI7OzthQUd6RCxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFDMUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDOzs7bUJBRzlDLFFBQVEsQ0FBQyxLQUFLOztDQUVoQyxDQUFDO0FBQ0YsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7Ozs7Ozs7O3NCQVE1QyxHQUFHOzs7O2tDQUlTLEdBQUc7Ozs7OztDQU1wQyxDQUFDLENBQUM7QUFDSCxNQUFNLFVBQVUs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S0FBSyxLQUFLLE9BQU8sS0FBcUIsQ0FBQyxDQUFDLENBQUM7Q0FDaEQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IExhYmVsIH0gZnJvbSAnLi4vTGFiZWwnO1xuaW1wb3J0IHsgU3RhbmRhcmRQcm9wcyB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5pbXBvcnQgeyBJbnB1dEVycm9yIH0gZnJvbSAnLi4vSW5wdXRFcnJvcic7XG5pbXBvcnQgeyBGb3JtQ29udGV4dCwgUmFkaW9CdXR0b25Hcm91cENvbnRleHQsIFJhZGlvQnV0dG9uR3JvdXBDb250ZXh0VHlwZSB9IGZyb20gJy4uLy4uL2NvbnRleHRzJztcbmltcG9ydCB7IEZvcm1Db250ZXh0UHJvcHMgfSBmcm9tICcuLi8uLi9ob2MnO1xuaW1wb3J0IHsgS2V5Q29kZXMgfSBmcm9tICcuLi8uLi91dGlscyc7XG5pbXBvcnQgeyBkaXN0YW5jZSB9IGZyb20gJy4uLy4uL2Rpc3RhbmNlJztcbmltcG9ydCB7IElucHV0Tm90aWZpY2F0aW9uIH0gZnJvbSAnLi4vSW5wdXROb3RpZmljYXRpb24nO1xuaW1wb3J0IHsgUGFkZGVkQ29udGFpbmVyIH0gZnJvbSAnLi4vUGFkZGVkQ29udGFpbmVyJztcbmV4cG9ydCBpbnRlcmZhY2UgUmFkaW9CdXR0b25DaGFuZ2VFdmVudCB7XG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnQgc2VsZWN0ZWQgc3RhdGUgb2YgdGhlIHJhZGlvIGJ1dHRvbi5cbiAgICAgKi9cbiAgICB2YWx1ZTogYm9vbGVhbjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUmFkaW9CdXR0b25Qcm9wcyBleHRlbmRzIFN0YW5kYXJkUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IG9mIHRoZSByYWRpbyBidXR0b24uXG4gICAgICovXG4gICAgY2hpbGRyZW4/OiBSZWFjdC5SZWFjdE5vZGU7XG4gICAgLyoqXG4gICAgICogRXZlbnQgZW1pdHRlZCBvbmNlIHRoZSByYWRpbyBidXR0b24gc2VsZWN0aW9uIGNoYW5nZXMuXG4gICAgICovXG4gICAgb25DaGFuZ2U/KGU6IFJhZGlvQnV0dG9uQ2hhbmdlRXZlbnQpOiB2b2lkO1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHJhZGlvIGJ1dHRvbiBhcyBkaXNhYmxlZC5cbiAgICAgKi9cbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRGlzcGxheXMgdGhlIGVycm9yIG1lc3NhZ2UgYmVsb3cgdGhlIHJhZGlvIGJ1dHRvbi5cbiAgICAgKi9cbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc2VsZWN0ZWQgYW5kIGVudGVycyB0aGUgY29udHJvbGxlZCBtb2RlLlxuICAgICAqL1xuICAgIHZhbHVlPzogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBpbml0aWFsIHNlbGVjdGVkLiBEb2VzIG5vdCBlbnRlciB0aGUgY29udHJvbGxlZCBtb2RlLlxuICAgICAqL1xuICAgIGRlZmF1bHRWYWx1ZT86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogTmFtZSBvZiB0aGUgcmFkaW8gYnV0dG9uIHdpdGhpbiBhIHJhZGlvIGJ1dHRvbiBncm91cC5cbiAgICAgKi9cbiAgICBuYW1lPzogc3RyaW5nO1xufVxuZXhwb3J0IGludGVyZmFjZSBSYWRpb0J1dHRvbkludFByb3BzIGV4dGVuZHMgUmFkaW9CdXR0b25Qcm9wcyB7XG4gICAgZ3JvdXA/OiBSYWRpb0J1dHRvbkdyb3VwQ29udGV4dFR5cGU7XG59XG5leHBvcnQgaW50ZXJmYWNlIFJhZGlvQnV0dG9uSW50U3RhdGUge1xuICAgIHZhbHVlOiBib29sZWFuO1xuICAgIGVycm9yPzogUmVhY3QuUmVhY3RDaGlsZDtcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIFJhZGlvQnV0dG9uQ29udGFpbmVyUHJvcHMge1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBSYWRpb0J1dHRvbkNpcmNsZVByb3BzIHtcbiAgICBzZWxlY3RlZDogYm9vbGVhbjtcbiAgICBkaXNhYmxlZDogYm9vbGVhbjtcbiAgICB0aGVtZTogYW55O1xufVxuY29uc3QgUmFkaW9CdXR0b25Db250YWluZXIgPSBzdHlsZWQoJ2RpdicpPFJhZGlvQnV0dG9uQ29udGFpbmVyUHJvcHM+IGBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIG9wYWNpdHk6ICR7cHJvcHMgPT4gKHByb3BzLmRpc2FibGVkID8gJzAuNScgOiAnMS4wJyl9O1xuICBjdXJzb3I6ICR7cHJvcHMgPT4gKHByb3BzLmRpc2FibGVkID8gJ25vdC1hbGxvd2VkJyA6ICdwb2ludGVyJyl9O1xuXG4gICsgZGl2IHtcbiAgICBtYXJnaW4tbGVmdDogJHtkaXN0YW5jZS5sYXJnZX07XG4gIH1cbmA7XG5jb25zdCBSYWRpb0J1dHRvbkNpcmNsZSA9IHN0eWxlZC5kaXYoKHsgdGhlbWU6IHsgdWkwLCB1aTUgfSB9KSA9PiBgXG4gIG91dGxpbmU6IDA7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBvdmVyZmxvdzogaGlkZGVuO1xuICBmbGV4OiAwIDAgYXV0bztcbiAgcGFkZGluZzogMC4xODc1ZW07XG4gIGJvcmRlcjogMnB4IHNvbGlkICR7dWk1fTtcbiAgYm9yZGVyLXJhZGl1czogMTAwJTtcblxuICAmOmZvY3VzIHtcbiAgICBib3gtc2hhZG93OiAwcHggMHB4IDBweCAycHggJHt1aTB9O1xuICB9XG5cbiAgKyBsYWJlbCB7XG4gICAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbiAgfVxuYCk7XG5jb25zdCBTZWxlY3RNYXJrID0gc3R5bGVkKCdkaXYnKTxSYWRpb0J1dHRvbkNpcmNsZVByb3BzPiBgXG4gIHdpZHRoOiAwLjVlbTtcbiAgaGVpZ2h0OiAwLjVlbTtcbiAgYm9yZGVyLXJhZGl1czogNTAlO1xuICBvdXRsaW5lOiAwO1xuICBiYWNrZ3JvdW5kOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS51aTUpfTtcbiAgdHJhbnNpdGlvbjogYWxsIDAuMnM7XG4gIG9wYWNpdHk6ICR7cHJvcHMgPT4gKHByb3BzLnNlbGVjdGVkID8gJzEnIDogJzAnKX07XG4gIHRyYW5zZm9ybTogJHtwcm9wcyA9PiAocHJvcHMuc2VsZWN0ZWQgPyAnc2NhbGUoMSknIDogJ3NjYWxlKDApJyl9O1xuYDtcbmNvbnN0IEZsZXhDb250YWluZXIgPSBzdHlsZWQuZGl2PHtcbiAgICB3aXRoRXJyb3I/OiBib29sZWFuO1xufT4gYFxuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogJHsoeyB3aXRoRXJyb3IgfSkgPT4gKHdpdGhFcnJvciA/ICdzdGFydCcgOiAnY2VudGVyJyl9O1xuYDtcbi8qKlxuICogVGhlIFJhZGlvQnV0dG9uIGlucHV0LlxuICovXG5leHBvcnQgY2xhc3MgUmFkaW9CdXR0b24gZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PFJhZGlvQnV0dG9uUHJvcHM+IHtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW4sIC4uLnByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gKDxGb3JtQ29udGV4dC5Db25zdW1lcj5cbiAgICAgICAge2Zvcm0gPT4gKDxSYWRpb0J1dHRvbkdyb3VwQ29udGV4dC5Db25zdW1lcj5cbiAgICAgICAgICAgIHtjdHggPT4gKDxSYWRpb0J1dHRvbkludCBncm91cD17Y3R4fSBmb3JtPXtmb3JtfSB7Li4ucHJvcHN9PlxuICAgICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAgPC9SYWRpb0J1dHRvbkludD4pfVxuICAgICAgICAgIDwvUmFkaW9CdXR0b25Hcm91cENvbnRleHQuQ29uc3VtZXI+KX1cbiAgICAgIDwvRm9ybUNvbnRleHQuQ29uc3VtZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgUmFkaW9CdXR0b25JbnQoKSB7IHJldHVybiBSYWRpb0J1dHRvbkludCBhcyB0eXBlb2YgUmFkaW9CdXR0b25JbnQ7IH1cbiAgICB9O1xufVxuZXhwb3J0IGNsYXNzIFJhZGlvQnV0dG9uSW50IGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxSYWRpb0J1dHRvbkludFByb3BzICYgRm9ybUNvbnRleHRQcm9wcywgUmFkaW9CdXR0b25JbnRTdGF0ZT4ge1xuICAgIHJlYWRvbmx5IG5hbWU/OiBzdHJpbmc7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IFJhZGlvQnV0dG9uSW50UHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLm5hbWUgPSBwcm9wcy5uYW1lO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgY29udHJvbGxlZDogcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy52YWx1ZSB8fCBwcm9wcy5kZWZhdWx0VmFsdWUgfHwgZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgIH07XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHsgdmFsdWUgPSBmYWxzZSwgZXJyb3IgfTogUmFkaW9CdXR0b25JbnRQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yIH0pO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBncm91cCwgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIGlmIChncm91cCkge1xuICAgICAgICAgICAgICAgIGdyb3VwLnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICBmb3JtLnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBncm91cCwgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIGlmIChncm91cCkge1xuICAgICAgICAgICAgICAgIGdyb3VwLnVuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2V0VmFsdWUgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIHNlbGVjdCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgZGlzYWJsZWQsIGdyb3VwLCBmb3JtLCBuYW1lID0gJycgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCwgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghZGlzYWJsZWQgJiYgIXZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIWNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXAuc2VsZWN0KHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm0uY2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBvblNlbGVjdGVkID0gKGU6IFJlYWN0Lk1vdXNlRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHRoaXMuc2VsZWN0KCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHByaXZhdGUgY29udHJvbCA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuc3BhY2U6XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3QoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBjaGlsZHJlbiwgZGlzYWJsZWQsIHRoZW1lLCB2YWx1ZTogXzAsIGRlZmF1bHRWYWx1ZTogXzEsIG9uQ2hhbmdlOiBfMiwgZ3JvdXA6IF8zLCBmb3JtOiBfNCwgbmFtZTogXzUsIC4uLnByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBlcnJvciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgY29udGFpbmVyUHJvcHMgPSB7XG4gICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgIHRoZW1lLFxuICAgICAgICAgICAgb25DbGljazogdGhpcy5vblNlbGVjdGVkLFxuICAgICAgICAgICAgZGlzYWJsZWQsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGNpcmNsZVByb3BzID0ge1xuICAgICAgICAgICAgc2VsZWN0ZWQ6IHZhbHVlLFxuICAgICAgICAgICAgZGlzYWJsZWQ6ICEhZGlzYWJsZWQsXG4gICAgICAgICAgICBvbktleURvd246IHRoaXMuY29udHJvbCxcbiAgICAgICAgICAgIHRoZW1lLFxuICAgICAgICAgICAgdGFiSW5kZXg6IGRpc2FibGVkID8gdW5kZWZpbmVkIDogMCxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgRXJyb3IgPSBlcnJvciAmJiAoPFBhZGRlZENvbnRhaW5lciB0b3A9XCJ4c21hbGxcIiBib3R0b209XCJ4c21hbGxcIj5cbiAgICAgICAgPElucHV0RXJyb3I+e2Vycm9yfTwvSW5wdXRFcnJvcj5cbiAgICAgIDwvUGFkZGVkQ29udGFpbmVyPik7XG4gICAgICAgIHJldHVybiAoPFJhZGlvQnV0dG9uQ29udGFpbmVyIHsuLi5jb250YWluZXJQcm9wc30+XG4gICAgICAgIDxGbGV4Q29udGFpbmVyIHdpdGhFcnJvcj17ISFlcnJvcn0+XG4gICAgICAgICAgPFJhZGlvQnV0dG9uQ2lyY2xlIHsuLi5jaXJjbGVQcm9wc30+XG4gICAgICAgICAgICA8U2VsZWN0TWFyayB7Li4uY2lyY2xlUHJvcHN9Lz5cbiAgICAgICAgICA8L1JhZGlvQnV0dG9uQ2lyY2xlPlxuICAgICAgICAgIHtjaGlsZHJlbiAmJiAoPExhYmVsIGF0dGFjaGVkIHRoZW1lPXt0aGVtZX0+XG4gICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAge0Vycm9yfVxuICAgICAgICAgICAgPC9MYWJlbD4pfVxuICAgICAgICA8L0ZsZXhDb250YWluZXI+XG4gICAgICAgIHshY2hpbGRyZW4gJiYgRXJyb3J9XG4gICAgICA8L1JhZGlvQnV0dG9uQ29udGFpbmVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFBhZGRlZENvbnRhaW5lcigpIHsgcmV0dXJuIFBhZGRlZENvbnRhaW5lciBhcyB0eXBlb2YgUGFkZGVkQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgSW5wdXRFcnJvcigpIHsgcmV0dXJuIElucHV0RXJyb3IgYXMgdHlwZW9mIElucHV0RXJyb3I7IH0sXG4gICAgICAgIGdldCBSYWRpb0J1dHRvbkNvbnRhaW5lcigpIHsgcmV0dXJuIFJhZGlvQnV0dG9uQ29udGFpbmVyIGFzIHR5cGVvZiBSYWRpb0J1dHRvbkNvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IEZsZXhDb250YWluZXIoKSB7IHJldHVybiBGbGV4Q29udGFpbmVyIGFzIHR5cGVvZiBGbGV4Q29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgUmFkaW9CdXR0b25DaXJjbGUoKSB7IHJldHVybiBSYWRpb0J1dHRvbkNpcmNsZSBhcyB0eXBlb2YgUmFkaW9CdXR0b25DaXJjbGU7IH0sXG4gICAgICAgIGdldCBTZWxlY3RNYXJrKCkgeyByZXR1cm4gU2VsZWN0TWFyayBhcyB0eXBlb2YgU2VsZWN0TWFyazsgfSxcbiAgICAgICAgZ2V0IExhYmVsKCkgeyByZXR1cm4gTGFiZWwgYXMgdHlwZW9mIExhYmVsOyB9XG4gICAgfTtcbn1cbiJdfQ==