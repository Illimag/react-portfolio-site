var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import { PaginationBar } from '../PaginationBar';
import { PaginationLayout } from './PaginationLayout.part';
/**
 * The Pagination component allows generic pagination of arbitrary components.
 */
export class Pagination extends React.Component {
    constructor(props) {
        super(props);
        this.handlePageChange = ({ page }) => {
            const { onChange, value } = this.props;
            if (value === undefined) {
                this.setState({
                    current: page,
                });
            }
            if (typeof onChange === 'function') {
                onChange({
                    value: page,
                });
            }
        };
        this.handleSizeChange = ({ size }) => {
            const { children } = this.props;
            const { current } = this.state;
            const total = React.Children.count(children);
            const maxPageCount = Math.max(Math.ceil(total / size) - 1, 0);
            this.setState({
                size,
                current: Math.min(current, maxPageCount),
            });
        };
        const { value, defaultValue, size = 20 } = props;
        this.state = {
            current: value || defaultValue || 0,
            size: Array.isArray(size) ? size[0] : size,
        };
    }
    getDim(count) {
        const { current, size: sizeState } = this.state;
        const min = current * sizeState;
        if (min < count) {
            return {
                current,
                min,
                max: min + sizeState,
                sizeState,
            };
        }
        else {
            const previous = ~~((count - 1) / sizeState);
            return {
                current: previous,
                min: previous * sizeState,
                max: (previous + 1) * sizeState,
                sizeState,
            };
        }
    }
    render() {
        const _a = this.props, { children, host, size: sizeProp, itemsInfo, pagesInfo, label, render } = _a, props = __rest(_a, ["children", "host", "size", "itemsInfo", "pagesInfo", "label", "render"]);
        const count = React.Children.count(children);
        const { current, min, max, sizeState } = this.getDim(count);
        const content = count < sizeState
            ? children
            : React.Children.map(children, (child, index) => {
                if (index >= min && index < max) {
                    return child;
                }
                return undefined;
            });
        if (typeof render === 'function') {
            return render({
                current,
                min,
                max,
                count,
                content,
                sizeChanged: this.handleSizeChange,
                pageChanged: this.handlePageChange,
            });
        }
        return (React.createElement(PaginationLayout, Object.assign({}, props, { host: host, content: content, controls: React.createElement(PaginationBar, { selectedPage: current, itemsInfo: itemsInfo, itemsPerPageLabel: label, pagesInfo: pagesInfo, size: sizeState, items: count, onSizeChanged: this.handleSizeChange, onPageChanged: this.handlePageChange, availableSizes: Array.isArray(sizeProp) ? sizeProp : [] }) })));
    }
}
Pagination.inner = {
    get PaginationLayout() { return PaginationLayout; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9QYWdpbmF0aW9uL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUUvQixPQUFPLEVBQUUsYUFBYSxFQUFnRSxNQUFNLGtCQUFrQixDQUFDO0FBQy9HLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBeUYzRDs7R0FFRztBQUNILE1BQU0sT0FBTyxVQUFXLFNBQVEsS0FBSyxDQUFDLFNBQTJDO0lBQzdFLFlBQVksS0FBc0I7UUFDOUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBT1QscUJBQWdCLEdBQUcsQ0FBQyxFQUFFLElBQUksRUFBaUMsRUFBRSxFQUFFO1lBQ25FLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUN2QyxJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7Z0JBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUM7b0JBQ1YsT0FBTyxFQUFFLElBQUk7aUJBQ2hCLENBQUMsQ0FBQzthQUNOO1lBQ0QsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLEVBQUU7Z0JBQ2hDLFFBQVEsQ0FBQztvQkFDTCxLQUFLLEVBQUUsSUFBSTtpQkFDZCxDQUFDLENBQUM7YUFDTjtRQUNMLENBQUMsQ0FBQztRQUNNLHFCQUFnQixHQUFHLENBQUMsRUFBRSxJQUFJLEVBQWlDLEVBQUUsRUFBRTtZQUNuRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUNoQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUMvQixNQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FB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QUFFLElBQUksRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxvQkFBQyxhQUFhLElBQUMsWUFBWSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsY0FBYyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLElBQUcsQ0FBQyxDQUFDO0lBQ3ZXLENBQUM7O0FBQ00sZ0JBQUssR0FBRztJQUNYLElBQUksZ0JBQWdCLEtBQUssT0FBTyxnQkFBMkMsQ0FBQyxDQUFDLENBQUM7Q0FDakYsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFN0YW5kYXJkUHJvcHMgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgUGFnaW5hdGlvbkJhciwgUGFnaW5hdGlvbkJhclNpemVDaGFuZ2VkRXZlbnQsIFBhZ2luYXRpb25CYXJQYWdlQ2hhbmdlZEV2ZW50IH0gZnJvbSAnLi4vUGFnaW5hdGlvbkJhcic7XG5pbXBvcnQgeyBQYWdpbmF0aW9uTGF5b3V0IH0gZnJvbSAnLi9QYWdpbmF0aW9uTGF5b3V0LnBhcnQnO1xuZXhwb3J0IGludGVyZmFjZSBQYWdpbmF0aW9uQ2hhbmdlRXZlbnQge1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHBhZ2UgaW5kZXguXG4gICAgICovXG4gICAgdmFsdWU6IG51bWJlcjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUGFnaW5hdGlvblN0YXRlIHtcbiAgICBjdXJyZW50OiBudW1iZXI7XG4gICAgc2l6ZTogbnVtYmVyO1xufVxuZXhwb3J0IGludGVyZmFjZSBQYWdpbmF0aW9uUmVuZGVyRXZlbnQge1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHBhZ2UgaW5kZXguXG4gICAgICovXG4gICAgY3VycmVudDogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIFRoZSBtaW5pbXVtIGluZGV4IGZvciB0aGUgZW50cnkgdG8gYmUgaW4gdGhlIGN1cnJlbnQgcGFnZS5cbiAgICAgKi9cbiAgICBtaW46IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBUaGUgbWF4aW11bSBpbmRleCBmb3IgdGhlIGVudHJ5IHRvIGJlIGluIHRoZSBjdXJyZW50IHBhZ2UuXG4gICAgICovXG4gICAgbWF4OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIHRvdGFsIG51bWJlciBvZiBlbnRyaWVzLlxuICAgICAqL1xuICAgIGNvdW50OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIHJlbmRlcmVkIGVudHJpZXMuXG4gICAgICovXG4gICAgY29udGVudDogUmVhY3QuUmVhY3ROb2RlO1xuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZvciBlbWl0dGluZyBhbiBpdGVtcyBwZXIgcGFnZSBjaGFuZ2UuXG4gICAgICovXG4gICAgc2l6ZUNoYW5nZWQoZTogUGFnaW5hdGlvbkJhclNpemVDaGFuZ2VkRXZlbnQpOiB2b2lkO1xuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZvciBlbWl0dGluZyBhIGNoYW5nZSBvZiB0aGUgY3VycmVudCBwYWdlIGluZGV4LlxuICAgICAqL1xuICAgIHBhZ2VDaGFuZ2VkKGU6IFBhZ2luYXRpb25CYXJQYWdlQ2hhbmdlZEV2ZW50KTogdm9pZDtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUGFnaW5hdGlvblByb3BzIGV4dGVuZHMgU3RhbmRhcmRQcm9wcyB7XG4gICAgLyoqXG4gICAgICogVGhlIGluaXRpYWwsIGkuZS4sIGRlZmF1bHQsIHBhZ2UgaW5kZXggdXNlZCBpbiBtYW5hZ2VkIG1vZGUuXG4gICAgICovXG4gICAgZGVmYXVsdFZhbHVlPzogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHBhZ2UgaW5kZXggbGVhZGluZyB0byBjb250cm9sbGVkIG1vZGUuXG4gICAgICovXG4gICAgdmFsdWU/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIG1heGltdW0gbnVtYmVyIG9mIGVudHJpZXMgcGVyIHBhZ2UuIEJ5IGRlZmF1bHQgc2V0IHRvIDIwLlxuICAgICAqIEBkZWZhdWx0IDIwXG4gICAgICovXG4gICAgc2l6ZT86IG51bWJlciB8IEFycmF5PG51bWJlcj47XG4gICAgLyoqXG4gICAgICogVGhlIG9wdGlvbmFsIGhvc3QgZWxlbWVudCB0byBiZSB1c2VkLlxuICAgICAqL1xuICAgIGhvc3Q/OiBzdHJpbmcgfCBSZWFjdC5Db21wb25lbnRDbGFzcyB8IFJlYWN0LlN0YXRlbGVzc0NvbXBvbmVudDtcbiAgICAvKipcbiAgICAgKiBFdmVudCBmaXJlZCB3aGVuIHRoZSBzZWxlY3RlZCBwYWdlIGNoYW5nZXMuXG4gICAgICovXG4gICAgb25DaGFuZ2U/KGU6IFBhZ2luYXRpb25DaGFuZ2VFdmVudCk6IHZvaWQ7XG4gICAgLyoqXG4gICAgICogVGhlIG9wdGlvbmFsIGZvb3RlciBpbmZvIGxhYmVsIG92ZXJyaWRlLCBlLmcuLCBmb3IgbG9jYWxpemF0aW9uLlxuICAgICAqL1xuICAgIGxhYmVsPzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsIGZ1bmN0aW9uIHRvIGNvbXB1dGUgdGhlIGl0ZW1zIGluZm8gbGFiZWwuXG4gICAgICogQHBhcmFtIHN0YXJ0IFRoZSBpbmNsdXNpdmUgc3RhcnQgbnVtYmVyIG9mIGVudHJpZXMuXG4gICAgICogQHBhcmFtIGVuZCBUaGUgaW5jbHVzaXZlIGVuZCBudW1iZXIgb2YgZW50cmllcy5cbiAgICAgKiBAcGFyYW0gdG90YWwgVGhlIHRvdGFsIG51bWJlciBvZiBwYWdlcy5cbiAgICAgKi9cbiAgICBpdGVtc0luZm8/KHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKTogUmVhY3QuUmVhY3RDaGlsZDtcbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCBmdW5jdGlvbiB0byBjb21wdXRlIHRoZSBwYWdlcyBpbmZvIGxhYmVsLlxuICAgICAqIEBwYXJhbSBzdGFydCBUaGUgaW5jbHVzaXZlIHN0YXJ0IG51bWJlciBvZiBlbnRyaWVzLlxuICAgICAqIEBwYXJhbSBlbmQgVGhlIGluY2x1c2l2ZSBlbmQgbnVtYmVyIG9mIGVudHJpZXMuXG4gICAgICovXG4gICAgcGFnZXNJbmZvPyhzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcik6IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgdG8gb3ZlcnJpZGUgdGhlIHJlbmRlcmluZyBvZiB0aGUgcGFnaW5hdGlvbi5cbiAgICAgKi9cbiAgICByZW5kZXI/KGU6IFBhZ2luYXRpb25SZW5kZXJFdmVudCk6IFJlYWN0LlJlYWN0Tm9kZTtcbiAgICAvKipcbiAgICAgKiBUaGUgY29udGVudCBvZiB0aGUgY29tcG9uZW50LiBXaWxsIGJlIGNyb3BwZWQgaWYgcGFnaW5hdGlvbiBhcHBsaWVzLlxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xufVxuLyoqXG4gKiBUaGUgUGFnaW5hdGlvbiBjb21wb25lbnQgYWxsb3dzIGdlbmVyaWMgcGFnaW5hdGlvbiBvZiBhcmJpdHJhcnkgY29tcG9uZW50cy5cbiAqL1xuZXhwb3J0IGNsYXNzIFBhZ2luYXRpb24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UGFnaW5hdGlvblByb3BzLCBQYWdpbmF0aW9uU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogUGFnaW5hdGlvblByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgZGVmYXVsdFZhbHVlLCBzaXplID0gMjAgfSA9IHByb3BzO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgY3VycmVudDogdmFsdWUgfHwgZGVmYXVsdFZhbHVlIHx8IDAsXG4gICAgICAgICAgICBzaXplOiBBcnJheS5pc0FycmF5KHNpemUpID8gc2l6ZVswXSA6IHNpemUsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHByaXZhdGUgaGFuZGxlUGFnZUNoYW5nZSA9ICh7IHBhZ2UgfTogUGFnaW5hdGlvbkJhclBhZ2VDaGFuZ2VkRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgdmFsdWUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBwYWdlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBwYWdlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlU2l6ZUNoYW5nZSA9ICh7IHNpemUgfTogUGFnaW5hdGlvbkJhclNpemVDaGFuZ2VkRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBjaGlsZHJlbiB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjdXJyZW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB0b3RhbCA9IFJlYWN0LkNoaWxkcmVuLmNvdW50KGNoaWxkcmVuKTtcbiAgICAgICAgY29uc3QgbWF4UGFnZUNvdW50ID0gTWF0aC5tYXgoTWF0aC5jZWlsKHRvdGFsIC8gc2l6ZSkgLSAxLCAwKTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzaXplLFxuICAgICAgICAgICAgY3VycmVudDogTWF0aC5taW4oY3VycmVudCwgbWF4UGFnZUNvdW50KSxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGdldERpbShjb3VudDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgY3VycmVudCwgc2l6ZTogc2l6ZVN0YXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBtaW4gPSBjdXJyZW50ICogc2l6ZVN0YXRlO1xuICAgICAgICBpZiAobWluIDwgY291bnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgY3VycmVudCxcbiAgICAgICAgICAgICAgICBtaW4sXG4gICAgICAgICAgICAgICAgbWF4OiBtaW4gKyBzaXplU3RhdGUsXG4gICAgICAgICAgICAgICAgc2l6ZVN0YXRlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzID0gfn4oKGNvdW50IC0gMSkgLyBzaXplU3RhdGUpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBwcmV2aW91cyxcbiAgICAgICAgICAgICAgICBtaW46IHByZXZpb3VzICogc2l6ZVN0YXRlLFxuICAgICAgICAgICAgICAgIG1heDogKHByZXZpb3VzICsgMSkgKiBzaXplU3RhdGUsXG4gICAgICAgICAgICAgICAgc2l6ZVN0YXRlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW4sIGhvc3QsIHNpemU6IHNpemVQcm9wLCBpdGVtc0luZm8sIHBhZ2VzSW5mbywgbGFiZWwsIHJlbmRlciwgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGNvdW50ID0gUmVhY3QuQ2hpbGRyZW4uY291bnQoY2hpbGRyZW4pO1xuICAgICAgICBjb25zdCB7IGN1cnJlbnQsIG1pbiwgbWF4LCBzaXplU3RhdGUgfSA9IHRoaXMuZ2V0RGltKGNvdW50KTtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGNvdW50IDwgc2l6ZVN0YXRlXG4gICAgICAgICAgICA/IGNoaWxkcmVuXG4gICAgICAgICAgICA6IFJlYWN0LkNoaWxkcmVuLm1hcChjaGlsZHJlbiwgKGNoaWxkLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSBtaW4gJiYgaW5kZXggPCBtYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVuZGVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyKHtcbiAgICAgICAgICAgICAgICBjdXJyZW50LFxuICAgICAgICAgICAgICAgIG1pbixcbiAgICAgICAgICAgICAgICBtYXgsXG4gICAgICAgICAgICAgICAgY291bnQsXG4gICAgICAgICAgICAgICAgY29udGVudCxcbiAgICAgICAgICAgICAgICBzaXplQ2hhbmdlZDogdGhpcy5oYW5kbGVTaXplQ2hhbmdlLFxuICAgICAgICAgICAgICAgIHBhZ2VDaGFuZ2VkOiB0aGlzLmhhbmRsZVBhZ2VDaGFuZ2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxQYWdpbmF0aW9uTGF5b3V0IHsuLi5wcm9wc30gaG9zdD17aG9zdH0gY29udGVudD17Y29udGVudH0gY29udHJvbHM9ezxQYWdpbmF0aW9uQmFyIHNlbGVjdGVkUGFnZT17Y3VycmVudH0gaXRlbXNJbmZvPXtpdGVtc0luZm99IGl0ZW1zUGVyUGFnZUxhYmVsPXtsYWJlbH0gcGFnZXNJbmZvPXtwYWdlc0luZm99IHNpemU9e3NpemVTdGF0ZX0gaXRlbXM9e2NvdW50fSBvblNpemVDaGFuZ2VkPXt0aGlzLmhhbmRsZVNpemVDaGFuZ2V9IG9uUGFnZUNoYW5nZWQ9e3RoaXMuaGFuZGxlUGFnZUNoYW5nZX0gYXZhaWxhYmxlU2l6ZXM9e0FycmF5LmlzQXJyYXkoc2l6ZVByb3ApID8gc2l6ZVByb3AgOiBbXX0vPn0vPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFBhZ2luYXRpb25MYXlvdXQoKSB7IHJldHVybiBQYWdpbmF0aW9uTGF5b3V0IGFzIHR5cGVvZiBQYWdpbmF0aW9uTGF5b3V0OyB9XG4gICAgfTtcbn1cbiJdfQ==