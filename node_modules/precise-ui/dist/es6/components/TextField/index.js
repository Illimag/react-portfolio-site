var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { themed } from '../../utils/styled';
import { StackPanel } from '../StackPanel';
import { purpleRed } from '../../colors';
import { InputIcon } from '../InputIcon';
import { withFormContext } from '../../hoc/withFormContext';
import { showInputInfo } from '../../utils/input';
import { distance } from '../../distance';
import { StyledInputRow, StyledInput, StyledInputBox, getTextFieldBorderType } from '../../quarks';
import { getFontSize } from '../../textStyles';
const TextFieldContainer = styled.div `
  position: relative;
`;
const TextFieldWrapper = styled(StackPanel) `
  display: flex;
`;
const TextFieldArea = styled.textarea `
  ::-ms-clear { display: none; }

  white-space: pre-wrap;
  word-break: break-word;

  ${getFontSize('medium')}
  color: ${themed(({ theme, disabled }) => (disabled ? theme.text3 : theme.text2))};
  border-radius: 0;
  font-family: inherit;
  padding: ${props => (props.labelShown ? `${distance.large} ${distance.medium} ${distance.small}` : distance.medium)};
  box-sizing: border-box;
  box-shadow: none;
  resize: ${props => props.resizable || 'none'};
  margin: 0;
  width: 100%;
  cursor: ${props => (props.disabled ? 'not-allowed' : 'auto')};
  border: none;
  border-bottom: 1px solid
    ${themed(({ theme, border }) => (border === 3 /* error */ ? purpleRed : theme.ui4))};
  background: ${themed(({ theme }) => theme.ui2)};

  &::placeholder {
    color: ${themed(({ theme, disabled }) => (disabled ? theme.text3 : theme.text2))};
    opacity: ${props => (props.labelShown ? '0' : '1')};
    transition: inherit;
  }

  &:focus {
    outline: none;

    &::placeholder {
      opacity: 1;
    }
  }
`;
const TextFieldElement = styled.div `
  ${getFontSize('medium')}

  display: flex;
  align-items: center;
  padding: ${distance.medium};
  color: ${themed(({ theme }) => theme.text2)};
  background: ${themed(({ theme }) => theme.ui3)};
`;
class TextFieldInt extends React.Component {
    constructor(props) {
        super(props);
        this.changeValue = (e) => {
            this.updateValue(e.target.value, e);
        };
        this.changeHeight = () => {
            const { resizable } = this.props;
            const element = this._element;
            if (resizable === 'auto' && element) {
                element.style.height = '1px';
                element.style.height = `${element.scrollHeight}px`;
            }
        };
        this.setTextFieldNode = (node) => {
            this._element = node;
            const { inputRef } = this.props;
            if (typeof inputRef === 'function') {
                inputRef(node);
            }
        };
        this.setFocus = () => {
            const { onFocus } = this.props;
            this.setState({
                focused: true,
            }, onFocus);
        };
        this.unsetFocus = () => {
            const { onBlur } = this.props;
            this.setState({
                focused: false,
            }, onBlur);
        };
        this.handleReset = () => {
            const { onClear } = this.props;
            this.updateValue('');
            if (typeof onClear === 'function') {
                onClear();
            }
        };
        this.state = {
            focused: false,
            reveal: false,
            controlled: props.value !== undefined,
            value: props.value || props.defaultValue || '',
            error: props.error,
        };
    }
    UNSAFE_componentWillReceiveProps({ value = '', error }) {
        if (this.state.controlled) {
            this.setState({ value });
        }
        this.setState({ error });
    }
    componentDidMount() {
        this.changeHeight();
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.subscribe(this);
        }
    }
    componentWillUnmount() {
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    }
    updateValue(value, e) {
        const { onChange, name = '', form } = this.props;
        if (!this.state.controlled) {
            if (form) {
                form.change({
                    name,
                    value,
                });
            }
            else {
                this.setState({
                    value,
                });
            }
        }
        if (typeof onChange === 'function') {
            onChange({
                value,
                originalEvent: e,
            });
        }
    }
    render() {
        const _a = this.props, { theme, borderless, prefix, suffix, multiline, resizable = false, disabled, placeholder, info, label, clearable, onClear, icon, onChange: _0, defaultValue: _1, value: _2, form: _3, onFocus: _4, onBlur: _5, inputRef: _6, onInput: _7 } = _a, rest = __rest(_a, ["theme", "borderless", "prefix", "suffix", "multiline", "resizable", "disabled", "placeholder", "info", "label", "clearable", "onClear", "icon", "onChange", "defaultValue", "value", "form", "onFocus", "onBlur", "inputRef", "onInput"]);
        const { focused, value, error } = this.state;
        const rows = typeof multiline === 'number' ? multiline : undefined;
        const border = getTextFieldBorderType(borderless, !!error, focused);
        const hasValue = !!value;
        const input = rows !== undefined || multiline ? (React.createElement(TextFieldArea, Object.assign({ ref: this.setTextFieldNode, onInput: this.changeHeight, border: border, rows: rows, resizable: typeof resizable === 'string' ? resizable : resizable ? 'auto' : undefined, disabled: disabled, labelShown: label !== undefined, placeholder: placeholder, onFocus: this.setFocus, onBlur: this.unsetFocus, value: value, onChange: this.changeValue }, rest))) : (React.createElement(StyledInput, Object.assign({ ref: el => this.setTextFieldNode(el), theme: theme, disabled: disabled, labelShown: label !== undefined, placeholder: placeholder, onFocus: this.setFocus, onBlur: this.unsetFocus, value: value, onChange: this.changeValue }, rest)));
        const textFieldWrapper = (React.createElement(StyledInputRow, { error: !!error, focused: focused, hasValue: hasValue, label: label, placeholder: placeholder, multiline: rows !== undefined || multiline !== undefined }, input));
        return (React.createElement(TextFieldContainer, null,
            rows !== undefined || multiline ? (textFieldWrapper) : (React.createElement(TextFieldWrapper, null,
                prefix && React.createElement(TextFieldElement, null, prefix),
                React.createElement(StyledInputBox, { border: border, disabled: disabled, focused: focused, hasValue: hasValue },
                    textFieldWrapper,
                    React.createElement(InputIcon, { disabled: disabled, defaultIcon: icon, theme: theme, error: error, hasValue: hasValue, clearable: clearable, onClear: this.handleReset, onClick: () => this._element && this._element.focus() })),
                suffix && React.createElement(TextFieldElement, null, suffix))),
            showInputInfo(error, info)));
    }
}
TextFieldInt.inner = {
    get TextFieldArea() { return TextFieldArea; },
    get StyledInput() { return StyledInput; },
    get StyledInputRow() { return StyledInputRow; },
    get TextFieldContainer() { return TextFieldContainer; },
    get TextFieldWrapper() { return TextFieldWrapper; },
    get TextFieldElement() { return TextFieldElement; },
    get StyledInputBox() { return StyledInputBox; },
    get InputIcon() { return InputIcon; }
};
/**
 * A text field for custom user input.
 */
export const TextField = withFormContext(TextFieldInt);
TextField.displayName = 'TextField';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9UZXh0RmllbGQvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFekMsT0FBTyxFQUFvQixlQUFlLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUM5RSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxjQUFjLEVBQUUsV0FBVyxFQUF1QixjQUFjLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDeEgsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBZ0QvQyxNQUFNLGtCQUFrQixHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7O0NBRXJDLENBQUM7QUFDRixNQUFNLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQzs7Q0FFM0MsQ0FBQztBQUNGLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQXFCOzs7Ozs7SUFNdEQsV0FBVyxDQUFDLFFBQVEsQ0FBQztXQUNkLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMs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U0FBUyxLQUFLLE9BQU8sU0FBNkIsQ0FBQyxDQUFDLENBQUM7Q0FDNUQsQ0FBQztBQUVOOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLGVBQWUsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN2RCxTQUFTLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IFN0YWNrUGFuZWwgfSBmcm9tICcuLi9TdGFja1BhbmVsJztcbmltcG9ydCB7IHB1cnBsZVJlZCB9IGZyb20gJy4uLy4uL2NvbG9ycyc7XG5pbXBvcnQgeyBJbnB1dEljb24gfSBmcm9tICcuLi9JbnB1dEljb24nO1xuaW1wb3J0IHsgSW5wdXRDaGFuZ2VFdmVudCwgVGV4dElucHV0UHJvcHMgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgRm9ybUNvbnRleHRQcm9wcywgd2l0aEZvcm1Db250ZXh0IH0gZnJvbSAnLi4vLi4vaG9jL3dpdGhGb3JtQ29udGV4dCc7XG5pbXBvcnQgeyBzaG93SW5wdXRJbmZvIH0gZnJvbSAnLi4vLi4vdXRpbHMvaW5wdXQnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBTdHlsZWRJbnB1dFJvdywgU3R5bGVkSW5wdXQsIFRleHRGaWVsZEJvcmRlclR5cGUsIFN0eWxlZElucHV0Qm94LCBnZXRUZXh0RmllbGRCb3JkZXJUeXBlIH0gZnJvbSAnLi4vLi4vcXVhcmtzJztcbmltcG9ydCB7IGdldEZvbnRTaXplIH0gZnJvbSAnLi4vLi4vdGV4dFN0eWxlcyc7XG5leHBvcnQgdHlwZSBUZXh0RmllbGRDaGFuZ2VFdmVudCA9IElucHV0Q2hhbmdlRXZlbnQ8c3RyaW5nPjtcbnR5cGUgVGV4dEZpZWxkSW5wdXROb2RlVHlwZSA9IEhUTUxUZXh0QXJlYUVsZW1lbnQgfCBIVE1MSW5wdXRFbGVtZW50O1xuZXhwb3J0IGludGVyZmFjZSBUZXh0RmllbGRQcm9wcyBleHRlbmRzIFRleHRJbnB1dFByb3BzIHtcbiAgICAvKipcbiAgICAgKiBBbGxvd3MgbXVsdGktbGluZSBpbnB1dCBmcm9tIHRoZSB1c2VyLiBFaXRoZXIgYSBib29sZWFuXG4gICAgICogb3IgYSBudW1iZXIgc3BlY2lmeWluZyB0aGUgYW1vdW50IG9mIHJvd3MgdG8gc2hvdy5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIG11bHRpbGluZT86IGJvb2xlYW4gfCBudW1iZXI7XG4gICAgLyoqXG4gICAgICogQWxsb3dzIHJlc2l6aW5nIHRoZSB0ZXh0IGZpZWxkIGlmIGJlaW5nIHVzZWQgYXMgYSBtdWx0aS1saW5lIGlucHV0LlxuICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICovXG4gICAgcmVzaXphYmxlPzogYm9vbGVhbiB8ICdhdXRvJyB8ICd2ZXJ0aWNhbCcgfCAnaG9yaXpvbnRhbCc7XG4gICAgLyoqXG4gICAgICogU2hvd3MgYSBjbGVhcmluZyBpY29uIHdoaWNoIHJlc2V0cyB0aGUgaW5wdXQgdG8gYW4gZW1wdHkgc3RyaW5nLlxuICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICovXG4gICAgY2xlYXJhYmxlPzogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gdGhlIGNsZWFyIGJ1dHRvbiB3YXMgcHJlc3NlZC4gV2lsbCBhbHdheXMgYmUgZmlyZWQgYWZ0ZXJcbiAgICAgKiB0aGUgb25DaGFuZ2UgZXZlbnQsIGkuZS4sIGFmdGVyIHRoZSB2YWx1ZSB3YXMgc2V0IC8gcHJvcG9zZWQuXG4gICAgICovXG4gICAgb25DbGVhcj8oKTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSByZWZlcmVuY2UgdG8gdGhlIHVuZGVybHlpbmcgaW5wdXQgb3IgdGV4dGFyZWEgZWxlbWVudC5cbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgaW5wdXRSZWY/KGluc3RhbmNlOiBIVE1MRWxlbWVudCB8IG51bGwpOiB2b2lkO1xuICAgIC8qKlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBjaGlsZHJlbj86IHZvaWQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIFRleHRGaWVsZFN0YXRlIHtcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xuICAgIGZvY3VzZWQ6IGJvb2xlYW47XG4gICAgcmV2ZWFsOiBib29sZWFuO1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgZXJyb3I/OiBSZWFjdC5SZWFjdENoaWxkO1xufVxuaW50ZXJmYWNlIFRleHRGaWVsZEFyZWFQcm9wcyB7XG4gICAgYm9yZGVyOiBUZXh0RmllbGRCb3JkZXJUeXBlO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgICByZXNpemFibGU/OiBzdHJpbmc7XG4gICAgbGFiZWxTaG93bjogYm9vbGVhbjtcbn1cbmNvbnN0IFRleHRGaWVsZENvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG5gO1xuY29uc3QgVGV4dEZpZWxkV3JhcHBlciA9IHN0eWxlZChTdGFja1BhbmVsKSBgXG4gIGRpc3BsYXk6IGZsZXg7XG5gO1xuY29uc3QgVGV4dEZpZWxkQXJlYSA9IHN0eWxlZC50ZXh0YXJlYTxUZXh0RmllbGRBcmVhUHJvcHM+IGBcbiAgOjotbXMtY2xlYXIgeyBkaXNwbGF5OiBub25lOyB9XG5cbiAgd2hpdGUtc3BhY2U6IHByZS13cmFwO1xuICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuXG4gICR7Z2V0Rm9udFNpemUoJ21lZGl1bScpfVxuICBjb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUsIGRpc2FibGVkIH0pID0+IChkaXNhYmxlZCA/IHRoZW1lLnRleHQzIDogdGhlbWUudGV4dDIpKX07XG4gIGJvcmRlci1yYWRpdXM6IDA7XG4gIGZvbnQtZmFtaWx5OiBpbmhlcml0O1xuICBwYWRkaW5nOiAke3Byb3BzID0+IChwcm9wcy5sYWJlbFNob3duID8gYCR7ZGlzdGFuY2UubGFyZ2V9ICR7ZGlzdGFuY2UubWVkaXVtfSAke2Rpc3RhbmNlLnNtYWxsfWAgOiBkaXN0YW5jZS5tZWRpdW0pfTtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYm94LXNoYWRvdzogbm9uZTtcbiAgcmVzaXplOiAke3Byb3BzID0+IHByb3BzLnJlc2l6YWJsZSB8fCAnbm9uZSd9O1xuICBtYXJnaW46IDA7XG4gIHdpZHRoOiAxMDAlO1xuICBjdXJzb3I6ICR7cHJvcHMgPT4gKHByb3BzLmRpc2FibGVkID8gJ25vdC1hbGxvd2VkJyA6ICdhdXRvJyl9O1xuICBib3JkZXI6IG5vbmU7XG4gIGJvcmRlci1ib3R0b206IDFweCBzb2xpZFxuICAgICR7dGhlbWVkKCh7IHRoZW1lLCBib3JkZXIgfSkgPT4gKGJvcmRlciA9PT0gVGV4dEZpZWxkQm9yZGVyVHlwZS5lcnJvciA/IHB1cnBsZVJlZCA6IHRoZW1lLnVpNCkpfTtcbiAgYmFja2dyb3VuZDogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudWkyKX07XG5cbiAgJjo6cGxhY2Vob2xkZXIge1xuICAgIGNvbG9yOiAke3RoZW1lZCgoeyB0aGVtZSwgZGlzYWJsZWQgfSkgPT4gKGRpc2FibGVkID8gdGhlbWUudGV4dDMgOiB0aGVtZS50ZXh0MikpfTtcbiAgICBvcGFjaXR5OiAke3Byb3BzID0+IChwcm9wcy5sYWJlbFNob3duID8gJzAnIDogJzEnKX07XG4gICAgdHJhbnNpdGlvbjogaW5oZXJpdDtcbiAgfVxuXG4gICY6Zm9jdXMge1xuICAgIG91dGxpbmU6IG5vbmU7XG5cbiAgICAmOjpwbGFjZWhvbGRlciB7XG4gICAgICBvcGFjaXR5OiAxO1xuICAgIH1cbiAgfVxuYDtcbmNvbnN0IFRleHRGaWVsZEVsZW1lbnQgPSBzdHlsZWQuZGl2IGBcbiAgJHtnZXRGb250U2l6ZSgnbWVkaXVtJyl9XG5cbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgcGFkZGluZzogJHtkaXN0YW5jZS5tZWRpdW19O1xuICBjb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDIpfTtcbiAgYmFja2dyb3VuZDogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudWkzKX07XG5gO1xuY2xhc3MgVGV4dEZpZWxkSW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFRleHRGaWVsZFByb3BzICYgRm9ybUNvbnRleHRQcm9wcywgVGV4dEZpZWxkU3RhdGU+IHtcbiAgICBwcml2YXRlIF9lbGVtZW50OiBUZXh0RmllbGRJbnB1dE5vZGVUeXBlIHwgbnVsbDtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogVGV4dEZpZWxkUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgZm9jdXNlZDogZmFsc2UsXG4gICAgICAgICAgICByZXZlYWw6IGZhbHNlLFxuICAgICAgICAgICAgY29udHJvbGxlZDogcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy52YWx1ZSB8fCBwcm9wcy5kZWZhdWx0VmFsdWUgfHwgJycsXG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgIH07XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHsgdmFsdWUgPSAnJywgZXJyb3IgfTogVGV4dEZpZWxkUHJvcHMpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvciB9KTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlSGVpZ2h0KCk7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS51bnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZVZhbHVlID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQgfCBIVE1MVGV4dEFyZWFFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZVZhbHVlKGUudGFyZ2V0LnZhbHVlLCBlKTtcbiAgICB9O1xuICAgIHByaXZhdGUgdXBkYXRlVmFsdWUodmFsdWU6IHN0cmluZywgZT86IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQgfCBIVE1MVGV4dEFyZWFFbGVtZW50Pikge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBuYW1lID0gJycsIGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm0uY2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRXZlbnQ6IGUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZUhlaWdodCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXNpemFibGUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSB0aGlzLl9lbGVtZW50O1xuICAgICAgICBpZiAocmVzaXphYmxlID09PSAnYXV0bycgJiYgZWxlbWVudCkge1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSAnMXB4JztcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gYCR7ZWxlbWVudC5zY3JvbGxIZWlnaHR9cHhgO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIHNldFRleHRGaWVsZE5vZGUgPSAobm9kZTogVGV4dEZpZWxkSW5wdXROb2RlVHlwZSB8IG51bGwpID0+IHtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG5vZGU7XG4gICAgICAgIGNvbnN0IHsgaW5wdXRSZWYgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0eXBlb2YgaW5wdXRSZWYgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGlucHV0UmVmKG5vZGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIHNldEZvY3VzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IG9uRm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZm9jdXNlZDogdHJ1ZSxcbiAgICAgICAgfSwgb25Gb2N1cyk7XG4gICAgfTtcbiAgICBwcml2YXRlIHVuc2V0Rm9jdXMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25CbHVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGZvY3VzZWQ6IGZhbHNlLFxuICAgICAgICB9LCBvbkJsdXIpO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVSZXNldCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNsZWFyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICB0aGlzLnVwZGF0ZVZhbHVlKCcnKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNsZWFyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNsZWFyKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyB0aGVtZSwgYm9yZGVybGVzcywgcHJlZml4LCBzdWZmaXgsIG11bHRpbGluZSwgcmVzaXphYmxlID0gZmFsc2UsIGRpc2FibGVkLCBwbGFjZWhvbGRlciwgaW5mbywgbGFiZWwsIGNsZWFyYWJsZSwgb25DbGVhciwgaWNvbiwgb25DaGFuZ2U6IF8wLCBkZWZhdWx0VmFsdWU6IF8xLCB2YWx1ZTogXzIsIGZvcm06IF8zLCBvbkZvY3VzOiBfNCwgb25CbHVyOiBfNSwgaW5wdXRSZWY6IF82LCBvbklucHV0OiBfNywgLi4ucmVzdCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBmb2N1c2VkLCB2YWx1ZSwgZXJyb3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHJvd3MgPSB0eXBlb2YgbXVsdGlsaW5lID09PSAnbnVtYmVyJyA/IG11bHRpbGluZSA6IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgYm9yZGVyID0gZ2V0VGV4dEZpZWxkQm9yZGVyVHlwZShib3JkZXJsZXNzLCAhIWVycm9yLCBmb2N1c2VkKTtcbiAgICAgICAgY29uc3QgaGFzVmFsdWUgPSAhIXZhbHVlO1xuICAgICAgICBjb25zdCBpbnB1dCA9IHJvd3MgIT09IHVuZGVmaW5lZCB8fCBtdWx0aWxpbmUgPyAoPFRleHRGaWVsZEFyZWEgcmVmPXt0aGlzLnNldFRleHRGaWVsZE5vZGV9IG9uSW5wdXQ9e3RoaXMuY2hhbmdlSGVpZ2h0fSBib3JkZXI9e2JvcmRlcn0gcm93cz17cm93c30gcmVzaXphYmxlPXt0eXBlb2YgcmVzaXphYmxlID09PSAnc3RyaW5nJyA/IHJlc2l6YWJsZSA6IHJlc2l6YWJsZSA/ICdhdXRvJyA6IHVuZGVmaW5lZH0gZGlzYWJsZWQ9e2Rpc2FibGVkfSBsYWJlbFNob3duPXtsYWJlbCAhPT0gdW5kZWZpbmVkfSBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9IG9uRm9jdXM9e3RoaXMuc2V0Rm9jdXN9IG9uQmx1cj17dGhpcy51bnNldEZvY3VzfSB2YWx1ZT17dmFsdWV9IG9uQ2hhbmdlPXt0aGlzLmNoYW5nZVZhbHVlfSB7Li4ucmVzdH0vPikgOiAoPFN0eWxlZElucHV0IHJlZj17ZWwgPT4gdGhpcy5zZXRUZXh0RmllbGROb2RlKGVsIGFzIFRleHRGaWVsZElucHV0Tm9kZVR5cGUpfSB0aGVtZT17dGhlbWV9IGRpc2FibGVkPXtkaXNhYmxlZH0gbGFiZWxTaG93bj17bGFiZWwgIT09IHVuZGVmaW5lZH0gcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfSBvbkZvY3VzPXt0aGlzLnNldEZvY3VzfSBvbkJsdXI9e3RoaXMudW5zZXRGb2N1c30gdmFsdWU9e3ZhbHVlfSBvbkNoYW5nZT17dGhpcy5jaGFuZ2VWYWx1ZX0gey4uLnJlc3R9Lz4pO1xuICAgICAgICBjb25zdCB0ZXh0RmllbGRXcmFwcGVyID0gKDxTdHlsZWRJbnB1dFJvdyBlcnJvcj17ISFlcnJvcn0gZm9jdXNlZD17Zm9jdXNlZH0gaGFzVmFsdWU9e2hhc1ZhbHVlfSBsYWJlbD17bGFiZWx9IHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn0gbXVsdGlsaW5lPXtyb3dzICE9PSB1bmRlZmluZWQgfHwgbXVsdGlsaW5lICE9PSB1bmRlZmluZWR9PlxuICAgICAgICB7aW5wdXR9XG4gICAgICA8L1N0eWxlZElucHV0Um93Pik7XG4gICAgICAgIHJldHVybiAoPFRleHRGaWVsZENvbnRhaW5lcj5cbiAgICAgICAge3Jvd3MgIT09IHVuZGVmaW5lZCB8fCBtdWx0aWxpbmUgPyAodGV4dEZpZWxkV3JhcHBlcikgOiAoPFRleHRGaWVsZFdyYXBwZXI+XG4gICAgICAgICAgICB7cHJlZml4ICYmIDxUZXh0RmllbGRFbGVtZW50PntwcmVmaXh9PC9UZXh0RmllbGRFbGVtZW50Pn1cbiAgICAgICAgICAgIDxTdHlsZWRJbnB1dEJveCBib3JkZXI9e2JvcmRlcn0gZGlzYWJsZWQ9e2Rpc2FibGVkfSBmb2N1c2VkPXtmb2N1c2VkfSBoYXNWYWx1ZT17aGFzVmFsdWV9PlxuICAgICAgICAgICAgICB7dGV4dEZpZWxkV3JhcHBlcn1cbiAgICAgICAgICAgICAgPElucHV0SWNvbiBkaXNhYmxlZD17ZGlzYWJsZWR9IGRlZmF1bHRJY29uPXtpY29ufSB0aGVtZT17dGhlbWV9IGVycm9yPXtlcnJvcn0gaGFzVmFsdWU9e2hhc1ZhbHVlfSBjbGVhcmFibGU9e2NsZWFyYWJsZX0gb25DbGVhcj17dGhpcy5oYW5kbGVSZXNldH0gb25DbGljaz17KCkgPT4gdGhpcy5fZWxlbWVudCAmJiB0aGlzLl9lbGVtZW50LmZvY3VzKCl9Lz5cbiAgICAgICAgICAgIDwvU3R5bGVkSW5wdXRCb3g+XG4gICAgICAgICAgICB7c3VmZml4ICYmIDxUZXh0RmllbGRFbGVtZW50PntzdWZmaXh9PC9UZXh0RmllbGRFbGVtZW50Pn1cbiAgICAgICAgICA8L1RleHRGaWVsZFdyYXBwZXI+KX1cbiAgICAgICAge3Nob3dJbnB1dEluZm8oZXJyb3IsIGluZm8pfVxuICAgICAgPC9UZXh0RmllbGRDb250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgVGV4dEZpZWxkQXJlYSgpIHsgcmV0dXJuIFRleHRGaWVsZEFyZWEgYXMgdHlwZW9mIFRleHRGaWVsZEFyZWE7IH0sXG4gICAgICAgIGdldCBTdHlsZWRJbnB1dCgpIHsgcmV0dXJuIFN0eWxlZElucHV0IGFzIHR5cGVvZiBTdHlsZWRJbnB1dDsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZElucHV0Um93KCkgeyByZXR1cm4gU3R5bGVkSW5wdXRSb3cgYXMgdHlwZW9mIFN0eWxlZElucHV0Um93OyB9LFxuICAgICAgICBnZXQgVGV4dEZpZWxkQ29udGFpbmVyKCkgeyByZXR1cm4gVGV4dEZpZWxkQ29udGFpbmVyIGFzIHR5cGVvZiBUZXh0RmllbGRDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBUZXh0RmllbGRXcmFwcGVyKCkgeyByZXR1cm4gVGV4dEZpZWxkV3JhcHBlciBhcyB0eXBlb2YgVGV4dEZpZWxkV3JhcHBlcjsgfSxcbiAgICAgICAgZ2V0IFRleHRGaWVsZEVsZW1lbnQoKSB7IHJldHVybiBUZXh0RmllbGRFbGVtZW50IGFzIHR5cGVvZiBUZXh0RmllbGRFbGVtZW50OyB9LFxuICAgICAgICBnZXQgU3R5bGVkSW5wdXRCb3goKSB7IHJldHVybiBTdHlsZWRJbnB1dEJveCBhcyB0eXBlb2YgU3R5bGVkSW5wdXRCb3g7IH0sXG4gICAgICAgIGdldCBJbnB1dEljb24oKSB7IHJldHVybiBJbnB1dEljb24gYXMgdHlwZW9mIElucHV0SWNvbjsgfVxuICAgIH07XG59XG4vKipcbiAqIEEgdGV4dCBmaWVsZCBmb3IgY3VzdG9tIHVzZXIgaW5wdXQuXG4gKi9cbmV4cG9ydCBjb25zdCBUZXh0RmllbGQgPSB3aXRoRm9ybUNvbnRleHQoVGV4dEZpZWxkSW50KTtcblRleHRGaWVsZC5kaXNwbGF5TmFtZSA9ICdUZXh0RmllbGQnO1xuIl19