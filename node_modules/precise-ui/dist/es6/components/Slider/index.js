var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { themed } from '../../utils/styled';
import { ocean } from '../../colors';
import { IndicatorKnob } from '../IndicatorKnob';
import { InteractiveSurface } from '../InteractiveSurface';
import { withFormContext } from '../../hoc';
import { showInputInfo } from '../../utils/input';
import { distance } from '../../distance';
import { transparentize } from '../../utils';
import { Tooltip } from '../Tooltip';
function percent(value) {
    return typeof value === 'number' ? `${value * 100}%` : '50%';
}
const transitionDuration = '0.3s';
const transitionEase = 'cubic-bezier(0, 0, 0.25, 1)';
const SliderContainer = styled.div `
  position: relative;
  outline: 0;
  height: 100%;
`;
const SliderBar = styled(InteractiveSurface) `
  position: relative;
  padding: ${props => (props.orientation === 'vertical' ? `0 ${distance.small}` : `${distance.small} 0`)};
  height: ${props => (props.orientation === 'vertical' ? '100%' : distance.xsmall)};
  width: ${props => (props.orientation === 'vertical' ? distance.xsmall : '100%')};
  box-sizing: content-box;

  &:after {
    content: '';
    display: block;
    border-radius: ${distance.small};
    height: 100%;
    width: 100%;
    background: ${themed(props => props.disabled
    ? props.theme.ui3
    : props.active
        ? transparentize(ocean, 0.25)
        : transparentize(props.theme.ui4, 0.25))};
    transition: background ${transitionDuration} ${transitionEase};
  }

  &:hover {
    cursor: pointer;

    &:after {
      background: ${transparentize(ocean, 0.25)};
    }
  }
`;
const IndicatorBar = styled('div') `
  border-radius: ${distance.small};
  background: ${themed(props => props.disabled ? props.theme.ui4 : props.active ? ocean : transparentize(props.theme.ui5, 0.75))};
  transition: background ${transitionDuration} ${transitionEase};
  height: ${props => (props.vertical ? '100%' : distance.xsmall)};
  width: ${props => (props.vertical ? distance.xsmall : 'auto')};
  position: absolute;
  margin: auto;
`;
const TooltipContainer = styled('div') `
  position: absolute;
  ${props => (props.vertical ? `top: ${props.value}` : `left: ${props.value}`)};
  ${props => (props.vertical ? `left: ${distance.large}` : `top: -${distance.large}`)};
  width: 0;
  height: 0;

  > div {
    display: ${props => (props.vertical ? `block` : `inline-block`)};
  }
`;
class SliderInt extends React.PureComponent {
    constructor(props) {
        super(props);
        this.updateValue = (e) => {
            const { maximum = 1, minimum = 0 } = this.props;
            const v = this.state.vertical ? 1 - e.y : e.x;
            const position = minimum + v * (maximum - minimum);
            const value = this.state.value;
            const length = Array.isArray(value) ? value.length : 1;
            const multi = length > 1;
            const knob = this.state.active || (multi ? this.getClosestKnob(position) : 1);
            this.setValue(position, e.active ? knob : 0);
        };
        this.control = (e) => {
            const { minimum = 0, maximum = 1, onInput } = this.props;
            const { step = Math.min(1, (maximum - minimum) / 10) } = this.props;
            const { active, vertical } = this.state;
            const knob = active || 1;
            switch (e.keyCode) {
                case 38 /* up */:
                case 40 /* down */:
                    this.controlKnob(vertical, 39 - e.keyCode, step);
                    break;
                case 37 /* left */:
                case 39 /* right */:
                    this.controlKnob(!vertical, e.keyCode - 38, step);
                    break;
                case 36 /* home */:
                    this.setValue(minimum, knob);
                    break;
                case 35 /* end */:
                    this.setValue(maximum, knob);
                    break;
                case 27 /* escape */:
                    this.setState({
                        active: 0,
                    });
                case 13 /* enter */:
                case 32 /* space */:
                default:
                    if (typeof onInput === 'function') {
                        onInput();
                    }
                    return;
            }
            e.preventDefault();
        };
        this.handleMouseEnter = () => {
            this.setState({ hovered: true });
        };
        this.handleMouseLeave = () => {
            this.setState({ hovered: false });
        };
        this.updateTooltipValue = (val) => {
            const { maximum = 1, step } = this.props;
            const decimalPlaces = step && step < 1 ? this.countDecimals(step) : 0;
            return !step && maximum <= 1 ? `${val.toFixed(1)}` : `${val.toFixed(decimalPlaces)}`;
        };
        const value = props.value || props.defaultValue;
        this.state = {
            value: Array.isArray(value) ? value : [value || 0],
            vertical: props.orientation === 'vertical',
            active: 0,
            controlled: typeof props.value !== 'undefined',
            hovered: false,
            error: props.error,
        };
    }
    componentDidMount() {
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.subscribe(this);
        }
    }
    componentWillUnmount() {
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    }
    UNSAFE_componentWillReceiveProps({ value = this.state.value, error, orientation }) {
        if (this.state.controlled) {
            this.setState({ value });
        }
        this.setState({
            vertical: orientation === 'vertical',
            error,
        });
    }
    getClosestKnob(current) {
        const values = this.state.value;
        if (Array.isArray(values)) {
            const dists = values.map(val => Math.abs(val - current));
            const length = dists.length;
            let minIndex = 0;
            for (let i = 0; i < length; i++) {
                const curValue = dists[i];
                const minValue = dists[minIndex];
                if (curValue < minValue || (curValue === minValue && current > values[i])) {
                    minIndex = i;
                }
            }
            return minIndex + 1;
        }
        return 1;
    }
    selectValue(selected, knob) {
        const { margin = 0 } = this.props;
        const current = this.state.value;
        if (Array.isArray(current)) {
            const value = [...current];
            const upper = value[knob];
            const lower = value[knob - 2];
            if (lower + margin > selected) {
                value[knob - 1] = lower + margin;
            }
            else if (upper - margin < selected) {
                value[knob - 1] = upper - margin;
            }
            else {
                value[knob - 1] = selected;
            }
            return value;
        }
        return selected;
    }
    setValue(position, knob) {
        const { onChange, onChangeDone, maximum = 1, minimum = 0, step = 0, disabled, form, name = '' } = this.props;
        if (!disabled) {
            const current = this.state.value;
            const length = Array.isArray(current) ? current.length : 1;
            const multi = length > 1;
            const previous = Array.isArray(current) ? current[knob - 1] : current;
            const valid = Math.abs(position - previous) >= step && position >= minimum && position <= maximum;
            const selected = position - (step && (position - previous) % step);
            if (!this.state.controlled && valid) {
                const value = this.selectValue(selected, knob);
                if (form) {
                    form.change({
                        name,
                        value,
                    });
                }
                else {
                    this.setState({
                        value,
                    });
                }
            }
            const event = {
                value: selected,
                index: knob - 1,
                type: multi ? 'multi' : 'single',
            };
            if (valid && typeof onChange === 'function') {
                onChange(event);
            }
            if (knob !== this.state.active) {
                this.setState({
                    active: knob,
                });
                if (!knob && valid && typeof onChangeDone === 'function') {
                    onChangeDone(event);
                }
            }
        }
    }
    controlKnob(change, dir, step) {
        const { active, value } = this.state;
        const length = Array.isArray(value) ? value.length : 1;
        const multi = length > 1;
        const knob = active || 1;
        if (change) {
            this.setValue(value[knob - 1] + dir * step, knob);
        }
        else if (multi) {
            const newActive = knob + dir;
            if (newActive <= length && newActive > 0) {
                this.setState({
                    active: newActive,
                });
            }
        }
    }
    countDecimals(val) {
        if (Math.floor(val) === val) {
            return 0;
        }
        return val.toString().split('.')[1].length || 0;
    }
    render() {
        const _a = this.props, { children: _0, value: _1, defaultValue: _2, disabled, onChange: _3, onChangeDone: _4, margin: _5, step, minimum = 0, maximum = 1, color, theme, info, onBlur, onFocus, showTooltip } = _a, props = __rest(_a, ["children", "value", "defaultValue", "disabled", "onChange", "onChangeDone", "margin", "step", "minimum", "maximum", "color", "theme", "info", "onBlur", "onFocus", "showTooltip"]);
        const { value, active, vertical, hovered, error } = this.state;
        const values = Array.isArray(value) ? value : [value];
        const ind = values.length === 1 ? (100 * (values[0] - minimum)) / (maximum - minimum) : 0;
        return (React.createElement(SliderContainer, { theme: theme, tabIndex: 0, onKeyDown: this.control, onBlur: onBlur, onFocus: onFocus, onMouseEnter: this.handleMouseEnter, onMouseLeave: this.handleMouseLeave },
            React.createElement(SliderBar, Object.assign({}, props, { theme: theme, onChange: this.updateValue, active: active !== 0, disabled: disabled }),
                ind > 0 && (React.createElement(IndicatorBar, { style: { [vertical ? 'height' : 'width']: `${ind}%` }, vertical: vertical, active: active !== 0 || hovered, disabled: disabled })),
                values.map((val, index) => (React.createElement("div", { key: index },
                    showTooltip && (React.createElement(TooltipContainer, { vertical: vertical, value: percent(vertical ? 1.0 - (val - minimum) / (maximum - minimum) : (val - minimum) / (maximum - minimum)) },
                        React.createElement(Tooltip, { content: this.updateTooltipValue(val), position: vertical ? 'right' : 'top', open: active === index + 1 }))),
                    React.createElement(IndicatorKnob, { x: vertical ? 0.5 : (val - minimum) / (maximum - minimum), y: vertical ? 1.0 - (val - minimum) / (maximum - minimum) : 0.5, key: index, color: color, active: active === index + 1 || hovered, theme: theme, disabled: disabled }))))),
            showInputInfo(error, info)));
    }
}
SliderInt.inner = {
    get SliderContainer() { return SliderContainer; },
    get SliderBar() { return SliderBar; },
    get IndicatorBar() { return IndicatorBar; },
    get TooltipContainer() { return TooltipContainer; },
    get Tooltip() { return Tooltip; },
    get IndicatorKnob() { return IndicatorKnob; }
};
/**
 * The slider component displays a data value picker in form of a sliding bar.
 */
export const Slider = withFormContext(SliderInt);
Slider.displayName = 'Slider';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TbGlkZXIvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUVyQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakQsT0FBTyxFQUFFLGtCQUFrQixFQUEwRCxNQUFNLHVCQUF1QixDQUFDO0FBQ25ILE9BQU8sRUFBRSxlQUFlLEVBQW9CLE1BQU0sV0FBVyxDQUFDO0FBQzlELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVsRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUM3QyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBc0ZyQyxTQUFTLE9BQU8sQ0FBQyxLQUFjO0lBQzNCLE9BQU8sT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0FBQ2pFLENBQUM7QUFDRCxNQUFNLGtCQUFrQixHQUFHLE1BQU0sQ0FBQztBQUNsQyxNQUFNLGNBQWMsR0FBRyw2QkFBNkIsQ0FBQztBQUNyRCxNQUFNLGVBQWUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDOzs7O0NBSWxDLENBQUM7QUFDRixNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBaUI7O2FBRWhELEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxL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QUFNLEtBQUssS0FBSyxHQUFHLENBQUMsSUFBSSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxHQUFHLENBQzdPLENBQUMsQ0FBQyxDQUNBO1lBQ1gsYUFBYSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FDWCxDQUFDLENBQUM7SUFDdEIsQ0FBQzs7QUFDTSxlQUFLLEdBQUc7SUFDWCxJQUFJLGVBQWUsS0FBSyxPQUFPLGVBQXlDLENBQUMsQ0FBQyxDQUFDO0lBQzNFLElBQUksU0FBUyxLQUFLLE9BQU8sU0FBNkIsQ0FBQyxDQUFDLENBQUM7SUFDekQsSUFBSSxZQUFZLEtBQUssT0FBTyxZQUFtQyxDQUFDLENBQUMsQ0FBQztJQUNsRSxJQUFJLGdCQUFnQixLQUFLLE9BQU8sZ0JBQTJDLENBQUMsQ0FBQyxDQUFDO0lBQzlFLElBQUksT0FBTyxLQUFLLE9BQU8sT0FBeUIsQ0FBQyxDQUFDLENBQUM7SUFDbkQsSUFBSSxhQUFhLEtBQUssT0FBTyxhQUFxQyxDQUFDLENBQUMsQ0FBQztDQUN4RSxDQUFDO0FBRU47O0dBRUc7QUFDSCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2pELE1BQU0sQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwgeyB0aGVtZWQgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgb2NlYW4gfSBmcm9tICcuLi8uLi9jb2xvcnMnO1xuaW1wb3J0IHsgSW5wdXRQcm9wcywgSW5wdXRDaGFuZ2VFdmVudCB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5pbXBvcnQgeyBJbmRpY2F0b3JLbm9iIH0gZnJvbSAnLi4vSW5kaWNhdG9yS25vYic7XG5pbXBvcnQgeyBJbnRlcmFjdGl2ZVN1cmZhY2UsIEludGVyYWN0aXZlU3VyZmFjZUNoYW5nZUV2ZW50LCBJbnRlcmFjdGl2ZVN1cmZhY2VQcm9wcyB9IGZyb20gJy4uL0ludGVyYWN0aXZlU3VyZmFjZSc7XG5pbXBvcnQgeyB3aXRoRm9ybUNvbnRleHQsIEZvcm1Db250ZXh0UHJvcHMgfSBmcm9tICcuLi8uLi9ob2MnO1xuaW1wb3J0IHsgc2hvd0lucHV0SW5mbyB9IGZyb20gJy4uLy4uL3V0aWxzL2lucHV0JztcbmltcG9ydCB7IEtleUNvZGVzIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyB0cmFuc3BhcmVudGl6ZSB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICcuLi9Ub29sdGlwJztcbmV4cG9ydCBpbnRlcmZhY2UgU2xpZGVyQ2hhbmdlRXZlbnQgZXh0ZW5kcyBJbnB1dENoYW5nZUV2ZW50PG51bWJlcj4ge1xuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIHR5cGUgb2YgdGhlIGNoYW5nZWQgdmFsdWUuXG4gICAgICovXG4gICAgdHlwZTogJ3NpbmdsZScgfCAnbXVsdGknO1xuICAgIC8qKlxuICAgICAqIEdldHMgdGhlIGluZGV4IG9mIHRoZSBrbm9iLlxuICAgICAqL1xuICAgIGluZGV4OiBudW1iZXI7XG59XG5leHBvcnQgaW50ZXJmYWNlIFNsaWRlclByb3BzIGV4dGVuZHMgSW5wdXRQcm9wczxudW1iZXIgfCBBcnJheTxudW1iZXI+PiB7XG4gICAgLyoqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogdm9pZDtcbiAgICAvKipcbiAgICAgKiBEZWZpbmVzIHRoZSBjb2xvciBvZiB0aGUgaW5kaWNhdG9yLlxuICAgICAqL1xuICAgIGNvbG9yPzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsbHkgc2V0cyB0aGUgbWluaW11bSB2YWx1ZSBvZiB0aGUgc2xpZGVyLiBCeSBkZWZhdWx0IGlzIHNldCB0byAwLlxuICAgICAqIEBkZWZhdWx0IDBcbiAgICAgKi9cbiAgICBtaW5pbXVtPzogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsbHkgc2V0cyB0aGUgbWF4aW11bSB2YWx1ZSBvZiB0aGUgc2xpZGVyLiBCeSBkZWZhdWx0IGlzIHNldCB0byAxLlxuICAgICAqIEBkZWZhdWx0IDFcbiAgICAgKi9cbiAgICBtYXhpbXVtPzogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsbHkgc2V0cyB0aGUgbWFyZ2luIGJldHdlZW4gdGhlIHZhbHVlcy5cbiAgICAgKi9cbiAgICBtYXJnaW4/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIHN0ZXBwaW5nIHRvIHVzZS4gQnkgZGVmYXVsdCBpcyBzZXQgdG8gMCwgaS5lLiwgbm8gZml4ZWQgc3RlcHBpbmcgLyBjb250aW51b3VzIG1vZGUuXG4gICAgICogQGRlZmF1bHQgMFxuICAgICAqL1xuICAgIHN0ZXA/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgb3JpZW5hdGF0aW9uIG9mIHRoZSBzbGlkZXIuIEJ5IGRlZmF1bHQgaXMgc2V0IHRvIGhvcml6b250YWwuXG4gICAgICogQGRlZmF1bHQgaG9yaXpvbnRhbFxuICAgICAqL1xuICAgIG9yaWVudGF0aW9uPzogJ2hvcml6b250YWwnIHwgJ3ZlcnRpY2FsJztcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzbGlkZXIgYXMgZGlzYWJsZWQsIGkuZS4sIG5vdCBtb3ZhYmxlLlxuICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICovXG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIFNob3cgc3RhdHVzIHRvb2x0aXBcbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIHNob3dUb29sdGlwPzogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBFbWl0dGVkIG9uY2UgdGhlIHNsaWRlcidzIHZhbHVlIGNoYW5nZWQuXG4gICAgICovXG4gICAgb25DaGFuZ2U/KGU6IFNsaWRlckNoYW5nZUV2ZW50KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBFbWl0dGVkIG9uY2UgdGhlIHNsaWRlcidzIHZhbHVlIGNoYW5naW5nIGRvbmUgYW5kIHZhbHVlIGlzIHJlYWR5LlxuICAgICAqL1xuICAgIG9uQ2hhbmdlRG9uZT8oZTogU2xpZGVyQ2hhbmdlRXZlbnQpOiB2b2lkO1xufVxuZXhwb3J0IGludGVyZmFjZSBTbGlkZXJTdGF0ZSB7XG4gICAgdmFsdWU6IG51bWJlciB8IEFycmF5PG51bWJlcj47XG4gICAgZXJyb3I/OiBSZWFjdC5SZWFjdENoaWxkO1xuICAgIGFjdGl2ZTogbnVtYmVyO1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG4gICAgdmVydGljYWw6IGJvb2xlYW47XG4gICAgaG92ZXJlZDogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBTbGlkZXJCYXJQcm9wcyBleHRlbmRzIEludGVyYWN0aXZlU3VyZmFjZVByb3BzIHtcbiAgICBvcmllbnRhdGlvbj86ICd2ZXJ0aWNhbCcgfCAnaG9yaXpvbnRhbCc7XG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICAgIGFjdGl2ZT86IGJvb2xlYW47XG4gICAgdGhlbWU6IGFueTtcbn1cbmludGVyZmFjZSBJbmRpY2F0b3JCYXJQcm9wcyB7XG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICAgIGFjdGl2ZT86IGJvb2xlYW47XG4gICAgdmVydGljYWw6IGJvb2xlYW47XG59XG5pbnRlcmZhY2UgVG9vbHRpcENvbnRhaW5lclByb3BzIHtcbiAgICB2YWx1ZTogc3RyaW5nO1xuICAgIHZlcnRpY2FsOiBib29sZWFuO1xufVxuZnVuY3Rpb24gcGVyY2VudCh2YWx1ZT86IG51bWJlcikge1xuICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInID8gYCR7dmFsdWUgKiAxMDB9JWAgOiAnNTAlJztcbn1cbmNvbnN0IHRyYW5zaXRpb25EdXJhdGlvbiA9ICcwLjNzJztcbmNvbnN0IHRyYW5zaXRpb25FYXNlID0gJ2N1YmljLWJlemllcigwLCAwLCAwLjI1LCAxKSc7XG5jb25zdCBTbGlkZXJDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBvdXRsaW5lOiAwO1xuICBoZWlnaHQ6IDEwMCU7XG5gO1xuY29uc3QgU2xpZGVyQmFyID0gc3R5bGVkKEludGVyYWN0aXZlU3VyZmFjZSk8U2xpZGVyQmFyUHJvcHM+IGBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBwYWRkaW5nOiAke3Byb3BzID0+IChwcm9wcy5vcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJyA/IGAwICR7ZGlzdGFuY2Uuc21hbGx9YCA6IGAke2Rpc3RhbmNlLnNtYWxsfSAwYCl9O1xuICBoZWlnaHQ6ICR7cHJvcHMgPT4gKHByb3BzLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnID8gJzEwMCUnIDogZGlzdGFuY2UueHNtYWxsKX07XG4gIHdpZHRoOiAke3Byb3BzID0+IChwcm9wcy5vcmllbnRhdGlvbiA9PT0gJ3ZlcnRpY2FsJyA/IGRpc3RhbmNlLnhzbWFsbCA6ICcxMDAlJyl9O1xuICBib3gtc2l6aW5nOiBjb250ZW50LWJveDtcblxuICAmOmFmdGVyIHtcbiAgICBjb250ZW50OiAnJztcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgICBib3JkZXItcmFkaXVzOiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgd2lkdGg6IDEwMCU7XG4gICAgYmFja2dyb3VuZDogJHt0aGVtZWQocHJvcHMgPT4gcHJvcHMuZGlzYWJsZWRcbiAgICA/IHByb3BzLnRoZW1lLnVpM1xuICAgIDogcHJvcHMuYWN0aXZlXG4gICAgICAgID8gdHJhbnNwYXJlbnRpemUob2NlYW4sIDAuMjUpXG4gICAgICAgIDogdHJhbnNwYXJlbnRpemUocHJvcHMudGhlbWUudWk0LCAwLjI1KSl9O1xuICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgJHt0cmFuc2l0aW9uRHVyYXRpb259ICR7dHJhbnNpdGlvbkVhc2V9O1xuICB9XG5cbiAgJjpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuXG4gICAgJjphZnRlciB7XG4gICAgICBiYWNrZ3JvdW5kOiAke3RyYW5zcGFyZW50aXplKG9jZWFuLCAwLjI1KX07XG4gICAgfVxuICB9XG5gO1xuY29uc3QgSW5kaWNhdG9yQmFyID0gc3R5bGVkKCdkaXYnKTxJbmRpY2F0b3JCYXJQcm9wcz4gYFxuICBib3JkZXItcmFkaXVzOiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgYmFja2dyb3VuZDogJHt0aGVtZWQocHJvcHMgPT4gcHJvcHMuZGlzYWJsZWQgPyBwcm9wcy50aGVtZS51aTQgOiBwcm9wcy5hY3RpdmUgPyBvY2VhbiA6IHRyYW5zcGFyZW50aXplKHByb3BzLnRoZW1lLnVpNSwgMC43NSkpfTtcbiAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAke3RyYW5zaXRpb25EdXJhdGlvbn0gJHt0cmFuc2l0aW9uRWFzZX07XG4gIGhlaWdodDogJHtwcm9wcyA9PiAocHJvcHMudmVydGljYWwgPyAnMTAwJScgOiBkaXN0YW5jZS54c21hbGwpfTtcbiAgd2lkdGg6ICR7cHJvcHMgPT4gKHByb3BzLnZlcnRpY2FsID8gZGlzdGFuY2UueHNtYWxsIDogJ2F1dG8nKX07XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgbWFyZ2luOiBhdXRvO1xuYDtcbmNvbnN0IFRvb2x0aXBDb250YWluZXIgPSBzdHlsZWQoJ2RpdicpPFRvb2x0aXBDb250YWluZXJQcm9wcz4gYFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICR7cHJvcHMgPT4gKHByb3BzLnZlcnRpY2FsID8gYHRvcDogJHtwcm9wcy52YWx1ZX1gIDogYGxlZnQ6ICR7cHJvcHMudmFsdWV9YCl9O1xuICAke3Byb3BzID0+IChwcm9wcy52ZXJ0aWNhbCA/IGBsZWZ0OiAke2Rpc3RhbmNlLmxhcmdlfWAgOiBgdG9wOiAtJHtkaXN0YW5jZS5sYXJnZX1gKX07XG4gIHdpZHRoOiAwO1xuICBoZWlnaHQ6IDA7XG5cbiAgPiBkaXYge1xuICAgIGRpc3BsYXk6ICR7cHJvcHMgPT4gKHByb3BzLnZlcnRpY2FsID8gYGJsb2NrYCA6IGBpbmxpbmUtYmxvY2tgKX07XG4gIH1cbmA7XG5jbGFzcyBTbGlkZXJJbnQgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PFNsaWRlclByb3BzICYgRm9ybUNvbnRleHRQcm9wcywgU2xpZGVyU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogU2xpZGVyUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BzLnZhbHVlIHx8IHByb3BzLmRlZmF1bHRWYWx1ZTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlIHx8IDBdLFxuICAgICAgICAgICAgdmVydGljYWw6IHByb3BzLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnLFxuICAgICAgICAgICAgYWN0aXZlOiAwLFxuICAgICAgICAgICAgY29udHJvbGxlZDogdHlwZW9mIHByb3BzLnZhbHVlICE9PSAndW5kZWZpbmVkJyxcbiAgICAgICAgICAgIGhvdmVyZWQ6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IHByb3BzLmVycm9yLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnVuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHsgdmFsdWUgPSB0aGlzLnN0YXRlLnZhbHVlLCBlcnJvciwgb3JpZW50YXRpb24gfTogU2xpZGVyUHJvcHMpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgdmVydGljYWw6IG9yaWVudGF0aW9uID09PSAndmVydGljYWwnLFxuICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwcml2YXRlIGdldENsb3Nlc3RLbm9iKGN1cnJlbnQ6IG51bWJlcikge1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7XG4gICAgICAgICAgICBjb25zdCBkaXN0cyA9IHZhbHVlcy5tYXAodmFsID0+IE1hdGguYWJzKHZhbCAtIGN1cnJlbnQpKTtcbiAgICAgICAgICAgIGNvbnN0IGxlbmd0aCA9IGRpc3RzLmxlbmd0aDtcbiAgICAgICAgICAgIGxldCBtaW5JbmRleCA9IDA7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY3VyVmFsdWUgPSBkaXN0c1tpXTtcbiAgICAgICAgICAgICAgICBjb25zdCBtaW5WYWx1ZSA9IGRpc3RzW21pbkluZGV4XTtcbiAgICAgICAgICAgICAgICBpZiAoY3VyVmFsdWUgPCBtaW5WYWx1ZSB8fCAoY3VyVmFsdWUgPT09IG1pblZhbHVlICYmIGN1cnJlbnQgPiB2YWx1ZXNbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIG1pbkluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbWluSW5kZXggKyAxO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICBwcml2YXRlIHNlbGVjdFZhbHVlKHNlbGVjdGVkOiBudW1iZXIsIGtub2I6IG51bWJlcikge1xuICAgICAgICBjb25zdCB7IG1hcmdpbiA9IDAgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjdXJyZW50KSkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBbLi4uY3VycmVudF07XG4gICAgICAgICAgICBjb25zdCB1cHBlciA9IHZhbHVlW2tub2JdO1xuICAgICAgICAgICAgY29uc3QgbG93ZXIgPSB2YWx1ZVtrbm9iIC0gMl07XG4gICAgICAgICAgICBpZiAobG93ZXIgKyBtYXJnaW4gPiBzZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHZhbHVlW2tub2IgLSAxXSA9IGxvd2VyICsgbWFyZ2luO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodXBwZXIgLSBtYXJnaW4gPCBzZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHZhbHVlW2tub2IgLSAxXSA9IHVwcGVyIC0gbWFyZ2luO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsdWVba25vYiAtIDFdID0gc2VsZWN0ZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNlbGVjdGVkO1xuICAgIH1cbiAgICBwcml2YXRlIHNldFZhbHVlKHBvc2l0aW9uOiBudW1iZXIsIGtub2I6IG51bWJlcikge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBvbkNoYW5nZURvbmUsIG1heGltdW0gPSAxLCBtaW5pbXVtID0gMCwgc3RlcCA9IDAsIGRpc2FibGVkLCBmb3JtLCBuYW1lID0gJycgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICghZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gQXJyYXkuaXNBcnJheShjdXJyZW50KSA/IGN1cnJlbnQubGVuZ3RoIDogMTtcbiAgICAgICAgICAgIGNvbnN0IG11bHRpID0gbGVuZ3RoID4gMTtcbiAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzID0gQXJyYXkuaXNBcnJheShjdXJyZW50KSA/IGN1cnJlbnRba25vYiAtIDFdIDogY3VycmVudDtcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkID0gTWF0aC5hYnMocG9zaXRpb24gLSBwcmV2aW91cykgPj0gc3RlcCAmJiBwb3NpdGlvbiA+PSBtaW5pbXVtICYmIHBvc2l0aW9uIDw9IG1heGltdW07XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IHBvc2l0aW9uIC0gKHN0ZXAgJiYgKHBvc2l0aW9uIC0gcHJldmlvdXMpICUgc3RlcCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUuY29udHJvbGxlZCAmJiB2YWxpZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5zZWxlY3RWYWx1ZShzZWxlY3RlZCwga25vYik7XG4gICAgICAgICAgICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGV2ZW50OiBTbGlkZXJDaGFuZ2VFdmVudCA9IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWQsXG4gICAgICAgICAgICAgICAgaW5kZXg6IGtub2IgLSAxLFxuICAgICAgICAgICAgICAgIHR5cGU6IG11bHRpID8gJ211bHRpJyA6ICdzaW5nbGUnLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICh2YWxpZCAmJiB0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvbkNoYW5nZShldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoa25vYiAhPT0gdGhpcy5zdGF0ZS5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBrbm9iLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICgha25vYiAmJiB2YWxpZCAmJiB0eXBlb2Ygb25DaGFuZ2VEb25lID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlRG9uZShldmVudCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgdXBkYXRlVmFsdWUgPSAoZTogSW50ZXJhY3RpdmVTdXJmYWNlQ2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBtYXhpbXVtID0gMSwgbWluaW11bSA9IDAgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHYgPSB0aGlzLnN0YXRlLnZlcnRpY2FsID8gMSAtIGUueSA6IGUueDtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBtaW5pbXVtICsgdiAqIChtYXhpbXVtIC0gbWluaW11bSk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICAgICAgY29uc3QgbGVuZ3RoID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5sZW5ndGggOiAxO1xuICAgICAgICBjb25zdCBtdWx0aSA9IGxlbmd0aCA+IDE7XG4gICAgICAgIGNvbnN0IGtub2IgPSB0aGlzLnN0YXRlLmFjdGl2ZSB8fCAobXVsdGkgPyB0aGlzLmdldENsb3Nlc3RLbm9iKHBvc2l0aW9uKSA6IDEpO1xuICAgICAgICB0aGlzLnNldFZhbHVlKHBvc2l0aW9uLCBlLmFjdGl2ZSA/IGtub2IgOiAwKTtcbiAgICB9O1xuICAgIHByaXZhdGUgY29udHJvbEtub2IoY2hhbmdlOiBib29sZWFuLCBkaXI6IG51bWJlciwgc3RlcDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgYWN0aXZlLCB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgbGVuZ3RoID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5sZW5ndGggOiAxO1xuICAgICAgICBjb25zdCBtdWx0aSA9IGxlbmd0aCA+IDE7XG4gICAgICAgIGNvbnN0IGtub2IgPSBhY3RpdmUgfHwgMTtcbiAgICAgICAgaWYgKGNoYW5nZSkge1xuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZSh2YWx1ZVtrbm9iIC0gMV0gKyBkaXIgKiBzdGVwLCBrbm9iKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtdWx0aSkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWN0aXZlID0ga25vYiArIGRpcjtcbiAgICAgICAgICAgIGlmIChuZXdBY3RpdmUgPD0gbGVuZ3RoICYmIG5ld0FjdGl2ZSA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiBuZXdBY3RpdmUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBjb250cm9sID0gKGU6IFJlYWN0LktleWJvYXJkRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgbWluaW11bSA9IDAsIG1heGltdW0gPSAxLCBvbklucHV0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHN0ZXAgPSBNYXRoLm1pbigxLCAobWF4aW11bSAtIG1pbmltdW0pIC8gMTApIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGFjdGl2ZSwgdmVydGljYWwgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IGtub2IgPSBhY3RpdmUgfHwgMTtcbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMudXA6XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmRvd246XG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sS25vYih2ZXJ0aWNhbCwgMzkgLSBlLmtleUNvZGUsIHN0ZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5sZWZ0OlxuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5yaWdodDpcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xLbm9iKCF2ZXJ0aWNhbCwgZS5rZXlDb2RlIC0gMzgsIHN0ZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5ob21lOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUobWluaW11bSwga25vYik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmVuZDpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKG1heGltdW0sIGtub2IpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lc2NhcGU6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogMCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZW50ZXI6XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnNwYWNlOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9uSW5wdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgb25JbnB1dCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVNb3VzZUVudGVyID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaG92ZXJlZDogdHJ1ZSB9KTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlTW91c2VMZWF2ZSA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGhvdmVyZWQ6IGZhbHNlIH0pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBjb3VudERlY2ltYWxzKHZhbDogbnVtYmVyKSB7XG4gICAgICAgIGlmIChNYXRoLmZsb29yKHZhbCkgPT09IHZhbCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbC50b1N0cmluZygpLnNwbGl0KCcuJylbMV0ubGVuZ3RoIHx8IDA7XG4gICAgfVxuICAgIHByaXZhdGUgdXBkYXRlVG9vbHRpcFZhbHVlID0gKHZhbDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgbWF4aW11bSA9IDEsIHN0ZXAgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGRlY2ltYWxQbGFjZXMgPSBzdGVwICYmIHN0ZXAgPCAxID8gdGhpcy5jb3VudERlY2ltYWxzKHN0ZXApIDogMDtcbiAgICAgICAgcmV0dXJuICFzdGVwICYmIG1heGltdW0gPD0gMSA/IGAke3ZhbC50b0ZpeGVkKDEpfWAgOiBgJHt2YWwudG9GaXhlZChkZWNpbWFsUGxhY2VzKX1gO1xuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGNoaWxkcmVuOiBfMCwgdmFsdWU6IF8xLCBkZWZhdWx0VmFsdWU6IF8yLCBkaXNhYmxlZCwgb25DaGFuZ2U6IF8zLCBvbkNoYW5nZURvbmU6IF80LCBtYXJnaW46IF81LCBzdGVwLCBtaW5pbXVtID0gMCwgbWF4aW11bSA9IDEsIGNvbG9yLCB0aGVtZSwgaW5mbywgb25CbHVyLCBvbkZvY3VzLCBzaG93VG9vbHRpcCwgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIGFjdGl2ZSwgdmVydGljYWwsIGhvdmVyZWQsIGVycm9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB2YWx1ZXMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlXTtcbiAgICAgICAgY29uc3QgaW5kID0gdmFsdWVzLmxlbmd0aCA9PT0gMSA/ICgxMDAgKiAodmFsdWVzWzBdIC0gbWluaW11bSkpIC8gKG1heGltdW0gLSBtaW5pbXVtKSA6IDA7XG4gICAgICAgIHJldHVybiAoPFNsaWRlckNvbnRhaW5lciB0aGVtZT17dGhlbWV9IHRhYkluZGV4PXswfSBvbktleURvd249e3RoaXMuY29udHJvbH0gb25CbHVyPXtvbkJsdXJ9IG9uRm9jdXM9e29uRm9jdXN9IG9uTW91c2VFbnRlcj17dGhpcy5oYW5kbGVNb3VzZUVudGVyfSBvbk1vdXNlTGVhdmU9e3RoaXMuaGFuZGxlTW91c2VMZWF2ZX0+XG4gICAgICAgIDxTbGlkZXJCYXIgey4uLnByb3BzfSB0aGVtZT17dGhlbWV9IG9uQ2hhbmdlPXt0aGlzLnVwZGF0ZVZhbHVlfSBhY3RpdmU9e2FjdGl2ZSAhPT0gMH0gZGlzYWJsZWQ9e2Rpc2FibGVkfT5cbiAgICAgICAgICB7aW5kID4gMCAmJiAoPEluZGljYXRvckJhciBzdHlsZT17eyBbdmVydGljYWwgPyAnaGVpZ2h0JyA6ICd3aWR0aCddOiBgJHtpbmR9JWAgfX0gdmVydGljYWw9e3ZlcnRpY2FsfSBhY3RpdmU9e2FjdGl2ZSAhPT0gMCB8fCBob3ZlcmVkfSBkaXNhYmxlZD17ZGlzYWJsZWR9Lz4pfVxuICAgICAgICAgIHt2YWx1ZXMubWFwKCh2YWwsIGluZGV4KSA9PiAoPGRpdiBrZXk9e2luZGV4fT5cbiAgICAgICAgICAgICAge3Nob3dUb29sdGlwICYmICg8VG9vbHRpcENvbnRhaW5lciB2ZXJ0aWNhbD17dmVydGljYWx9IHZhbHVlPXtwZXJjZW50KHZlcnRpY2FsID8gMS4wIC0gKHZhbCAtIG1pbmltdW0pIC8gKG1heGltdW0gLSBtaW5pbXVtKSA6ICh2YWwgLSBtaW5pbXVtKSAvIChtYXhpbXVtIC0gbWluaW11bSkpfT5cbiAgICAgICAgICAgICAgICAgIDxUb29sdGlwIGNvbnRlbnQ9e3RoaXMudXBkYXRlVG9vbHRpcFZhbHVlKHZhbCl9IHBvc2l0aW9uPXt2ZXJ0aWNhbCA/ICdyaWdodCcgOiAndG9wJ30gb3Blbj17YWN0aXZlID09PSBpbmRleCArIDF9Lz5cbiAgICAgICAgICAgICAgICA8L1Rvb2x0aXBDb250YWluZXI+KX1cbiAgICAgICAgICAgICAgPEluZGljYXRvcktub2IgeD17dmVydGljYWwgPyAwLjUgOiAodmFsIC0gbWluaW11bSkgLyAobWF4aW11bSAtIG1pbmltdW0pfSB5PXt2ZXJ0aWNhbCA/IDEuMCAtICh2YWwgLSBtaW5pbXVtKSAvIChtYXhpbXVtIC0gbWluaW11bSkgOiAwLjV9IGtleT17aW5kZXh9IGNvbG9yPXtjb2xvcn0gYWN0aXZlPXthY3RpdmUgPT09IGluZGV4ICsgMSB8fCBob3ZlcmVkfSB0aGVtZT17dGhlbWV9IGRpc2FibGVkPXtkaXNhYmxlZH0vPlxuICAgICAgICAgICAgPC9kaXY+KSl9XG4gICAgICAgIDwvU2xpZGVyQmFyPlxuICAgICAgICB7c2hvd0lucHV0SW5mbyhlcnJvciwgaW5mbyl9XG4gICAgICA8L1NsaWRlckNvbnRhaW5lcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTbGlkZXJDb250YWluZXIoKSB7IHJldHVybiBTbGlkZXJDb250YWluZXIgYXMgdHlwZW9mIFNsaWRlckNvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IFNsaWRlckJhcigpIHsgcmV0dXJuIFNsaWRlckJhciBhcyB0eXBlb2YgU2xpZGVyQmFyOyB9LFxuICAgICAgICBnZXQgSW5kaWNhdG9yQmFyKCkgeyByZXR1cm4gSW5kaWNhdG9yQmFyIGFzIHR5cGVvZiBJbmRpY2F0b3JCYXI7IH0sXG4gICAgICAgIGdldCBUb29sdGlwQ29udGFpbmVyKCkgeyByZXR1cm4gVG9vbHRpcENvbnRhaW5lciBhcyB0eXBlb2YgVG9vbHRpcENvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IFRvb2x0aXAoKSB7IHJldHVybiBUb29sdGlwIGFzIHR5cGVvZiBUb29sdGlwOyB9LFxuICAgICAgICBnZXQgSW5kaWNhdG9yS25vYigpIHsgcmV0dXJuIEluZGljYXRvcktub2IgYXMgdHlwZW9mIEluZGljYXRvcktub2I7IH1cbiAgICB9O1xufVxuLyoqXG4gKiBUaGUgc2xpZGVyIGNvbXBvbmVudCBkaXNwbGF5cyBhIGRhdGEgdmFsdWUgcGlja2VyIGluIGZvcm0gb2YgYSBzbGlkaW5nIGJhci5cbiAqL1xuZXhwb3J0IGNvbnN0IFNsaWRlciA9IHdpdGhGb3JtQ29udGV4dChTbGlkZXJJbnQpO1xuU2xpZGVyLmRpc3BsYXlOYW1lID0gJ1NsaWRlcic7XG4iXX0=