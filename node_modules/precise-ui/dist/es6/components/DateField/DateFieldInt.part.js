var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import { withFormContext } from '../../hoc';
import { CustomReactDatepicker } from './CustomReactDatepicker.part';
import { DatePickerTextField } from './DateFieldTextField.part';
import { parseDate, safeDateFormat, getIsoDateFormat } from '../../utils';
const reactDatepickerProps = {
    adjustDateOnChange: 1,
    allowSameDay: 1,
    autoComplete: 1,
    autoFocus: 1,
    calendarClassName: 1,
    calendarContainer: 1,
    children: 1,
    className: 1,
    clearButtonTitle: 1,
    customInput: 1,
    customInputRef: 1,
    dateFormat: 1,
    dateFormatCalendar: 1,
    dayClassName: 1,
    disabled: 1,
    disabledKeyboardNavigation: 1,
    dropdownMode: 1,
    endDate: 1,
    excludeDates: 1,
    excludeTimes: 1,
    filterDate: 1,
    fixedHeight: 1,
    forceShowMonthNavigation: 1,
    formatWeekDay: 1,
    formatWeekNumber: 1,
    highlightDates: 1,
    id: 1,
    includeDates: 1,
    includeTimes: 1,
    injectTimes: 1,
    inline: 1,
    isClearable: 1,
    locale: 1,
    maxDate: 1,
    maxTime: 1,
    minDate: 1,
    minTime: 1,
    monthsShown: 1,
    name: 1,
    nextMonthButtonLabel: 1,
    onBlur: 1,
    onChange: 1,
    onChangeRaw: 1,
    onClickOutside: 1,
    onFocus: 1,
    onInputClick: 1,
    onInputError: 1,
    onKeyDown: 1,
    onMonthChange: 1,
    onSelect: 1,
    onWeekSelect: 1,
    onYearChange: 1,
    open: 1,
    openToDate: 1,
    peekNextMonth: 1,
    placeholderText: 1,
    popperClassName: 1,
    popperContainer: 1,
    popperModifiers: 1,
    popperPlacement: 1,
    popperProps: 1,
    preventOpenOnFocus: 1,
    previousMonthButtonLabel: 1,
    readOnly: 1,
    renderCustomHeader: 1,
    renderDayContents: 1,
    required: 1,
    scrollableMonthYearDropdown: 1,
    scrollableYearDropdown: 1,
    selected: 1,
    selectsEnd: 1,
    selectsStart: 1,
    shouldCloseOnSelect: 1,
    showDisabledMonthNavigation: 1,
    showMonthDropdown: 1,
    showMonthYearDropdown: 1,
    showMonthYearPicker: 1,
    showTimeSelect: 1,
    showTimeSelectOnly: 1,
    showWeekNumbers: 1,
    showYearDropdown: 1,
    startDate: 1,
    startOpen: 1,
    strictParsing: 1,
    tabIndex: 1,
    timeCaption: 1,
    timeFormat: 1,
    timeIntervals: 1,
    title: 1,
    todayButton: 1,
    useShortMonthInDropdown: 1,
    useWeekdaysShort: 1,
    value: 1,
    weekLabel: 1,
    withPortal: 1,
    yearDropdownItemNumber: 1,
    timeInputLabel: 1,
    inlineFocusSelectedMonth: 1,
    onDayMouseEnter: 1,
    onMonthMouseLeave: 1,
};
const excludedReactDatePickerProps = {
    autoComplete: 1,
    onBlur: 1,
    onChange: 1,
    onFocus: 1,
    children: 1,
    todayButton: 1,
    placeholderText: 1,
    isClearable: 1,
    withPortal: 1,
    showYearDropdown: 1,
    showMonthDropdown: 1,
    useShortMonthInDropdown: 1,
    showMonthYearDropdown: 1,
    dropdownMode: 1,
    monthsShown: 1,
    showTimeInput: 1,
    showMonthYearPicker: 1,
};
const DefaultDateFormat = getIsoDateFormat();
class DateFieldInt extends React.Component {
    constructor(props) {
        super(props);
        this.changeValue = inputDate => {
            const { dateFormat = DefaultDateFormat, locale } = this.props;
            const date = inputDate || undefined;
            const value = safeDateFormat(date, {
                dateFormat,
                locale,
            });
            this.change(date, value);
        };
        this.changeInput = (e) => {
            const { onChangeRaw } = this.props;
            const { value } = e.target;
            this.change(this.parseDate(value), value);
            if (typeof onChangeRaw === 'function') {
                onChangeRaw(e);
            }
        };
        this.parseDate = (value) => {
            const { locale, dateFormat = DefaultDateFormat, strictParsing } = this.props;
            return parseDate(value, dateFormat, locale, strictParsing) || undefined;
        };
        this.change = (date, value) => {
            const { onChange, name = '', form } = this.props;
            if (!this.valueControlled) {
                this.setState({ value, date }, () => {
                    form &&
                        form.change({
                            name,
                            value,
                        });
                    this.onOpenChange(true);
                });
            }
            if (typeof onChange === 'function') {
                onChange({
                    value,
                    date,
                });
            }
        };
        this.onClickOutside = event => {
            const { onClickOutside } = this.props;
            this.onOpenChange(false);
            if (typeof onClickOutside === 'function') {
                onClickOutside(event);
            }
        };
        this.onFocus = () => {
            const { onFocus } = this.props;
            this.onOpenChange(true);
            if (typeof onFocus === 'function') {
                onFocus();
            }
        };
        this.onBlur = () => {
            const { onBlur } = this.props;
            this.onOpenChange(false);
            if (typeof onBlur === 'function') {
                onBlur();
            }
        };
        const value = props.value || props.defaultValue || '';
        const date = value ? this.parseDate(value) : new Date();
        this.valueControlled = props.value !== undefined;
        this.state = {
            error: props.error,
            date,
            value,
        };
    }
    UNSAFE_componentWillReceiveProps({ value = '', error }) {
        if (this.valueControlled) {
            this.setState({ value, date: this.parseDate(value) });
        }
        this.setState({ error });
    }
    componentDidMount() {
        const { form } = this.props;
        if (!this.valueControlled && form) {
            form.subscribe(this);
        }
    }
    componentWillUnmount() {
        const { form } = this.props;
        if (!this.valueControlled && form) {
            form.unsubscribe(this);
        }
    }
    onOpenChange(open) {
        const { onOpenChange } = this.props;
        if (typeof onOpenChange === 'function') {
            onOpenChange({
                open,
            });
        }
    }
    render() {
        const _a = this.props, { autoComplete, months, weekDays, open, placeholder, name: _0, value: _1, defaultValue: _2, onChange: _3, onOpenChange: _4, onClickOutside: _5, onFocus: _6, onBlur: _7 } = _a, rest = __rest(_a, ["autoComplete", "months", "weekDays", "open", "placeholder", "name", "value", "defaultValue", "onChange", "onOpenChange", "onClickOutside", "onFocus", "onBlur"]);
        const datePickerProps = {};
        const customInputProps = {};
        Object.keys(rest).forEach(propName => {
            if (excludedReactDatePickerProps[propName]) {
                return;
            }
            if (reactDatepickerProps[propName]) {
                datePickerProps[propName] = rest[propName];
            }
            else {
                customInputProps[propName] = rest[propName];
            }
        });
        const { value, error, date } = this.state;
        return (React.createElement(CustomReactDatepicker, Object.assign({ customInput: React.createElement(DatePickerTextField, Object.assign({}, customInputProps, { error: error, autoComplete: autoComplete })), placeholderText: placeholder, customInputRef: "inputRef", months: months, weekDays: weekDays, value: value, selected: date }, datePickerProps, { open: open, onChange: this.changeValue, onChangeRaw: this.changeInput, onClickOutside: this.onClickOutside, onFocus: this.onFocus, onBlur: this.onBlur })));
    }
}
DateFieldInt.inner = {
    get CustomReactDatepicker() { return CustomReactDatepicker; }
};
export const DateField = withFormContext(DateFieldInt);
DateField.displayName = 'DateField';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZUZpZWxkSW50LnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9EYXRlRmllbGQvRGF0ZUZpZWxkSW50LnBhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBRy9CLE9BQU8sRUFBb0IsZUFBZSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzlELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3JFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBUTFFLE1BQU0sb0JBQW9CLEdBQUc7SUFDekIsa0JBQWtCLEVBQUUsQ0FBQztJQUNyQixZQUFZLEVBQUUsQ0FBQztJQUNmLFlBQVksRUFBRSxDQUFDO0lBQ2YsU0FBUyxFQUFFLENBQUM7SUFDWixpQkFBaUIsRUFBRSxDQUFDO0lBQ3BCLGlCQUFpQixFQUFFLENBQUM7SUFDcEIsUUFBUSxFQUFFLENBQUM7SUFDWCxTQUFTLEVBQUUsQ0FBQztJQUNaLGdCQUFnQixFQUFFLENBQUM7SUFDbkIsV0FBVyxFQUFFLENBQUM7SUFDZCxjQUFjLEVBQUUsQ0FBQztJQUNqQixVQUFVLEVBQUUsQ0FBQztJQUNiLGtCQUFrQixFQUFFLENBQUM7SUFDckIsWUFBWSxFQUFFLENBQUM7SUFDZixRQUFRLEVBQUUsQ0FBQztJQUNYLDBCQUEwQixFQUFFLENBQUM7SUFDN0IsWUFBWSxFQUFFLENBQUM7SUFDZixPQUFPLEVBQUUsQ0FBQztJQUNWLFlBQVksRUFBRSxDQUFDO0lBQ2YsWUFBWSxFQUFFLENBQUM7SUFDZixVQUFVLEVBQUUsQ0FBQztJQUNiLFdBQVcsRUFBRSxDQUFDO0lBQ2Qsd0JBQXdCLEVBQUUsQ0FBQztJ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QUssT0FBTyxxQkFBcUQsQ0FBQyxDQUFDLENBQUM7Q0FDaEcsQ0FBQztBQUVOLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDdkQsU0FBUyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBSZWFjdERhdGVQaWNrZXJQcm9wcyB9IGZyb20gJ3JlYWN0LWRhdGVwaWNrZXInO1xuaW1wb3J0IHsgVGV4dElucHV0UHJvcHMsIE9taXQsIElucHV0Q2hhbmdlRXZlbnQgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgRm9ybUNvbnRleHRQcm9wcywgd2l0aEZvcm1Db250ZXh0IH0gZnJvbSAnLi4vLi4vaG9jJztcbmltcG9ydCB7IEN1c3RvbVJlYWN0RGF0ZXBpY2tlciB9IGZyb20gJy4vQ3VzdG9tUmVhY3REYXRlcGlja2VyLnBhcnQnO1xuaW1wb3J0IHsgRGF0ZVBpY2tlclRleHRGaWVsZCB9IGZyb20gJy4vRGF0ZUZpZWxkVGV4dEZpZWxkLnBhcnQnO1xuaW1wb3J0IHsgcGFyc2VEYXRlLCBzYWZlRGF0ZUZvcm1hdCwgZ2V0SXNvRGF0ZUZvcm1hdCB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmV4cG9ydCB7IFJlYWN0RGF0ZVBpY2tlclByb3BzIH07XG5leHBvcnQgaW50ZXJmYWNlIERhdGVGaWVsZE9wZW5DaGFuZ2VkRXZlbnQge1xuICAgIC8qKlxuICAgICAqIElmIHRoZSBjYWxlbmRhciBmbHlvdXQgaXMgc3VwcG9zZWQgdG8gYmUgb3BlbiBvciBjbG9zZWQuXG4gICAgICovXG4gICAgb3BlbjogYm9vbGVhbjtcbn1cbmNvbnN0IHJlYWN0RGF0ZXBpY2tlclByb3BzID0ge1xuICAgIGFkanVzdERhdGVPbkNoYW5nZTogMSxcbiAgICBhbGxvd1NhbWVEYXk6IDEsXG4gICAgYXV0b0NvbXBsZXRlOiAxLFxuICAgIGF1dG9Gb2N1czogMSxcbiAgICBjYWxlbmRhckNsYXNzTmFtZTogMSxcbiAgICBjYWxlbmRhckNvbnRhaW5lcjogMSxcbiAgICBjaGlsZHJlbjogMSxcbiAgICBjbGFzc05hbWU6IDEsXG4gICAgY2xlYXJCdXR0b25UaXRsZTogMSxcbiAgICBjdXN0b21JbnB1dDogMSxcbiAgICBjdXN0b21JbnB1dFJlZjogMSxcbiAgICBkYXRlRm9ybWF0OiAxLFxuICAgIGRhdGVGb3JtYXRDYWxlbmRhcjogMSxcbiAgICBkYXlDbGFzc05hbWU6IDEsXG4gICAgZGlzYWJsZWQ6IDEsXG4gICAgZGlzYWJsZWRLZXlib2FyZE5hdmlnYXRpb246IDEsXG4gICAgZHJvcGRvd25Nb2RlOiAxLFxuICAgIGVuZERhdGU6IDEsXG4gICAgZXhjbHVkZURhdGVzOiAxLFxuICAgIGV4Y2x1ZGVUaW1lczogMSxcbiAgICBmaWx0ZXJEYXRlOiAxLFxuICAgIGZpeGVkSGVpZ2h0OiAxLFxuICAgIGZvcmNlU2hvd01vbnRoTmF2aWdhdGlvbjogMSxcbiAgICBmb3JtYXRXZWVrRGF5OiAxLFxuICAgIGZvcm1hdFdlZWtOdW1iZXI6IDEsXG4gICAgaGlnaGxpZ2h0RGF0ZXM6IDEsXG4gICAgaWQ6IDEsXG4gICAgaW5jbHVkZURhdGVzOiAxLFxuICAgIGluY2x1ZGVUaW1lczogMSxcbiAgICBpbmplY3RUaW1lczogMSxcbiAgICBpbmxpbmU6IDEsXG4gICAgaXNDbGVhcmFibGU6IDEsXG4gICAgbG9jYWxlOiAxLFxuICAgIG1heERhdGU6IDEsXG4gICAgbWF4VGltZTogMSxcbiAgICBtaW5EYXRlOiAxLFxuICAgIG1pblRpbWU6IDEsXG4gICAgbW9udGhzU2hvd246IDEsXG4gICAgbmFtZTogMSxcbiAgICBuZXh0TW9udGhCdXR0b25MYWJlbDogMSxcbiAgICBvbkJsdXI6IDEsXG4gICAgb25DaGFuZ2U6IDEsXG4gICAgb25DaGFuZ2VSYXc6IDEsXG4gICAgb25DbGlja091dHNpZGU6IDEsXG4gICAgb25Gb2N1czogMSxcbiAgICBvbklucHV0Q2xpY2s6IDEsXG4gICAgb25JbnB1dEVycm9yOiAxLFxuICAgIG9uS2V5RG93bjogMSxcbiAgICBvbk1vbnRoQ2hhbmdlOiAxLFxuICAgIG9uU2VsZWN0OiAxLFxuICAgIG9uV2Vla1NlbGVjdDogMSxcbiAgICBvblllYXJDaGFuZ2U6IDEsXG4gICAgb3BlbjogMSxcbiAgICBvcGVuVG9EYXRlOiAxLFxuICAgIHBlZWtOZXh0TW9udGg6IDEsXG4gICAgcGxhY2Vob2xkZXJUZXh0OiAxLFxuICAgIHBvcHBlckNsYXNzTmFtZTogMSxcbiAgICBwb3BwZXJDb250YWluZXI6IDEsXG4gICAgcG9wcGVyTW9kaWZpZXJzOiAxLFxuICAgIHBvcHBlclBsYWNlbWVudDogMSxcbiAgICBwb3BwZXJQcm9wczogMSxcbiAgICBwcmV2ZW50T3Blbk9uRm9jdXM6IDEsXG4gICAgcHJldmlvdXNNb250aEJ1dHRvbkxhYmVsOiAxLFxuICAgIHJlYWRPbmx5OiAxLFxuICAgIHJlbmRlckN1c3RvbUhlYWRlcjogMSxcbiAgICByZW5kZXJEYXlDb250ZW50czogMSxcbiAgICByZXF1aXJlZDogMSxcbiAgICBzY3JvbGxhYmxlTW9udGhZZWFyRHJvcGRvd246IDEsXG4gICAgc2Nyb2xsYWJsZVllYXJEcm9wZG93bjogMSxcbiAgICBzZWxlY3RlZDogMSxcbiAgICBzZWxlY3RzRW5kOiAxLFxuICAgIHNlbGVjdHNTdGFydDogMSxcbiAgICBzaG91bGRDbG9zZU9uU2VsZWN0OiAxLFxuICAgIHNob3dEaXNhYmxlZE1vbnRoTmF2aWdhdGlvbjogMSxcbiAgICBzaG93TW9udGhEcm9wZG93bjogMSxcbiAgICBzaG93TW9udGhZZWFyRHJvcGRvd246IDEsXG4gICAgc2hvd01vbnRoWWVhclBpY2tlcjogMSxcbiAgICBzaG93VGltZVNlbGVjdDogMSxcbiAgICBzaG93VGltZVNlbGVjdE9ubHk6IDEsXG4gICAgc2hvd1dlZWtOdW1iZXJzOiAxLFxuICAgIHNob3dZZWFyRHJvcGRvd246IDEsXG4gICAgc3RhcnREYXRlOiAxLFxuICAgIHN0YXJ0T3BlbjogMSxcbiAgICBzdHJpY3RQYXJzaW5nOiAxLFxuICAgIHRhYkluZGV4OiAxLFxuICAgIHRpbWVDYXB0aW9uOiAxLFxuICAgIHRpbWVGb3JtYXQ6IDEsXG4gICAgdGltZUludGVydmFsczogMSxcbiAgICB0aXRsZTogMSxcbiAgICB0b2RheUJ1dHRvbjogMSxcbiAgICB1c2VTaG9ydE1vbnRoSW5Ecm9wZG93bjogMSxcbiAgICB1c2VXZWVrZGF5c1Nob3J0OiAxLFxuICAgIHZhbHVlOiAxLFxuICAgIHdlZWtMYWJlbDogMSxcbiAgICB3aXRoUG9ydGFsOiAxLFxuICAgIHllYXJEcm9wZG93bkl0ZW1OdW1iZXI6IDEsXG4gICAgdGltZUlucHV0TGFiZWw6IDEsXG4gICAgaW5saW5lRm9jdXNTZWxlY3RlZE1vbnRoOiAxLFxuICAgIG9uRGF5TW91c2VFbnRlcjogMSxcbiAgICBvbk1vbnRoTW91c2VMZWF2ZTogMSxcbn07XG5jb25zdCBleGNsdWRlZFJlYWN0RGF0ZVBpY2tlclByb3BzID0ge1xuICAgIGF1dG9Db21wbGV0ZTogMSxcbiAgICBvbkJsdXI6IDEsXG4gICAgb25DaGFuZ2U6IDEsXG4gICAgb25Gb2N1czogMSxcbiAgICBjaGlsZHJlbjogMSxcbiAgICB0b2RheUJ1dHRvbjogMSxcbiAgICBwbGFjZWhvbGRlclRleHQ6IDEsXG4gICAgaXNDbGVhcmFibGU6IDEsXG4gICAgd2l0aFBvcnRhbDogMSxcbiAgICBzaG93WWVhckRyb3Bkb3duOiAxLFxuICAgIHNob3dNb250aERyb3Bkb3duOiAxLFxuICAgIHVzZVNob3J0TW9udGhJbkRyb3Bkb3duOiAxLFxuICAgIHNob3dNb250aFllYXJEcm9wZG93bjogMSxcbiAgICBkcm9wZG93bk1vZGU6IDEsXG4gICAgbW9udGhzU2hvd246IDEsXG4gICAgc2hvd1RpbWVJbnB1dDogMSxcbiAgICBzaG93TW9udGhZZWFyUGlja2VyOiAxLFxufTtcbmV4cG9ydCBpbnRlcmZhY2UgRGF0ZVBpY2tlck9uQ2hhbmdlRXZlbnQgZXh0ZW5kcyBJbnB1dENoYW5nZUV2ZW50PHN0cmluZz4ge1xuICAgIGRhdGU/OiBEYXRlO1xufVxuZXhwb3J0IGludGVyZmFjZSBEYXRlRmllbGRCYXNpY1Byb3BzIGV4dGVuZHMgRm9ybUNvbnRleHRQcm9wcywgVGV4dElucHV0UHJvcHMge1xuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsIGFiYnJldmlhdGlvbnMgZm9yIHRoZSAxMiBtb250aHMgKEphbiAtIERlYykgb2YgdGhlIHllYXIgdG8gdXNlLlxuICAgICAqL1xuICAgIG1vbnRocz86IEFycmF5PHN0cmluZz47XG4gICAgLyoqXG4gICAgICogT3B0aW9uYWwgYWJicmV2aWF0aW9ucyBmb3IgdGhlIDcgZGF5cyAoTW9uIC0gU3VuKSBvZiB0aGUgd2VlayB0byB1c2UuXG4gICAgICovXG4gICAgd2Vla0RheXM/OiBBcnJheTxzdHJpbmc+O1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHZpc2liaWx0eSBvZiB0aGUgY2FsZW5kYXIgZmx5b3V0LiBJZiBzZXQgdGhlIGZseW91dCB3aWxsIGJlIHNldFxuICAgICAqIHRvIGNvbnRyb2xsZWQgbW9kZSwgb3RoZXJ3aXNlIGl0IGlzIG1hbmFnZWQuXG4gICAgICovXG4gICAgb3Blbj86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRXZlbnQgZmlyZWQgd2hlbiB0aGUgZmx5b3V0IHdhbnRzIHRvIG9wZW4gb3IgY2xvc2UuXG4gICAgICovXG4gICAgb25PcGVuQ2hhbmdlPyhlOiBEYXRlRmllbGRPcGVuQ2hhbmdlZEV2ZW50KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBFdmVudCBlbWl0dGVkIG9uY2UgdGhlIHZhbHVlIGNoYW5nZXMgZHVlIHRvIHVzZXIgaW5wdXQuXG4gICAgICovXG4gICAgb25DaGFuZ2U/KGU6IERhdGVQaWNrZXJPbkNoYW5nZUV2ZW50KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgY2hpbGRyZW4/OiB2b2lkO1xufVxuZXhwb3J0IHR5cGUgRGF0ZUZpZWxkUHJvcHMgPSBEYXRlRmllbGRCYXNpY1Byb3BzICYgT21pdDxSZWFjdERhdGVQaWNrZXJQcm9wcywga2V5b2YgdHlwZW9mIGV4Y2x1ZGVkUmVhY3REYXRlUGlja2VyUHJvcHM+O1xuaW50ZXJmYWNlIERhdGVGaWVsZFN0YXRlIHtcbiAgICB2YWx1ZTogc3RyaW5nO1xuICAgIGRhdGU/OiBEYXRlO1xuICAgIGVycm9yPzogUmVhY3QuUmVhY3RDaGlsZDtcbn1cbmNvbnN0IERlZmF1bHREYXRlRm9ybWF0ID0gZ2V0SXNvRGF0ZUZvcm1hdCgpO1xuY2xhc3MgRGF0ZUZpZWxkSW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PERhdGVGaWVsZFByb3BzLCBEYXRlRmllbGRTdGF0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdmFsdWVDb250cm9sbGVkOiBib29sZWFuO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBEYXRlRmllbGRQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlIHx8ICcnO1xuICAgICAgICBjb25zdCBkYXRlID0gdmFsdWUgPyB0aGlzLnBhcnNlRGF0ZSh2YWx1ZSkgOiBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLnZhbHVlQ29udHJvbGxlZCA9IHByb3BzLnZhbHVlICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgICAgICBkYXRlLFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgIH07XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHsgdmFsdWUgPSAnJywgZXJyb3IgfTogRGF0ZUZpZWxkUHJvcHMpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWVDb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUsIGRhdGU6IHRoaXMucGFyc2VEYXRlKHZhbHVlKSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3IgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICghdGhpcy52YWx1ZUNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCF0aGlzLnZhbHVlQ29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnVuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgb25PcGVuQ2hhbmdlKG9wZW46IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgeyBvbk9wZW5DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0eXBlb2Ygb25PcGVuQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbk9wZW5DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIG9wZW4sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZVZhbHVlOiBSZWFjdERhdGVQaWNrZXJQcm9wc1snb25DaGFuZ2UnXSA9IGlucHV0RGF0ZSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZGF0ZUZvcm1hdCA9IERlZmF1bHREYXRlRm9ybWF0LCBsb2NhbGUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBpbnB1dERhdGUgfHwgdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHNhZmVEYXRlRm9ybWF0KGRhdGUsIHtcbiAgICAgICAgICAgIGRhdGVGb3JtYXQsXG4gICAgICAgICAgICBsb2NhbGUsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNoYW5nZShkYXRlLCB2YWx1ZSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNoYW5nZUlucHV0ID0gKGU6IFJlYWN0LkZvY3VzRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZVJhdyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gZS50YXJnZXQ7XG4gICAgICAgIHRoaXMuY2hhbmdlKHRoaXMucGFyc2VEYXRlKHZhbHVlKSwgdmFsdWUpO1xuICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlUmF3ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNoYW5nZVJhdyhlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBwYXJzZURhdGUgPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCB7IGxvY2FsZSwgZGF0ZUZvcm1hdCA9IERlZmF1bHREYXRlRm9ybWF0LCBzdHJpY3RQYXJzaW5nIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gcGFyc2VEYXRlKHZhbHVlLCBkYXRlRm9ybWF0LCBsb2NhbGUsIHN0cmljdFBhcnNpbmcpIHx8IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHByaXZhdGUgY2hhbmdlID0gKGRhdGU6IERhdGUgfCB1bmRlZmluZWQsIHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgbmFtZSA9ICcnLCBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIXRoaXMudmFsdWVDb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUsIGRhdGUgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvcm0gJiZcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uT3BlbkNoYW5nZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICBkYXRlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgb25DbGlja091dHNpZGU6IERhdGVGaWVsZFByb3BzWydvbkNsaWNrT3V0c2lkZSddID0gZXZlbnQgPT4ge1xuICAgICAgICBjb25zdCB7IG9uQ2xpY2tPdXRzaWRlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICB0aGlzLm9uT3BlbkNoYW5nZShmYWxzZSk7XG4gICAgICAgIGlmICh0eXBlb2Ygb25DbGlja091dHNpZGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2xpY2tPdXRzaWRlKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBvbkZvY3VzOiBEYXRlRmllbGRQcm9wc1snb25Gb2N1cyddID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IG9uRm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMub25PcGVuQ2hhbmdlKHRydWUpO1xuICAgICAgICBpZiAodHlwZW9mIG9uRm9jdXMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uRm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBvbkJsdXI6IERhdGVGaWVsZFByb3BzWydvbkJsdXInXSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkJsdXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMub25PcGVuQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkJsdXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQmx1cigpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgYXV0b0NvbXBsZXRlLCBtb250aHMsIHdlZWtEYXlzLCBvcGVuLCBwbGFjZWhvbGRlciwgbmFtZTogXzAsIHZhbHVlOiBfMSwgZGVmYXVsdFZhbHVlOiBfMiwgb25DaGFuZ2U6IF8zLCBvbk9wZW5DaGFuZ2U6IF80LCBvbkNsaWNrT3V0c2lkZTogXzUsIG9uRm9jdXM6IF82LCBvbkJsdXI6IF83LCAuLi5yZXN0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBkYXRlUGlja2VyUHJvcHMgPSB7fSBhcyBSZWFjdERhdGVQaWNrZXJQcm9wcztcbiAgICAgICAgY29uc3QgY3VzdG9tSW5wdXRQcm9wcyA9IHt9IGFzIE9taXQ8RGF0ZUZpZWxkQmFzaWNQcm9wcywgJ29uQ2hhbmdlJyB8ICdjaGlsZHJlbic+O1xuICAgICAgICBPYmplY3Qua2V5cyhyZXN0KS5mb3JFYWNoKHByb3BOYW1lID0+IHtcbiAgICAgICAgICAgIGlmIChleGNsdWRlZFJlYWN0RGF0ZVBpY2tlclByb3BzW3Byb3BOYW1lXSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZWFjdERhdGVwaWNrZXJQcm9wc1twcm9wTmFtZV0pIHtcbiAgICAgICAgICAgICAgICBkYXRlUGlja2VyUHJvcHNbcHJvcE5hbWVdID0gcmVzdFtwcm9wTmFtZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXN0b21JbnB1dFByb3BzW3Byb3BOYW1lXSA9IHJlc3RbcHJvcE5hbWVdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgZXJyb3IsIGRhdGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiAoPEN1c3RvbVJlYWN0RGF0ZXBpY2tlciBjdXN0b21JbnB1dD17PERhdGVQaWNrZXJUZXh0RmllbGQgey4uLmN1c3RvbUlucHV0UHJvcHN9IGVycm9yPXtlcnJvcn0gYXV0b0NvbXBsZXRlPXthdXRvQ29tcGxldGV9Lz59IHBsYWNlaG9sZGVyVGV4dD17cGxhY2Vob2xkZXJ9IGN1c3RvbUlucHV0UmVmPVwiaW5wdXRSZWZcIiBtb250aHM9e21vbnRoc30gd2Vla0RheXM9e3dlZWtEYXlzfSB2YWx1ZT17dmFsdWV9IHNlbGVjdGVkPXtkYXRlfSB7Li4uZGF0ZVBpY2tlclByb3BzfSBvcGVuPXtvcGVufSBvbkNoYW5nZT17dGhpcy5jaGFuZ2VWYWx1ZX0gb25DaGFuZ2VSYXc9e3RoaXMuY2hhbmdlSW5wdXR9IG9uQ2xpY2tPdXRzaWRlPXt0aGlzLm9uQ2xpY2tPdXRzaWRlfSBvbkZvY3VzPXt0aGlzLm9uRm9jdXN9IG9uQmx1cj17dGhpcy5vbkJsdXJ9Lz4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBDdXN0b21SZWFjdERhdGVwaWNrZXIoKSB7IHJldHVybiBDdXN0b21SZWFjdERhdGVwaWNrZXIgYXMgdHlwZW9mIEN1c3RvbVJlYWN0RGF0ZXBpY2tlcjsgfVxuICAgIH07XG59XG5leHBvcnQgY29uc3QgRGF0ZUZpZWxkID0gd2l0aEZvcm1Db250ZXh0KERhdGVGaWVsZEludCk7XG5EYXRlRmllbGQuZGlzcGxheU5hbWUgPSAnRGF0ZUZpZWxkJztcbiJdfQ==