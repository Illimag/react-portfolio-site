var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import * as icons from '../Icon/icons';
import styled, { keyframes, css } from '../../utils/styled';
import { withFormContext } from '../../hoc/withFormContext';
import { ocean } from '../../colors';
import { distance } from '../../distance';
const RatingContainer = styled.div `
  display: inline-block;
`;
const SetAnimation = keyframes `
  0% {
    transform: scale(1);
  }
  25% {
    transform: scale(1.5);
  }
  50% {
    transform: scale(0.9);
  }
  75% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
  }
`;
const RatingElement = styled.span `
  display: inline-block;
  cursor: ${props => (props.disabled ? 'not-allowed' : 'pointer')};

  & + & {
    padding-left: ${props => (props.size === 'medium' ? distance.small : distance.xsmall)};
  }
`;
function getColor(theme, disabled, i, value, hover) {
    if (!disabled) {
        if (hover !== -1) {
            if (i < hover) {
                return theme.ui0;
            }
            else if (i === hover) {
                return ocean;
            }
        }
        else if (i < value) {
            return theme.ui5;
        }
        return theme.ui4;
    }
    else if (i < value) {
        return theme.ui4;
    }
    return theme.ui3;
}
function getAnimation(i, value) {
    if (i + 1 === value) {
        return css `
      ${SetAnimation} 0.5s ease-in-out
    `;
    }
    return 'none';
}
const RatingIconInt = (_a) => {
    var { disabled, index, value, hover, size } = _a, props = __rest(_a, ["disabled", "index", "value", "hover", "size"]);
    return (React.createElement(icons.Star, Object.assign({}, props)));
};
const RatingIcon = styled(RatingIconInt)(({ theme, disabled, index, value, hover, size }) => css `
    fill: ${getColor(theme, disabled, index, value, hover)};
    animation: ${getAnimation(index, value)};
    width: ${size};
    height: ${size};
  `);
class RatingInt extends React.Component {
    constructor(props) {
        super(props);
        this.hoverVoid = () => {
            this.setState({
                hover: -1,
            });
        };
        const { value, defaultValue, levels = 5 } = props;
        const changers = [];
        const hovers = [];
        for (let i = 0; i < levels; i++) {
            changers.push(() => this.updateValue(i + 1));
            hovers.push(() => this.hoverValue(i));
        }
        this.state = {
            controlled: value !== undefined,
            value: value || defaultValue || 0,
            error: props.error,
            hover: -1,
            changers,
            hovers,
        };
    }
    UNSAFE_componentWillReceiveProps(nextProps) {
        if (this.state.controlled) {
            this.setState({
                value: nextProps.value || 0,
                error: nextProps.error,
            });
        }
    }
    componentDidMount() {
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.subscribe(this);
        }
    }
    componentWillUnmount() {
        const { form } = this.props;
        const { controlled } = this.state;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    }
    updateValue(value) {
        const { onChange, name = '', form } = this.props;
        if (!this.state.controlled) {
            if (form) {
                form.change({
                    name,
                    value,
                });
            }
            else {
                this.setState({
                    value,
                });
            }
        }
        if (typeof onChange === 'function') {
            onChange({
                value,
            });
        }
    }
    hoverValue(value) {
        this.setState({
            hover: value,
        });
    }
    render() {
        const _a = this.props, { levels: _0, name: _1, value: _2, defaultValue: _3, onChange: _4, onInput: _5, disabled, size = 'medium', icon = 'Star' } = _a, props = __rest(_a, ["levels", "name", "value", "defaultValue", "onChange", "onInput", "disabled", "size", "icon"]);
        const { value, changers, hover, hovers } = this.state;
        const dim = size === 'medium' ? '32px' : '22px';
        return (React.createElement(RatingContainer, Object.assign({}, props), changers.map((changer, i) => (React.createElement(RatingElement, { key: i, size: size, onClick: changer, disabled: disabled, onMouseEnter: hovers[i], onMouseLeave: this.hoverVoid },
            React.createElement(RatingIcon, { index: i, disabled: disabled, value: value, hover: hover, size: dim, as: icons[icon] }))))));
    }
}
RatingInt.inner = {
    get RatingContainer() { return RatingContainer; },
    get RatingElement() { return RatingElement; },
    get RatingIcon() { return RatingIcon; }
};
/**
 * An input control for providing user ratings.
 */
export const Rating = withFormContext(RatingInt);
Rating.displayName = 'Rating';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9SYXRpbmcvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sS0FBSyxLQUFLLE1BQU0sZUFBZSxDQUFDO0FBQ3ZDLE9BQU8sTUFBTSxFQUFFLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRzVELE9BQU8sRUFBRSxlQUFlLEVBQW9CLE1BQU0sMkJBQTJCLENBQUM7QUFDOUUsT0FBTyxFQUFzQixLQUFLLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDekQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBOEIxQyxNQUFNLGVBQWUsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDOztDQUVsQyxDQUFDO0FBS0YsTUFBTSxZQUFZLEdBQUcsU0FBUyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7O0NBZ0I5QixDQUFDO0FBQ0YsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBcUI7O1lBRTFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQzs7O29CQUc3QyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7O0NBRXhGLENBQUM7QUFDRixTQUFTLFFBQVEsQ0FBQyxLQUFtQixFQUFFLFFBQTZCLEVBQUUsQ0FBUyxFQUFFLEtBQWEsRUFBRSxLQUFhO0lBQ3pHLElBQUksQ0FBQyxRQUFRLEVBQUU7UUFDWCxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNkLElBQUksQ0FBQyxHQUFHLEtBQUssRUFBRTtnQkFDWCxPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDcEI7aUJBQ0ksSUFBSSxDQUFDLEtBQUssS0FBSyxFQUFFO2dCQUNsQixPQUFPLEtBQUssQ0FBQzthQUNoQjtTQUNKO2FBQ0ksSUFBSSxDQUFDLEdBQUcsS0FBSyxFQUFFO1lBQ2hCLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQztTQUNwQjtRQUNELE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQztLQUNwQjtTQUNJLElBQUksQ0FBQyxHQUFHLEtBQUssRUFBRTtRQUNoQixPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUM7S0FDcEI7SUFDRCxPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUM7QUFDckIsQ0FBQztBQUNELFNBQVMsWUFBWSxDQUFDLENBQVMsRUFBRSxLQUFhO0lBQzFDLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLEVBQUU7UUFDakIsT0FBTyxHQUFHLENBQUM7UUFDWCxZQUFZO0tBQ2YsQ0FBQztLQUNEO0lBQ0QsT0FBTyxNQUFNLENBQUM7QUFDbEIsQ0FBQztBQVFELE1BQU0sYUFBYSxHQUE4QixDQUFDLEVBQWlELEVBQUUsRUFBRTtRQUFyRCxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLE9BQVksRUFBVixtRUFBUTtJQUFPLE9BQUEsQ0FBQyxvQkFBQyxLQUFLLENBQUMsSUFBSSxvQkFBSyxLQUFLLEVBQUcsQ0FBQyxDQUFBO0NBQUEsQ0FBQztBQUNuSSxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQztZQUNyRixRQUFRLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQztpQkFDekMsWUFBWSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUM7YUFDOUIsSUFBSTtjQUNILElBQUk7R0FDZixDQUFDLENBQUM7QUFDTCxNQUFNLFNBQVUsU0FBUSxLQUFLLENBQUMsU0FBc0Q7SUFDaEYsWUFBWSxLQUFrQjtRQUMxQixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUE0RFQsY0FBUyxHQUFHLEdBQUcsRUFBRTtZQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDO2dCQUNWLEtBQUssRUFBRSxDQUFDLENBQUM7YUFDWixDQUFDLENBQUM7UUFDUCxDQUFDLENBQUM7UUEvREUsTUFBTSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUNsRCxNQUFNLFFBQVEsR0FBc0IsRUFBRSxDQUFDO1FBQ3ZDLE1BQU0sTUFBTSxHQUFzQixFQUFFLENBQUM7UUFDckMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM3QixRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0MsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDekM7UUFDRCxJQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1QsVUFBVSxFQUFFLEtBQUssS0FBSyxTQUFTO1lBQy9CLEtBQUssRUFBRSxLQUFLLElBQUksWUFBWSxJQUFJLENBQUM7WUFDakMsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO1lBQ2xCLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDVCxRQUFRO1lBQ1IsTUFBTTtTQUNULENBQUM7SUFDTixDQUFDO0lBQ0QsZ0NBQWdDLENBQUMsU0FBc0I7UUFDbkQsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRTtZQUN2QixJQUFJLENBQUMsUUFBUSxDQUFDO2dCQUNWLEtBQUssRUFBRSxTQUFTLENBQUMsS0FBSyxJQUFJLENBQUM7Z0JBQzNCLEtBQUssRUFBRSxTQUFTLENBQUMsS0FBSzthQUN6QixDQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7SUFDRCxpQkFBaUI7UUFDYixNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUM1QixNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNsQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksRUFBRTtZQUNyQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3hCO0lBQ0wsQ0FBQztJQUNELG9CQUFvQjtRQUNoQixNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUM1QixNQUFNLEVBQUUsVUFBVSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNsQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksRUFBRTtZQUNyQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzFCO0lBQ0wsQ0FBQztJQUNPLFdBQVcsQ0FBQyxLQUFhO1FBQzdCLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ2pELElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRTtZQUN4QixJQUFJLElBQUksRUFBRTtnQkFDTixJQUFJLENBQUMsTUFBTSxDQUFDO29CQUNSLElBQUk7b0JBQ0osS0FBSztpQkFDUixDQUFDLENBQUM7YUFDTjtpQkFDSTtnQkFDRCxJQUFJLENBQUMsUUFBUSxDQUFDO29CQUNWLEtBQUs7aUJBQ1IsQ0FBQyxDQUFDO2FBQ047U0FDSjtRQUNELElBQUksT0FBTyxRQUFRLEtBQUssVUFBVSxFQUFFO1lBQ2hDLFFBQVEsQ0FBQztnQkFDTCxLQUFLO2FBQ1IsQ0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDO0lBTU8sVUFBVSxDQUFDLEtBQWE7UUFDNUIsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNWLEtBQUssRUFBRSxLQUFLO1NBQ2YsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNELE1BQU07UUFDRixNQUFNLGVBQWlKLEVBQWpKLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLEVBQUUsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxRQUFRLEVBQUUsSUFBSSxHQUFHLE1BQU0sT0FBeUIsRUFBdkIsa0hBQXVCLENBQUM7UUFDeEosTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDdEQsTUFBTSxHQUFHLEdBQUcsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDaEQsT0FBTyxDQUFDLG9CQUFDLGVBQWUsb0JBQUssS0FBSyxHQUNqQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxvQkFBQyxhQUFhLElBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLFlBQVksRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6SixvQkFBQyxVQUFVLElBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FDckYsQ0FBQyxDQUFDLENBQ0osQ0FBQyxDQUFDO0lBQ3RCLENBQUM7O0FBQ00sZUFBSyxHQUFHO0lBQ1gsSUFBSSxlQUFlLEtBQUssT0FBTyxlQUF5QyxDQUFDLENBQUMsQ0FBQztJQUMzRSxJQUFJLGFBQWEsS0FBSyxPQUFPLGFBQXFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JFLElBQUksVUFBVSxLQUFLLE9BQU8sVUFBK0IsQ0FBQyxDQUFDLENBQUM7Q0FDL0QsQ0FBQztBQUVOOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sTUFBTSxHQUFHLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNqRCxNQUFNLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCAqIGFzIGljb25zIGZyb20gJy4uL0ljb24vaWNvbnMnO1xuaW1wb3J0IHN0eWxlZCwgeyBrZXlmcmFtZXMsIGNzcyB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBJY29uTmFtZSB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgSW5wdXRQcm9wcywgUHJlY2lzZVRoZW1lIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IHdpdGhGb3JtQ29udGV4dCwgRm9ybUNvbnRleHRQcm9wcyB9IGZyb20gJy4uLy4uL2hvYy93aXRoRm9ybUNvbnRleHQnO1xuaW1wb3J0IHsgYnJpZ2h0TGVtb24sIHdoaXRlLCBvY2VhbiB9IGZyb20gJy4uLy4uL2NvbG9ycyc7XG5pbXBvcnQgeyBkaXN0YW5jZSB9IGZyb20gJy4uLy4uL2Rpc3RhbmNlJztcbmV4cG9ydCBpbnRlcmZhY2UgUmF0aW5nUHJvcHMgZXh0ZW5kcyBJbnB1dFByb3BzPG51bWJlcj4ge1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGljb24gdG8gYmUgdXNlZC5cbiAgICAgKiBAZGVmYXVsdCBGYXZvcml0ZVxuICAgICAqL1xuICAgIGljb24/OiBJY29uTmFtZTtcbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIGxldmVscyBmb3IgdGhlIHJhdGluZy4gQnkgZGVmYXVsdCA1LlxuICAgICAqIEBkZWZhdWx0IDVcbiAgICAgKi9cbiAgICBsZXZlbHM/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc2l6ZSBvZiB0aGUgc3RhcnMuXG4gICAgICogQGRlZmF1bHQgXCJtZWRpdW1cIlxuICAgICAqL1xuICAgIHNpemU/OiAnc21hbGwnIHwgJ21lZGl1bSc7XG4gICAgLyoqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogdm9pZDtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUmF0aW5nU3RhdGUge1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgaG92ZXI6IG51bWJlcjtcbiAgICBjaGFuZ2VyczogQXJyYXk8KCkgPT4gdm9pZD47XG4gICAgaG92ZXJzOiBBcnJheTwoKSA9PiB2b2lkPjtcbn1cbmNvbnN0IFJhdGluZ0NvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG5gO1xuaW50ZXJmYWNlIFJhdGluZ0VsZW1lbnRQcm9wcyB7XG4gICAgc2l6ZTogJ21lZGl1bScgfCAnc21hbGwnO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbn1cbmNvbnN0IFNldEFuaW1hdGlvbiA9IGtleWZyYW1lcyBgXG4gIDAlIHtcbiAgICB0cmFuc2Zvcm06IHNjYWxlKDEpO1xuICB9XG4gIDI1JSB7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgxLjUpO1xuICB9XG4gIDUwJSB7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgwLjkpO1xuICB9XG4gIDc1JSB7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpO1xuICB9XG4gIDEwMCUge1xuICAgIHRyYW5zZm9ybTogc2NhbGUoMSk7XG4gIH1cbmA7XG5jb25zdCBSYXRpbmdFbGVtZW50ID0gc3R5bGVkLnNwYW48UmF0aW5nRWxlbWVudFByb3BzPiBgXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgY3Vyc29yOiAke3Byb3BzID0+IChwcm9wcy5kaXNhYmxlZCA/ICdub3QtYWxsb3dlZCcgOiAncG9pbnRlcicpfTtcblxuICAmICsgJiB7XG4gICAgcGFkZGluZy1sZWZ0OiAke3Byb3BzID0+IChwcm9wcy5zaXplID09PSAnbWVkaXVtJyA/IGRpc3RhbmNlLnNtYWxsIDogZGlzdGFuY2UueHNtYWxsKX07XG4gIH1cbmA7XG5mdW5jdGlvbiBnZXRDb2xvcih0aGVtZTogUHJlY2lzZVRoZW1lLCBkaXNhYmxlZDogYm9vbGVhbiB8IHVuZGVmaW5lZCwgaTogbnVtYmVyLCB2YWx1ZTogbnVtYmVyLCBob3ZlcjogbnVtYmVyKSB7XG4gICAgaWYgKCFkaXNhYmxlZCkge1xuICAgICAgICBpZiAoaG92ZXIgIT09IC0xKSB7XG4gICAgICAgICAgICBpZiAoaSA8IGhvdmVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoZW1lLnVpMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGkgPT09IGhvdmVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9jZWFuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGkgPCB2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoZW1lLnVpNTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhlbWUudWk0O1xuICAgIH1cbiAgICBlbHNlIGlmIChpIDwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoZW1lLnVpNDtcbiAgICB9XG4gICAgcmV0dXJuIHRoZW1lLnVpMztcbn1cbmZ1bmN0aW9uIGdldEFuaW1hdGlvbihpOiBudW1iZXIsIHZhbHVlOiBudW1iZXIpIHtcbiAgICBpZiAoaSArIDEgPT09IHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBjc3MgYFxuICAgICAgJHtTZXRBbmltYXRpb259IDAuNXMgZWFzZS1pbi1vdXRcbiAgICBgO1xuICAgIH1cbiAgICByZXR1cm4gJ25vbmUnO1xufVxuaW50ZXJmYWNlIFJhdGluZ0ljb25Qcm9wcyB7XG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICAgIGluZGV4OiBudW1iZXI7XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgICBob3ZlcjogbnVtYmVyO1xuICAgIHNpemU6IHN0cmluZztcbn1cbmNvbnN0IFJhdGluZ0ljb25JbnQ6IFJlYWN0LkZDPFJhdGluZ0ljb25Qcm9wcz4gPSAoeyBkaXNhYmxlZCwgaW5kZXgsIHZhbHVlLCBob3Zlciwgc2l6ZSwgLi4ucHJvcHMgfSkgPT4gKDxpY29ucy5TdGFyIHsuLi5wcm9wc30vPik7XG5jb25zdCBSYXRpbmdJY29uID0gc3R5bGVkKFJhdGluZ0ljb25JbnQpKCh7IHRoZW1lLCBkaXNhYmxlZCwgaW5kZXgsIHZhbHVlLCBob3Zlciwgc2l6ZSB9KSA9PiBjc3MgYFxuICAgIGZpbGw6ICR7Z2V0Q29sb3IodGhlbWUsIGRpc2FibGVkLCBpbmRleCwgdmFsdWUsIGhvdmVyKX07XG4gICAgYW5pbWF0aW9uOiAke2dldEFuaW1hdGlvbihpbmRleCwgdmFsdWUpfTtcbiAgICB3aWR0aDogJHtzaXplfTtcbiAgICBoZWlnaHQ6ICR7c2l6ZX07XG4gIGApO1xuY2xhc3MgUmF0aW5nSW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFJhdGluZ1Byb3BzICYgRm9ybUNvbnRleHRQcm9wcywgUmF0aW5nU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogUmF0aW5nUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBkZWZhdWx0VmFsdWUsIGxldmVscyA9IDUgfSA9IHByb3BzO1xuICAgICAgICBjb25zdCBjaGFuZ2VyczogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcbiAgICAgICAgY29uc3QgaG92ZXJzOiBBcnJheTwoKSA9PiB2b2lkPiA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxldmVsczsgaSsrKSB7XG4gICAgICAgICAgICBjaGFuZ2Vycy5wdXNoKCgpID0+IHRoaXMudXBkYXRlVmFsdWUoaSArIDEpKTtcbiAgICAgICAgICAgIGhvdmVycy5wdXNoKCgpID0+IHRoaXMuaG92ZXJWYWx1ZShpKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHZhbHVlICE9PSB1bmRlZmluZWQsXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUgfHwgZGVmYXVsdFZhbHVlIHx8IDAsXG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgICAgICBob3ZlcjogLTEsXG4gICAgICAgICAgICBjaGFuZ2VycyxcbiAgICAgICAgICAgIGhvdmVycyxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBSYXRpbmdQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogbmV4dFByb3BzLnZhbHVlIHx8IDAsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5leHRQcm9wcy5lcnJvcixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSB1cGRhdGVWYWx1ZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIG5hbWUgPSAnJywgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGhvdmVyVm9pZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBob3ZlcjogLTEsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBob3ZlclZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBob3ZlcjogdmFsdWUsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGV2ZWxzOiBfMCwgbmFtZTogXzEsIHZhbHVlOiBfMiwgZGVmYXVsdFZhbHVlOiBfMywgb25DaGFuZ2U6IF80LCBvbklucHV0OiBfNSwgZGlzYWJsZWQsIHNpemUgPSAnbWVkaXVtJywgaWNvbiA9ICdTdGFyJywgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIGNoYW5nZXJzLCBob3ZlciwgaG92ZXJzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBkaW0gPSBzaXplID09PSAnbWVkaXVtJyA/ICczMnB4JyA6ICcyMnB4JztcbiAgICAgICAgcmV0dXJuICg8UmF0aW5nQ29udGFpbmVyIHsuLi5wcm9wc30+XG4gICAgICAgIHtjaGFuZ2Vycy5tYXAoKGNoYW5nZXIsIGkpID0+ICg8UmF0aW5nRWxlbWVudCBrZXk9e2l9IHNpemU9e3NpemV9IG9uQ2xpY2s9e2NoYW5nZXJ9IGRpc2FibGVkPXtkaXNhYmxlZH0gb25Nb3VzZUVudGVyPXtob3ZlcnNbaV19IG9uTW91c2VMZWF2ZT17dGhpcy5ob3ZlclZvaWR9PlxuICAgICAgICAgICAgPFJhdGluZ0ljb24gaW5kZXg9e2l9IGRpc2FibGVkPXtkaXNhYmxlZH0gdmFsdWU9e3ZhbHVlfSBob3Zlcj17aG92ZXJ9IHNpemU9e2RpbX0gYXM9e2ljb25zW2ljb25dfS8+XG4gICAgICAgICAgPC9SYXRpbmdFbGVtZW50PikpfVxuICAgICAgPC9SYXRpbmdDb250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgUmF0aW5nQ29udGFpbmVyKCkgeyByZXR1cm4gUmF0aW5nQ29udGFpbmVyIGFzIHR5cGVvZiBSYXRpbmdDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBSYXRpbmdFbGVtZW50KCkgeyByZXR1cm4gUmF0aW5nRWxlbWVudCBhcyB0eXBlb2YgUmF0aW5nRWxlbWVudDsgfSxcbiAgICAgICAgZ2V0IFJhdGluZ0ljb24oKSB7IHJldHVybiBSYXRpbmdJY29uIGFzIHR5cGVvZiBSYXRpbmdJY29uOyB9XG4gICAgfTtcbn1cbi8qKlxuICogQW4gaW5wdXQgY29udHJvbCBmb3IgcHJvdmlkaW5nIHVzZXIgcmF0aW5ncy5cbiAqL1xuZXhwb3J0IGNvbnN0IFJhdGluZyA9IHdpdGhGb3JtQ29udGV4dChSYXRpbmdJbnQpO1xuUmF0aW5nLmRpc3BsYXlOYW1lID0gJ1JhdGluZyc7XG4iXX0=