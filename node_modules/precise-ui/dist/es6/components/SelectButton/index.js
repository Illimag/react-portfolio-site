var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled from '../../utils/styled';
import { InteractiveList, InteractiveListDirection, } from '../InteractiveList';
import { Icon } from '../Icon';
import { white, cyan, skyBlue } from '../../colors';
import { distance } from '../../distance';
import OnClickOut from 'react-onclickoutside';
const RootWrapper = styled.div `
  color: ${cyan};
  &:hover {
    color: ${skyBlue};
  }
`;
const ButtonWrapper = styled.div `
  padding-left: ${distance.xsmall};
  display: flex;
  align-items: center;
  cursor: pointer;
`;
const StyledCustomWrapper = styled.div `
  position: absolute;
  border: solid 1px #dfe3e6;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.1);
  position: absolute;
  z-index: 2;
  top: ${props => (props.direction === InteractiveListDirection.normal ? 8 : -30)}px;
  transform: translateY(${props => (props.direction === InteractiveListDirection.normal ? 0 : -100)}%);
  background: ${white};
  border: 1px solid #dfe3e6;
  max-height: 50vh;
  overflow-y: auto;
`;
const CustomWrapper = Object.assign((props => {
    return React.createElement(StyledCustomWrapper, Object.assign({}, props));
}), { inner: {
        get StyledCustomWrapper() { return StyledCustomWrapper; }
    } });
function renderValue(data, value) {
    for (const item of data) {
        if (typeof item !== 'string' && item.key === value) {
            return item.content || value;
        }
    }
    return value;
}
class SelectButtonInt extends React.PureComponent {
    constructor(props) {
        super(props);
        this.handleMouseDown = (e) => {
            const { open } = this.state;
            this.setState({
                open: !open,
            });
            e.preventDefault();
        };
        this.handleChange = (e) => {
            const { onChange, data } = this.props;
            const { controlled } = this.state;
            const index = e.value.length ? e.value[0] : -1;
            const item = data[index];
            const value = item && (typeof item === 'string' ? item : item.key);
            if (!value) {
                return;
            }
            if (!controlled) {
                this.setState({
                    open: false,
                    value,
                });
            }
            else {
                this.setState({
                    open: false,
                });
            }
            if (typeof onChange === 'function') {
                onChange({
                    index,
                    value,
                });
            }
        };
        this.handleBlur = () => {
            this.setState({
                open: false,
            });
        };
        this.handleClickOutside = this.handleBlur;
        const controlled = props.value !== undefined;
        this.state = {
            open: false,
            value: (controlled ? props.value : props.defaultValue) || '',
            controlled,
        };
    }
    UNSAFE_componentWillReceiveProps(nextProps) {
        const { controlled } = this.state;
        if (controlled) {
            this.setState({
                value: nextProps.value || '',
            });
        }
    }
    render() {
        const _a = this.props, { data = [], onChange: _0, value: _1 } = _a, props = __rest(_a, ["data", "onChange", "value"]);
        const { open, value } = this.state;
        return (React.createElement(RootWrapper, Object.assign({}, props),
            React.createElement(ButtonWrapper, { onMouseDown: this.handleMouseDown },
                renderValue(data, value),
                React.createElement(Icon, { name: "ArrowDropDown", size: 1.5 })),
            React.createElement(InteractiveList, { data: data, open: open, onBlur: this.handleBlur, onChange: this.handleChange, customWrapper: CustomWrapper, value: value, onClickOutside: () => { }, autoPosition: true, autoFocus: true, showTick: true })));
    }
}
SelectButtonInt.inner = {
    get RootWrapper() { return RootWrapper; },
    get ButtonWrapper() { return ButtonWrapper; },
    get Icon() { return Icon; },
    get InteractiveList() { return InteractiveList; }
};
/**
 * Represents a select button, which is a kind of dropdown button.
 */
export const SelectButton = OnClickOut(SelectButtonInt);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TZWxlY3RCdXR0b24vaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sTUFBTSxNQUFNLG9CQUFvQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxlQUFlLEVBQWdGLHdCQUF3QixHQUFHLE1BQU0sb0JBQW9CLENBQUM7QUFDOUosT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUMvQixPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFFcEQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sVUFBVSxNQUFNLHNCQUFzQixDQUFDO0FBd0M5QyxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO1dBQ3BCLElBQUk7O2FBRUYsT0FBTzs7Q0FFbkIsQ0FBQztBQUNGLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7a0JBQ2YsUUFBUSxDQUFDLE1BQU07Ozs7Q0FJaEMsQ0FBQztBQUNGLE1BQU0sbUJBQW1CLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBOEI7Ozs7OztTQU0zRCxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFNBQVMsS0FBSyx3QkFBd0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7MEJBQ3ZELEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxLQUFLLHdCQUF3QixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztnQkFDbkYsS0FBSzs7OztDQUlw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V0FBVyxLQUFLLE9BQU8sV0FBaUMsQ0FBQyxDQUFDLENBQUM7SUFDL0QsSUFBSSxhQUFhLEtBQUssT0FBTyxhQUFxQyxDQUFDLENBQUMsQ0FBQztJQUNyRSxJQUFJLElBQUksS0FBSyxPQUFPLElBQW1CLENBQUMsQ0FBQyxDQUFDO0lBQzFDLElBQUksZUFBZSxLQUFLLE9BQU8sZUFBeUMsQ0FBQyxDQUFDLENBQUM7Q0FDOUUsQ0FBQztBQUVOOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IEludGVyYWN0aXZlTGlzdCwgSW50ZXJhY3RpdmVMaXN0Q2hhbmdlRXZlbnQsIEludGVyYWN0aXZlTGlzdEl0ZW0sIEludGVyYWN0aXZlTGlzdFdyYXBwZXJQcm9wcywgSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLCB9IGZyb20gJy4uL0ludGVyYWN0aXZlTGlzdCc7XG5pbXBvcnQgeyBJY29uIH0gZnJvbSAnLi4vSWNvbic7XG5pbXBvcnQgeyB3aGl0ZSwgY3lhbiwgc2t5Qmx1ZSB9IGZyb20gJy4uLy4uL2NvbG9ycyc7XG5pbXBvcnQgeyBTdGFuZGFyZFByb3BzIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IE9uQ2xpY2tPdXQgZnJvbSAncmVhY3Qtb25jbGlja291dHNpZGUnO1xuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RCdXR0b25DaGFuZ2VFdmVudCB7XG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnRseSBzZWxlY3RlZCBpbmRleC4gSW4gY2FzZSBub25lIGlzXG4gICAgICogY2hvc2VuIHRoZSB2YWx1ZSAtMSBpcyBjb21tdW5pY2F0ZWQuXG4gICAgICovXG4gICAgaW5kZXg6IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIHZhbHVlLiBVbmRlZmluZWQgaWYgbm9uZVxuICAgICAqIGlzIGNob3Nlbi5cbiAgICAgKi9cbiAgICB2YWx1ZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xufVxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RCdXR0b25Qcm9wcyBleHRlbmRzIFN0YW5kYXJkUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRoZSBkYXRhIHNvdXJjZSBvZiB0aGUgZWxlbWVudHMgdG8gc2hvdy5cbiAgICAgKi9cbiAgICBkYXRhOiBBcnJheTxzdHJpbmcgfCBJbnRlcmFjdGl2ZUxpc3RJdGVtPjtcbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIHZhbHVlIGlmIGFueS4gUGlja2luZyBvbmUgZW50ZXJzIHRoZSBjb250cm9sbGVkIG1vZGUuXG4gICAgICovXG4gICAgdmFsdWU/OiBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogVGhlIGluaXRpYWwgdmFsdWUgaWYgYW55LiBQaWNraW5nIG9uZSBlbnRlcnMgbWFuYWdlZCBtb2RlLlxuICAgICAqL1xuICAgIGRlZmF1bHRWYWx1ZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBFdmVudCBmaXJlZCBvbmNlIHRoZSBzZWxlY3RlZCB2YWx1ZSBjaGFuZ2VzLlxuICAgICAqL1xuICAgIG9uQ2hhbmdlPyhlOiBTZWxlY3RCdXR0b25DaGFuZ2VFdmVudCk6IHZvaWQ7XG4gICAgLyoqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogdm9pZDtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgU2VsZWN0QnV0dG9uU3RhdGUge1xuICAgIG9wZW46IGJvb2xlYW47XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuY29uc3QgUm9vdFdyYXBwZXIgPSBzdHlsZWQuZGl2IGBcbiAgY29sb3I6ICR7Y3lhbn07XG4gICY6aG92ZXIge1xuICAgIGNvbG9yOiAke3NreUJsdWV9O1xuICB9XG5gO1xuY29uc3QgQnV0dG9uV3JhcHBlciA9IHN0eWxlZC5kaXYgYFxuICBwYWRkaW5nLWxlZnQ6ICR7ZGlzdGFuY2UueHNtYWxsfTtcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgY3Vyc29yOiBwb2ludGVyO1xuYDtcbmNvbnN0IFN0eWxlZEN1c3RvbVdyYXBwZXIgPSBzdHlsZWQuZGl2PEludGVyYWN0aXZlTGlzdFdyYXBwZXJQcm9wcz4gYFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGJvcmRlcjogc29saWQgMXB4ICNkZmUzZTY7XG4gIGJveC1zaGFkb3c6IDAgNHB4IDhweCAwIHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICB6LWluZGV4OiAyO1xuICB0b3A6ICR7cHJvcHMgPT4gKHByb3BzLmRpcmVjdGlvbiA9PT0gSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLm5vcm1hbCA/IDggOiAtMzApfXB4O1xuICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoJHtwcm9wcyA9PiAocHJvcHMuZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsID8gMCA6IC0xMDApfSUpO1xuICBiYWNrZ3JvdW5kOiAke3doaXRlfTtcbiAgYm9yZGVyOiAxcHggc29saWQgI2RmZTNlNjtcbiAgbWF4LWhlaWdodDogNTB2aDtcbiAgb3ZlcmZsb3cteTogYXV0bztcbmA7XG5jb25zdCBDdXN0b21XcmFwcGVyID0gT2JqZWN0LmFzc2lnbigoKHByb3BzID0+IHtcbiAgICByZXR1cm4gPFN0eWxlZEN1c3RvbVdyYXBwZXIgey4uLnByb3BzfS8+O1xufSkgYXMgUmVhY3QuU0ZDPEludGVyYWN0aXZlTGlzdFdyYXBwZXJQcm9wcz4pLCB7IGlubmVyOiB7XG4gICAgICAgIGdldCBTdHlsZWRDdXN0b21XcmFwcGVyKCkgeyByZXR1cm4gU3R5bGVkQ3VzdG9tV3JhcHBlciBhcyB0eXBlb2YgU3R5bGVkQ3VzdG9tV3JhcHBlcjsgfVxuICAgIH0gfSk7XG5mdW5jdGlvbiByZW5kZXJWYWx1ZShkYXRhOiBBcnJheTxzdHJpbmcgfCBJbnRlcmFjdGl2ZUxpc3RJdGVtPiwgdmFsdWU6IHN0cmluZykge1xuICAgIGZvciAoY29uc3QgaXRlbSBvZiBkYXRhKSB7XG4gICAgICAgIGlmICh0eXBlb2YgaXRlbSAhPT0gJ3N0cmluZycgJiYgaXRlbS5rZXkgPT09IHZhbHVlKSB7XG4gICAgICAgICAgICByZXR1cm4gaXRlbS5jb250ZW50IHx8IHZhbHVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbn1cbmNsYXNzIFNlbGVjdEJ1dHRvbkludCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8U2VsZWN0QnV0dG9uUHJvcHMsIFNlbGVjdEJ1dHRvblN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IFNlbGVjdEJ1dHRvblByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgY29uc3QgY29udHJvbGxlZCA9IHByb3BzLnZhbHVlICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgICAgICAgIHZhbHVlOiAoY29udHJvbGxlZCA/IHByb3BzLnZhbHVlIDogcHJvcHMuZGVmYXVsdFZhbHVlKSB8fCAnJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wczogU2VsZWN0QnV0dG9uUHJvcHMpIHtcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IG5leHRQcm9wcy52YWx1ZSB8fCAnJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgaGFuZGxlTW91c2VEb3duID0gKGU6IFJlYWN0Lk1vdXNlRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb3BlbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBvcGVuOiAhb3BlbixcbiAgICAgICAgfSk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlQ2hhbmdlID0gKGU6IEludGVyYWN0aXZlTGlzdENoYW5nZUV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIGRhdGEgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgaW5kZXggPSBlLnZhbHVlLmxlbmd0aCA/IGUudmFsdWVbMF0gOiAtMTtcbiAgICAgICAgY29uc3QgaXRlbSA9IGRhdGFbaW5kZXhdO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGl0ZW0gJiYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLmtleSk7XG4gICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIG9wZW46IGZhbHNlLFxuICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIGhhbmRsZUJsdXIgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgb3BlbjogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgaGFuZGxlQ2xpY2tPdXRzaWRlID0gdGhpcy5oYW5kbGVCbHVyO1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhID0gW10sIG9uQ2hhbmdlOiBfMCwgdmFsdWU6IF8xLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBvcGVuLCB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuICg8Um9vdFdyYXBwZXIgey4uLnByb3BzfT5cbiAgICAgICAgPEJ1dHRvbldyYXBwZXIgb25Nb3VzZURvd249e3RoaXMuaGFuZGxlTW91c2VEb3dufT5cbiAgICAgICAgICB7cmVuZGVyVmFsdWUoZGF0YSwgdmFsdWUpfVxuICAgICAgICAgIDxJY29uIG5hbWU9XCJBcnJvd0Ryb3BEb3duXCIgc2l6ZT17MS41fS8+XG4gICAgICAgIDwvQnV0dG9uV3JhcHBlcj5cbiAgICAgICAgPEludGVyYWN0aXZlTGlzdCBkYXRhPXtkYXRhfSBvcGVuPXtvcGVufSBvbkJsdXI9e3RoaXMuaGFuZGxlQmx1cn0gb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlfSBjdXN0b21XcmFwcGVyPXtDdXN0b21XcmFwcGVyfSB2YWx1ZT17dmFsdWV9IG9uQ2xpY2tPdXRzaWRlPXsoKSA9PiB7IH19IGF1dG9Qb3NpdGlvbiBhdXRvRm9jdXMgc2hvd1RpY2svPlxuICAgICAgPC9Sb290V3JhcHBlcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBSb290V3JhcHBlcigpIHsgcmV0dXJuIFJvb3RXcmFwcGVyIGFzIHR5cGVvZiBSb290V3JhcHBlcjsgfSxcbiAgICAgICAgZ2V0IEJ1dHRvbldyYXBwZXIoKSB7IHJldHVybiBCdXR0b25XcmFwcGVyIGFzIHR5cGVvZiBCdXR0b25XcmFwcGVyOyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH0sXG4gICAgICAgIGdldCBJbnRlcmFjdGl2ZUxpc3QoKSB7IHJldHVybiBJbnRlcmFjdGl2ZUxpc3QgYXMgdHlwZW9mIEludGVyYWN0aXZlTGlzdDsgfVxuICAgIH07XG59XG4vKipcbiAqIFJlcHJlc2VudHMgYSBzZWxlY3QgYnV0dG9uLCB3aGljaCBpcyBhIGtpbmQgb2YgZHJvcGRvd24gYnV0dG9uLlxuICovXG5leHBvcnQgY29uc3QgU2VsZWN0QnV0dG9uID0gT25DbGlja091dChTZWxlY3RCdXR0b25JbnQpO1xuIl19