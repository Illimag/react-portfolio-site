var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
import * as React from 'react';
import styled, { themed, css } from '../../utils/styled';
import { getPropLabel } from '../../utils/labels';
import { Icon } from '../Icon';
import { ProgressBar } from '../ProgressBar';
import { Table } from '../Table';
import { ActionIconContainer } from './ActionIconContainer.part';
import { StatusIcon } from './StatusIcon.part';
import { getStatus, iconNames } from './helpers';
const TextWrapBox = styled.div `
  display: block;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`;
const StyledTable = styled(Table) `
  table-layout: fixed;
`;
const ProgressTableRow = styled.tr(themed(({ theme }) => css `
      border-bottom: 1px solid ${theme.ui4};
      padding: 0;
      &:hover {
        background: ${theme.ui3};
      }
    `));
const ProgressTableCell = styled.td `
  padding: 0 !important;
  &:hover {
    background: ${themed(({ theme }) => theme.ui3)};
  }
`;
const StyledProgressBar = styled(ProgressBar) `
  border-radius: 0;
  height: 2px;
`;
export const StyledTableRow = styled.tr(themed(({ hasProgressBar, theme }) => css `
      border-bottom: ${hasProgressBar ? 0 : 1}px solid ${theme.ui4};
      &:hover {
        background: ${theme.ui4};
      }
    `));
export const StatusTable = Object.assign(((_a) => {
    var { theme, files, onCancel, onDelete } = _a, props = __rest(_a, ["theme", "files", "onCancel", "onDelete"]);
    const columns = {
        name: {
            header: getPropLabel(props, 'tableHeaderFileLabel'),
        },
        status: {
            header: getPropLabel(props, 'tableHeaderStatusLabel'),
            width: '40%',
        },
        action: {
            header: '',
            width: '30px',
        },
    };
    const data = files.map(item => (Object.assign({}, item, { status: getStatus(item) })));
    function rowRenderer({ cells, data }) {
        const hasProgressBar = !(data.canceled || data.error || data.progress >= 100);
        return (React.createElement(React.Fragment, { key: data.fileId },
            React.createElement(StyledTableRow, { hasProgressBar: hasProgressBar, theme: theme }, cells),
            hasProgressBar && (React.createElement(ProgressTableRow, { theme: theme },
                React.createElement(ProgressTableCell, { colSpan: 3 },
                    React.createElement(StyledProgressBar, { value: data.progress, animate: true }))))));
    }
    function cellRenderer(e) {
        const value = e.value;
        const fileData = e.data;
        if (e.key.toLowerCase() === 'action' && fileData) {
            const status = getStatus(fileData);
            return status === 'progress' || status === 'scanning' ? (React.createElement(ActionIconContainer, { onClick: () => onCancel({ files: [fileData] }) },
                React.createElement(Icon, { name: "Close" }))) : status === 'success' ? (React.createElement(ActionIconContainer, { onClick: () => onDelete({ files: [fileData] }) },
                React.createElement(Icon, { name: "Delete" }))) : (false);
        }
        if (e.key.toLowerCase() === 'status' && e.data) {
            const status = getStatus(e.data);
            const error = status === 'error' && e.data.error;
            return (React.createElement(TextWrapBox, null,
                React.createElement(StatusIcon, { condensed: true, type: status, name: iconNames[value] }),
                getPropLabel(props, `${status}TableUploadLabel`, error)));
        }
        return React.createElement(TextWrapBox, null, value);
    }
    return (React.createElement(StyledTable, { data: data, theme: theme, columns: columns, rowRenderer: rowRenderer, cellRenderer: cellRenderer, mode: "table", condensed: true }));
}), { inner: {
        get StyledTableRow() { return StyledTableRow; },
        get ProgressTableRow() { return ProgressTableRow; },
        get ProgressTableCell() { return ProgressTableCell; },
        get StyledProgressBar() { return StyledProgressBar; },
        get ActionIconContainer() { return ActionIconContainer; },
        get Icon() { return Icon; },
        get TextWrapBox() { return TextWrapBox; },
        get StatusIcon() { return StatusIcon; },
        get StyledTable() { return StyledTable; }
    } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhdHVzVGFibGUucGFydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0ZpbGVVcGxvYWRlckRldGFpbHMvU3RhdHVzVGFibGUucGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDekQsT0FBTyxFQUFFLFlBQVksRUFBcUIsTUFBTSxvQkFBb0IsQ0FBQztBQUNyRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQy9CLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsS0FBSyxFQUFpQyxNQUFNLFVBQVUsQ0FBQztBQUNoRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUVqRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDL0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFakQsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQzs7Ozs7Q0FLOUIsQ0FBQztBQUNGLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzs7Q0FFakMsQ0FBQztBQUNGLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUM7aUNBQzVCLEtBQUssQ0FBQyxHQUFHOzs7c0JBR3BCLEtBQUssQ0FBQyxHQUFHOztLQUUxQixDQUFDLENBQUMsQ0FBQztBQUNSLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQzs7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LEVBQUU7UUFDckMsSUFBSSxjQUFjLEtBQUssT0FBTyxjQUF1QyxDQUFDLENBQUMsQ0FBQztRQUN4RSxJQUFJLGdCQUFnQixLQUFLLE9BQU8sZ0JBQTJDLENBQUMsQ0FBQyxDQUFDO1FBQzlFLElBQUksaUJBQWlCLEtBQUssT0FBTyxpQkFBNkMsQ0FBQyxDQUFDLENBQUM7UUFDakYsSUFBSSxpQkFBaUIsS0FBSyxPQUFPLGlCQUE2QyxDQUFDLENBQUMsQ0FBQztRQUNqRixJQUFJLG1CQUFtQixLQUFLLE9BQU8sbUJBQWlELENBQUMsQ0FBQyxDQUFDO1FBQ3ZGLElBQUksSUFBSSxLQUFLLE9BQU8sSUFBbUIsQ0FBQyxDQUFDLENBQUM7UUFDMUMsSUFBSSxXQUFXLEtBQUssT0FBTyxXQUFpQyxDQUFDLENBQUMsQ0FBQztRQUMvRCxJQUFJLFVBQVUsS0FBSyxPQUFPLFVBQStCLENBQUMsQ0FBQyxDQUFDO1FBQzVELElBQUksV0FBVyxLQUFLLE9BQU8sV0FBaUMsQ0FBQyxDQUFDLENBQUM7S0FDbEUsRUFBRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCwgY3NzIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IGdldFByb3BMYWJlbCwgU3RhdHVzVGFibGVMYWJlbHMgfSBmcm9tICcuLi8uLi91dGlscy9sYWJlbHMnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgUHJvZ3Jlc3NCYXIgfSBmcm9tICcuLi9Qcm9ncmVzc0Jhcic7XG5pbXBvcnQgeyBUYWJsZSwgVGFibGVDZWxsRXZlbnQsIFRhYmxlUm93RXZlbnQgfSBmcm9tICcuLi9UYWJsZSc7XG5pbXBvcnQgeyBBY3Rpb25JY29uQ29udGFpbmVyIH0gZnJvbSAnLi9BY3Rpb25JY29uQ29udGFpbmVyLnBhcnQnO1xuaW1wb3J0IHsgRmlsZVByb2dyZXNzLCBGaWxlVXBsb2FkZXJEZXRhaWxzRXZlbnQgfSBmcm9tICcuL0ZpbGVVcGxvYWRlckRldGFpbHMudHlwZXMucGFydCc7XG5pbXBvcnQgeyBTdGF0dXNJY29uIH0gZnJvbSAnLi9TdGF0dXNJY29uLnBhcnQnO1xuaW1wb3J0IHsgZ2V0U3RhdHVzLCBpY29uTmFtZXMgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgU3RhbmRhcmRQcm9wcyB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5jb25zdCBUZXh0V3JhcEJveCA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBibG9jaztcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG5gO1xuY29uc3QgU3R5bGVkVGFibGUgPSBzdHlsZWQoVGFibGUpIGBcbiAgdGFibGUtbGF5b3V0OiBmaXhlZDtcbmA7XG5jb25zdCBQcm9ncmVzc1RhYmxlUm93ID0gc3R5bGVkLnRyKHRoZW1lZCgoeyB0aGVtZSB9KSA9PiBjc3MgYFxuICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICR7dGhlbWUudWk0fTtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAmOmhvdmVyIHtcbiAgICAgICAgYmFja2dyb3VuZDogJHt0aGVtZS51aTN9O1xuICAgICAgfVxuICAgIGApKTtcbmNvbnN0IFByb2dyZXNzVGFibGVDZWxsID0gc3R5bGVkLnRkIGBcbiAgcGFkZGluZzogMCAhaW1wb3J0YW50O1xuICAmOmhvdmVyIHtcbiAgICBiYWNrZ3JvdW5kOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS51aTMpfTtcbiAgfVxuYDtcbmNvbnN0IFN0eWxlZFByb2dyZXNzQmFyID0gc3R5bGVkKFByb2dyZXNzQmFyKSBgXG4gIGJvcmRlci1yYWRpdXM6IDA7XG4gIGhlaWdodDogMnB4O1xuYDtcbmV4cG9ydCBpbnRlcmZhY2UgU3R5bGVkVGFibGVSb3dQcm9wcyB7XG4gICAgaGFzUHJvZ3Jlc3NCYXI6IGJvb2xlYW47XG59XG5leHBvcnQgY29uc3QgU3R5bGVkVGFibGVSb3cgPSBzdHlsZWQudHI8U3R5bGVkVGFibGVSb3dQcm9wcz4odGhlbWVkKCh7IGhhc1Byb2dyZXNzQmFyLCB0aGVtZSB9KSA9PiBjc3MgYFxuICAgICAgYm9yZGVyLWJvdHRvbTogJHtoYXNQcm9ncmVzc0JhciA/IDAgOiAxfXB4IHNvbGlkICR7dGhlbWUudWk0fTtcbiAgICAgICY6aG92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kOiAke3RoZW1lLnVpNH07XG4gICAgICB9XG4gICAgYCkpO1xuZXhwb3J0IGludGVyZmFjZSBTdGF0dXNUYWJsZVByb3BzIGV4dGVuZHMgU3RhbmRhcmRQcm9wcywgU3RhdHVzVGFibGVMYWJlbHMge1xuICAgIGZpbGVzOiBBcnJheTxGaWxlUHJvZ3Jlc3M+O1xuICAgIG9uQ2FuY2VsKGU6IEZpbGVVcGxvYWRlckRldGFpbHNFdmVudDxGaWxlUHJvZ3Jlc3M+KTogdm9pZDtcbiAgICBvbkRlbGV0ZShlOiBGaWxlVXBsb2FkZXJEZXRhaWxzRXZlbnQ8RmlsZVByb2dyZXNzPik6IHZvaWQ7XG59XG5leHBvcnQgY29uc3QgU3RhdHVzVGFibGUgPSBPYmplY3QuYXNzaWduKCgoKHsgdGhlbWUsIGZpbGVzLCBvbkNhbmNlbCwgb25EZWxldGUsIC4uLnByb3BzIH0pID0+IHtcbiAgICBjb25zdCBjb2x1bW5zID0ge1xuICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICBoZWFkZXI6IGdldFByb3BMYWJlbChwcm9wcywgJ3RhYmxlSGVhZGVyRmlsZUxhYmVsJyksXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgaGVhZGVyOiBnZXRQcm9wTGFiZWwocHJvcHMsICd0YWJsZUhlYWRlclN0YXR1c0xhYmVsJyksXG4gICAgICAgICAgICB3aWR0aDogJzQwJScsXG4gICAgICAgIH0sXG4gICAgICAgIGFjdGlvbjoge1xuICAgICAgICAgICAgaGVhZGVyOiAnJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMzBweCcsXG4gICAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCBkYXRhID0gZmlsZXMubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgc3RhdHVzOiBnZXRTdGF0dXMoaXRlbSksXG4gICAgfSkpO1xuICAgIGZ1bmN0aW9uIHJvd1JlbmRlcmVyKHsgY2VsbHMsIGRhdGEgfTogVGFibGVSb3dFdmVudDxGaWxlUHJvZ3Jlc3M+KSB7XG4gICAgICAgIGNvbnN0IGhhc1Byb2dyZXNzQmFyID0gIShkYXRhLmNhbmNlbGVkIHx8IGRhdGEuZXJyb3IgfHwgZGF0YS5wcm9ncmVzcyA+PSAxMDApO1xuICAgICAgICByZXR1cm4gKDxSZWFjdC5GcmFnbWVudCBrZXk9e2RhdGEuZmlsZUlkfT5cbiAgICAgICAgPFN0eWxlZFRhYmxlUm93IGhhc1Byb2dyZXNzQmFyPXtoYXNQcm9ncmVzc0Jhcn0gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICB7Y2VsbHN9XG4gICAgICAgIDwvU3R5bGVkVGFibGVSb3c+XG4gICAgICAgIHtoYXNQcm9ncmVzc0JhciAmJiAoPFByb2dyZXNzVGFibGVSb3cgdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgIDxQcm9ncmVzc1RhYmxlQ2VsbCBjb2xTcGFuPXszfT5cbiAgICAgICAgICAgICAgPFN0eWxlZFByb2dyZXNzQmFyIHZhbHVlPXtkYXRhLnByb2dyZXNzfSBhbmltYXRlLz5cbiAgICAgICAgICAgIDwvUHJvZ3Jlc3NUYWJsZUNlbGw+XG4gICAgICAgICAgPC9Qcm9ncmVzc1RhYmxlUm93Pil9XG4gICAgICA8L1JlYWN0LkZyYWdtZW50Pik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNlbGxSZW5kZXJlcihlOiBUYWJsZUNlbGxFdmVudDxGaWxlUHJvZ3Jlc3M+KSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZS52YWx1ZTtcbiAgICAgICAgY29uc3QgZmlsZURhdGEgPSBlLmRhdGE7XG4gICAgICAgIGlmIChlLmtleS50b0xvd2VyQ2FzZSgpID09PSAnYWN0aW9uJyAmJiBmaWxlRGF0YSkge1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZ2V0U3RhdHVzKGZpbGVEYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBzdGF0dXMgPT09ICdwcm9ncmVzcycgfHwgc3RhdHVzID09PSAnc2Nhbm5pbmcnID8gKDxBY3Rpb25JY29uQ29udGFpbmVyIG9uQ2xpY2s9eygpID0+IG9uQ2FuY2VsKHsgZmlsZXM6IFtmaWxlRGF0YV0gfSl9PlxuICAgICAgICAgIDxJY29uIG5hbWU9XCJDbG9zZVwiLz5cbiAgICAgICAgPC9BY3Rpb25JY29uQ29udGFpbmVyPikgOiBzdGF0dXMgPT09ICdzdWNjZXNzJyA/ICg8QWN0aW9uSWNvbkNvbnRhaW5lciBvbkNsaWNrPXsoKSA9PiBvbkRlbGV0ZSh7IGZpbGVzOiBbZmlsZURhdGFdIH0pfT5cbiAgICAgICAgICA8SWNvbiBuYW1lPVwiRGVsZXRlXCIvPlxuICAgICAgICA8L0FjdGlvbkljb25Db250YWluZXI+KSA6IChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5LnRvTG93ZXJDYXNlKCkgPT09ICdzdGF0dXMnICYmIGUuZGF0YSkge1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZ2V0U3RhdHVzKGUuZGF0YSk7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IHN0YXR1cyA9PT0gJ2Vycm9yJyAmJiBlLmRhdGEuZXJyb3I7XG4gICAgICAgICAgICByZXR1cm4gKDxUZXh0V3JhcEJveD5cbiAgICAgICAgICA8U3RhdHVzSWNvbiBjb25kZW5zZWQgdHlwZT17c3RhdHVzfSBuYW1lPXtpY29uTmFtZXNbdmFsdWVdfS8+XG4gICAgICAgICAge2dldFByb3BMYWJlbChwcm9wcywgYCR7c3RhdHVzfVRhYmxlVXBsb2FkTGFiZWxgIGFzIGFueSwgZXJyb3IpfVxuICAgICAgICA8L1RleHRXcmFwQm94Pik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDxUZXh0V3JhcEJveD57dmFsdWV9PC9UZXh0V3JhcEJveD47XG4gICAgfVxuICAgIHJldHVybiAoPFN0eWxlZFRhYmxlIGRhdGE9e2RhdGF9IHRoZW1lPXt0aGVtZX0gY29sdW1ucz17Y29sdW1uc30gcm93UmVuZGVyZXI9e3Jvd1JlbmRlcmVyfSBjZWxsUmVuZGVyZXI9e2NlbGxSZW5kZXJlcn0gbW9kZT1cInRhYmxlXCIgY29uZGVuc2VkLz4pO1xufSkgYXMgUmVhY3QuU0ZDPFN0YXR1c1RhYmxlUHJvcHM+KSwgeyBpbm5lcjoge1xuICAgICAgICBnZXQgU3R5bGVkVGFibGVSb3coKSB7IHJldHVybiBTdHlsZWRUYWJsZVJvdyBhcyB0eXBlb2YgU3R5bGVkVGFibGVSb3c7IH0sXG4gICAgICAgIGdldCBQcm9ncmVzc1RhYmxlUm93KCkgeyByZXR1cm4gUHJvZ3Jlc3NUYWJsZVJvdyBhcyB0eXBlb2YgUHJvZ3Jlc3NUYWJsZVJvdzsgfSxcbiAgICAgICAgZ2V0IFByb2dyZXNzVGFibGVDZWxsKCkgeyByZXR1cm4gUHJvZ3Jlc3NUYWJsZUNlbGwgYXMgdHlwZW9mIFByb2dyZXNzVGFibGVDZWxsOyB9LFxuICAgICAgICBnZXQgU3R5bGVkUHJvZ3Jlc3NCYXIoKSB7IHJldHVybiBTdHlsZWRQcm9ncmVzc0JhciBhcyB0eXBlb2YgU3R5bGVkUHJvZ3Jlc3NCYXI7IH0sXG4gICAgICAgIGdldCBBY3Rpb25JY29uQ29udGFpbmVyKCkgeyByZXR1cm4gQWN0aW9uSWNvbkNvbnRhaW5lciBhcyB0eXBlb2YgQWN0aW9uSWNvbkNvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IEljb24oKSB7IHJldHVybiBJY29uIGFzIHR5cGVvZiBJY29uOyB9LFxuICAgICAgICBnZXQgVGV4dFdyYXBCb3goKSB7IHJldHVybiBUZXh0V3JhcEJveCBhcyB0eXBlb2YgVGV4dFdyYXBCb3g7IH0sXG4gICAgICAgIGdldCBTdGF0dXNJY29uKCkgeyByZXR1cm4gU3RhdHVzSWNvbiBhcyB0eXBlb2YgU3RhdHVzSWNvbjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZFRhYmxlKCkgeyByZXR1cm4gU3R5bGVkVGFibGUgYXMgdHlwZW9mIFN0eWxlZFRhYmxlOyB9XG4gICAgfSB9KTtcbiJdfQ==