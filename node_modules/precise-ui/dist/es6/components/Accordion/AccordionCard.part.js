import * as React from 'react';
import styled, { themed, css } from '../../utils/styled';
import { distance } from '../../distance';
import { List } from '../List';
import { ListItem } from '../ListItem';
import { normalizeIndex, toggleIndex, hasIndex } from '../AccordionTable/helpers/indexHelper';
import { getFontStyle } from '../../textStyles';
const animationDuration = '0.3s';
const animationFunction = 'cubic-bezier(0, 0, 0.25, 1)';
const StyledList = styled(List) `
  overflow: visible;
`;
const StyledListItem = styled(ListItem) `
  padding: 0;
  margin-bottom: ${distance.xlarge};
  border: none;

  &:last-child {
    margin-bottom: 0;
  }
`;
const Container = styled.div `
  ${getFontStyle({ size: 'medium' })}

  position: relative;
  color: ${themed(({ theme }) => theme.text1)};
`;
const ContentContainer = styled.div(themed(({ open, theme: { ui1, ui2, ui4, ui5 } }) => css `
      ${getFontStyle({ size: 'small' })}

      padding: ${distance.medium};
      background: ${open ? ui2 : ui1};
      border: 1px solid ${open ? ui5 : ui4};
      border-bottom: ${open ? `1px solid ${ui4}` : 'none'};
    `));
const DetailsContainerAnimator = styled('div') `
  transition: all ${animationDuration} ${animationFunction};
  max-height: ${({ open }) => (open ? '10000px' : '0')};
  opacity: ${({ open }) => (open ? '1' : '0')};
  overflow: hidden;
`;
const DetailsContainer = styled.div(themed(({ open, theme: { ui4, ui5 } }) => css `
      border-right: 1px solid ${open ? ui5 : ui4};
      border-left: 1px solid ${open ? ui5 : ui4};
    `));
const ActionContainer = styled.div(themed(({ open, theme: { ui0, ui1 } }) => css `
      text-align: center;
      padding: ${distance.small} ${distance.medium};
      cursor: pointer;
      background: ${open ? ui1 : ui0};
      border: ${open ? `1px solid ${ui0}` : 'none'};
      color: ${open ? ui0 : ui1};
    `));
export class AccordionCard extends React.Component {
    constructor(props) {
        super(props);
        this.selects = [];
        this.state = {
            selectedIndexes: props.selectedIndex !== undefined
                ? normalizeIndex(props.selectedIndex)
                : normalizeIndex(props.defaultSelectedIndex),
            controlled: props.selectedIndex !== undefined,
        };
    }
    static getDerivedStateFromProps(props, state) {
        const { selectedIndex, defaultSelectedIndex } = props;
        if (state.controlled && selectedIndex !== undefined) {
            return {
                selectedIndexes: normalizeIndex(selectedIndex),
            };
        }
        else if (defaultSelectedIndex !== undefined) {
            return {
                selectedIndexes: normalizeIndex(defaultSelectedIndex),
            };
        }
        return state;
    }
    changeIndex(target) {
        const { onChange, multiple } = this.props;
        const { controlled, selectedIndexes } = this.state;
        const nextIndexes = toggleIndex(selectedIndexes, target, multiple);
        if (typeof onChange === 'function') {
            onChange({
                selectedIndex: multiple ? nextIndexes : nextIndexes[0] !== undefined ? nextIndexes[0] : -1,
                previousIndex: multiple ? selectedIndexes : selectedIndexes[0] !== undefined ? selectedIndexes[0] : -1,
            });
        }
        if (!controlled) {
            this.setState({
                selectedIndexes: nextIndexes,
            });
        }
    }
    render() {
        const { selectedIndexes } = this.state;
        const { children, theme, onChange: _0, selectedIndex: _1, openLabel, closeLabel } = this.props;
        const items = [];
        const selects = this.selects;
        React.Children.forEach(children, (element, index) => {
            if (element && React.isValidElement(element)) {
                const { header } = element.props;
                const open = hasIndex(selectedIndexes, index);
                if (selects[index] === undefined) {
                    selects[index] = () => this.changeIndex(index);
                }
                items.push(React.createElement(StyledListItem, { theme: theme, key: `item-${index}` },
                    React.createElement(Container, { theme: theme },
                        React.createElement(ContentContainer, { theme: theme, open: open }, header),
                        React.createElement(DetailsContainerAnimator, { open: open },
                            React.createElement(DetailsContainer, { open: open }, element)),
                        React.createElement(ActionContainer, { theme: theme, onClick: selects[index], open: open }, open ? closeLabel || 'Close Details' : openLabel || 'Open Details'))));
            }
        });
        return React.createElement(StyledList, { borderless: true }, items);
    }
}
AccordionCard.inner = {
    get StyledListItem() { return StyledListItem; },
    get Container() { return Container; },
    get ContentContainer() { return ContentContainer; },
    get DetailsContainerAnimator() { return DetailsContainerAnimator; },
    get DetailsContainer() { return DetailsContainer; },
    get ActionContainer() { return ActionContainer; },
    get StyledList() { return StyledList; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjb3JkaW9uQ2FyZC5wYXJ0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvQWNjb3JkaW9uL0FjY29yZGlvbkNhcmQucGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDL0IsT0FBTyxNQUFNLEVBQUUsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFekQsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDL0IsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN2QyxPQUFPLEVBQUUsY0FBYyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUM5RixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFlaEQsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUM7QUFDakMsTUFBTSxpQkFBaUIsR0FBRyw2QkFBNkIsQ0FBQztBQUN4RCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7O0NBRS9CLENBQUM7QUFDRixNQUFNLGNBQWMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7O21CQUVyQixRQUFRLENBQUMsTUFBTTs7Ozs7O0NBTWpDLENBQUM7QUFDRixNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO0lBQ3pCLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQzs7O1dBR3pCLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7Q0FDNUMsQ0FBQztBQUNGLE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBYyxNQUFNLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUM7UUFDakcsWUFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDOztpQkFFdEIsUUFBUSxDQUFDLE1BQU07b0JBQ1osSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUc7MEJBQ1YsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUc7dUJBQ25CLElBQUksQ0FBQyxDQUFDLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTTtLQUNwRCxDQUFDLENBQUMsQ0FBQztBQUNSLE1BQU0sd0JBQXdCLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFjO29CQUN4QyxpQkFBaUIsSUFBSSxpQkFBaUI7Z0JBQzFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO2FBQ3pDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDOztDQUU1QyxDQUFDO0FBQ0YsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFjLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUM7Z0NBQy9ELElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHOytCQUNqQixJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRztLQUMxQyxDQUFDLENBQUMsQ0FBQztBQUNSLE1BQU0sZUFBZSxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQWMsTUFBTSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQzs7aUJBRTdFLFFBQVEsQ0FBQyxLQUFLLElBQUksUUFBUSxDQUFDLE1BQU07O29CQUU5QixJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRztnQkFDcEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxhQUFhLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNO2VBQ25DLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHO0tBQzFCLENBQUMsQ0FBQyxDQUFDO0FBQ1IsTUFBTSxPQUFPLGFBQWMsU0FBUSxLQUFLLENBQUMsU0FBNkM7SUFFbEYsWUFBWSxLQUFxQjtRQUM3QixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFGVCxZQUFPLEdBQXNCLEVBQUUsQ0FBQztRQUdwQyxJQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1QsZUFBZSxFQUFFLEtBQUssQ0FBQyxhQUFhLEtBQUssU0FBUztnQkFDOUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDO2dCQUNyQyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQztZQUNoRCxVQUFVLEVBQUUsS0FBSyxDQUFDLGFBQWEsS0FBSyxTQUFTO1NBQ2hELENBQUM7SUFDTixDQUFDO0lBQ0QsTUFBTSxDQUFDLHdCQUF3QixDQUFDLEtBQXFCLEVBQUUsS0FBeUI7UUFDNUUsTUFBTSxFQUFFLGFBQWEsRUFBRSxvQkFBb0IsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUN0RCxJQUFJLEtBQUssQ0FBQyxVQUFVLElBQUksYUFBYSxLQUFLLFNBQVMsRUFBRTtZQUNqRCxPQUFPO2dCQUNILGVBQWUsRUFBRSxjQUFjLENBQUMsYUFBYSxDQUFDO2FBQ2pELENBQUM7U0FDTDthQUNJLElBQUksb0JBQW9CLEtBQUssU0FBUyxFQUFFO1lBQ3pDLE9BQU87Z0JBQ0gsZUFBZSxFQUFFLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQzthQUN4RCxDQUFDO1NBQ0w7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBQ08sV0FBVyxDQUFDLE1BQWM7UUFDOUIsTUFBTSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQzFDLE1BQU0sRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNuRCxNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsZUFBZSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNuRSxJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRTtZQUNoQyxRQUFRLENBQUM7Z0JBQ0wsYUFBYSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUYsYUFBYSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN6RyxDQUFDLENBQUM7U0FDTjtRQUNELElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDYixJQUFJLENBQUMsUUFBUSxDQUFDO2dCQUNWLGVBQWUsRUFBRSxXQUFXO2FBQy9CLENBQUMsQ0FBQztTQUNOO0lBQ0wsQ0FBQztJQUNELE1BQU07UUFDRixNQUFNLEVBQUUsZUFBZSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN2QyxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDL0YsTUFBTSxLQUFLLEdBQTRCLEVBQUUsQ0FBQztRQUMxQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQzdCLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQThDLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDdkYsSUFBSSxPQUFPLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsRUFBRTtnQkFDMUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7Z0JBQ2pDLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQzlDLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLFNBQVMsRUFBRTtvQkFDOUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2xEO2dCQUNELEtBQUssQ0FBQyxJQUFJLENBQUMsb0JBQUMsY0FBYyxJQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLFFBQVEsS0FBSyxFQUFFO29CQUNqRSxvQkFBQyxTQUFTLElBQUMsS0FBSyxFQUFFLEtBQUs7d0JBQ3JCLG9CQUFDLGdCQUFnQixJQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksSUFDdkMsTUFBTSxDQUNVO3dCQUVuQixvQkFBQyx3QkFBd0IsSUFBQyxJQUFJLEVBQUUsSUFBSTs0QkFDbEMsb0JBQUMsZ0JBQWdCLElBQUMsSUFBSSxFQUFFLElBQUksSUFBRyxPQUFPLENBQW9CLENBQ2pDO3dCQUUzQixvQkFBQyxlQUFlLElBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLElBQy9ELElBQUksQ0FBQyxDQUFDLENBQUMsVUFBVSxJQUFJLGVBQWUsQ0FBQyxDQUFDLENBQUMsU0FBUyxJQUFJLGNBQWMsQ0FDbkQsQ0FDUixDQUNHLENBQUMsQ0FBQzthQUNoQjtRQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxvQkFBQyxVQUFVLElBQUMsVUFBVSxVQUFFLEtBQUssQ0FBYyxDQUFDO0lBQ3ZELENBQUM7O0FBQ00sbUJBQUssR0FBRztJQUNYLElBQUksY0FBYyxLQUFLLE9BQU8sY0FBdUMsQ0FBQyxDQUFDLENBQUM7SUFDeEUsSUFBSSxTQUFTLEtBQUssT0FBTyxTQUE2QixDQUFDLENBQUMsQ0FBQztJQUN6RCxJQUFJLGdCQUFnQixLQUFLLE9BQU8sZ0JBQTJDLENBQUMsQ0FBQyxDQUFDO0lBQzlFLElBQUksd0JBQXdCLEtBQUssT0FBTyx3QkFBMkQsQ0FBQyxDQUFDLENBQUM7SUFDdEcsSUFBSSxnQkFBZ0IsS0FBSyxPQUFPLGdCQUEyQyxDQUFDLENBQUMsQ0FBQztJQUM5RSxJQUFJLGVBQWUsS0FBSyxPQUFPLGVBQXlDLENBQUMsQ0FBQyxDQUFDO0lBQzNFLElBQUksVUFBVSxLQUFLLE9BQU8sVUFBK0IsQ0FBQyxDQUFDLENBQUM7Q0FDL0QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkLCBjc3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgQWNjb3JkaW9uUHJvcHMgfSBmcm9tICcuL0FjY29yZGlvbi50eXBlcy5wYXJ0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgQWNjb3JkaW9uVGFiUHJvcHMgfSBmcm9tICcuLi9BY2NvcmRpb25UYWInO1xuaW1wb3J0IHsgTGlzdCB9IGZyb20gJy4uL0xpc3QnO1xuaW1wb3J0IHsgTGlzdEl0ZW0gfSBmcm9tICcuLi9MaXN0SXRlbSc7XG5pbXBvcnQgeyBub3JtYWxpemVJbmRleCwgdG9nZ2xlSW5kZXgsIGhhc0luZGV4IH0gZnJvbSAnLi4vQWNjb3JkaW9uVGFibGUvaGVscGVycy9pbmRleEhlbHBlcic7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmV4cG9ydCBpbnRlcmZhY2UgQWNjb3JkaW9uQ2FyZFN0YXRlIHtcbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIGluZGljZXMuXG4gICAgICovXG4gICAgc2VsZWN0ZWRJbmRleGVzOiBBcnJheTxudW1iZXI+O1xuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIGFjY29yZGlvbiB0YWJsZSBjb21wb25lbnQgaXMgY29udHJvbGxlZCBmcm9tIHRoZSBvdXRzaWRlIG9yIG5vdC5cbiAgICAgKi9cbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIEFjdGl2ZVByb3BzIHtcbiAgICBvcGVuPzogYm9vbGVhbjtcbiAgICBvbkNsaWNrPyhlOiBSZWFjdC5Nb3VzZUV2ZW50KTogdm9pZDtcbn1cbmNvbnN0IGFuaW1hdGlvbkR1cmF0aW9uID0gJzAuM3MnO1xuY29uc3QgYW5pbWF0aW9uRnVuY3Rpb24gPSAnY3ViaWMtYmV6aWVyKDAsIDAsIDAuMjUsIDEpJztcbmNvbnN0IFN0eWxlZExpc3QgPSBzdHlsZWQoTGlzdCkgYFxuICBvdmVyZmxvdzogdmlzaWJsZTtcbmA7XG5jb25zdCBTdHlsZWRMaXN0SXRlbSA9IHN0eWxlZChMaXN0SXRlbSkgYFxuICBwYWRkaW5nOiAwO1xuICBtYXJnaW4tYm90dG9tOiAke2Rpc3RhbmNlLnhsYXJnZX07XG4gIGJvcmRlcjogbm9uZTtcblxuICAmOmxhc3QtY2hpbGQge1xuICAgIG1hcmdpbi1ib3R0b206IDA7XG4gIH1cbmA7XG5jb25zdCBDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnbWVkaXVtJyB9KX1cblxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGNvbG9yOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS50ZXh0MSl9O1xuYDtcbmNvbnN0IENvbnRlbnRDb250YWluZXIgPSBzdHlsZWQuZGl2PEFjdGl2ZVByb3BzPih0aGVtZWQoKHsgb3BlbiwgdGhlbWU6IHsgdWkxLCB1aTIsIHVpNCwgdWk1IH0gfSkgPT4gY3NzIGBcbiAgICAgICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ3NtYWxsJyB9KX1cblxuICAgICAgcGFkZGluZzogJHtkaXN0YW5jZS5tZWRpdW19O1xuICAgICAgYmFja2dyb3VuZDogJHtvcGVuID8gdWkyIDogdWkxfTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7b3BlbiA/IHVpNSA6IHVpNH07XG4gICAgICBib3JkZXItYm90dG9tOiAke29wZW4gPyBgMXB4IHNvbGlkICR7dWk0fWAgOiAnbm9uZSd9O1xuICAgIGApKTtcbmNvbnN0IERldGFpbHNDb250YWluZXJBbmltYXRvciA9IHN0eWxlZCgnZGl2Jyk8QWN0aXZlUHJvcHM+IGBcbiAgdHJhbnNpdGlvbjogYWxsICR7YW5pbWF0aW9uRHVyYXRpb259ICR7YW5pbWF0aW9uRnVuY3Rpb259O1xuICBtYXgtaGVpZ2h0OiAkeyh7IG9wZW4gfSkgPT4gKG9wZW4gPyAnMTAwMDBweCcgOiAnMCcpfTtcbiAgb3BhY2l0eTogJHsoeyBvcGVuIH0pID0+IChvcGVuID8gJzEnIDogJzAnKX07XG4gIG92ZXJmbG93OiBoaWRkZW47XG5gO1xuY29uc3QgRGV0YWlsc0NvbnRhaW5lciA9IHN0eWxlZC5kaXY8QWN0aXZlUHJvcHM+KHRoZW1lZCgoeyBvcGVuLCB0aGVtZTogeyB1aTQsIHVpNSB9IH0pID0+IGNzcyBgXG4gICAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAke29wZW4gPyB1aTUgOiB1aTR9O1xuICAgICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAke29wZW4gPyB1aTUgOiB1aTR9O1xuICAgIGApKTtcbmNvbnN0IEFjdGlvbkNvbnRhaW5lciA9IHN0eWxlZC5kaXY8QWN0aXZlUHJvcHM+KHRoZW1lZCgoeyBvcGVuLCB0aGVtZTogeyB1aTAsIHVpMSB9IH0pID0+IGNzcyBgXG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBwYWRkaW5nOiAke2Rpc3RhbmNlLnNtYWxsfSAke2Rpc3RhbmNlLm1lZGl1bX07XG4gICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICBiYWNrZ3JvdW5kOiAke29wZW4gPyB1aTEgOiB1aTB9O1xuICAgICAgYm9yZGVyOiAke29wZW4gPyBgMXB4IHNvbGlkICR7dWkwfWAgOiAnbm9uZSd9O1xuICAgICAgY29sb3I6ICR7b3BlbiA/IHVpMCA6IHVpMX07XG4gICAgYCkpO1xuZXhwb3J0IGNsYXNzIEFjY29yZGlvbkNhcmQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8QWNjb3JkaW9uUHJvcHMsIEFjY29yZGlvbkNhcmRTdGF0ZT4ge1xuICAgIHByaXZhdGUgc2VsZWN0czogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogQWNjb3JkaW9uUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICA/IG5vcm1hbGl6ZUluZGV4KHByb3BzLnNlbGVjdGVkSW5kZXgpXG4gICAgICAgICAgICAgICAgOiBub3JtYWxpemVJbmRleChwcm9wcy5kZWZhdWx0U2VsZWN0ZWRJbmRleCksXG4gICAgICAgICAgICBjb250cm9sbGVkOiBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHM6IEFjY29yZGlvblByb3BzLCBzdGF0ZTogQWNjb3JkaW9uQ2FyZFN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRJbmRleCwgZGVmYXVsdFNlbGVjdGVkSW5kZXggfSA9IHByb3BzO1xuICAgICAgICBpZiAoc3RhdGUuY29udHJvbGxlZCAmJiBzZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBub3JtYWxpemVJbmRleChzZWxlY3RlZEluZGV4KSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGVmYXVsdFNlbGVjdGVkSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4ZXM6IG5vcm1hbGl6ZUluZGV4KGRlZmF1bHRTZWxlY3RlZEluZGV4KSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZUluZGV4KHRhcmdldDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIG11bHRpcGxlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQsIHNlbGVjdGVkSW5kZXhlcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgbmV4dEluZGV4ZXMgPSB0b2dnbGVJbmRleChzZWxlY3RlZEluZGV4ZXMsIHRhcmdldCwgbXVsdGlwbGUpO1xuICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogbXVsdGlwbGUgPyBuZXh0SW5kZXhlcyA6IG5leHRJbmRleGVzWzBdICE9PSB1bmRlZmluZWQgPyBuZXh0SW5kZXhlc1swXSA6IC0xLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzSW5kZXg6IG11bHRpcGxlID8gc2VsZWN0ZWRJbmRleGVzIDogc2VsZWN0ZWRJbmRleGVzWzBdICE9PSB1bmRlZmluZWQgPyBzZWxlY3RlZEluZGV4ZXNbMF0gOiAtMSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBuZXh0SW5kZXhlcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZEluZGV4ZXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW4sIHRoZW1lLCBvbkNoYW5nZTogXzAsIHNlbGVjdGVkSW5kZXg6IF8xLCBvcGVuTGFiZWwsIGNsb3NlTGFiZWwgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGl0ZW1zOiBBcnJheTxSZWFjdC5SZWFjdENoaWxkPiA9IFtdO1xuICAgICAgICBjb25zdCBzZWxlY3RzID0gdGhpcy5zZWxlY3RzO1xuICAgICAgICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoZWxlbWVudDogUmVhY3QuUmVhY3RFbGVtZW50PEFjY29yZGlvblRhYlByb3BzPiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIFJlYWN0LmlzVmFsaWRFbGVtZW50KGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBoZWFkZXIgfSA9IGVsZW1lbnQucHJvcHM7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3BlbiA9IGhhc0luZGV4KHNlbGVjdGVkSW5kZXhlcywgaW5kZXgpO1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdHNbaW5kZXhdID0gKCkgPT4gdGhpcy5jaGFuZ2VJbmRleChpbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goPFN0eWxlZExpc3RJdGVtIHRoZW1lPXt0aGVtZX0ga2V5PXtgaXRlbS0ke2luZGV4fWB9PlxuICAgICAgICAgICAgPENvbnRhaW5lciB0aGVtZT17dGhlbWV9PlxuICAgICAgICAgICAgICA8Q29udGVudENvbnRhaW5lciB0aGVtZT17dGhlbWV9IG9wZW49e29wZW59PlxuICAgICAgICAgICAgICAgIHtoZWFkZXJ9XG4gICAgICAgICAgICAgIDwvQ29udGVudENvbnRhaW5lcj5cblxuICAgICAgICAgICAgICA8RGV0YWlsc0NvbnRhaW5lckFuaW1hdG9yIG9wZW49e29wZW59PlxuICAgICAgICAgICAgICAgIDxEZXRhaWxzQ29udGFpbmVyIG9wZW49e29wZW59PntlbGVtZW50fTwvRGV0YWlsc0NvbnRhaW5lcj5cbiAgICAgICAgICAgICAgPC9EZXRhaWxzQ29udGFpbmVyQW5pbWF0b3I+XG5cbiAgICAgICAgICAgICAgPEFjdGlvbkNvbnRhaW5lciB0aGVtZT17dGhlbWV9IG9uQ2xpY2s9e3NlbGVjdHNbaW5kZXhdfSBvcGVuPXtvcGVufT5cbiAgICAgICAgICAgICAgICB7b3BlbiA/IGNsb3NlTGFiZWwgfHwgJ0Nsb3NlIERldGFpbHMnIDogb3BlbkxhYmVsIHx8ICdPcGVuIERldGFpbHMnfVxuICAgICAgICAgICAgICA8L0FjdGlvbkNvbnRhaW5lcj5cbiAgICAgICAgICAgIDwvQ29udGFpbmVyPlxuICAgICAgICAgIDwvU3R5bGVkTGlzdEl0ZW0+KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiA8U3R5bGVkTGlzdCBib3JkZXJsZXNzPntpdGVtc308L1N0eWxlZExpc3Q+O1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWRMaXN0SXRlbSgpIHsgcmV0dXJuIFN0eWxlZExpc3RJdGVtIGFzIHR5cGVvZiBTdHlsZWRMaXN0SXRlbTsgfSxcbiAgICAgICAgZ2V0IENvbnRhaW5lcigpIHsgcmV0dXJuIENvbnRhaW5lciBhcyB0eXBlb2YgQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgQ29udGVudENvbnRhaW5lcigpIHsgcmV0dXJuIENvbnRlbnRDb250YWluZXIgYXMgdHlwZW9mIENvbnRlbnRDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBEZXRhaWxzQ29udGFpbmVyQW5pbWF0b3IoKSB7IHJldHVybiBEZXRhaWxzQ29udGFpbmVyQW5pbWF0b3IgYXMgdHlwZW9mIERldGFpbHNDb250YWluZXJBbmltYXRvcjsgfSxcbiAgICAgICAgZ2V0IERldGFpbHNDb250YWluZXIoKSB7IHJldHVybiBEZXRhaWxzQ29udGFpbmVyIGFzIHR5cGVvZiBEZXRhaWxzQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgQWN0aW9uQ29udGFpbmVyKCkgeyByZXR1cm4gQWN0aW9uQ29udGFpbmVyIGFzIHR5cGVvZiBBY3Rpb25Db250YWluZXI7IH0sXG4gICAgICAgIGdldCBTdHlsZWRMaXN0KCkgeyByZXR1cm4gU3R5bGVkTGlzdCBhcyB0eXBlb2YgU3R5bGVkTGlzdDsgfVxuICAgIH07XG59XG4iXX0=