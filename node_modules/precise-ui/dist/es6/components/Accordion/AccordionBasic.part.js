import * as React from 'react';
import styled, { themed } from '../../utils/styled';
import { Icon } from '../Icon';
import { remCalc } from '../../utils/remCalc';
import { distance } from '../../distance';
import { normalizeIndex, toggleIndex, hasIndex } from '../AccordionTable/helpers/indexHelper';
import { Expander } from '../Expander';
import { getFontStyle } from '../../textStyles';
const animationDuration = '0.3s';
const animationFunction = 'cubic-bezier(0, 0, 0.25, 1)';
const AccordionContainer = styled.div ``;
const AccordionItems = styled.ul `
  padding: 0;
  list-style: none;
`;
const AccordionItem = styled.li `
  ${getFontStyle({ size: 'small' })}

  position: relative;
  z-index: 1;
  margin: 0;
  text-align: left;
  overflow: visible;
  border-top: ${themed(({ theme }) => theme.accordionLine)};
  box-sizing: border-box;
  color: ${themed(({ theme }) => theme.text1)};

  &:last-child {
    border-bottom: ${themed(({ theme }) => theme.accordionLine)};
  }
`;
const AccordionItemHeaderContainer = styled('div') `
  transition: background-color ${animationDuration} ${animationFunction};
  background-color: ${themed(props => (props.active ? props.theme.ui2 : props.theme.ui1))};
`;
const AccordionItemHeader = styled.div `
  display: flex;
  white-space: pre-wrap;
  align-items: center;
  cursor: pointer;
  padding: ${themed(({ theme }) => theme.accordionPadding)};
`;
const StyledIcon = styled(Icon) `
  font-size: ${remCalc('18px')};
  margin-right: ${distance.medium};
  transition: transform 0.2s ${animationFunction};
  transform: ${({ isRotated }) => `rotate(${isRotated ? 90 : 0}deg)`};
`;
const AccordionItemContent = styled.div `
  padding: ${themed(({ theme }) => theme.accordionContentPadding)};
`;
export class AccordionBasic extends React.Component {
    constructor(props) {
        super(props);
        this.selects = [];
        this.state = {
            selectedIndexes: props.selectedIndex !== undefined
                ? normalizeIndex(props.selectedIndex)
                : normalizeIndex(props.defaultSelectedIndex),
            controlled: props.selectedIndex !== undefined,
        };
    }
    componentDidMount() {
        const { defaultSelectedIndex } = this.props;
        if (defaultSelectedIndex) {
            this.setState({
                selectedIndexes: normalizeIndex(defaultSelectedIndex),
            });
        }
    }
    static getDerivedStateFromProps(props, state) {
        const { selectedIndex } = props;
        if (state.controlled && selectedIndex !== undefined) {
            return {
                selectedIndexes: normalizeIndex(selectedIndex),
            };
        }
        return state;
    }
    changeIndex(target) {
        const { onChange, multiple } = this.props;
        const { controlled, selectedIndexes } = this.state;
        const nextIndexes = toggleIndex(selectedIndexes, target, multiple);
        if (typeof onChange === 'function') {
            onChange({
                selectedIndex: multiple ? nextIndexes : nextIndexes[0] !== undefined ? nextIndexes[0] : -1,
                previousIndex: multiple ? selectedIndexes : selectedIndexes[0] !== undefined ? selectedIndexes[0] : -1,
            });
        }
        if (!controlled) {
            this.setState({
                selectedIndexes: nextIndexes,
            });
        }
    }
    render() {
        const { selectedIndexes } = this.state;
        const { children, theme, onChange: _0, selectedIndex: _1 } = this.props;
        const items = [];
        const selects = this.selects;
        React.Children.forEach(children, (element, index) => {
            if (element && React.isValidElement(element)) {
                const { header } = element.props;
                const active = hasIndex(selectedIndexes, index);
                if (selects[index] === undefined) {
                    selects[index] = () => this.changeIndex(index);
                }
                items.push(React.createElement(AccordionItem, { theme: theme, key: `item-${index}` },
                    React.createElement(AccordionItemHeaderContainer, { active: active },
                        React.createElement(AccordionItemHeader, { theme: theme, onClick: selects[index] },
                            React.createElement(StyledIcon, { isRotated: active, name: "KeyboardArrowRight" }),
                            header)),
                    React.createElement(Expander, { expand: active, timeout: 300, unmountOnExit: true },
                        React.createElement(AccordionItemContent, { theme: theme }, element))));
            }
        });
        return (React.createElement(AccordionContainer, null,
            React.createElement(AccordionItems, { theme: theme }, items)));
    }
}
AccordionBasic.inner = {
    get AccordionItem() { return AccordionItem; },
    get AccordionItemHeaderContainer() { return AccordionItemHeaderContainer; },
    get AccordionItemHeader() { return AccordionItemHeader; },
    get StyledIcon() { return StyledIcon; },
    get Expander() { return Expander; },
    get AccordionItemContent() { return AccordionItemContent; },
    get AccordionContainer() { return AccordionContainer; },
    get AccordionItems() { return AccordionItems; }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjb3JkaW9uQmFzaWMucGFydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0FjY29yZGlvbi9BY2NvcmRpb25CYXNpYy5wYXJ0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUMvQixPQUFPLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXBELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFDL0IsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUUxQyxPQUFPLEVBQUUsY0FBYyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUM5RixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQWlCaEQsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUM7QUFDakMsTUFBTSxpQkFBaUIsR0FBRyw2QkFBNkIsQ0FBQztBQUN4RCxNQUFNLGtCQUFrQixHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO0FBQ3pDLE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUM7OztDQUdoQyxDQUFDO0FBQ0YsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUM1QixZQUFZLENBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUM7Ozs7Ozs7Z0JBT25CLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUM7O1dBRS9DLE1BQU0sQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLEVB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VUFBVSxLQUFLLE9BQU8sVUFBK0IsQ0FBQyxDQUFDLENBQUM7SUFDNUQsSUFBSSxRQUFRLEtBQUssT0FBTyxRQUEyQixDQUFDLENBQUMsQ0FBQztJQUN0RCxJQUFJLG9CQUFvQixLQUFLLE9BQU8sb0JBQW1ELENBQUMsQ0FBQyxDQUFDO0lBQzFGLElBQUksa0JBQWtCLEtBQUssT0FBTyxrQkFBK0MsQ0FBQyxDQUFDLENBQUM7SUFDcEYsSUFBSSxjQUFjLEtBQUssT0FBTyxjQUF1QyxDQUFDLENBQUMsQ0FBQztDQUMzRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwgeyB0aGVtZWQgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgQWNjb3JkaW9uVGFiUHJvcHMgfSBmcm9tICcuLi9BY2NvcmRpb25UYWInO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgcmVtQ2FsYyB9IGZyb20gJy4uLy4uL3V0aWxzL3JlbUNhbGMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBBY2NvcmRpb25Qcm9wcyB9IGZyb20gJy4vQWNjb3JkaW9uLnR5cGVzLnBhcnQnO1xuaW1wb3J0IHsgbm9ybWFsaXplSW5kZXgsIHRvZ2dsZUluZGV4LCBoYXNJbmRleCB9IGZyb20gJy4uL0FjY29yZGlvblRhYmxlL2hlbHBlcnMvaW5kZXhIZWxwZXInO1xuaW1wb3J0IHsgRXhwYW5kZXIgfSBmcm9tICcuLi9FeHBhbmRlcic7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmV4cG9ydCBpbnRlcmZhY2UgQWNjb3JkaW9uQmFzaWNTdGF0ZSB7XG4gICAgLyoqXG4gICAgICogVGhlIGN1cnJlbnRseSBzZWxlY3RlZCBpbmRpY2VzLlxuICAgICAqL1xuICAgIHNlbGVjdGVkSW5kZXhlczogQXJyYXk8bnVtYmVyPjtcbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIHRoZSBhY2NvcmRpb24gY29tcG9uZW50IGlzIGNvbnRyb2xsZWQgZnJvbSB0aGUgb3V0c2lkZSBvciBub3QuXG4gICAgICovXG4gICAgY29udHJvbGxlZDogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBBY2NvcmRpb25JdGVtUHJvcHMge1xuICAgIGFjdGl2ZT86IGJvb2xlYW47XG59XG5pbnRlcmZhY2UgU3R5bGVkQXJyb3dQcm9wcyB7XG4gICAgaXNSb3RhdGVkOiBib29sZWFuO1xufVxuY29uc3QgYW5pbWF0aW9uRHVyYXRpb24gPSAnMC4zcyc7XG5jb25zdCBhbmltYXRpb25GdW5jdGlvbiA9ICdjdWJpYy1iZXppZXIoMCwgMCwgMC4yNSwgMSknO1xuY29uc3QgQWNjb3JkaW9uQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgYDtcbmNvbnN0IEFjY29yZGlvbkl0ZW1zID0gc3R5bGVkLnVsIGBcbiAgcGFkZGluZzogMDtcbiAgbGlzdC1zdHlsZTogbm9uZTtcbmA7XG5jb25zdCBBY2NvcmRpb25JdGVtID0gc3R5bGVkLmxpIGBcbiAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnc21hbGwnIH0pfVxuXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgei1pbmRleDogMTtcbiAgbWFyZ2luOiAwO1xuICB0ZXh0LWFsaWduOiBsZWZ0O1xuICBvdmVyZmxvdzogdmlzaWJsZTtcbiAgYm9yZGVyLXRvcDogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUuYWNjb3JkaW9uTGluZSl9O1xuICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICBjb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDEpfTtcblxuICAmOmxhc3QtY2hpbGQge1xuICAgIGJvcmRlci1ib3R0b206ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLmFjY29yZGlvbkxpbmUpfTtcbiAgfVxuYDtcbmNvbnN0IEFjY29yZGlvbkl0ZW1IZWFkZXJDb250YWluZXIgPSBzdHlsZWQoJ2RpdicpPEFjY29yZGlvbkl0ZW1Qcm9wcz4gYFxuICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kLWNvbG9yICR7YW5pbWF0aW9uRHVyYXRpb259ICR7YW5pbWF0aW9uRnVuY3Rpb259O1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAke3RoZW1lZChwcm9wcyA9PiAocHJvcHMuYWN0aXZlID8gcHJvcHMudGhlbWUudWkyIDogcHJvcHMudGhlbWUudWkxKSl9O1xuYDtcbmNvbnN0IEFjY29yZGlvbkl0ZW1IZWFkZXIgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAgd2hpdGUtc3BhY2U6IHByZS13cmFwO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIHBhZGRpbmc6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLmFjY29yZGlvblBhZGRpbmcpfTtcbmA7XG5jb25zdCBTdHlsZWRJY29uID0gc3R5bGVkKEljb24pPFN0eWxlZEFycm93UHJvcHM+IGBcbiAgZm9udC1zaXplOiAke3JlbUNhbGMoJzE4cHgnKX07XG4gIG1hcmdpbi1yaWdodDogJHtkaXN0YW5jZS5tZWRpdW19O1xuICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4ycyAke2FuaW1hdGlvbkZ1bmN0aW9ufTtcbiAgdHJhbnNmb3JtOiAkeyh7IGlzUm90YXRlZCB9KSA9PiBgcm90YXRlKCR7aXNSb3RhdGVkID8gOTAgOiAwfWRlZylgfTtcbmA7XG5jb25zdCBBY2NvcmRpb25JdGVtQ29udGVudCA9IHN0eWxlZC5kaXYgYFxuICBwYWRkaW5nOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS5hY2NvcmRpb25Db250ZW50UGFkZGluZyl9O1xuYDtcbmV4cG9ydCBjbGFzcyBBY2NvcmRpb25CYXNpYyBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxBY2NvcmRpb25Qcm9wcywgQWNjb3JkaW9uQmFzaWNTdGF0ZT4ge1xuICAgIHByaXZhdGUgc2VsZWN0czogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogQWNjb3JkaW9uUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICA/IG5vcm1hbGl6ZUluZGV4KHByb3BzLnNlbGVjdGVkSW5kZXgpXG4gICAgICAgICAgICAgICAgOiBub3JtYWxpemVJbmRleChwcm9wcy5kZWZhdWx0U2VsZWN0ZWRJbmRleCksXG4gICAgICAgICAgICBjb250cm9sbGVkOiBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGRlZmF1bHRTZWxlY3RlZEluZGV4IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoZGVmYXVsdFNlbGVjdGVkSW5kZXgpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXhlczogbm9ybWFsaXplSW5kZXgoZGVmYXVsdFNlbGVjdGVkSW5kZXgpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wczogQWNjb3JkaW9uUHJvcHMsIHN0YXRlOiBBY2NvcmRpb25CYXNpY1N0YXRlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRJbmRleCB9ID0gcHJvcHM7XG4gICAgICAgIGlmIChzdGF0ZS5jb250cm9sbGVkICYmIHNlbGVjdGVkSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4ZXM6IG5vcm1hbGl6ZUluZGV4KHNlbGVjdGVkSW5kZXgpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgfVxuICAgIHByaXZhdGUgY2hhbmdlSW5kZXgodGFyZ2V0OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgbXVsdGlwbGUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCwgc2VsZWN0ZWRJbmRleGVzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBuZXh0SW5kZXhlcyA9IHRvZ2dsZUluZGV4KHNlbGVjdGVkSW5kZXhlcywgdGFyZ2V0LCBtdWx0aXBsZSk7XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4OiBtdWx0aXBsZSA/IG5leHRJbmRleGVzIDogbmV4dEluZGV4ZXNbMF0gIT09IHVuZGVmaW5lZCA/IG5leHRJbmRleGVzWzBdIDogLTEsXG4gICAgICAgICAgICAgICAgcHJldmlvdXNJbmRleDogbXVsdGlwbGUgPyBzZWxlY3RlZEluZGV4ZXMgOiBzZWxlY3RlZEluZGV4ZXNbMF0gIT09IHVuZGVmaW5lZCA/IHNlbGVjdGVkSW5kZXhlc1swXSA6IC0xLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4ZXM6IG5leHRJbmRleGVzLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkSW5kZXhlcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBjaGlsZHJlbiwgdGhlbWUsIG9uQ2hhbmdlOiBfMCwgc2VsZWN0ZWRJbmRleDogXzEgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGl0ZW1zOiBBcnJheTxSZWFjdC5SZWFjdENoaWxkPiA9IFtdO1xuICAgICAgICBjb25zdCBzZWxlY3RzID0gdGhpcy5zZWxlY3RzO1xuICAgICAgICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoZWxlbWVudDogUmVhY3QuUmVhY3RFbGVtZW50PEFjY29yZGlvblRhYlByb3BzPiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIFJlYWN0LmlzVmFsaWRFbGVtZW50KGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBoZWFkZXIgfSA9IGVsZW1lbnQucHJvcHM7XG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlID0gaGFzSW5kZXgoc2VsZWN0ZWRJbmRleGVzLCBpbmRleCk7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdHNbaW5kZXhdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0c1tpbmRleF0gPSAoKSA9PiB0aGlzLmNoYW5nZUluZGV4KGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaXRlbXMucHVzaCg8QWNjb3JkaW9uSXRlbSB0aGVtZT17dGhlbWV9IGtleT17YGl0ZW0tJHtpbmRleH1gfT5cbiAgICAgICAgICAgIDxBY2NvcmRpb25JdGVtSGVhZGVyQ29udGFpbmVyIGFjdGl2ZT17YWN0aXZlfT5cbiAgICAgICAgICAgICAgPEFjY29yZGlvbkl0ZW1IZWFkZXIgdGhlbWU9e3RoZW1lfSBvbkNsaWNrPXtzZWxlY3RzW2luZGV4XX0+XG4gICAgICAgICAgICAgICAgPFN0eWxlZEljb24gaXNSb3RhdGVkPXthY3RpdmV9IG5hbWU9XCJLZXlib2FyZEFycm93UmlnaHRcIi8+XG4gICAgICAgICAgICAgICAge2hlYWRlcn1cbiAgICAgICAgICAgICAgPC9BY2NvcmRpb25JdGVtSGVhZGVyPlxuICAgICAgICAgICAgPC9BY2NvcmRpb25JdGVtSGVhZGVyQ29udGFpbmVyPlxuICAgICAgICAgICAgPEV4cGFuZGVyIGV4cGFuZD17YWN0aXZlfSB0aW1lb3V0PXszMDB9IHVubW91bnRPbkV4aXQ+XG4gICAgICAgICAgICAgIDxBY2NvcmRpb25JdGVtQ29udGVudCB0aGVtZT17dGhlbWV9PntlbGVtZW50fTwvQWNjb3JkaW9uSXRlbUNvbnRlbnQ+XG4gICAgICAgICAgICA8L0V4cGFuZGVyPlxuICAgICAgICAgIDwvQWNjb3JkaW9uSXRlbT4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICg8QWNjb3JkaW9uQ29udGFpbmVyPlxuICAgICAgICA8QWNjb3JkaW9uSXRlbXMgdGhlbWU9e3RoZW1lfT57aXRlbXN9PC9BY2NvcmRpb25JdGVtcz5cbiAgICAgIDwvQWNjb3JkaW9uQ29udGFpbmVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IEFjY29yZGlvbkl0ZW0oKSB7IHJldHVybiBBY2NvcmRpb25JdGVtIGFzIHR5cGVvZiBBY2NvcmRpb25JdGVtOyB9LFxuICAgICAgICBnZXQgQWNjb3JkaW9uSXRlbUhlYWRlckNvbnRhaW5lcigpIHsgcmV0dXJuIEFjY29yZGlvbkl0ZW1IZWFkZXJDb250YWluZXIgYXMgdHlwZW9mIEFjY29yZGlvbkl0ZW1IZWFkZXJDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBBY2NvcmRpb25JdGVtSGVhZGVyKCkgeyByZXR1cm4gQWNjb3JkaW9uSXRlbUhlYWRlciBhcyB0eXBlb2YgQWNjb3JkaW9uSXRlbUhlYWRlcjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZEljb24oKSB7IHJldHVybiBTdHlsZWRJY29uIGFzIHR5cGVvZiBTdHlsZWRJY29uOyB9LFxuICAgICAgICBnZXQgRXhwYW5kZXIoKSB7IHJldHVybiBFeHBhbmRlciBhcyB0eXBlb2YgRXhwYW5kZXI7IH0sXG4gICAgICAgIGdldCBBY2NvcmRpb25JdGVtQ29udGVudCgpIHsgcmV0dXJuIEFjY29yZGlvbkl0ZW1Db250ZW50IGFzIHR5cGVvZiBBY2NvcmRpb25JdGVtQ29udGVudDsgfSxcbiAgICAgICAgZ2V0IEFjY29yZGlvbkNvbnRhaW5lcigpIHsgcmV0dXJuIEFjY29yZGlvbkNvbnRhaW5lciBhcyB0eXBlb2YgQWNjb3JkaW9uQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgQWNjb3JkaW9uSXRlbXMoKSB7IHJldHVybiBBY2NvcmRpb25JdGVtcyBhcyB0eXBlb2YgQWNjb3JkaW9uSXRlbXM7IH1cbiAgICB9O1xufVxuIl19