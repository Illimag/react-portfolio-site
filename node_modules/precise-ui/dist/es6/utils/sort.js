function compareGeneralNormal(a, b) {
    return a < b;
}
function compareGeneralReverse(a, b) {
    return b < a;
}
export function compareArrayNormal(a, b) {
    // treat empty array like undefined
    const aIsUndefined = !a || a.length === 0;
    const bIsUndefined = !b || b.length === 0;
    if (aIsUndefined && bIsUndefined) {
        return false;
    }
    else {
        if (aIsUndefined) {
            return false;
        }
        else if (bIsUndefined) {
            return true;
        }
        else {
            return !!a && !!b && a < b; // double checking for not undefined is needed to satisfy typescript
        }
    }
}
function compareArrayReverse(a, b) {
    return compareArrayNormal(b, a);
}
function compareStringNormal(a, b) {
    if (!a && !b) {
        return false;
    }
    else {
        if (!a) {
            return false;
        }
        else if (!b) {
            return true;
        }
        else {
            return a.localeCompare(b) === -1;
        }
    }
}
function compareStringReverse(a, b) {
    if (!a && !b) {
        return false;
    }
    else {
        if (!b) {
            return true;
        }
        else if (!a) {
            return false;
        }
        else {
            return b.localeCompare(a) === -1;
        }
    }
}
export function compareNumberNormal(a, b) {
    if (a === b) {
        return false;
    }
    if (a === 0) {
        return !b || a < b;
    }
    if (!a) {
        return false;
    }
    if (!b && b !== 0) {
        return true;
    }
    return a < b;
}
function compareNumberReverse(a, b) {
    return compareNumberNormal(b, a);
}
function getComparer(exampleValue, reverse) {
    if (typeof exampleValue === 'string') {
        return reverse ? compareStringReverse : compareStringNormal;
    }
    if (typeof exampleValue === 'number') {
        return reverse ? compareNumberReverse : compareNumberNormal;
    }
    if (Array.isArray(exampleValue)) {
        return reverse ? compareArrayReverse : compareArrayNormal;
    }
    return reverse ? compareGeneralReverse : compareGeneralNormal;
}
function getCombinedComparer(keyValues, groupValues, reverse) {
    const hasGroups = groupValues && groupValues.length;
    const keycomparer = getComparer(keyValues.find(item => !!item), reverse);
    if (hasGroups) {
        const groupcomparer = getComparer(groupValues.find(item => !!item), false); // Group order is always ascending
        return (a, b) => groupcomparer(groupValues[a], groupValues[b]) ||
            (groupValues[a] === groupValues[b] && keycomparer(keyValues[a], keyValues[b]));
    }
    else {
        return (a, b) => keycomparer(keyValues[a], keyValues[b]);
    }
}
function sorter(indices, items, key, groupBy, reverse = false) {
    const keyValues = items.map(item => item[key]);
    const n = keyValues.length;
    if (n > 1) {
        const groupValues = groupBy ? items.map(item => item[groupBy]) : [];
        const comparer = getCombinedComparer(keyValues, groupValues, reverse);
        for (let i = 1; i < n; i++) {
            for (let j = 0; j < i; j++) {
                const ij = indices[j];
                const ii = indices[i];
                if (comparer(ii, ij)) {
                    indices[i] = ij;
                    indices[j] = ii;
                }
            }
        }
    }
}
export function sortObjectList(items, sortBy, order = 'ascending', groupBy) {
    const result = items.map((_, index) => index);
    if (sortBy) {
        sorter(result, items, sortBy, groupBy, order === 'descending');
    }
    else if (groupBy) {
        sorter(result, items, groupBy, undefined, order === 'descending');
    }
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9zb3J0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFNBQVMsb0JBQW9CLENBQUMsQ0FBTSxFQUFFLENBQU07SUFDMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2YsQ0FBQztBQUVELFNBQVMscUJBQXFCLENBQUMsQ0FBTSxFQUFFLENBQU07SUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ2YsQ0FBQztBQUVELE1BQU0sVUFBVSxrQkFBa0IsQ0FBQyxDQUF5QixFQUFFLENBQXlCO0lBQ3JGLG1DQUFtQztJQUNuQyxNQUFNLFlBQVksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUMxQyxNQUFNLFlBQVksR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUUxQyxJQUFJLFlBQVksSUFBSSxZQUFZLEVBQUU7UUFDaEMsT0FBTyxLQUFLLENBQUM7S0FDZDtTQUFNO1FBQ0wsSUFBSSxZQUFZLEVBQUU7WUFDaEIsT0FBTyxLQUFLLENBQUM7U0FDZDthQUFNLElBQUksWUFBWSxFQUFFO1lBQ3ZCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7YUFBTTtZQUNMLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxvRUFBb0U7U0FDakc7S0FDRjtBQUNILENBQUM7QUFFRCxTQUFTLG1CQUFtQixDQUFDLENBQXlCLEVBQUUsQ0FBeUI7SUFDL0UsT0FBTyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDbEMsQ0FBQztBQUVELFNBQVMsbUJBQW1CLENBQUMsQ0FBcUIsRUFBRSxDQUFxQjtJQUN2RSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFO1FBQ1os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QkFDMUIsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0QixNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRXRCLElBQUksUUFBUSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRTtvQkFDcEIsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDaEIsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztpQkFDakI7YUFDRjtTQUNGO0tBQ0Y7QUFDSCxDQUFDO0FBRUQsTUFBTSxVQUFVLGNBQWMsQ0FDNUIsS0FBZSxFQUNmLE1BQWdCLEVBQ2hCLFFBQW9DLFdBQVcsRUFDL0MsT0FBaUI7SUFFakIsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRTlDLElBQUksTUFBTSxFQUFFO1FBQ1YsTUFBTSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLEtBQUssWUFBWSxDQUFDLENBQUM7S0FDaEU7U0FBTSxJQUFJLE9BQU8sRUFBRTtRQUNsQixNQUFNLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssS0FBSyxZQUFZLENBQUMsQ0FBQztLQUNuRTtJQUVELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBjb21wYXJlR2VuZXJhbE5vcm1hbChhOiBhbnksIGI6IGFueSkge1xuICByZXR1cm4gYSA8IGI7XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVHZW5lcmFsUmV2ZXJzZShhOiBhbnksIGI6IGFueSkge1xuICByZXR1cm4gYiA8IGE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlQXJyYXlOb3JtYWwoYTogQXJyYXk8YW55PiB8IHVuZGVmaW5lZCwgYjogQXJyYXk8YW55PiB8IHVuZGVmaW5lZCkge1xuICAvLyB0cmVhdCBlbXB0eSBhcnJheSBsaWtlIHVuZGVmaW5lZFxuICBjb25zdCBhSXNVbmRlZmluZWQgPSAhYSB8fCBhLmxlbmd0aCA9PT0gMDtcbiAgY29uc3QgYklzVW5kZWZpbmVkID0gIWIgfHwgYi5sZW5ndGggPT09IDA7XG5cbiAgaWYgKGFJc1VuZGVmaW5lZCAmJiBiSXNVbmRlZmluZWQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGFJc1VuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoYklzVW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICEhYSAmJiAhIWIgJiYgYSA8IGI7IC8vIGRvdWJsZSBjaGVja2luZyBmb3Igbm90IHVuZGVmaW5lZCBpcyBuZWVkZWQgdG8gc2F0aXNmeSB0eXBlc2NyaXB0XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVBcnJheVJldmVyc2UoYTogQXJyYXk8YW55PiB8IHVuZGVmaW5lZCwgYjogQXJyYXk8YW55PiB8IHVuZGVmaW5lZCkge1xuICByZXR1cm4gY29tcGFyZUFycmF5Tm9ybWFsKGIsIGEpO1xufVxuXG5mdW5jdGlvbiBjb21wYXJlU3RyaW5nTm9ybWFsKGE6IHN0cmluZyB8IHVuZGVmaW5lZCwgYjogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gIGlmICghYSAmJiAhYikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoIWEpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKCFiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKSA9PT0gLTE7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvbXBhcmVTdHJpbmdSZXZlcnNlKGE6IHN0cmluZyB8IHVuZGVmaW5lZCwgYjogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XG4gIGlmICghYSAmJiAhYikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoIWIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSBpZiAoIWEpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGIubG9jYWxlQ29tcGFyZShhKSA9PT0gLTE7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlTnVtYmVyTm9ybWFsKGE6IG51bWJlciB8IHVuZGVmaW5lZCwgYjogbnVtYmVyIHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG4gIGlmIChhID09PSBiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKGEgPT09IDApIHtcbiAgICByZXR1cm4gIWIgfHwgYSA8IGI7XG4gIH1cblxuICBpZiAoIWEpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoIWIgJiYgYiAhPT0gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGEgPCBiO1xufVxuXG5mdW5jdGlvbiBjb21wYXJlTnVtYmVyUmV2ZXJzZShhOiBudW1iZXIgfCB1bmRlZmluZWQsIGI6IG51bWJlciB8IHVuZGVmaW5lZCk6IGJvb2xlYW4ge1xuICByZXR1cm4gY29tcGFyZU51bWJlck5vcm1hbChiLCBhKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q29tcGFyZXIoZXhhbXBsZVZhbHVlOiBhbnksIHJldmVyc2U6IGJvb2xlYW4pOiAoYTogYW55LCBiOiBhbnkpID0+IGJvb2xlYW4ge1xuICBpZiAodHlwZW9mIGV4YW1wbGVWYWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gcmV2ZXJzZSA/IGNvbXBhcmVTdHJpbmdSZXZlcnNlIDogY29tcGFyZVN0cmluZ05vcm1hbDtcbiAgfVxuXG4gIGlmICh0eXBlb2YgZXhhbXBsZVZhbHVlID09PSAnbnVtYmVyJykge1xuICAgIHJldHVybiByZXZlcnNlID8gY29tcGFyZU51bWJlclJldmVyc2UgOiBjb21wYXJlTnVtYmVyTm9ybWFsO1xuICB9XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkoZXhhbXBsZVZhbHVlKSkge1xuICAgIHJldHVybiByZXZlcnNlID8gY29tcGFyZUFycmF5UmV2ZXJzZSA6IGNvbXBhcmVBcnJheU5vcm1hbDtcbiAgfVxuXG4gIHJldHVybiByZXZlcnNlID8gY29tcGFyZUdlbmVyYWxSZXZlcnNlIDogY29tcGFyZUdlbmVyYWxOb3JtYWw7XG59XG5cbmZ1bmN0aW9uIGdldENvbWJpbmVkQ29tcGFyZXI8VD4oa2V5VmFsdWVzOiBBcnJheTxUW2tleW9mIFRdPiwgZ3JvdXBWYWx1ZXM6IEFycmF5PFRba2V5b2YgVF0+LCByZXZlcnNlOiBib29sZWFuKSB7XG4gIGNvbnN0IGhhc0dyb3VwcyA9IGdyb3VwVmFsdWVzICYmIGdyb3VwVmFsdWVzLmxlbmd0aDtcbiAgY29uc3Qga2V5Y29tcGFyZXIgPSBnZXRDb21wYXJlcihrZXlWYWx1ZXMuZmluZChpdGVtID0+ICEhaXRlbSksIHJldmVyc2UpO1xuXG4gIGlmIChoYXNHcm91cHMpIHtcbiAgICBjb25zdCBncm91cGNvbXBhcmVyID0gZ2V0Q29tcGFyZXIoZ3JvdXBWYWx1ZXMuZmluZChpdGVtID0+ICEhaXRlbSksIGZhbHNlKTsgLy8gR3JvdXAgb3JkZXIgaXMgYWx3YXlzIGFzY2VuZGluZ1xuXG4gICAgcmV0dXJuIChhOiBudW1iZXIsIGI6IG51bWJlcikgPT5cbiAgICAgIGdyb3VwY29tcGFyZXIoZ3JvdXBWYWx1ZXNbYV0sIGdyb3VwVmFsdWVzW2JdKSB8fFxuICAgICAgKGdyb3VwVmFsdWVzW2FdID09PSBncm91cFZhbHVlc1tiXSAmJiBrZXljb21wYXJlcihrZXlWYWx1ZXNbYV0sIGtleVZhbHVlc1tiXSkpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAoYTogbnVtYmVyLCBiOiBudW1iZXIpID0+IGtleWNvbXBhcmVyKGtleVZhbHVlc1thXSwga2V5VmFsdWVzW2JdKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzb3J0ZXI8VCBleHRlbmRzIHt9PihcbiAgaW5kaWNlczogQXJyYXk8bnVtYmVyPixcbiAgaXRlbXM6IEFycmF5PFQ+LFxuICBrZXk6IGtleW9mIFQsXG4gIGdyb3VwQnk/OiBrZXlvZiBULFxuICByZXZlcnNlID0gZmFsc2UsXG4pIHtcbiAgY29uc3Qga2V5VmFsdWVzID0gaXRlbXMubWFwKGl0ZW0gPT4gaXRlbVtrZXldKTtcbiAgY29uc3QgbiA9IGtleVZhbHVlcy5sZW5ndGg7XG5cbiAgaWYgKG4gPiAxKSB7XG4gICAgY29uc3QgZ3JvdXBWYWx1ZXMgPSBncm91cEJ5ID8gaXRlbXMubWFwKGl0ZW0gPT4gaXRlbVtncm91cEJ5XSkgOiBbXTtcbiAgICBjb25zdCBjb21wYXJlciA9IGdldENvbWJpbmVkQ29tcGFyZXIoa2V5VmFsdWVzLCBncm91cFZhbHVlcywgcmV2ZXJzZSk7XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpOyBqKyspIHtcbiAgICAgICAgY29uc3QgaWogPSBpbmRpY2VzW2pdO1xuICAgICAgICBjb25zdCBpaSA9IGluZGljZXNbaV07XG5cbiAgICAgICAgaWYgKGNvbXBhcmVyKGlpLCBpaikpIHtcbiAgICAgICAgICBpbmRpY2VzW2ldID0gaWo7XG4gICAgICAgICAgaW5kaWNlc1tqXSA9IGlpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzb3J0T2JqZWN0TGlzdDxUIGV4dGVuZHMge30+KFxuICBpdGVtczogQXJyYXk8VD4sXG4gIHNvcnRCeT86IGtleW9mIFQsXG4gIG9yZGVyOiAnYXNjZW5kaW5nJyB8ICdkZXNjZW5kaW5nJyA9ICdhc2NlbmRpbmcnLFxuICBncm91cEJ5Pzoga2V5b2YgVCxcbikge1xuICBjb25zdCByZXN1bHQgPSBpdGVtcy5tYXAoKF8sIGluZGV4KSA9PiBpbmRleCk7XG5cbiAgaWYgKHNvcnRCeSkge1xuICAgIHNvcnRlcihyZXN1bHQsIGl0ZW1zLCBzb3J0QnksIGdyb3VwQnksIG9yZGVyID09PSAnZGVzY2VuZGluZycpO1xuICB9IGVsc2UgaWYgKGdyb3VwQnkpIHtcbiAgICBzb3J0ZXIocmVzdWx0LCBpdGVtcywgZ3JvdXBCeSwgdW5kZWZpbmVkLCBvcmRlciA9PT0gJ2Rlc2NlbmRpbmcnKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG4iXX0=