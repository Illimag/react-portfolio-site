function byte(v) {
    return v < 0 ? 0 : v >= 1 ? 255 : ~~(v * 256);
}
export function hsvToRgb(h, s, v, a = 1) {
    const i = Math.floor(h * 6);
    const f = h * 6 - i;
    const p = v * (1 - s);
    const q = v * (1 - f * s);
    const t = v * (1 - (1 - f) * s);
    let r = 0;
    let g = 0;
    let b = 0;
    switch (i % 6) {
        case 0:
            (r = v), (g = t), (b = p);
            break;
        case 1:
            (r = q), (g = v), (b = p);
            break;
        case 2:
            (r = p), (g = v), (b = t);
            break;
        case 3:
            (r = p), (g = q), (b = v);
            break;
        case 4:
            (r = t), (g = p), (b = v);
            break;
        case 5:
            (r = v), (g = p), (b = q);
            break;
    }
    return {
        r: byte(r),
        g: byte(g),
        b: byte(b),
        a,
    };
}
export function rgbToHsv(r, g, b, a = 1) {
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const d = max - min;
    const s = max === 0 ? 0 : d / max;
    const v = max / 255;
    let h = 0;
    switch (max) {
        case min:
            h = 0;
            break;
        case r:
            h = (g - b + d * (g < b ? 6 : 0)) / (6 * d);
            break;
        case g:
            h = (b - r + d * 2) / (6 * d);
            break;
        case b:
            h = (r - g + d * 4) / (6 * d);
            break;
    }
    return {
        h,
        s,
        v,
        a,
    };
}
export function parseColor(color) {
    if (color.match(/^rgb\(/)) {
        const parts = color.substring(4, color.length - 1).split(',');
        return {
            r: +parts[0],
            g: +parts[1],
            b: +parts[2],
            a: 1,
        };
    }
    else if (color.match(/^rgba\(/)) {
        const parts = color.substring(5, color.length - 1).split(',');
        return {
            r: +parts[0],
            g: +parts[1],
            b: +parts[2],
            a: +parts[3],
        };
    }
    else if (color[0] === '#') {
        const value = parseInt(color.substr(1), 16);
        const full = color.length === 7;
        const convert = full
            ? (v, p) => (v >> (p * 8)) & 255
            : (v, p) => ((v >> (p * 4)) & 15) * 17;
        return {
            r: convert(value, 2),
            g: convert(value, 1),
            b: convert(value, 0),
            a: 1,
        };
    }
    return {
        r: 0,
        g: 0,
        b: 0,
        a: 1,
    };
}
export function serializeColor(c) {
    return `rgba(${c.r}, ${c.g}, ${c.b}, ${c.a})`;
}
export function transparentize(color, alpha) {
    const c = parseColor(color);
    c.a = alpha;
    return serializeColor(c);
}
export function invertColor(color, blackWhite = false) {
    const { r, g, b } = parseColor(color);
    if (!blackWhite) {
        const newR = (255 - r).toString(16);
        const newG = (255 - g).toString(16);
        const newB = (255 - b).toString(16);
        return `rgb(${newR}, ${newG}, ${newB})`;
    }
    return r * 0.299 + g * 0.587 + b * 0.114 > 186 ? 'rgb(0, 0, 0)' : 'rgb(255, 255, 255)';
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3V0aWxzL2NvbG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxTQUFTLElBQUksQ0FBQyxDQUFTO0lBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQztJQUM3RCxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM1QixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMxQixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDaEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRVYsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ2IsS0FBSyxDQUFDO1lBQ0osQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDMUIsTUFBTTtRQUNSLEtBQUssQ0FBQztZQUNKLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzFCLE1BQU07UUFDUixLQUFLLENBQUM7WUFDSixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMxQixNQUFNO1FBQ1IsS0FBSyxDQUFDO1lBQ0osQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDMUIsTUFBTTtRQUNSLEtBQUssQ0FBQztZQUNKLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzFCLE1BQU07UUFDUixLQUFLLENBQUM7WUFDSixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMxQixNQUFNO0tBQ1Q7SUFFRCxPQUFPO1FBQ0wsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDVixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNWLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1YsQ0FBQztLQUNGLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQztJQUM3RCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDOUIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzlCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDcEIsTUFBTSxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDcEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRVYsUUFBUSxHQUFHLEVBQUU7UUFDWCxLQUFLLEdBQUc7WUFDTixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ04sTUFBTTtRQUNSLEtBQUssQ0FBQztZQUNKLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzVDLE1BQU07UUFDUixLQUFLLENBQUM7WUFDSixDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNO1FBQ1IsS0FBSyxDQUFDO1lBQ0osQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDOUIsTUFBTTtLQUNUO0lBRUQsT0FBTztRQUNMLENBQUM7UUFDRCxDQUFDO1FBQ0QsQ0FBQztRQUNELENBQUM7S0FDRixDQUFDO0FBQ0osQ0FB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TSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRXRDLElBQUksQ0FBQyxVQUFVLEVBQUU7UUFDZixNQUFNLElBQUksR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDcEMsTUFBTSxJQUFJLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sSUFBSSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQyxPQUFPLE9BQU8sSUFBSSxLQUFLLElBQUksS0FBSyxJQUFJLEdBQUcsQ0FBQztLQUN6QztJQUVELE9BQU8sQ0FBQyxHQUFHLEtBQUssR0FBRyxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsR0FBRyxLQUFLLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO0FBQ3pGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBieXRlKHY6IG51bWJlcikge1xuICByZXR1cm4gdiA8IDAgPyAwIDogdiA+PSAxID8gMjU1IDogfn4odiAqIDI1Nik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoc3ZUb1JnYihoOiBudW1iZXIsIHM6IG51bWJlciwgdjogbnVtYmVyLCBhID0gMSkge1xuICBjb25zdCBpID0gTWF0aC5mbG9vcihoICogNik7XG4gIGNvbnN0IGYgPSBoICogNiAtIGk7XG4gIGNvbnN0IHAgPSB2ICogKDEgLSBzKTtcbiAgY29uc3QgcSA9IHYgKiAoMSAtIGYgKiBzKTtcbiAgY29uc3QgdCA9IHYgKiAoMSAtICgxIC0gZikgKiBzKTtcbiAgbGV0IHIgPSAwO1xuICBsZXQgZyA9IDA7XG4gIGxldCBiID0gMDtcblxuICBzd2l0Y2ggKGkgJSA2KSB7XG4gICAgY2FzZSAwOlxuICAgICAgKHIgPSB2KSwgKGcgPSB0KSwgKGIgPSBwKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMTpcbiAgICAgIChyID0gcSksIChnID0gdiksIChiID0gcCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDI6XG4gICAgICAociA9IHApLCAoZyA9IHYpLCAoYiA9IHQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAzOlxuICAgICAgKHIgPSBwKSwgKGcgPSBxKSwgKGIgPSB2KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgNDpcbiAgICAgIChyID0gdCksIChnID0gcCksIChiID0gdik7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDU6XG4gICAgICAociA9IHYpLCAoZyA9IHApLCAoYiA9IHEpO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHI6IGJ5dGUociksXG4gICAgZzogYnl0ZShnKSxcbiAgICBiOiBieXRlKGIpLFxuICAgIGEsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZ2JUb0hzdihyOiBudW1iZXIsIGc6IG51bWJlciwgYjogbnVtYmVyLCBhID0gMSkge1xuICBjb25zdCBtYXggPSBNYXRoLm1heChyLCBnLCBiKTtcbiAgY29uc3QgbWluID0gTWF0aC5taW4ociwgZywgYik7XG4gIGNvbnN0IGQgPSBtYXggLSBtaW47XG4gIGNvbnN0IHMgPSBtYXggPT09IDAgPyAwIDogZCAvIG1heDtcbiAgY29uc3QgdiA9IG1heCAvIDI1NTtcbiAgbGV0IGggPSAwO1xuXG4gIHN3aXRjaCAobWF4KSB7XG4gICAgY2FzZSBtaW46XG4gICAgICBoID0gMDtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgcjpcbiAgICAgIGggPSAoZyAtIGIgKyBkICogKGcgPCBiID8gNiA6IDApKSAvICg2ICogZCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIGc6XG4gICAgICBoID0gKGIgLSByICsgZCAqIDIpIC8gKDYgKiBkKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgYjpcbiAgICAgIGggPSAociAtIGcgKyBkICogNCkgLyAoNiAqIGQpO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGgsXG4gICAgcyxcbiAgICB2LFxuICAgIGEsXG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUkdCQUNvbG9yIHtcbiAgcjogbnVtYmVyO1xuICBnOiBudW1iZXI7XG4gIGI6IG51bWJlcjtcbiAgYTogbnVtYmVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VDb2xvcihjb2xvcjogc3RyaW5nKTogUkdCQUNvbG9yIHtcbiAgaWYgKGNvbG9yLm1hdGNoKC9ecmdiXFwoLykpIHtcbiAgICBjb25zdCBwYXJ0cyA9IGNvbG9yLnN1YnN0cmluZyg0LCBjb2xvci5sZW5ndGggLSAxKS5zcGxpdCgnLCcpO1xuICAgIHJldHVybiB7XG4gICAgICByOiArcGFydHNbMF0sXG4gICAgICBnOiArcGFydHNbMV0sXG4gICAgICBiOiArcGFydHNbMl0sXG4gICAgICBhOiAxLFxuICAgIH07XG4gIH0gZWxzZSBpZiAoY29sb3IubWF0Y2goL15yZ2JhXFwoLykpIHtcbiAgICBjb25zdCBwYXJ0cyA9IGNvbG9yLnN1YnN0cmluZyg1LCBjb2xvci5sZW5ndGggLSAxKS5zcGxpdCgnLCcpO1xuICAgIHJldHVybiB7XG4gICAgICByOiArcGFydHNbMF0sXG4gICAgICBnOiArcGFydHNbMV0sXG4gICAgICBiOiArcGFydHNbMl0sXG4gICAgICBhOiArcGFydHNbM10sXG4gICAgfTtcbiAgfSBlbHNlIGlmIChjb2xvclswXSA9PT0gJyMnKSB7XG4gICAgY29uc3QgdmFsdWUgPSBwYXJzZUludChjb2xvci5zdWJzdHIoMSksIDE2KTtcbiAgICBjb25zdCBmdWxsID0gY29sb3IubGVuZ3RoID09PSA3O1xuICAgIGNvbnN0IGNvbnZlcnQgPSBmdWxsXG4gICAgICA/ICh2OiBudW1iZXIsIHA6IG51bWJlcikgPT4gKHYgPj4gKHAgKiA4KSkgJiAyNTVcbiAgICAgIDogKHY6IG51bWJlciwgcDogbnVtYmVyKSA9PiAoKHYgPj4gKHAgKiA0KSkgJiAxNSkgKiAxNztcbiAgICByZXR1cm4ge1xuICAgICAgcjogY29udmVydCh2YWx1ZSwgMiksXG4gICAgICBnOiBjb252ZXJ0KHZhbHVlLCAxKSxcbiAgICAgIGI6IGNvbnZlcnQodmFsdWUsIDApLFxuICAgICAgYTogMSxcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICByOiAwLFxuICAgIGc6IDAsXG4gICAgYjogMCxcbiAgICBhOiAxLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplQ29sb3IoYzogUkdCQUNvbG9yKTogc3RyaW5nIHtcbiAgcmV0dXJuIGByZ2JhKCR7Yy5yfSwgJHtjLmd9LCAke2MuYn0sICR7Yy5hfSlgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNwYXJlbnRpemUoY29sb3I6IHN0cmluZywgYWxwaGE6IG51bWJlcik6IHN0cmluZyB7XG4gIGNvbnN0IGMgPSBwYXJzZUNvbG9yKGNvbG9yKTtcbiAgYy5hID0gYWxwaGE7XG4gIHJldHVybiBzZXJpYWxpemVDb2xvcihjKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludmVydENvbG9yKGNvbG9yOiBzdHJpbmcsIGJsYWNrV2hpdGUgPSBmYWxzZSkge1xuICBjb25zdCB7IHIsIGcsIGIgfSA9IHBhcnNlQ29sb3IoY29sb3IpO1xuXG4gIGlmICghYmxhY2tXaGl0ZSkge1xuICAgIGNvbnN0IG5ld1IgPSAoMjU1IC0gcikudG9TdHJpbmcoMTYpO1xuICAgIGNvbnN0IG5ld0cgPSAoMjU1IC0gZykudG9TdHJpbmcoMTYpO1xuICAgIGNvbnN0IG5ld0IgPSAoMjU1IC0gYikudG9TdHJpbmcoMTYpO1xuICAgIHJldHVybiBgcmdiKCR7bmV3Un0sICR7bmV3R30sICR7bmV3Qn0pYDtcbiAgfVxuXG4gIHJldHVybiByICogMC4yOTkgKyBnICogMC41ODcgKyBiICogMC4xMTQgPiAxODYgPyAncmdiKDAsIDAsIDApJyA6ICdyZ2IoMjU1LCAyNTUsIDI1NSknO1xufVxuIl19