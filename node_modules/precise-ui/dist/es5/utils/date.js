"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var format_1 = require("date-fns/esm/format");
var isAfter_1 = require("date-fns/esm/isAfter");
var isValid_1 = require("date-fns/esm/isValid");
var parse_1 = require("date-fns/esm/parse");
var longFormatters = require('date-fns/_lib/format/longFormatters');
// This RegExp catches symbols escaped by quotes, and also
// sequences of symbols P, p, and the combinations like `PPPPPPPppppp`
var longFormattingTokensRegExp = /P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;
/**
 * Date parsing
 * @param value
 * @param dateFormat
 * @param locale
 * @param strictParsing
 */
function parseDate(value, dateFormat, locale, strictParsing) {
    // tslint:disable-next-line
    var parsedDate = null;
    var localeObject = getLocaleObject(locale || '') || getDefaultLocale();
    var strictParsingValueMatch = true;
    if (Array.isArray(dateFormat)) {
        dateFormat.forEach(function (df) {
            var tryParseDate = parse_1.default(value, df, new Date(), { locale: localeObject });
            if (strictParsing) {
                strictParsingValueMatch = isValid(tryParseDate) && value === format_1.default(tryParseDate, df);
            }
            if (isValid(tryParseDate) && strictParsingValueMatch) {
                parsedDate = tryParseDate;
            }
        });
        return parsedDate;
    }
    parsedDate = parse_1.default(value, dateFormat, new Date(), { locale: localeObject });
    if (strictParsing) {
        strictParsingValueMatch = isValid(parsedDate) && value === format_1.default(parsedDate, dateFormat);
    }
    else if (!isValid(parsedDate)) {
        var match = dateFormat.match(longFormattingTokensRegExp);
        var updatedDateFormat = match
            ? match
                .map(function (substring) {
                var firstCharacter = substring[0];
                if (firstCharacter === 'p' || firstCharacter === 'P') {
                    var longFormatter = longFormatters[firstCharacter];
                    return localeObject ? longFormatter(substring, localeObject.formatLong) : firstCharacter;
                }
                return substring;
            })
                .join('')
            : dateFormat;
        if (value.length > 0) {
            parsedDate = parse_1.default(value, updatedDateFormat.slice(0, value.length), new Date());
        }
        if (!isValid(parsedDate)) {
            parsedDate = new Date(value);
        }
    }
    // tslint:disable-next-line
    return isValid(parsedDate) && strictParsingValueMatch ? parsedDate : null;
}
exports.parseDate = parseDate;
function getIsoDateFormat() {
    return 'yyyy-MM-dd';
}
exports.getIsoDateFormat = getIsoDateFormat;
function getLocaleObject(localeSpec) {
    if (typeof localeSpec === 'string') {
        // Treat it as a locale name registered by registerLocale
        // tslint:disable-next-line
        return window.__localeData__ ? window.__localeData__[localeSpec] : null;
    }
    else {
        // Treat it as a raw date-fns locale object
        return localeSpec;
    }
}
function getDefaultLocale() {
    return window.__localeId__;
}
function isValid(date) {
    return isValid_1.default(date) && isAfter_1.default(date, new Date('1/1/1000'));
}
/**
 * Date Formatting
 * @param date Date
 * @param formatStr string
 * @param locale string
 */
function formatDate(date, formatStr, locale) {
    if (locale === void 0) { locale = ''; }
    if (locale === 'en') {
        return format_1.default(date, formatStr);
    }
    var localeObj = getLocaleObject(locale);
    if (locale && !localeObj) {
        console.warn("A locale object was not found for the provided string [\"" + locale + "\"].");
    }
    if (!localeObj && !!getDefaultLocale() && !!getLocaleObject(getDefaultLocale())) {
        localeObj = getLocaleObject(getDefaultLocale());
    }
    return format_1.default(date, formatStr, {
        // tslint:disable-next-line
        locale: localeObj ? localeObj : null,
    });
}
function safeDateFormat(date, _a) {
    var dateFormat = _a.dateFormat, locale = _a.locale;
    return (date && formatDate(date, Array.isArray(dateFormat) ? dateFormat[0] : dateFormat, locale)) || '';
}
exports.safeDateFormat = safeDateFormat;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9kYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsOENBQXlDO0FBQ3pDLGdEQUEyQztBQUMzQyxnREFBK0M7QUFDL0MsNENBQXVDO0FBRXZDLElBQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxxQ0FBcUMsQ0FBQyxDQUFDO0FBU3RFLDBEQUEwRDtBQUMxRCxzRUFBc0U7QUFDdEUsSUFBTSwwQkFBMEIsR0FBRyxtQ0FBbUMsQ0FBQztBQUV2RTs7Ozs7O0dBTUc7QUFDSCxTQUFnQixTQUFTLENBQ3ZCLEtBQWEsRUFDYixVQUFrQyxFQUNsQyxNQUF3QixFQUN4QixhQUF1QjtJQUV2QiwyQkFBMkI7SUFDM0IsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDO0lBQ3RCLElBQU0sWUFBWSxHQUFHLGVBQWUsQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztJQUN6RSxJQUFJLHVCQUF1QixHQUFHLElBQUksQ0FBQztJQUNuQyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7UUFDN0IsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFBLEVBQUU7WUFDbkIsSUFBTSxZQUFZLEdBQUcsZUFBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO1lBQzVFLElBQUksYUFBYSxFQUFFO2dCQUNqQix1QkFBdUIsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksS0FBSyxLQUFLLGdCQUFNLENBQUMsWUFBWSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2FBQ3ZGO1lBQ0QsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksdUJBQXVCLEVBQUU7Z0JBQ3BELFVBQVUsR0FBRyxZQUFZLENBQUM7YUFDM0I7UUFDSCxDQUFDLENBQUMs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aEM7SUFDRCxJQUFJLFNBQVMsR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDeEMsSUFBSSxNQUFNLElBQUksQ0FBQyxTQUFTLEVBQUU7UUFDeEIsT0FBTyxDQUFDLElBQUksQ0FBQyw4REFBMkQsTUFBTSxTQUFLLENBQUMsQ0FBQztLQUN0RjtJQUNELElBQUksQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEVBQUU7UUFDL0UsU0FBUyxHQUFHLGVBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7S0FDakQ7SUFDRCxPQUFPLGdCQUFNLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRTtRQUM3QiwyQkFBMkI7UUFDM0IsTUFBTSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJO0tBQ3JDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxTQUFnQixjQUFjLENBQzVCLElBQXNCLEVBQ3RCLEVBQXdGO1FBQXRGLDBCQUFVLEVBQUUsa0JBQU07SUFFcEIsT0FBTyxDQUFDLElBQUksSUFBSSxVQUFVLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQzFHLENBQUM7QUFMRCx3Q0FLQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvY2FsZSB9IGZyb20gJ2RhdGUtZm5zJztcbmltcG9ydCBmb3JtYXQgZnJvbSAnZGF0ZS1mbnMvZXNtL2Zvcm1hdCc7XG5pbXBvcnQgaXNBZnRlciBmcm9tICdkYXRlLWZucy9lc20vaXNBZnRlcic7XG5pbXBvcnQgaXNWYWxpZERhdGUgZnJvbSAnZGF0ZS1mbnMvZXNtL2lzVmFsaWQnO1xuaW1wb3J0IHBhcnNlIGZyb20gJ2RhdGUtZm5zL2VzbS9wYXJzZSc7XG5cbmNvbnN0IGxvbmdGb3JtYXR0ZXJzID0gcmVxdWlyZSgnZGF0ZS1mbnMvX2xpYi9mb3JtYXQvbG9uZ0Zvcm1hdHRlcnMnKTtcblxuZGVjbGFyZSBnbG9iYWwge1xuICBpbnRlcmZhY2UgV2luZG93IHtcbiAgICBfX2xvY2FsZURhdGFfXzogT2JqZWN0O1xuICAgIF9fbG9jYWxlSWRfXzogc3RyaW5nO1xuICB9XG59XG5cbi8vIFRoaXMgUmVnRXhwIGNhdGNoZXMgc3ltYm9scyBlc2NhcGVkIGJ5IHF1b3RlcywgYW5kIGFsc29cbi8vIHNlcXVlbmNlcyBvZiBzeW1ib2xzIFAsIHAsIGFuZCB0aGUgY29tYmluYXRpb25zIGxpa2UgYFBQUFBQUFBwcHBwcGBcbmNvbnN0IGxvbmdGb3JtYXR0aW5nVG9rZW5zUmVnRXhwID0gL1ArcCt8UCt8cCt8Jyd8JygnJ3xbXiddKSsoJ3wkKXwuL2c7XG5cbi8qKlxuICogRGF0ZSBwYXJzaW5nXG4gKiBAcGFyYW0gdmFsdWVcbiAqIEBwYXJhbSBkYXRlRm9ybWF0XG4gKiBAcGFyYW0gbG9jYWxlXG4gKiBAcGFyYW0gc3RyaWN0UGFyc2luZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VEYXRlKFxuICB2YWx1ZTogc3RyaW5nLFxuICBkYXRlRm9ybWF0OiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LFxuICBsb2NhbGU/OiBMb2NhbGUgfCBzdHJpbmcsXG4gIHN0cmljdFBhcnNpbmc/OiBib29sZWFuLFxuKSB7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZVxuICBsZXQgcGFyc2VkRGF0ZSA9IG51bGw7XG4gIGNvbnN0IGxvY2FsZU9iamVjdCA9IGdldExvY2FsZU9iamVjdChsb2NhbGUgfHwgJycpIHx8IGdldERlZmF1bHRMb2NhbGUoKTtcbiAgbGV0IHN0cmljdFBhcnNpbmdWYWx1ZU1hdGNoID0gdHJ1ZTtcbiAgaWYgKEFycmF5LmlzQXJyYXkoZGF0ZUZvcm1hdCkpIHtcbiAgICBkYXRlRm9ybWF0LmZvckVhY2goZGYgPT4ge1xuICAgICAgY29uc3QgdHJ5UGFyc2VEYXRlID0gcGFyc2UodmFsdWUsIGRmLCBuZXcgRGF0ZSgpLCB7IGxvY2FsZTogbG9jYWxlT2JqZWN0IH0pO1xuICAgICAgaWYgKHN0cmljdFBhcnNpbmcpIHtcbiAgICAgICAgc3RyaWN0UGFyc2luZ1ZhbHVlTWF0Y2ggPSBpc1ZhbGlkKHRyeVBhcnNlRGF0ZSkgJiYgdmFsdWUgPT09IGZvcm1hdCh0cnlQYXJzZURhdGUsIGRmKTtcbiAgICAgIH1cbiAgICAgIGlmIChpc1ZhbGlkKHRyeVBhcnNlRGF0ZSkgJiYgc3RyaWN0UGFyc2luZ1ZhbHVlTWF0Y2gpIHtcbiAgICAgICAgcGFyc2VkRGF0ZSA9IHRyeVBhcnNlRGF0ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcGFyc2VkRGF0ZTtcbiAgfVxuXG4gIHBhcnNlZERhdGUgPSBwYXJzZSh2YWx1ZSwgZGF0ZUZvcm1hdCwgbmV3IERhdGUoKSwgeyBsb2NhbGU6IGxvY2FsZU9iamVjdCB9KTtcblxuICBpZiAoc3RyaWN0UGFyc2luZykge1xuICAgIHN0cmljdFBhcnNpbmdWYWx1ZU1hdGNoID0gaXNWYWxpZChwYXJzZWREYXRlKSAmJiB2YWx1ZSA9PT0gZm9ybWF0KHBhcnNlZERhdGUsIGRhdGVGb3JtYXQpO1xuICB9IGVsc2UgaWYgKCFpc1ZhbGlkKHBhcnNlZERhdGUpKSB7XG4gICAgY29uc3QgbWF0Y2ggPSBkYXRlRm9ybWF0Lm1hdGNoKGxvbmdGb3JtYXR0aW5nVG9rZW5zUmVnRXhwKTtcbiAgICBjb25zdCB1cGRhdGVkRGF0ZUZvcm1hdCA9IG1hdGNoXG4gICAgICA/IG1hdGNoXG4gICAgICAgICAgLm1hcChzdWJzdHJpbmcgPT4ge1xuICAgICAgICAgICAgY29uc3QgZmlyc3RDaGFyYWN0ZXIgPSBzdWJzdHJpbmdbMF07XG4gICAgICAgICAgICBpZiAoZmlyc3RDaGFyYWN0ZXIgPT09ICdwJyB8fCBmaXJzdENoYXJhY3RlciA9PT0gJ1AnKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGxvbmdGb3JtYXR0ZXIgPSBsb25nRm9ybWF0dGVyc1tmaXJzdENoYXJhY3Rlcl07XG4gICAgICAgICAgICAgIHJldHVybiBsb2NhbGVPYmplY3QgPyBsb25nRm9ybWF0dGVyKHN1YnN0cmluZywgbG9jYWxlT2JqZWN0LmZvcm1hdExvbmcpIDogZmlyc3RDaGFyYWN0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3Vic3RyaW5nO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmpvaW4oJycpXG4gICAgICA6IGRhdGVGb3JtYXQ7XG5cbiAgICBpZiAodmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgcGFyc2VkRGF0ZSA9IHBhcnNlKHZhbHVlLCB1cGRhdGVkRGF0ZUZvcm1hdC5zbGljZSgwLCB2YWx1ZS5sZW5ndGgpLCBuZXcgRGF0ZSgpKTtcbiAgICB9XG5cbiAgICBpZiAoIWlzVmFsaWQocGFyc2VkRGF0ZSkpIHtcbiAgICAgIHBhcnNlZERhdGUgPSBuZXcgRGF0ZSh2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lXG4gIHJldHVybiBpc1ZhbGlkKHBhcnNlZERhdGUpICYmIHN0cmljdFBhcnNpbmdWYWx1ZU1hdGNoID8gcGFyc2VkRGF0ZSA6IG51bGw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRJc29EYXRlRm9ybWF0KCkge1xuICByZXR1cm4gJ3l5eXktTU0tZGQnO1xufVxuXG5mdW5jdGlvbiBnZXRMb2NhbGVPYmplY3QobG9jYWxlU3BlYzogc3RyaW5nIHwgTG9jYWxlKSB7XG4gIGlmICh0eXBlb2YgbG9jYWxlU3BlYyA9PT0gJ3N0cmluZycpIHtcbiAgICAvLyBUcmVhdCBpdCBhcyBhIGxvY2FsZSBuYW1lIHJlZ2lzdGVyZWQgYnkgcmVnaXN0ZXJMb2NhbGVcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmVcbiAgICByZXR1cm4gd2luZG93Ll9fbG9jYWxlRGF0YV9fID8gd2luZG93Ll9fbG9jYWxlRGF0YV9fW2xvY2FsZVNwZWNdIDogbnVsbDtcbiAgfSBlbHNlIHtcbiAgICAvLyBUcmVhdCBpdCBhcyBhIHJhdyBkYXRlLWZucyBsb2NhbGUgb2JqZWN0XG4gICAgcmV0dXJuIGxvY2FsZVNwZWM7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RGVmYXVsdExvY2FsZSgpIHtcbiAgcmV0dXJuIHdpbmRvdy5fX2xvY2FsZUlkX187XG59XG5cbmZ1bmN0aW9uIGlzVmFsaWQoZGF0ZTogRGF0ZSkge1xuICByZXR1cm4gaXNWYWxpZERhdGUoZGF0ZSkgJiYgaXNBZnRlcihkYXRlLCBuZXcgRGF0ZSgnMS8xLzEwMDAnKSk7XG59XG5cbi8qKlxuICogRGF0ZSBGb3JtYXR0aW5nXG4gKiBAcGFyYW0gZGF0ZSBEYXRlXG4gKiBAcGFyYW0gZm9ybWF0U3RyIHN0cmluZ1xuICogQHBhcmFtIGxvY2FsZSBzdHJpbmdcbiAqL1xuZnVuY3Rpb24gZm9ybWF0RGF0ZShkYXRlOiBEYXRlLCBmb3JtYXRTdHI6IHN0cmluZywgbG9jYWxlOiBzdHJpbmcgfCBMb2NhbGUgPSAnJykge1xuICBpZiAobG9jYWxlID09PSAnZW4nKSB7XG4gICAgcmV0dXJuIGZvcm1hdChkYXRlLCBmb3JtYXRTdHIpO1xuICB9XG4gIGxldCBsb2NhbGVPYmogPSBnZXRMb2NhbGVPYmplY3QobG9jYWxlKTtcbiAgaWYgKGxvY2FsZSAmJiAhbG9jYWxlT2JqKSB7XG4gICAgY29uc29sZS53YXJuKGBBIGxvY2FsZSBvYmplY3Qgd2FzIG5vdCBmb3VuZCBmb3IgdGhlIHByb3ZpZGVkIHN0cmluZyBbXCIke2xvY2FsZX1cIl0uYCk7XG4gIH1cbiAgaWYgKCFsb2NhbGVPYmogJiYgISFnZXREZWZhdWx0TG9jYWxlKCkgJiYgISFnZXRMb2NhbGVPYmplY3QoZ2V0RGVmYXVsdExvY2FsZSgpKSkge1xuICAgIGxvY2FsZU9iaiA9IGdldExvY2FsZU9iamVjdChnZXREZWZhdWx0TG9jYWxlKCkpO1xuICB9XG4gIHJldHVybiBmb3JtYXQoZGF0ZSwgZm9ybWF0U3RyLCB7XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lXG4gICAgbG9jYWxlOiBsb2NhbGVPYmogPyBsb2NhbGVPYmogOiBudWxsLFxuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVEYXRlRm9ybWF0KFxuICBkYXRlOiBEYXRlIHwgdW5kZWZpbmVkLFxuICB7IGRhdGVGb3JtYXQsIGxvY2FsZSB9OiB7IGRhdGVGb3JtYXQ6IHN0cmluZyB8IEFycmF5PHN0cmluZz47IGxvY2FsZT86IHN0cmluZyB8IExvY2FsZSB9LFxuKSB7XG4gIHJldHVybiAoZGF0ZSAmJiBmb3JtYXREYXRlKGRhdGUsIEFycmF5LmlzQXJyYXkoZGF0ZUZvcm1hdCkgPyBkYXRlRm9ybWF0WzBdIDogZGF0ZUZvcm1hdCwgbG9jYWxlKSkgfHwgJyc7XG59XG4iXX0=