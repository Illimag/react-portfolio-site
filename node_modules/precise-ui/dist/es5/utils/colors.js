"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function byte(v) {
    return v < 0 ? 0 : v >= 1 ? 255 : ~~(v * 256);
}
function hsvToRgb(h, s, v, a) {
    if (a === void 0) { a = 1; }
    var i = Math.floor(h * 6);
    var f = h * 6 - i;
    var p = v * (1 - s);
    var q = v * (1 - f * s);
    var t = v * (1 - (1 - f) * s);
    var r = 0;
    var g = 0;
    var b = 0;
    switch (i % 6) {
        case 0:
            (r = v), (g = t), (b = p);
            break;
        case 1:
            (r = q), (g = v), (b = p);
            break;
        case 2:
            (r = p), (g = v), (b = t);
            break;
        case 3:
            (r = p), (g = q), (b = v);
            break;
        case 4:
            (r = t), (g = p), (b = v);
            break;
        case 5:
            (r = v), (g = p), (b = q);
            break;
    }
    return {
        r: byte(r),
        g: byte(g),
        b: byte(b),
        a: a,
    };
}
exports.hsvToRgb = hsvToRgb;
function rgbToHsv(r, g, b, a) {
    if (a === void 0) { a = 1; }
    var max = Math.max(r, g, b);
    var min = Math.min(r, g, b);
    var d = max - min;
    var s = max === 0 ? 0 : d / max;
    var v = max / 255;
    var h = 0;
    switch (max) {
        case min:
            h = 0;
            break;
        case r:
            h = (g - b + d * (g < b ? 6 : 0)) / (6 * d);
            break;
        case g:
            h = (b - r + d * 2) / (6 * d);
            break;
        case b:
            h = (r - g + d * 4) / (6 * d);
            break;
    }
    return {
        h: h,
        s: s,
        v: v,
        a: a,
    };
}
exports.rgbToHsv = rgbToHsv;
function parseColor(color) {
    if (color.match(/^rgb\(/)) {
        var parts = color.substring(4, color.length - 1).split(',');
        return {
            r: +parts[0],
            g: +parts[1],
            b: +parts[2],
            a: 1,
        };
    }
    else if (color.match(/^rgba\(/)) {
        var parts = color.substring(5, color.length - 1).split(',');
        return {
            r: +parts[0],
            g: +parts[1],
            b: +parts[2],
            a: +parts[3],
        };
    }
    else if (color[0] === '#') {
        var value = parseInt(color.substr(1), 16);
        var full = color.length === 7;
        var convert = full
            ? function (v, p) { return (v >> (p * 8)) & 255; }
            : function (v, p) { return ((v >> (p * 4)) & 15) * 17; };
        return {
            r: convert(value, 2),
            g: convert(value, 1),
            b: convert(value, 0),
            a: 1,
        };
    }
    return {
        r: 0,
        g: 0,
        b: 0,
        a: 1,
    };
}
exports.parseColor = parseColor;
function serializeColor(c) {
    return "rgba(" + c.r + ", " + c.g + ", " + c.b + ", " + c.a + ")";
}
exports.serializeColor = serializeColor;
function transparentize(color, alpha) {
    var c = parseColor(color);
    c.a = alpha;
    return serializeColor(c);
}
exports.transparentize = transparentize;
function invertColor(color, blackWhite) {
    if (blackWhite === void 0) { blackWhite = false; }
    var _a = parseColor(color), r = _a.r, g = _a.g, b = _a.b;
    if (!blackWhite) {
        var newR = (255 - r).toString(16);
        var newG = (255 - g).toString(16);
        var newB = (255 - b).toString(16);
        return "rgb(" + newR + ", " + newG + ", " + newB + ")";
    }
    return r * 0.299 + g * 0.587 + b * 0.114 > 186 ? 'rgb(0, 0, 0)' : 'rgb(255, 255, 255)';
}
exports.invertColor = invertColor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3V0aWxzL2NvbG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLFNBQVMsSUFBSSxDQUFDLENBQVM7SUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQ2hELENBQUM7QUFFRCxTQUFnQixRQUFRLENBQUMsQ0FBUyxFQUFFLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBSztJQUFMLGtCQUFBLEVBQUEsS0FBSztJQUM3RCxJQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM1QixJQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwQixJQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdEIsSUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMxQixJQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDaEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRVYsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ2IsS0FBSyxDQUFDO1lBQ0osQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDMUIsTUFBTTtRQUNSLEtBQUssQ0FBQztZQUNKLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzFCLE1BQU07UUFDUixLQUFLLENBQUM7WUFDSixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMxQixNQUFNO1FBQ1IsS0FBSyxDQUFDO1lBQ0osQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDMUIsTUFBTTtRQUNSLEtBQUssQ0FBQztZQUNKLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQzFCLE1BQU07UUFDUixLQUFLLENBQUM7WUFDSixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMxQixNQUFNO0tBQ1Q7SUFFRCxPQUFPO1FBQ0wsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDVixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNWLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1YsQ0FBQyxHQUFBO0tBQ0YsQ0FBQztBQUNKLENBQUM7QUFyQ0QsNEJBcUNDO0FBRUQsU0FBZ0IsUUFBUSxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUyxFQUFFLENBQUs7SUFBTCxrQkFB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QWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMzQixDQUFDO0FBSkQsd0NBSUM7QUFFRCxTQUFnQixXQUFXLENBQUMsS0FBYSxFQUFFLFVBQWtCO0lBQWxCLDJCQUFBLEVBQUEsa0JBQWtCO0lBQ3JELElBQUEsc0JBQStCLEVBQTdCLFFBQUMsRUFBRSxRQUFDLEVBQUUsUUFBdUIsQ0FBQztJQUV0QyxJQUFJLENBQUMsVUFBVSxFQUFFO1FBQ2YsSUFBTSxJQUFJLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3BDLElBQU0sSUFBSSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQyxJQUFNLElBQUksR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDcEMsT0FBTyxTQUFPLElBQUksVUFBSyxJQUFJLFVBQUssSUFBSSxNQUFHLENBQUM7S0FDekM7SUFFRCxPQUFPLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxHQUFHLEtBQUssR0FBRyxDQUFDLEdBQUcsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztBQUN6RixDQUFDO0FBWEQsa0NBV0MiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBieXRlKHY6IG51bWJlcikge1xuICByZXR1cm4gdiA8IDAgPyAwIDogdiA+PSAxID8gMjU1IDogfn4odiAqIDI1Nik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoc3ZUb1JnYihoOiBudW1iZXIsIHM6IG51bWJlciwgdjogbnVtYmVyLCBhID0gMSkge1xuICBjb25zdCBpID0gTWF0aC5mbG9vcihoICogNik7XG4gIGNvbnN0IGYgPSBoICogNiAtIGk7XG4gIGNvbnN0IHAgPSB2ICogKDEgLSBzKTtcbiAgY29uc3QgcSA9IHYgKiAoMSAtIGYgKiBzKTtcbiAgY29uc3QgdCA9IHYgKiAoMSAtICgxIC0gZikgKiBzKTtcbiAgbGV0IHIgPSAwO1xuICBsZXQgZyA9IDA7XG4gIGxldCBiID0gMDtcblxuICBzd2l0Y2ggKGkgJSA2KSB7XG4gICAgY2FzZSAwOlxuICAgICAgKHIgPSB2KSwgKGcgPSB0KSwgKGIgPSBwKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMTpcbiAgICAgIChyID0gcSksIChnID0gdiksIChiID0gcCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDI6XG4gICAgICAociA9IHApLCAoZyA9IHYpLCAoYiA9IHQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAzOlxuICAgICAgKHIgPSBwKSwgKGcgPSBxKSwgKGIgPSB2KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgNDpcbiAgICAgIChyID0gdCksIChnID0gcCksIChiID0gdik7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDU6XG4gICAgICAociA9IHYpLCAoZyA9IHApLCAoYiA9IHEpO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHI6IGJ5dGUociksXG4gICAgZzogYnl0ZShnKSxcbiAgICBiOiBieXRlKGIpLFxuICAgIGEsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZ2JUb0hzdihyOiBudW1iZXIsIGc6IG51bWJlciwgYjogbnVtYmVyLCBhID0gMSkge1xuICBjb25zdCBtYXggPSBNYXRoLm1heChyLCBnLCBiKTtcbiAgY29uc3QgbWluID0gTWF0aC5taW4ociwgZywgYik7XG4gIGNvbnN0IGQgPSBtYXggLSBtaW47XG4gIGNvbnN0IHMgPSBtYXggPT09IDAgPyAwIDogZCAvIG1heDtcbiAgY29uc3QgdiA9IG1heCAvIDI1NTtcbiAgbGV0IGggPSAwO1xuXG4gIHN3aXRjaCAobWF4KSB7XG4gICAgY2FzZSBtaW46XG4gICAgICBoID0gMDtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgcjpcbiAgICAgIGggPSAoZyAtIGIgKyBkICogKGcgPCBiID8gNiA6IDApKSAvICg2ICogZCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIGc6XG4gICAgICBoID0gKGIgLSByICsgZCAqIDIpIC8gKDYgKiBkKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgYjpcbiAgICAgIGggPSAociAtIGcgKyBkICogNCkgLyAoNiAqIGQpO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGgsXG4gICAgcyxcbiAgICB2LFxuICAgIGEsXG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUkdCQUNvbG9yIHtcbiAgcjogbnVtYmVyO1xuICBnOiBudW1iZXI7XG4gIGI6IG51bWJlcjtcbiAgYTogbnVtYmVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VDb2xvcihjb2xvcjogc3RyaW5nKTogUkdCQUNvbG9yIHtcbiAgaWYgKGNvbG9yLm1hdGNoKC9ecmdiXFwoLykpIHtcbiAgICBjb25zdCBwYXJ0cyA9IGNvbG9yLnN1YnN0cmluZyg0LCBjb2xvci5sZW5ndGggLSAxKS5zcGxpdCgnLCcpO1xuICAgIHJldHVybiB7XG4gICAgICByOiArcGFydHNbMF0sXG4gICAgICBnOiArcGFydHNbMV0sXG4gICAgICBiOiArcGFydHNbMl0sXG4gICAgICBhOiAxLFxuICAgIH07XG4gIH0gZWxzZSBpZiAoY29sb3IubWF0Y2goL15yZ2JhXFwoLykpIHtcbiAgICBjb25zdCBwYXJ0cyA9IGNvbG9yLnN1YnN0cmluZyg1LCBjb2xvci5sZW5ndGggLSAxKS5zcGxpdCgnLCcpO1xuICAgIHJldHVybiB7XG4gICAgICByOiArcGFydHNbMF0sXG4gICAgICBnOiArcGFydHNbMV0sXG4gICAgICBiOiArcGFydHNbMl0sXG4gICAgICBhOiArcGFydHNbM10sXG4gICAgfTtcbiAgfSBlbHNlIGlmIChjb2xvclswXSA9PT0gJyMnKSB7XG4gICAgY29uc3QgdmFsdWUgPSBwYXJzZUludChjb2xvci5zdWJzdHIoMSksIDE2KTtcbiAgICBjb25zdCBmdWxsID0gY29sb3IubGVuZ3RoID09PSA3O1xuICAgIGNvbnN0IGNvbnZlcnQgPSBmdWxsXG4gICAgICA/ICh2OiBudW1iZXIsIHA6IG51bWJlcikgPT4gKHYgPj4gKHAgKiA4KSkgJiAyNTVcbiAgICAgIDogKHY6IG51bWJlciwgcDogbnVtYmVyKSA9PiAoKHYgPj4gKHAgKiA0KSkgJiAxNSkgKiAxNztcbiAgICByZXR1cm4ge1xuICAgICAgcjogY29udmVydCh2YWx1ZSwgMiksXG4gICAgICBnOiBjb252ZXJ0KHZhbHVlLCAxKSxcbiAgICAgIGI6IGNvbnZlcnQodmFsdWUsIDApLFxuICAgICAgYTogMSxcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICByOiAwLFxuICAgIGc6IDAsXG4gICAgYjogMCxcbiAgICBhOiAxLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplQ29sb3IoYzogUkdCQUNvbG9yKTogc3RyaW5nIHtcbiAgcmV0dXJuIGByZ2JhKCR7Yy5yfSwgJHtjLmd9LCAke2MuYn0sICR7Yy5hfSlgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNwYXJlbnRpemUoY29sb3I6IHN0cmluZywgYWxwaGE6IG51bWJlcik6IHN0cmluZyB7XG4gIGNvbnN0IGMgPSBwYXJzZUNvbG9yKGNvbG9yKTtcbiAgYy5hID0gYWxwaGE7XG4gIHJldHVybiBzZXJpYWxpemVDb2xvcihjKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGludmVydENvbG9yKGNvbG9yOiBzdHJpbmcsIGJsYWNrV2hpdGUgPSBmYWxzZSkge1xuICBjb25zdCB7IHIsIGcsIGIgfSA9IHBhcnNlQ29sb3IoY29sb3IpO1xuXG4gIGlmICghYmxhY2tXaGl0ZSkge1xuICAgIGNvbnN0IG5ld1IgPSAoMjU1IC0gcikudG9TdHJpbmcoMTYpO1xuICAgIGNvbnN0IG5ld0cgPSAoMjU1IC0gZykudG9TdHJpbmcoMTYpO1xuICAgIGNvbnN0IG5ld0IgPSAoMjU1IC0gYikudG9TdHJpbmcoMTYpO1xuICAgIHJldHVybiBgcmdiKCR7bmV3Un0sICR7bmV3R30sICR7bmV3Qn0pYDtcbiAgfVxuXG4gIHJldHVybiByICogMC4yOTkgKyBnICogMC41ODcgKyBiICogMC4xMTQgPiAxODYgPyAncmdiKDAsIDAsIDApJyA6ICdyZ2IoMjU1LCAyNTUsIDI1NSknO1xufVxuIl19