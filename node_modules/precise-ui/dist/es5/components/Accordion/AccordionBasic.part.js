"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var Icon_1 = require("../Icon");
var remCalc_1 = require("../../utils/remCalc");
var distance_1 = require("../../distance");
var indexHelper_1 = require("../AccordionTable/helpers/indexHelper");
var Expander_1 = require("../Expander");
var textStyles_1 = require("../../textStyles");
var animationDuration = '0.3s';
var animationFunction = 'cubic-bezier(0, 0, 0.25, 1)';
var AccordionContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject([""], [""])));
var AccordionItems = styled_1.default.ul(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  padding: 0;\n  list-style: none;\n"], ["\n  padding: 0;\n  list-style: none;\n"])));
var AccordionItem = styled_1.default.li(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  ", "\n\n  position: relative;\n  z-index: 1;\n  margin: 0;\n  text-align: left;\n  overflow: visible;\n  border-top: ", ";\n  box-sizing: border-box;\n  color: ", ";\n\n  &:last-child {\n    border-bottom: ", ";\n  }\n"], ["\n  ", "\n\n  position: relative;\n  z-index: 1;\n  margin: 0;\n  text-align: left;\n  overflow: visible;\n  border-top: ", ";\n  box-sizing: border-box;\n  color: ", ";\n\n  &:last-child {\n    border-bottom: ", ";\n  }\n"])), textStyles_1.getFontStyle({ size: 'small' }), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.accordionLine;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.accordionLine;
}));
var AccordionItemHeaderContainer = styled_1.default('div')(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  transition: background-color ", " ", ";\n  background-color: ", ";\n"], ["\n  transition: background-color ", " ", ";\n  background-color: ", ";\n"])), animationDuration, animationFunction, styled_1.themed(function (props) { return (props.active ? props.theme.ui2 : props.theme.ui1); }));
var AccordionItemHeader = styled_1.default.div(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  display: flex;\n  white-space: pre-wrap;\n  align-items: center;\n  cursor: pointer;\n  padding: ", ";\n"], ["\n  display: flex;\n  white-space: pre-wrap;\n  align-items: center;\n  cursor: pointer;\n  padding: ", ";\n"])), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.accordionPadding;
}));
var StyledIcon = styled_1.default(Icon_1.Icon)(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  font-size: ", ";\n  margin-right: ", ";\n  transition: transform 0.2s ", ";\n  transform: ", ";\n"], ["\n  font-size: ", ";\n  margin-right: ", ";\n  transition: transform 0.2s ", ";\n  transform: ", ";\n"])), remCalc_1.remCalc('18px'), distance_1.distance.medium, animationFunction, function (_a) {
    var isRotated = _a.isRotated;
    return "rotate(" + (isRotated ? 90 : 0) + "deg)";
});
var AccordionItemContent = styled_1.default.div(templateObject_7 || (templateObject_7 = __makeTemplateObject(["\n  padding: ", ";\n"], ["\n  padding: ", ";\n"])), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.accordionContentPadding;
}));
var AccordionBasic = /** @class */ (function (_super) {
    __extends(AccordionBasic, _super);
    function AccordionBasic(props) {
        var _this = _super.call(this, props) || this;
        _this.selects = [];
        _this.state = {
            selectedIndexes: props.selectedIndex !== undefined
                ? indexHelper_1.normalizeIndex(props.selectedIndex)
                : indexHelper_1.normalizeIndex(props.defaultSelectedIndex),
            controlled: props.selectedIndex !== undefined,
        };
        return _this;
    }
    AccordionBasic.prototype.componentDidMount = function () {
        var defaultSelectedIndex = this.props.defaultSelectedIndex;
        if (defaultSelectedIndex) {
            this.setState({
                selectedIndexes: indexHelper_1.normalizeIndex(defaultSelectedIndex),
            });
        }
    };
    AccordionBasic.getDerivedStateFromProps = function (props, state) {
        var selectedIndex = props.selectedIndex;
        if (state.controlled && selectedIndex !== undefined) {
            return {
                selectedIndexes: indexHelper_1.normalizeIndex(selectedIndex),
            };
        }
        return state;
    };
    AccordionBasic.prototype.changeIndex = function (target) {
        var _a = this.props, onChange = _a.onChange, multiple = _a.multiple;
        var _b = this.state, controlled = _b.controlled, selectedIndexes = _b.selectedIndexes;
        var nextIndexes = indexHelper_1.toggleIndex(selectedIndexes, target, multiple);
        if (typeof onChange === 'function') {
            onChange({
                selectedIndex: multiple ? nextIndexes : nextIndexes[0] !== undefined ? nextIndexes[0] : -1,
                previousIndex: multiple ? selectedIndexes : selectedIndexes[0] !== undefined ? selectedIndexes[0] : -1,
            });
        }
        if (!controlled) {
            this.setState({
                selectedIndexes: nextIndexes,
            });
        }
    };
    AccordionBasic.prototype.render = function () {
        var _this = this;
        var selectedIndexes = this.state.selectedIndexes;
        var _a = this.props, children = _a.children, theme = _a.theme, _0 = _a.onChange, _1 = _a.selectedIndex;
        var items = [];
        var selects = this.selects;
        React.Children.forEach(children, function (element, index) {
            if (element && React.isValidElement(element)) {
                var header = element.props.header;
                var active = indexHelper_1.hasIndex(selectedIndexes, index);
                if (selects[index] === undefined) {
                    selects[index] = function () { return _this.changeIndex(index); };
                }
                items.push(React.createElement(AccordionItem, { theme: theme, key: "item-" + index },
                    React.createElement(AccordionItemHeaderContainer, { active: active },
                        React.createElement(AccordionItemHeader, { theme: theme, onClick: selects[index] },
                            React.createElement(StyledIcon, { isRotated: active, name: "KeyboardArrowRight" }),
                            header)),
                    React.createElement(Expander_1.Expander, { expand: active, timeout: 300, unmountOnExit: true },
                        React.createElement(AccordionItemContent, { theme: theme }, element))));
            }
        });
        return (React.createElement(AccordionContainer, null,
            React.createElement(AccordionItems, { theme: theme }, items)));
    };
    AccordionBasic.inner = {
        get AccordionItem() { return AccordionItem; },
        get AccordionItemHeaderContainer() { return AccordionItemHeaderContainer; },
        get AccordionItemHeader() { return AccordionItemHeader; },
        get StyledIcon() { return StyledIcon; },
        get Expander() { return Expander_1.Expander; },
        get AccordionItemContent() { return AccordionItemContent; },
        get AccordionContainer() { return AccordionContainer; },
        get AccordionItems() { return AccordionItems; }
    };
    return AccordionBasic;
}(React.Component));
exports.AccordionBasic = AccordionBasic;
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjb3JkaW9uQmFzaWMucGFydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0FjY29yZGlvbi9BY2NvcmRpb25CYXNpYy5wYXJ0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkJBQStCO0FBQy9CLDZDQUFvRDtBQUVwRCxnQ0FBK0I7QUFDL0IsK0NBQThDO0FBQzlDLDJDQUEwQztBQUUxQyxxRUFBOEY7QUFDOUYsd0NBQXVDO0FBQ3ZDLCtDQUFnRDtBQWlCaEQsSUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUM7QUFDakMsSUFBTSxpQkFBaUIsR0FBRyw2QkFBNkIsQ0FBQztBQUN4RCxJQUFNLGtCQUFrQixHQUFHLGdCQUFNLENBQUMsR0FBRyxxRUFBQyxFQUFFLElBQUEsQ0FBQztBQUN6QyxJQUFNLGNBQWMsR0FBRyxnQkFBTSxDQUFDLEVBQUUsMkdBQUMsd0NBR2hDLElBQUEsQ0FBQztBQUNGLElBQU0sYUFBYSxHQUFHLGdCQUFNLENBQUMsRUFBRSxtU0FBQyxNQUM1QixFQUErQixtSEFPbkIsRUFBMEMseUNBRS9DLEVBQWtDLDRDQUd4QixFQUEwQyxVQUU5RCxLQWRHLHlCQUFZLENBQUMsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFPbkIsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsYUFBYTtBQUFuQixDQUFtQixDQUFDLEVBRS9DLGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsS0FBSyxDQUFDLEtBQUs7QUFBWCxDQUFXLENBQUMsRUFHeEIsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsYUFBYTtBQUFuQixDQUFtQixDQUFDLENBRTlELENBQUM7QUFDRixJQUFNLDRCQUE0QixHQUFHLGdCQUFNLENBQUMsS0FBSyxD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QWtCLEtBQUssT0FBTyxrQkFBK0MsQ0FBQyxDQUFDLENBQUM7UUFDcEYsSUFBSSxjQUFjLEtBQUssT0FBTyxjQUF1QyxDQUFDLENBQUMsQ0FBQztLQUMzRSxDQUFDO0lBQ04scUJBQUM7Q0FBQSxBQW5GRCxDQUFvQyxLQUFLLENBQUMsU0FBUyxHQW1GbEQ7QUFuRlksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBBY2NvcmRpb25UYWJQcm9wcyB9IGZyb20gJy4uL0FjY29yZGlvblRhYic7XG5pbXBvcnQgeyBJY29uIH0gZnJvbSAnLi4vSWNvbic7XG5pbXBvcnQgeyByZW1DYWxjIH0gZnJvbSAnLi4vLi4vdXRpbHMvcmVtQ2FsYyc7XG5pbXBvcnQgeyBkaXN0YW5jZSB9IGZyb20gJy4uLy4uL2Rpc3RhbmNlJztcbmltcG9ydCB7IEFjY29yZGlvblByb3BzIH0gZnJvbSAnLi9BY2NvcmRpb24udHlwZXMucGFydCc7XG5pbXBvcnQgeyBub3JtYWxpemVJbmRleCwgdG9nZ2xlSW5kZXgsIGhhc0luZGV4IH0gZnJvbSAnLi4vQWNjb3JkaW9uVGFibGUvaGVscGVycy9pbmRleEhlbHBlcic7XG5pbXBvcnQgeyBFeHBhbmRlciB9IGZyb20gJy4uL0V4cGFuZGVyJztcbmltcG9ydCB7IGdldEZvbnRTdHlsZSB9IGZyb20gJy4uLy4uL3RleHRTdHlsZXMnO1xuZXhwb3J0IGludGVyZmFjZSBBY2NvcmRpb25CYXNpY1N0YXRlIHtcbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIGluZGljZXMuXG4gICAgICovXG4gICAgc2VsZWN0ZWRJbmRleGVzOiBBcnJheTxudW1iZXI+O1xuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIGFjY29yZGlvbiBjb21wb25lbnQgaXMgY29udHJvbGxlZCBmcm9tIHRoZSBvdXRzaWRlIG9yIG5vdC5cbiAgICAgKi9cbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIEFjY29yZGlvbkl0ZW1Qcm9wcyB7XG4gICAgYWN0aXZlPzogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBTdHlsZWRBcnJvd1Byb3BzIHtcbiAgICBpc1JvdGF0ZWQ6IGJvb2xlYW47XG59XG5jb25zdCBhbmltYXRpb25EdXJhdGlvbiA9ICcwLjNzJztcbmNvbnN0IGFuaW1hdGlvbkZ1bmN0aW9uID0gJ2N1YmljLWJlemllcigwLCAwLCAwLjI1LCAxKSc7XG5jb25zdCBBY2NvcmRpb25Db250YWluZXIgPSBzdHlsZWQuZGl2IGBgO1xuY29uc3QgQWNjb3JkaW9uSXRlbXMgPSBzdHlsZWQudWwgYFxuICBwYWRkaW5nOiAwO1xuICBsaXN0LXN0eWxlOiBub25lO1xuYDtcbmNvbnN0IEFjY29yZGlvbkl0ZW0gPSBzdHlsZWQubGkgYFxuICAke2dldEZvbnRTdHlsZSh7IHNpemU6ICdzbWFsbCcgfSl9XG5cbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICB6LWluZGV4OiAxO1xuICBtYXJnaW46IDA7XG4gIHRleHQtYWxpZ246IGxlZnQ7XG4gIG92ZXJmbG93OiB2aXNpYmxlO1xuICBib3JkZXItdG9wOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS5hY2NvcmRpb25MaW5lKX07XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGNvbG9yOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS50ZXh0MSl9O1xuXG4gICY6bGFzdC1jaGlsZCB7XG4gICAgYm9yZGVyLWJvdHRvbTogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUuYWNjb3JkaW9uTGluZSl9O1xuICB9XG5gO1xuY29uc3QgQWNjb3JkaW9uSXRlbUhlYWRlckNvbnRhaW5lciA9IHN0eWxlZCgnZGl2Jyk8QWNjb3JkaW9uSXRlbVByb3BzPiBgXG4gIHRyYW5zaXRpb246IGJhY2tncm91bmQtY29sb3IgJHthbmltYXRpb25EdXJhdGlvbn0gJHthbmltYXRpb25GdW5jdGlvbn07XG4gIGJhY2tncm91bmQtY29sb3I6ICR7dGhlbWVkKHByb3BzID0+IChwcm9wcy5hY3RpdmUgPyBwcm9wcy50aGVtZS51aTIgOiBwcm9wcy50aGVtZS51aTEpKX07XG5gO1xuY29uc3QgQWNjb3JkaW9uSXRlbUhlYWRlciA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBmbGV4O1xuICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgcGFkZGluZzogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUuYWNjb3JkaW9uUGFkZGluZyl9O1xuYDtcbmNvbnN0IFN0eWxlZEljb24gPSBzdHlsZWQoSWNvbik8U3R5bGVkQXJyb3dQcm9wcz4gYFxuICBmb250LXNpemU6ICR7cmVtQ2FsYygnMThweCcpfTtcbiAgbWFyZ2luLXJpZ2h0OiAke2Rpc3RhbmNlLm1lZGl1bX07XG4gIHRyYW5zaXRpb246IHRyYW5zZm9ybSAwLjJzICR7YW5pbWF0aW9uRnVuY3Rpb259O1xuICB0cmFuc2Zvcm06ICR7KHsgaXNSb3RhdGVkIH0pID0+IGByb3RhdGUoJHtpc1JvdGF0ZWQgPyA5MCA6IDB9ZGVnKWB9O1xuYDtcbmNvbnN0IEFjY29yZGlvbkl0ZW1Db250ZW50ID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLmFjY29yZGlvbkNvbnRlbnRQYWRkaW5nKX07XG5gO1xuZXhwb3J0IGNsYXNzIEFjY29yZGlvbkJhc2ljIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PEFjY29yZGlvblByb3BzLCBBY2NvcmRpb25CYXNpY1N0YXRlPiB7XG4gICAgcHJpdmF0ZSBzZWxlY3RzOiBBcnJheTwoKSA9PiB2b2lkPiA9IFtdO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBBY2NvcmRpb25Qcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBzZWxlY3RlZEluZGV4ZXM6IHByb3BzLnNlbGVjdGVkSW5kZXggIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgID8gbm9ybWFsaXplSW5kZXgocHJvcHMuc2VsZWN0ZWRJbmRleClcbiAgICAgICAgICAgICAgICA6IG5vcm1hbGl6ZUluZGV4KHByb3BzLmRlZmF1bHRTZWxlY3RlZEluZGV4KSxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLnNlbGVjdGVkSW5kZXggIT09IHVuZGVmaW5lZCxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZGVmYXVsdFNlbGVjdGVkSW5kZXggfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChkZWZhdWx0U2VsZWN0ZWRJbmRleCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBub3JtYWxpemVJbmRleChkZWZhdWx0U2VsZWN0ZWRJbmRleCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdGF0aWMgZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzKHByb3BzOiBBY2NvcmRpb25Qcm9wcywgc3RhdGU6IEFjY29yZGlvbkJhc2ljU3RhdGUpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZEluZGV4IH0gPSBwcm9wcztcbiAgICAgICAgaWYgKHN0YXRlLmNvbnRyb2xsZWQgJiYgc2VsZWN0ZWRJbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXhlczogbm9ybWFsaXplSW5kZXgoc2VsZWN0ZWRJbmRleCksXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG4gICAgcHJpdmF0ZSBjaGFuZ2VJbmRleCh0YXJnZXQ6IG51bWJlcikge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBtdWx0aXBsZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkLCBzZWxlY3RlZEluZGV4ZXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IG5leHRJbmRleGVzID0gdG9nZ2xlSW5kZXgoc2VsZWN0ZWRJbmRleGVzLCB0YXJnZXQsIG11bHRpcGxlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IG11bHRpcGxlID8gbmV4dEluZGV4ZXMgOiBuZXh0SW5kZXhlc1swXSAhPT0gdW5kZWZpbmVkID8gbmV4dEluZGV4ZXNbMF0gOiAtMSxcbiAgICAgICAgICAgICAgICBwcmV2aW91c0luZGV4OiBtdWx0aXBsZSA/IHNlbGVjdGVkSW5kZXhlcyA6IHNlbGVjdGVkSW5kZXhlc1swXSAhPT0gdW5kZWZpbmVkID8gc2VsZWN0ZWRJbmRleGVzWzBdIDogLTEsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXhlczogbmV4dEluZGV4ZXMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRJbmRleGVzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGNoaWxkcmVuLCB0aGVtZSwgb25DaGFuZ2U6IF8wLCBzZWxlY3RlZEluZGV4OiBfMSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgaXRlbXM6IEFycmF5PFJlYWN0LlJlYWN0Q2hpbGQ+ID0gW107XG4gICAgICAgIGNvbnN0IHNlbGVjdHMgPSB0aGlzLnNlbGVjdHM7XG4gICAgICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIChlbGVtZW50OiBSZWFjdC5SZWFjdEVsZW1lbnQ8QWNjb3JkaW9uVGFiUHJvcHM+LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQgJiYgUmVhY3QuaXNWYWxpZEVsZW1lbnQoZWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IGhlYWRlciB9ID0gZWxlbWVudC5wcm9wcztcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmUgPSBoYXNJbmRleChzZWxlY3RlZEluZGV4ZXMsIGluZGV4KTtcbiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0c1tpbmRleF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RzW2luZGV4XSA9ICgpID0+IHRoaXMuY2hhbmdlSW5kZXgoaW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKDxBY2NvcmRpb25JdGVtIHRoZW1lPXt0aGVtZX0ga2V5PXtgaXRlbS0ke2luZGV4fWB9PlxuICAgICAgICAgICAgPEFjY29yZGlvbkl0ZW1IZWFkZXJDb250YWluZXIgYWN0aXZlPXthY3RpdmV9PlxuICAgICAgICAgICAgICA8QWNjb3JkaW9uSXRlbUhlYWRlciB0aGVtZT17dGhlbWV9IG9uQ2xpY2s9e3NlbGVjdHNbaW5kZXhdfT5cbiAgICAgICAgICAgICAgICA8U3R5bGVkSWNvbiBpc1JvdGF0ZWQ9e2FjdGl2ZX0gbmFtZT1cIktleWJvYXJkQXJyb3dSaWdodFwiLz5cbiAgICAgICAgICAgICAgICB7aGVhZGVyfVxuICAgICAgICAgICAgICA8L0FjY29yZGlvbkl0ZW1IZWFkZXI+XG4gICAgICAgICAgICA8L0FjY29yZGlvbkl0ZW1IZWFkZXJDb250YWluZXI+XG4gICAgICAgICAgICA8RXhwYW5kZXIgZXhwYW5kPXthY3RpdmV9IHRpbWVvdXQ9ezMwMH0gdW5tb3VudE9uRXhpdD5cbiAgICAgICAgICAgICAgPEFjY29yZGlvbkl0ZW1Db250ZW50IHRoZW1lPXt0aGVtZX0+e2VsZW1lbnR9PC9BY2NvcmRpb25JdGVtQ29udGVudD5cbiAgICAgICAgICAgIDwvRXhwYW5kZXI+XG4gICAgICAgICAgPC9BY2NvcmRpb25JdGVtPik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKDxBY2NvcmRpb25Db250YWluZXI+XG4gICAgICAgIDxBY2NvcmRpb25JdGVtcyB0aGVtZT17dGhlbWV9PntpdGVtc308L0FjY29yZGlvbkl0ZW1zPlxuICAgICAgPC9BY2NvcmRpb25Db250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgQWNjb3JkaW9uSXRlbSgpIHsgcmV0dXJuIEFjY29yZGlvbkl0ZW0gYXMgdHlwZW9mIEFjY29yZGlvbkl0ZW07IH0sXG4gICAgICAgIGdldCBBY2NvcmRpb25JdGVtSGVhZGVyQ29udGFpbmVyKCkgeyByZXR1cm4gQWNjb3JkaW9uSXRlbUhlYWRlckNvbnRhaW5lciBhcyB0eXBlb2YgQWNjb3JkaW9uSXRlbUhlYWRlckNvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IEFjY29yZGlvbkl0ZW1IZWFkZXIoKSB7IHJldHVybiBBY2NvcmRpb25JdGVtSGVhZGVyIGFzIHR5cGVvZiBBY2NvcmRpb25JdGVtSGVhZGVyOyB9LFxuICAgICAgICBnZXQgU3R5bGVkSWNvbigpIHsgcmV0dXJuIFN0eWxlZEljb24gYXMgdHlwZW9mIFN0eWxlZEljb247IH0sXG4gICAgICAgIGdldCBFeHBhbmRlcigpIHsgcmV0dXJuIEV4cGFuZGVyIGFzIHR5cGVvZiBFeHBhbmRlcjsgfSxcbiAgICAgICAgZ2V0IEFjY29yZGlvbkl0ZW1Db250ZW50KCkgeyByZXR1cm4gQWNjb3JkaW9uSXRlbUNvbnRlbnQgYXMgdHlwZW9mIEFjY29yZGlvbkl0ZW1Db250ZW50OyB9LFxuICAgICAgICBnZXQgQWNjb3JkaW9uQ29udGFpbmVyKCkgeyByZXR1cm4gQWNjb3JkaW9uQ29udGFpbmVyIGFzIHR5cGVvZiBBY2NvcmRpb25Db250YWluZXI7IH0sXG4gICAgICAgIGdldCBBY2NvcmRpb25JdGVtcygpIHsgcmV0dXJuIEFjY29yZGlvbkl0ZW1zIGFzIHR5cGVvZiBBY2NvcmRpb25JdGVtczsgfVxuICAgIH07XG59XG4iXX0=