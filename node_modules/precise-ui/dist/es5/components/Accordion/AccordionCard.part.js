"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var distance_1 = require("../../distance");
var List_1 = require("../List");
var ListItem_1 = require("../ListItem");
var indexHelper_1 = require("../AccordionTable/helpers/indexHelper");
var textStyles_1 = require("../../textStyles");
var animationDuration = '0.3s';
var animationFunction = 'cubic-bezier(0, 0, 0.25, 1)';
var StyledList = styled_1.default(List_1.List)(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  overflow: visible;\n"], ["\n  overflow: visible;\n"])));
var StyledListItem = styled_1.default(ListItem_1.ListItem)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  padding: 0;\n  margin-bottom: ", ";\n  border: none;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n"], ["\n  padding: 0;\n  margin-bottom: ", ";\n  border: none;\n\n  &:last-child {\n    margin-bottom: 0;\n  }\n"])), distance_1.distance.xlarge);
var Container = styled_1.default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  ", "\n\n  position: relative;\n  color: ", ";\n"], ["\n  ", "\n\n  position: relative;\n  color: ", ";\n"])), textStyles_1.getFontStyle({ size: 'medium' }), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}));
var ContentContainer = styled_1.default.div(styled_1.themed(function (_a) {
    var open = _a.open, _b = _a.theme, ui1 = _b.ui1, ui2 = _b.ui2, ui4 = _b.ui4, ui5 = _b.ui5;
    return styled_1.css(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n      ", "\n\n      padding: ", ";\n      background: ", ";\n      border: 1px solid ", ";\n      border-bottom: ", ";\n    "], ["\n      ", "\n\n      padding: ", ";\n      background: ", ";\n      border: 1px solid ", ";\n      border-bottom: ", ";\n    "])), textStyles_1.getFontStyle({ size: 'small' }), distance_1.distance.medium, open ? ui2 : ui1, open ? ui5 : ui4, open ? "1px solid " + ui4 : 'none');
}));
var DetailsContainerAnimator = styled_1.default('div')(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  transition: all ", " ", ";\n  max-height: ", ";\n  opacity: ", ";\n  overflow: hidden;\n"], ["\n  transition: all ", " ", ";\n  max-height: ", ";\n  opacity: ", ";\n  overflow: hidden;\n"])), animationDuration, animationFunction, function (_a) {
    var open = _a.open;
    return (open ? '10000px' : '0');
}, function (_a) {
    var open = _a.open;
    return (open ? '1' : '0');
});
var DetailsContainer = styled_1.default.div(styled_1.themed(function (_a) {
    var open = _a.open, _b = _a.theme, ui4 = _b.ui4, ui5 = _b.ui5;
    return styled_1.css(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n      border-right: 1px solid ", ";\n      border-left: 1px solid ", ";\n    "], ["\n      border-right: 1px solid ", ";\n      border-left: 1px solid ", ";\n    "])), open ? ui5 : ui4, open ? ui5 : ui4);
}));
var ActionContainer = styled_1.default.div(styled_1.themed(function (_a) {
    var open = _a.open, _b = _a.theme, ui0 = _b.ui0, ui1 = _b.ui1;
    return styled_1.css(templateObject_7 || (templateObject_7 = __makeTemplateObject(["\n      text-align: center;\n      padding: ", " ", ";\n      cursor: pointer;\n      background: ", ";\n      border: ", ";\n      color: ", ";\n    "], ["\n      text-align: center;\n      padding: ", " ", ";\n      cursor: pointer;\n      background: ", ";\n      border: ", ";\n      color: ", ";\n    "])), distance_1.distance.small, distance_1.distance.medium, open ? ui1 : ui0, open ? "1px solid " + ui0 : 'none', open ? ui0 : ui1);
}));
var AccordionCard = /** @class */ (function (_super) {
    __extends(AccordionCard, _super);
    function AccordionCard(props) {
        var _this = _super.call(this, props) || this;
        _this.selects = [];
        _this.state = {
            selectedIndexes: props.selectedIndex !== undefined
                ? indexHelper_1.normalizeIndex(props.selectedIndex)
                : indexHelper_1.normalizeIndex(props.defaultSelectedIndex),
            controlled: props.selectedIndex !== undefined,
        };
        return _this;
    }
    AccordionCard.getDerivedStateFromProps = function (props, state) {
        var selectedIndex = props.selectedIndex, defaultSelectedIndex = props.defaultSelectedIndex;
        if (state.controlled && selectedIndex !== undefined) {
            return {
                selectedIndexes: indexHelper_1.normalizeIndex(selectedIndex),
            };
        }
        else if (defaultSelectedIndex !== undefined) {
            return {
                selectedIndexes: indexHelper_1.normalizeIndex(defaultSelectedIndex),
            };
        }
        return state;
    };
    AccordionCard.prototype.changeIndex = function (target) {
        var _a = this.props, onChange = _a.onChange, multiple = _a.multiple;
        var _b = this.state, controlled = _b.controlled, selectedIndexes = _b.selectedIndexes;
        var nextIndexes = indexHelper_1.toggleIndex(selectedIndexes, target, multiple);
        if (typeof onChange === 'function') {
            onChange({
                selectedIndex: multiple ? nextIndexes : nextIndexes[0] !== undefined ? nextIndexes[0] : -1,
                previousIndex: multiple ? selectedIndexes : selectedIndexes[0] !== undefined ? selectedIndexes[0] : -1,
            });
        }
        if (!controlled) {
            this.setState({
                selectedIndexes: nextIndexes,
            });
        }
    };
    AccordionCard.prototype.render = function () {
        var _this = this;
        var selectedIndexes = this.state.selectedIndexes;
        var _a = this.props, children = _a.children, theme = _a.theme, _0 = _a.onChange, _1 = _a.selectedIndex, openLabel = _a.openLabel, closeLabel = _a.closeLabel;
        var items = [];
        var selects = this.selects;
        React.Children.forEach(children, function (element, index) {
            if (element && React.isValidElement(element)) {
                var header = element.props.header;
                var open_1 = indexHelper_1.hasIndex(selectedIndexes, index);
                if (selects[index] === undefined) {
                    selects[index] = function () { return _this.changeIndex(index); };
                }
                items.push(React.createElement(StyledListItem, { theme: theme, key: "item-" + index },
                    React.createElement(Container, { theme: theme },
                        React.createElement(ContentContainer, { theme: theme, open: open_1 }, header),
                        React.createElement(DetailsContainerAnimator, { open: open_1 },
                            React.createElement(DetailsContainer, { open: open_1 }, element)),
                        React.createElement(ActionContainer, { theme: theme, onClick: selects[index], open: open_1 }, open_1 ? closeLabel || 'Close Details' : openLabel || 'Open Details'))));
            }
        });
        return React.createElement(StyledList, { borderless: true }, items);
    };
    AccordionCard.inner = {
        get StyledListItem() { return StyledListItem; },
        get Container() { return Container; },
        get ContentContainer() { return ContentContainer; },
        get DetailsContainerAnimator() { return DetailsContainerAnimator; },
        get DetailsContainer() { return DetailsContainer; },
        get ActionContainer() { return ActionContainer; },
        get StyledList() { return StyledList; }
    };
    return AccordionCard;
}(React.Component));
exports.AccordionCard = AccordionCard;
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjb3JkaW9uQ2FyZC5wYXJ0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvQWNjb3JkaW9uL0FjY29yZGlvbkNhcmQucGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBeUQ7QUFFekQsMkNBQTBDO0FBRTFDLGdDQUErQjtBQUMvQix3Q0FBdUM7QUFDdkMscUVBQThGO0FBQzlGLCtDQUFnRDtBQWVoRCxJQUFNLGlCQUFpQixHQUFHLE1BQU0sQ0FBQztBQUNqQyxJQUFNLGlCQUFpQixHQUFHLDZCQUE2QixDQUFDO0FBQ3hELElBQU0sVUFBVSxHQUFHLGdCQUFNLENBQUMsV0FBSSxDQUFDLDZGQUFDLDBCQUUvQixJQUFBLENBQUM7QUFDRixJQUFNLGNBQWMsR0FBRyxnQkFBTSxDQUFDLG1CQUFRLENBQUMsK0tBQUMsb0NBRXJCLEVBQWUsc0VBTWpDLEtBTmtCLG1CQUFRLENBQUMsTUFBTSxDQU1qQyxDQUFDO0FBQ0YsSUFBTSxTQUFTLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLHdIQUFDLE1BQ3pCLEVBQWdDLHNDQUd6QixFQUFrQyxLQUM1QyxLQUpHLHlCQUFZLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFHekIsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsS0FBSztBQUFYLENBQVcsQ0FBQyxDQUM1QyxDQUFDO0FBQ0YsSUFBTSxnQkFBZ0IsR0FBRyxnQkFBTSxDQUFDLEdBQUcsQ0FBYyxlQUFNLENBQUMsVUFBQyxFQUF1QztRQUFyQyxjQUFJLEVBQUUsYUFBNkIsRUFBcEIsWUFBRyxFQUFFLFlBQUcsRUFBRSxZQUFHLEVBQUUsWUFBRztJQUFTLE9BQUEsWUFBRyxtTUFBQyxVQUNqRyxFQUErQixxQkFFdEIsRUFBZSx1QkFDWixFQUFnQiw2QkFDVixFQUFn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QyxVQUFVLElBQUksZUFBZSxDQUFDLENBQUMsQ0FBQyxTQUFTLElBQUksY0FBYyxDQUNuRCxDQUNSLENBQ0csQ0FBQyxDQUFDO2FBQ2hCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLG9CQUFDLFVBQVUsSUFBQyxVQUFVLFVBQUUsS0FBSyxDQUFjLENBQUM7SUFDdkQsQ0FBQztJQUNNLG1CQUFLLEdBQUc7UUFDWCxJQUFJLGNBQWMsS0FBSyxPQUFPLGNBQXVDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLElBQUksU0FBUyxLQUFLLE9BQU8sU0FBNkIsQ0FBQyxDQUFDLENBQUM7UUFDekQsSUFBSSxnQkFBZ0IsS0FBSyxPQUFPLGdCQUEyQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxJQUFJLHdCQUF3QixLQUFLLE9BQU8sd0JBQTJELENBQUMsQ0FBQyxDQUFDO1FBQ3RHLElBQUksZ0JBQWdCLEtBQUssT0FBTyxnQkFBMkMsQ0FBQyxDQUFDLENBQUM7UUFDOUUsSUFBSSxlQUFlLEtBQUssT0FBTyxlQUF5QyxDQUFDLENBQUMsQ0FBQztRQUMzRSxJQUFJLFVBQVUsS0FBSyxPQUFPLFVBQStCLENBQUMsQ0FBQyxDQUFDO0tBQy9ELENBQUM7SUFDTixvQkFBQztDQUFBLEFBakZELENBQW1DLEtBQUssQ0FBQyxTQUFTLEdBaUZqRDtBQWpGWSxzQ0FBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkLCBjc3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgQWNjb3JkaW9uUHJvcHMgfSBmcm9tICcuL0FjY29yZGlvbi50eXBlcy5wYXJ0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgQWNjb3JkaW9uVGFiUHJvcHMgfSBmcm9tICcuLi9BY2NvcmRpb25UYWInO1xuaW1wb3J0IHsgTGlzdCB9IGZyb20gJy4uL0xpc3QnO1xuaW1wb3J0IHsgTGlzdEl0ZW0gfSBmcm9tICcuLi9MaXN0SXRlbSc7XG5pbXBvcnQgeyBub3JtYWxpemVJbmRleCwgdG9nZ2xlSW5kZXgsIGhhc0luZGV4IH0gZnJvbSAnLi4vQWNjb3JkaW9uVGFibGUvaGVscGVycy9pbmRleEhlbHBlcic7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmV4cG9ydCBpbnRlcmZhY2UgQWNjb3JkaW9uQ2FyZFN0YXRlIHtcbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIGluZGljZXMuXG4gICAgICovXG4gICAgc2VsZWN0ZWRJbmRleGVzOiBBcnJheTxudW1iZXI+O1xuICAgIC8qKlxuICAgICAqIERldGVybWluZXMgaWYgdGhlIGFjY29yZGlvbiB0YWJsZSBjb21wb25lbnQgaXMgY29udHJvbGxlZCBmcm9tIHRoZSBvdXRzaWRlIG9yIG5vdC5cbiAgICAgKi9cbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIEFjdGl2ZVByb3BzIHtcbiAgICBvcGVuPzogYm9vbGVhbjtcbiAgICBvbkNsaWNrPyhlOiBSZWFjdC5Nb3VzZUV2ZW50KTogdm9pZDtcbn1cbmNvbnN0IGFuaW1hdGlvbkR1cmF0aW9uID0gJzAuM3MnO1xuY29uc3QgYW5pbWF0aW9uRnVuY3Rpb24gPSAnY3ViaWMtYmV6aWVyKDAsIDAsIDAuMjUsIDEpJztcbmNvbnN0IFN0eWxlZExpc3QgPSBzdHlsZWQoTGlzdCkgYFxuICBvdmVyZmxvdzogdmlzaWJsZTtcbmA7XG5jb25zdCBTdHlsZWRMaXN0SXRlbSA9IHN0eWxlZChMaXN0SXRlbSkgYFxuICBwYWRkaW5nOiAwO1xuICBtYXJnaW4tYm90dG9tOiAke2Rpc3RhbmNlLnhsYXJnZX07XG4gIGJvcmRlcjogbm9uZTtcblxuICAmOmxhc3QtY2hpbGQge1xuICAgIG1hcmdpbi1ib3R0b206IDA7XG4gIH1cbmA7XG5jb25zdCBDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnbWVkaXVtJyB9KX1cblxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGNvbG9yOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS50ZXh0MSl9O1xuYDtcbmNvbnN0IENvbnRlbnRDb250YWluZXIgPSBzdHlsZWQuZGl2PEFjdGl2ZVByb3BzPih0aGVtZWQoKHsgb3BlbiwgdGhlbWU6IHsgdWkxLCB1aTIsIHVpNCwgdWk1IH0gfSkgPT4gY3NzIGBcbiAgICAgICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ3NtYWxsJyB9KX1cblxuICAgICAgcGFkZGluZzogJHtkaXN0YW5jZS5tZWRpdW19O1xuICAgICAgYmFja2dyb3VuZDogJHtvcGVuID8gdWkyIDogdWkxfTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7b3BlbiA/IHVpNSA6IHVpNH07XG4gICAgICBib3JkZXItYm90dG9tOiAke29wZW4gPyBgMXB4IHNvbGlkICR7dWk0fWAgOiAnbm9uZSd9O1xuICAgIGApKTtcbmNvbnN0IERldGFpbHNDb250YWluZXJBbmltYXRvciA9IHN0eWxlZCgnZGl2Jyk8QWN0aXZlUHJvcHM+IGBcbiAgdHJhbnNpdGlvbjogYWxsICR7YW5pbWF0aW9uRHVyYXRpb259ICR7YW5pbWF0aW9uRnVuY3Rpb259O1xuICBtYXgtaGVpZ2h0OiAkeyh7IG9wZW4gfSkgPT4gKG9wZW4gPyAnMTAwMDBweCcgOiAnMCcpfTtcbiAgb3BhY2l0eTogJHsoeyBvcGVuIH0pID0+IChvcGVuID8gJzEnIDogJzAnKX07XG4gIG92ZXJmbG93OiBoaWRkZW47XG5gO1xuY29uc3QgRGV0YWlsc0NvbnRhaW5lciA9IHN0eWxlZC5kaXY8QWN0aXZlUHJvcHM+KHRoZW1lZCgoeyBvcGVuLCB0aGVtZTogeyB1aTQsIHVpNSB9IH0pID0+IGNzcyBgXG4gICAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAke29wZW4gPyB1aTUgOiB1aTR9O1xuICAgICAgYm9yZGVyLWxlZnQ6IDFweCBzb2xpZCAke29wZW4gPyB1aTUgOiB1aTR9O1xuICAgIGApKTtcbmNvbnN0IEFjdGlvbkNvbnRhaW5lciA9IHN0eWxlZC5kaXY8QWN0aXZlUHJvcHM+KHRoZW1lZCgoeyBvcGVuLCB0aGVtZTogeyB1aTAsIHVpMSB9IH0pID0+IGNzcyBgXG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBwYWRkaW5nOiAke2Rpc3RhbmNlLnNtYWxsfSAke2Rpc3RhbmNlLm1lZGl1bX07XG4gICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICBiYWNrZ3JvdW5kOiAke29wZW4gPyB1aTEgOiB1aTB9O1xuICAgICAgYm9yZGVyOiAke29wZW4gPyBgMXB4IHNvbGlkICR7dWkwfWAgOiAnbm9uZSd9O1xuICAgICAgY29sb3I6ICR7b3BlbiA/IHVpMCA6IHVpMX07XG4gICAgYCkpO1xuZXhwb3J0IGNsYXNzIEFjY29yZGlvbkNhcmQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8QWNjb3JkaW9uUHJvcHMsIEFjY29yZGlvbkNhcmRTdGF0ZT4ge1xuICAgIHByaXZhdGUgc2VsZWN0czogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogQWNjb3JkaW9uUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICA/IG5vcm1hbGl6ZUluZGV4KHByb3BzLnNlbGVjdGVkSW5kZXgpXG4gICAgICAgICAgICAgICAgOiBub3JtYWxpemVJbmRleChwcm9wcy5kZWZhdWx0U2VsZWN0ZWRJbmRleCksXG4gICAgICAgICAgICBjb250cm9sbGVkOiBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHM6IEFjY29yZGlvblByb3BzLCBzdGF0ZTogQWNjb3JkaW9uQ2FyZFN0YXRlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRJbmRleCwgZGVmYXVsdFNlbGVjdGVkSW5kZXggfSA9IHByb3BzO1xuICAgICAgICBpZiAoc3RhdGUuY29udHJvbGxlZCAmJiBzZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBub3JtYWxpemVJbmRleChzZWxlY3RlZEluZGV4KSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGVmYXVsdFNlbGVjdGVkSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4ZXM6IG5vcm1hbGl6ZUluZGV4KGRlZmF1bHRTZWxlY3RlZEluZGV4KSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZUluZGV4KHRhcmdldDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIG11bHRpcGxlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQsIHNlbGVjdGVkSW5kZXhlcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgbmV4dEluZGV4ZXMgPSB0b2dnbGVJbmRleChzZWxlY3RlZEluZGV4ZXMsIHRhcmdldCwgbXVsdGlwbGUpO1xuICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogbXVsdGlwbGUgPyBuZXh0SW5kZXhlcyA6IG5leHRJbmRleGVzWzBdICE9PSB1bmRlZmluZWQgPyBuZXh0SW5kZXhlc1swXSA6IC0xLFxuICAgICAgICAgICAgICAgIHByZXZpb3VzSW5kZXg6IG11bHRpcGxlID8gc2VsZWN0ZWRJbmRleGVzIDogc2VsZWN0ZWRJbmRleGVzWzBdICE9PSB1bmRlZmluZWQgPyBzZWxlY3RlZEluZGV4ZXNbMF0gOiAtMSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleGVzOiBuZXh0SW5kZXhlcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzZWxlY3RlZEluZGV4ZXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW4sIHRoZW1lLCBvbkNoYW5nZTogXzAsIHNlbGVjdGVkSW5kZXg6IF8xLCBvcGVuTGFiZWwsIGNsb3NlTGFiZWwgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGl0ZW1zOiBBcnJheTxSZWFjdC5SZWFjdENoaWxkPiA9IFtdO1xuICAgICAgICBjb25zdCBzZWxlY3RzID0gdGhpcy5zZWxlY3RzO1xuICAgICAgICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoZWxlbWVudDogUmVhY3QuUmVhY3RFbGVtZW50PEFjY29yZGlvblRhYlByb3BzPiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIFJlYWN0LmlzVmFsaWRFbGVtZW50KGVsZW1lbnQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBoZWFkZXIgfSA9IGVsZW1lbnQucHJvcHM7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3BlbiA9IGhhc0luZGV4KHNlbGVjdGVkSW5kZXhlcywgaW5kZXgpO1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3RzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdHNbaW5kZXhdID0gKCkgPT4gdGhpcy5jaGFuZ2VJbmRleChpbmRleCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goPFN0eWxlZExpc3RJdGVtIHRoZW1lPXt0aGVtZX0ga2V5PXtgaXRlbS0ke2luZGV4fWB9PlxuICAgICAgICAgICAgPENvbnRhaW5lciB0aGVtZT17dGhlbWV9PlxuICAgICAgICAgICAgICA8Q29udGVudENvbnRhaW5lciB0aGVtZT17dGhlbWV9IG9wZW49e29wZW59PlxuICAgICAgICAgICAgICAgIHtoZWFkZXJ9XG4gICAgICAgICAgICAgIDwvQ29udGVudENvbnRhaW5lcj5cblxuICAgICAgICAgICAgICA8RGV0YWlsc0NvbnRhaW5lckFuaW1hdG9yIG9wZW49e29wZW59PlxuICAgICAgICAgICAgICAgIDxEZXRhaWxzQ29udGFpbmVyIG9wZW49e29wZW59PntlbGVtZW50fTwvRGV0YWlsc0NvbnRhaW5lcj5cbiAgICAgICAgICAgICAgPC9EZXRhaWxzQ29udGFpbmVyQW5pbWF0b3I+XG5cbiAgICAgICAgICAgICAgPEFjdGlvbkNvbnRhaW5lciB0aGVtZT17dGhlbWV9IG9uQ2xpY2s9e3NlbGVjdHNbaW5kZXhdfSBvcGVuPXtvcGVufT5cbiAgICAgICAgICAgICAgICB7b3BlbiA/IGNsb3NlTGFiZWwgfHwgJ0Nsb3NlIERldGFpbHMnIDogb3BlbkxhYmVsIHx8ICdPcGVuIERldGFpbHMnfVxuICAgICAgICAgICAgICA8L0FjdGlvbkNvbnRhaW5lcj5cbiAgICAgICAgICAgIDwvQ29udGFpbmVyPlxuICAgICAgICAgIDwvU3R5bGVkTGlzdEl0ZW0+KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiA8U3R5bGVkTGlzdCBib3JkZXJsZXNzPntpdGVtc308L1N0eWxlZExpc3Q+O1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWRMaXN0SXRlbSgpIHsgcmV0dXJuIFN0eWxlZExpc3RJdGVtIGFzIHR5cGVvZiBTdHlsZWRMaXN0SXRlbTsgfSxcbiAgICAgICAgZ2V0IENvbnRhaW5lcigpIHsgcmV0dXJuIENvbnRhaW5lciBhcyB0eXBlb2YgQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgQ29udGVudENvbnRhaW5lcigpIHsgcmV0dXJuIENvbnRlbnRDb250YWluZXIgYXMgdHlwZW9mIENvbnRlbnRDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBEZXRhaWxzQ29udGFpbmVyQW5pbWF0b3IoKSB7IHJldHVybiBEZXRhaWxzQ29udGFpbmVyQW5pbWF0b3IgYXMgdHlwZW9mIERldGFpbHNDb250YWluZXJBbmltYXRvcjsgfSxcbiAgICAgICAgZ2V0IERldGFpbHNDb250YWluZXIoKSB7IHJldHVybiBEZXRhaWxzQ29udGFpbmVyIGFzIHR5cGVvZiBEZXRhaWxzQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgQWN0aW9uQ29udGFpbmVyKCkgeyByZXR1cm4gQWN0aW9uQ29udGFpbmVyIGFzIHR5cGVvZiBBY3Rpb25Db250YWluZXI7IH0sXG4gICAgICAgIGdldCBTdHlsZWRMaXN0KCkgeyByZXR1cm4gU3R5bGVkTGlzdCBhcyB0eXBlb2YgU3R5bGVkTGlzdDsgfVxuICAgIH07XG59XG4iXX0=