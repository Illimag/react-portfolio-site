"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var displayTo_1 = require("../../utils/displayTo");
var themes_1 = require("../../themes");
var Responsive = /** @class */ (function (_super) {
    __extends(Responsive, _super);
    function Responsive(props) {
        var _this = _super.call(this, props) || this;
        _this.mediaQueriesToListen = {};
        _this.updateMatches = function () {
            _this.setState({
                matchesTo: _this.currentlyMatches(),
            });
        };
        var _a = _this.props, _b = _a.theme, theme = _b === void 0 ? themes_1.light : _b, screenSize = _a.screenSize, _c = _a.screenSizeCondition, screenSizeCondition = _c === void 0 ? 'equal' : _c, render = _a.render;
        var themedBreakpoints = __assign({}, themes_1.breakpoints, theme.breakpoints);
        if (screenSize) {
            var screenSizeBreakpoints = _this.getBreakpoints(themedBreakpoints, screenSize, screenSizeCondition);
            if (screenSizeBreakpoints) {
                _this.mediaQueriesToListen[screenSize] = window.matchMedia(displayTo_1.getWidthBreakpointsQuery(screenSizeBreakpoints));
            }
        }
        else {
            var allMediaQueries = displayTo_1.getMediaQueries(themedBreakpoints);
            for (var screenSize_1 in allMediaQueries) {
                _this.mediaQueriesToListen[screenSize_1] = window.matchMedia(allMediaQueries[screenSize_1]);
            }
        }
        if (typeof render !== 'function' && !Object.keys(_this.mediaQueriesToListen).length) {
            console.error('`render` callback method or valid `screenSize` and `screenSizeCondition` should be defined');
        }
        _this.state = {
            matchesTo: undefined,
        };
        return _this;
    }
    Responsive.prototype.getBreakpoints = function (breakpoints, screenSize, screenSizeCondition) {
        var screenSizeBreakpoints = displayTo_1.getScreenSizeBreakpoints(screenSize, breakpoints);
        if (!screenSizeBreakpoints) {
            console.error("Invalid screen size " + screenSize);
            return;
        }
        switch (screenSizeCondition) {
            case 'equal':
                return __assign({}, screenSizeBreakpoints);
            case 'from':
                return __assign({}, screenSizeBreakpoints, { max: undefined });
            case 'upTo':
                return __assign({}, screenSizeBreakpoints, { min: undefined });
            default:
                console.error("Invalid screen size condition " + screenSizeCondition);
                return;
        }
    };
    Responsive.prototype.currentlyMatches = function () {
        var mediaQueries = this.mediaQueriesToListen;
        for (var _i = 0, _a = Object.keys(mediaQueries); _i < _a.length; _i++) {
            var screenSize = _a[_i];
            if (mediaQueries[screenSize].matches) {
                return screenSize;
            }
        }
        return undefined;
    };
    Responsive.prototype.componentDidMount = function () {
        for (var screenSizeListenTo in this.mediaQueriesToListen) {
            this.mediaQueriesToListen[screenSizeListenTo].addListener(this.updateMatches);
        }
        this.updateMatches();
    };
    Responsive.prototype.componentWillUnmount = function () {
        for (var _i = 0, _a = Object.keys(this.mediaQueriesToListen); _i < _a.length; _i++) {
            var sceenSize = _a[_i];
            this.mediaQueriesToListen[sceenSize].removeListener(this.updateMatches);
        }
    };
    Responsive.prototype.render = function () {
        var _a = this.props, children = _a.children, render = _a.render;
        var matchesTo = this.state.matchesTo;
        if (render) {
            return render(matchesTo);
        }
        else {
            return children && matchesTo ? React.createElement(React.Fragment, null, children) : false;
        }
    };
    return Responsive;
}(React.Component));
exports.Responsive = Responsive;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9SZXNwb25zaXZlL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQixtREFBNEc7QUFFNUcsdUNBQWtEO0FBOEJsRDtJQUFnQyw4QkFBaUQ7SUFJN0Usb0JBQVksS0FBc0I7UUFBbEMsWUFDSSxrQkFBTSxLQUFLLENBQUMsU0FxQmY7UUF6Qk8sMEJBQW9CLEdBRXhCLEVBQUUsQ0FBQztRQW1EQyxtQkFBYSxHQUFHO1lBQ3BCLEtBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQ1YsU0FBUyxFQUFFLEtBQUksQ0FBQyxnQkFBZ0IsRUFBRTthQUNyQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUM7UUFwRFEsSUFBQSxnQkFBaUYsRUFBL0UsYUFBYSxFQUFiLDJDQUFhLEVBQUUsMEJBQVUsRUFBRSwyQkFBNkIsRUFBN0Isa0RBQTZCLEVBQUUsa0JBQXFCLENBQUM7UUFDeEYsSUFBTSxpQkFBaUIsZ0JBQVEsb0JBQVcsRUFBSyxLQUFLLENBQUMsV0FBVyxDQUFFLENBQUM7UUFDbkUsSUFBSSxVQUFVLEVBQUU7WUFDWixJQUFNLHFCQUFxQixHQUFHLEtBQUksQ0FBQyxjQUFjLENBQUMsaUJBQWlCLEVBQUUsVUFBVSxFQUFFLG1CQUFtQixDQUFDLENBQUM7WUFDdEcsSUFBSSxxQkFBcUIsRUFBRTtnQkFDdkIsS0FBSSxDQUFDLG9CQUFvQixDQUFDLFVBQVUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsb0NBQXdCLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO2FBQzlHO1NBQ0o7YUFDSTtZQUNELElBQU0sZUFBZSxHQUFHLDJCQUFlLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUMzRCxLQUFLLElBQU0sWUFBVSxJQUFJLGVBQWUsRUFBRTtnQkFDdEMsS0FBSSxDQUFD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c0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgZ2V0V2lkdGhCcmVha3BvaW50c1F1ZXJ5LCBnZXRTY3JlZW5TaXplQnJlYWtwb2ludHMsIGdldE1lZGlhUXVlcmllcyB9IGZyb20gJy4uLy4uL3V0aWxzL2Rpc3BsYXlUbyc7XG5pbXBvcnQgeyBQcmVjaXNlVGhlbWUsIFNjcmVlblNpemUsIEJyZWFrcG9pbnRzIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IGxpZ2h0LCBicmVha3BvaW50cyB9IGZyb20gJy4uLy4uL3RoZW1lcyc7XG5leHBvcnQgdHlwZSBTY3JlZW5TaXplQ29uZGl0aW9uID0gJ2VxdWFsJyB8ICdmcm9tJyB8ICd1cFRvJztcbmV4cG9ydCBpbnRlcmZhY2UgUmVzcG9uc2l2ZVByb3BzIHtcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzY3JlZW4gc2l6ZSBmb3Igd2hpY2ggdG8gc2hvdyB0aGUgY2hpbGRyZW4uXG4gICAgICogVmFsaWQgdmFsdWVzIGFyZTogJ3NtYWxsJyB8ICdtZWRpdW0nIHwgJ2xhcmdlJyB8ICd4TGFyZ2UnIHwgJ21heCdcbiAgICAgKi9cbiAgICBzY3JlZW5TaXplPzogU2NyZWVuU2l6ZTtcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBzY3JlZW4gc2l6ZSBjaGVjayBjb25kaXRpb24uXG4gICAgICogVmFsaWQgdmFsdWVzIGFyZTogJ2VxdWFsJyB8ICdmcm9tJyB8ICd1cFRvJ1xuICAgICAqIEBkZWZhdWx0ICdlcXVhbCdcbiAgICAgKi9cbiAgICBzY3JlZW5TaXplQ29uZGl0aW9uPzogU2NyZWVuU2l6ZUNvbmRpdGlvbjtcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSByZW5kZXIgY2FsbGJhY2suIFdoZW4gc2NyZWVuIHNpemUgY2hhbmdlcyBpdCdzIGNhbGxlZCB3aXRoIGEgbmV3IG9uZS5cbiAgICAgKi9cbiAgICByZW5kZXI/KHNjcmVlblNpemU/OiBTY3JlZW5TaXplKTogUmVhY3QuUmVhY3ROb2RlO1xuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IHRvIGJlIGRpc3BsYXllZCB3aGVuIHRoZSBxdWVyeSBtYXRjaGVzLlxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xuICAgIC8qKlxuICAgICAqIFRoZSB0aGVtZSB0byBzdXBwbHkgZm9yIHNldHRpbmcgdGhlIGN1c3RvbSBicmVha3BvaW50cywgaWYgYW55LlxuICAgICAqL1xuICAgIHRoZW1lPzogUHJlY2lzZVRoZW1lO1xufVxuZXhwb3J0IGludGVyZmFjZSBSZXNwb25zaXZlU3RhdGUge1xuICAgIG1hdGNoZXNUbz86IFNjcmVlblNpemU7XG59XG5leHBvcnQgY2xhc3MgUmVzcG9uc2l2ZSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxSZXNwb25zaXZlUHJvcHMsIFJlc3BvbnNpdmVTdGF0ZT4ge1xuICAgIHByaXZhdGUgbWVkaWFRdWVyaWVzVG9MaXN0ZW46IHtcbiAgICAgICAgW3NpemU6IHN0cmluZ106IE1lZGlhUXVlcnlMaXN0O1xuICAgIH0gPSB7fTtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogUmVzcG9uc2l2ZVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgY29uc3QgeyB0aGVtZSA9IGxpZ2h0LCBzY3JlZW5TaXplLCBzY3JlZW5TaXplQ29uZGl0aW9uID0gJ2VxdWFsJywgcmVuZGVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB0aGVtZWRCcmVha3BvaW50cyA9IHsgLi4uYnJlYWtwb2ludHMsIC4uLnRoZW1lLmJyZWFrcG9pbnRzIH07XG4gICAgICAgIGlmIChzY3JlZW5TaXplKSB7XG4gICAgICAgICAgICBjb25zdCBzY3JlZW5TaXplQnJlYWtwb2ludHMgPSB0aGlzLmdldEJyZWFrcG9pbnRzKHRoZW1lZEJyZWFrcG9pbnRzLCBzY3JlZW5TaXplLCBzY3JlZW5TaXplQ29uZGl0aW9uKTtcbiAgICAgICAgICAgIGlmIChzY3JlZW5TaXplQnJlYWtwb2ludHMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lZGlhUXVlcmllc1RvTGlzdGVuW3NjcmVlblNpemVdID0gd2luZG93Lm1hdGNoTWVkaWEoZ2V0V2lkdGhCcmVha3BvaW50c1F1ZXJ5KHNjcmVlblNpemVCcmVha3BvaW50cykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgYWxsTWVkaWFRdWVyaWVzID0gZ2V0TWVkaWFRdWVyaWVzKHRoZW1lZEJyZWFrcG9pbnRzKTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc2NyZWVuU2l6ZSBpbiBhbGxNZWRpYVF1ZXJpZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1lZGlhUXVlcmllc1RvTGlzdGVuW3NjcmVlblNpemVdID0gd2luZG93Lm1hdGNoTWVkaWEoYWxsTWVkaWFRdWVyaWVzW3NjcmVlblNpemVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIHJlbmRlciAhPT0gJ2Z1bmN0aW9uJyAmJiAhT2JqZWN0LmtleXModGhpcy5tZWRpYVF1ZXJpZXNUb0xpc3RlbikubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdgcmVuZGVyYCBjYWxsYmFjayBtZXRob2Qgb3IgdmFsaWQgYHNjcmVlblNpemVgIGFuZCBgc2NyZWVuU2l6ZUNvbmRpdGlvbmAgc2hvdWxkIGJlIGRlZmluZWQnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgbWF0Y2hlc1RvOiB1bmRlZmluZWQsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHByaXZhdGUgZ2V0QnJlYWtwb2ludHMoYnJlYWtwb2ludHM6IEJyZWFrcG9pbnRzLCBzY3JlZW5TaXplOiBTY3JlZW5TaXplLCBzY3JlZW5TaXplQ29uZGl0aW9uOiBTY3JlZW5TaXplQ29uZGl0aW9uKSB7XG4gICAgICAgIGNvbnN0IHNjcmVlblNpemVCcmVha3BvaW50cyA9IGdldFNjcmVlblNpemVCcmVha3BvaW50cyhzY3JlZW5TaXplLCBicmVha3BvaW50cyk7XG4gICAgICAgIGlmICghc2NyZWVuU2l6ZUJyZWFrcG9pbnRzKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBJbnZhbGlkIHNjcmVlbiBzaXplICR7c2NyZWVuU2l6ZX1gKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKHNjcmVlblNpemVDb25kaXRpb24pIHtcbiAgICAgICAgICAgIGNhc2UgJ2VxdWFsJzpcbiAgICAgICAgICAgICAgICByZXR1cm4geyAuLi5zY3JlZW5TaXplQnJlYWtwb2ludHMgfTtcbiAgICAgICAgICAgIGNhc2UgJ2Zyb20nOlxuICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnNjcmVlblNpemVCcmVha3BvaW50cywgbWF4OiB1bmRlZmluZWQgfTtcbiAgICAgICAgICAgIGNhc2UgJ3VwVG8nOlxuICAgICAgICAgICAgICAgIHJldHVybiB7IC4uLnNjcmVlblNpemVCcmVha3BvaW50cywgbWluOiB1bmRlZmluZWQgfTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgSW52YWxpZCBzY3JlZW4gc2l6ZSBjb25kaXRpb24gJHtzY3JlZW5TaXplQ29uZGl0aW9ufWApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGN1cnJlbnRseU1hdGNoZXMoKSB7XG4gICAgICAgIGNvbnN0IG1lZGlhUXVlcmllcyA9IHRoaXMubWVkaWFRdWVyaWVzVG9MaXN0ZW47XG4gICAgICAgIGZvciAoY29uc3Qgc2NyZWVuU2l6ZSBvZiBPYmplY3Qua2V5cyhtZWRpYVF1ZXJpZXMpKSB7XG4gICAgICAgICAgICBpZiAobWVkaWFRdWVyaWVzW3NjcmVlblNpemVdLm1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2NyZWVuU2l6ZSBhcyBTY3JlZW5TaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHByaXZhdGUgdXBkYXRlTWF0Y2hlcyA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBtYXRjaGVzVG86IHRoaXMuY3VycmVudGx5TWF0Y2hlcygpLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBmb3IgKGNvbnN0IHNjcmVlblNpemVMaXN0ZW5UbyBpbiB0aGlzLm1lZGlhUXVlcmllc1RvTGlzdGVuKSB7XG4gICAgICAgICAgICB0aGlzLm1lZGlhUXVlcmllc1RvTGlzdGVuW3NjcmVlblNpemVMaXN0ZW5Ub10uYWRkTGlzdGVuZXIodGhpcy51cGRhdGVNYXRjaGVzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwZGF0ZU1hdGNoZXMoKTtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGZvciAoY29uc3Qgc2NlZW5TaXplIG9mIE9iamVjdC5rZXlzKHRoaXMubWVkaWFRdWVyaWVzVG9MaXN0ZW4pKSB7XG4gICAgICAgICAgICB0aGlzLm1lZGlhUXVlcmllc1RvTGlzdGVuW3NjZWVuU2l6ZV0ucmVtb3ZlTGlzdGVuZXIodGhpcy51cGRhdGVNYXRjaGVzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW4sIHJlbmRlciB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBtYXRjaGVzVG8gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmIChyZW5kZXIpIHtcbiAgICAgICAgICAgIHJldHVybiByZW5kZXIobWF0Y2hlc1RvKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbiAmJiBtYXRjaGVzVG8gPyA8PntjaGlsZHJlbn08Lz4gOiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==