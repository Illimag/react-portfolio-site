"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var TextField_1 = require("../TextField");
var withFormContext_1 = require("../../hoc/withFormContext");
var InteractiveList_1 = require("../InteractiveList");
var AutocompleteWrapper = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n  width: 100%;\n"], ["\n  position: relative;\n  width: 100%;\n"])));
var StyledInteractiveList = styled_1.default(InteractiveList_1.InteractiveList)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  position: static;\n"], ["\n  position: static;\n"])));
var StyledAutosuggestWrapper = styled_1.default.ul(styled_1.themed(function (_a) {
    var direction = _a.direction, _b = _a.theme, ui1 = _b.ui1, ui4 = _b.ui4;
    return styled_1.css(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n      list-style: none;\n      width: 100%;\n      box-sizing: border-box;\n      box-shadow: none;\n      margin: 0;\n      padding: 0;\n      background: ", ";\n      border: 1px solid ", ";\n      ", ";\n      max-height: 50vh;\n      position: absolute;\n      top: ", ";\n      transform: translateY(", "%);\n      overflow-y: auto;\n      z-index: 100;\n    "], ["\n      list-style: none;\n      width: 100%;\n      box-sizing: border-box;\n      box-shadow: none;\n      margin: 0;\n      padding: 0;\n      background: ", ";\n      border: 1px solid ", ";\n      ",
        ";\n      max-height: 50vh;\n      position: absolute;\n      top: ", ";\n      transform: translateY(", "%);\n      overflow-y: auto;\n      z-index: 100;\n    "])), ui1, ui4, direction === InteractiveList_1.InteractiveListDirection.normal
        ? 'border-top-color: transparent'
        : 'border-bottom-color: transparent', direction === InteractiveList_1.InteractiveListDirection.normal ? '100%' : '0px', direction === InteractiveList_1.InteractiveListDirection.normal ? 0 : -100);
}));
function defaultSuggestionRenderer(suggestion) {
    var value = String(suggestion);
    return {
        content: value,
        key: value,
    };
}
function defaultInputRenderer(props) {
    return React.createElement(TextField_1.TextField, __assign({}, props));
}
var NotOpenComponent = React.createElement(React.Fragment, null);
var AutosuggestWrapper = Object.assign((function (_a) {
    var _0 = _a.border, open = _a.open, props = __rest(_a, ["border", "open"]);
    return open ? React.createElement(StyledAutosuggestWrapper, __assign({}, props)) : NotOpenComponent;
}), { inner: {
        get StyledAutosuggestWrapper() { return StyledAutosuggestWrapper; }
    } });
AutosuggestWrapper.displayName = 'AutosuggestWrapper';
var AutocompleteInt = /** @class */ (function (_super) {
    __extends(AutocompleteInt, _super);
    function AutocompleteInt(props) {
        var _this = _super.call(this, props) || this;
        _this.handleKeyDown = function (e) {
            var keyCode = e.keyCode;
            switch (keyCode) {
                case 40 /* down */:
                case 38 /* up */:
                    e.preventDefault();
                    var open_1 = _this.state.open;
                    open_1 &&
                        _this.setState(function () { return ({
                            listFocus: true,
                            focus: false,
                        }); });
                    break;
            }
        };
        _this.handleListChange = function (e) {
            var _a = _this.props.suggestions, suggestions = _a === void 0 ? [] : _a;
            var index = e.value[0];
            var suggestion = suggestions[index];
            _this.handle(suggestion);
        };
        _this.show = function () {
            _this.setState({ open: true });
        };
        _this.hide = function () {
            _this.setState(function () { return ({ open: false }); }, _this.props.onBlur);
        };
        _this.handleFocus = function () {
            var onFocus = _this.props.onFocus;
            cancelAnimationFrame(_this.delayedBlur);
            _this.show();
            _this.setState(function () { return ({ focus: true, listFocus: false }); });
            typeof onFocus === 'function' && onFocus();
        };
        _this.handleBlur = function () {
            cancelAnimationFrame(_this.delayedBlur);
            _this.delayedBlur = requestAnimationFrame(function () {
                _this.setState(function () { return ({
                    focus: false,
                    listFocus: false,
                }); }, _this.hide);
            });
        };
        _this.changed = function (e) {
            _this.updateValue(e.value);
        };
        _this.setNode = function (node) {
            _this._element = node;
            var inputRef = _this.props.inputRef;
            typeof inputRef === 'function' && inputRef(node);
        };
        _this.state = {
            controlled: props.value !== undefined,
            value: props.value || props.defaultValue || '',
            open: false,
            listFocus: false,
            focus: false,
            error: props.error,
        };
        return _this;
    }
    AutocompleteInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.value, value = _b === void 0 ? '' : _b, error = _a.error;
        if (this.state.controlled) {
            this.setState({ value: value });
        }
        this.setState({ error: error });
    };
    AutocompleteInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    AutocompleteInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    AutocompleteInt.prototype.updateValue = function (value, suggestionSelected) {
        if (suggestionSelected === void 0) { suggestionSelected = false; }
        var _a = this.props, onChange = _a.onChange, _b = _a.name, name = _b === void 0 ? '' : _b, form = _a.form;
        if (!this.state.controlled) {
            form ? form.change({ name: name, value: value }) : this.setState({ value: value });
        }
        suggestionSelected ? this.hide() : this.show();
        typeof onChange === 'function' && onChange({ value: value });
    };
    AutocompleteInt.prototype.handle = function (suggestion) {
        var _a = this.props, getSuggestionValue = _a.getSuggestionValue, onSuggestionSelected = _a.onSuggestionSelected;
        if (typeof getSuggestionValue === 'function') {
            var value = getSuggestionValue(suggestion);
            this.updateValue(value, true);
        }
        else if (typeof suggestion === 'string') {
            this.updateValue(suggestion, true);
        }
        typeof onSuggestionSelected === 'function' && onSuggestionSelected({ value: suggestion });
    };
    AutocompleteInt.prototype.render = function () {
        var _a = this.props, _b = _a.suggestions, suggestions = _b === void 0 ? [] : _b, noSuggestionsMessage = _a.noSuggestionsMessage, _c = _a.renderSuggestion, renderSuggestion = _c === void 0 ? defaultSuggestionRenderer : _c, _d = _a.inputRenderer, inputRenderer = _d === void 0 ? defaultInputRenderer : _d, _1 = _a.getSuggestionValue, _2 = _a.onChange, _3 = _a.children, _4 = _a.onBlur, _5 = _a.onFocus, _6 = _a.defaultValue, _7 = _a.inputRef, _8 = _a.onSuggestionSelected, info = _a.info, props = __rest(_a, ["suggestions", "noSuggestionsMessage", "renderSuggestion", "inputRenderer", "getSuggestionValue", "onChange", "children", "onBlur", "onFocus", "defaultValue", "inputRef", "onSuggestionSelected", "info"]);
        var _e = this.state, open = _e.open, listFocus = _e.listFocus, value = _e.value, error = _e.error;
        var isListOpen = open && (!!suggestions.length || !!noSuggestionsMessage);
        return (React.createElement(AutocompleteWrapper, { onKeyDown: this.handleKeyDown, onFocus: this.handleFocus, onBlur: this.handleBlur },
            inputRenderer(__assign({}, props, { clearable: true, info: isListOpen ? undefined : info, onChange: this.changed, inputRef: this.setNode, value: value,
                error: error })),
            React.createElement(StyledInteractiveList, { data: suggestions.length ? suggestions.map(renderSuggestion) : [{ key: 'default', content: noSuggestionsMessage }], disabled: suggestions.length === 0, customWrapper: AutosuggestWrapper, focus: listFocus, onChange: this.handleListChange, autoPosition: true, open: isListOpen }),
            isListOpen && info && React.createElement("div", null, info)));
    };
    AutocompleteInt.inner = {
        get AutocompleteWrapper() { return AutocompleteWrapper; },
        get StyledInteractiveList() { return StyledInteractiveList; }
    };
    return AutocompleteInt;
}(React.Component));
/**
 * Extends a TextField with autocompletion capabilities.
 */
exports.Autocomplete = withFormContext_1.withFormContext(AutocompleteInt);
exports.Autocomplete.displayName = 'Autocomplete';
var templateObject_1, templateObject_2, templateObject_3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9BdXRvY29tcGxldGUvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBeUQ7QUFDekQsMENBQStFO0FBQy9FLDZEQUE4RTtBQUM5RSxzREFBeUk7QUE4RHpJLElBQU0sbUJBQW1CLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLDhHQUFDLDJDQUd0QyxJQUFBLENBQUM7QUFDRixJQUFNLHFCQUFxQixHQUFHLGdCQUFNLENBQUMsaUNBQWUsQ0FBQyw0RkFBQyx5QkFFckQsSUFBQSxDQUFDO0FBSUYsSUFBTSx3QkFBd0IsR0FBRyxnQkFBTSxDQUFDLEVBQUUsQ0FBZ0MsZUFBTSxDQUFDLFVBQUMsRUFBa0M7UUFBaEMsd0JBQVMsRUFBRSxhQUFtQixFQUFWLFlBQUcsRUFBRSxZQUFHO0lBQVMsT0FBQSxZQUFHLG1iQUFDLGdLQU96RyxFQUFHLDZCQUNHLEVBQUcsV0FDckI7UUFFZ0Msb0VBRzNCLEVBQThELGlDQUM3QyxFQUF3RCx5REFHakYsS0FYZSxHQUFHLEVBQ0csR0FBRyxFQUNyQixTQUFTLEtBQUssMENBQXdCLENBQUMsTUFBTTtRQUNqRCxDQUFDLENBQUMsK0JBQStCO1FBQ2pDLENBQUMsQ0FBQyxrQ0FBa0MsRUFHM0IsU0FBUyxLQUFLLDBDQUF3QixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQzdDLFNBQVMsS0FBSywwQ0FBd0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHO0FBZm1DLENBa0JwSCxDQUFDLENBQUMsQ0FBQztBQUNSLFNBQVMseUJBQXlCLENBQUksVUFBYTtJQUMvQyxJQUFNLEtBQUssR0FBRyxNQUFNLENBQUMs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LE9BQU8sRUFDdEIsUUFBUSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQ3RCLEtBQUssT0FBQTtnQkFDTCxLQUFLLE9BQUEsSUFDUDtZQUNGLG9CQUFDLHFCQUFxQixJQUFDLElBQUksRUFBRSxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLGFBQWEsRUFBRSxrQkFBa0IsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsWUFBWSxRQUFDLElBQUksRUFBRSxVQUFVLEdBQUc7WUFDcFMsVUFBVSxJQUFJLElBQUksSUFBSSxpQ0FBTSxJQUFJLENBQU8sQ0FDcEIsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFDTSxxQkFBSyxHQUFHO1FBQ1gsSUFBSSxtQkFBbUIsS0FBSyxPQUFPLG1CQUFpRCxDQUFDLENBQUMsQ0FBQztRQUN2RixJQUFJLHFCQUFxQixLQUFLLE9BQU8scUJBQXFELENBQUMsQ0FBQyxDQUFDO0tBQ2hHLENBQUM7SUFDTixzQkFBQztDQUFBLEFBOUhELENBQWlDLEtBQUssQ0FBQyxTQUFTLEdBOEgvQztBQUNEOztHQUVHO0FBQ1UsUUFBQSxZQUFZLEdBQUcsaUNBQWUsQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUM3RCxvQkFBWSxDQUFDLFdBQVcsR0FBRyxjQUFjLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCwgY3NzIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IFRleHRGaWVsZCwgVGV4dEZpZWxkUHJvcHMsIFRleHRGaWVsZENoYW5nZUV2ZW50IH0gZnJvbSAnLi4vVGV4dEZpZWxkJztcbmltcG9ydCB7IEZvcm1Db250ZXh0UHJvcHMsIHdpdGhGb3JtQ29udGV4dCB9IGZyb20gJy4uLy4uL2hvYy93aXRoRm9ybUNvbnRleHQnO1xuaW1wb3J0IHsgSW50ZXJhY3RpdmVMaXN0LCBJbnRlcmFjdGl2ZUxpc3RXcmFwcGVyUHJvcHMsIEludGVyYWN0aXZlTGlzdERpcmVjdGlvbiwgSW50ZXJhY3RpdmVMaXN0Q2hhbmdlRXZlbnQsIH0gZnJvbSAnLi4vSW50ZXJhY3RpdmVMaXN0JztcbmltcG9ydCB7IEtleUNvZGVzIH0gZnJvbSAnLi4vLi4vdXRpbHMva2V5Q29kZXMnO1xuaW1wb3J0IHsgSW5wdXRDaGFuZ2VFdmVudCwgT21pdCB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5leHBvcnQgaW50ZXJmYWNlIEF1dG9zdWdnZXN0SXRlbSB7XG4gICAga2V5OiBzdHJpbmc7XG4gICAgY29udGVudD86IFJlYWN0LlJlYWN0Q2hpbGQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIEF1dG9zdWdnZXN0U2VsZWN0RXZlbnQ8VD4ge1xuICAgIHZhbHVlOiBUO1xufVxuZXhwb3J0IGludGVyZmFjZSBBdXRvY29tcGxldGVJbnB1dFByb3BzIHtcbiAgICBvbkNoYW5nZShlOiBJbnB1dENoYW5nZUV2ZW50PHN0cmluZz4pOiB2b2lkO1xuICAgIGNsZWFyYWJsZTogYm9vbGVhbjtcbiAgICBpbnB1dFJlZj8oaW5zdGFuY2U6IEhUTUxFbGVtZW50IHwgbnVsbCk6IHZvaWQ7XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICBlcnJvcjogYW55O1xuICAgIFtpbmRleDogc3RyaW5nXTogYW55O1xufVxuZXhwb3J0IGludGVyZmFjZSBBdXRvY29tcGxldGVQcm9wczxUPiBleHRlbmRzIFRleHRGaWVsZFByb3BzIHtcbiAgICAvKipcbiAgICAgKiBUaGUgb3B0aW9uYWwgbWVzc2FnZSB0byBzaG93IGluIGNhc2UgdGVocmUgYXJlIG5vIHN1Z2dlc3Rpb25zIHRvIGRpc3BsYXkuXG4gICAgICovXG4gICAgbm9TdWdnZXN0aW9uc01lc3NhZ2U/OiBSZWFjdC5SZWFjdENoaWxkO1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50IHZhbHVlIG9mIHRoZSB0ZXh0IGZpZWxkLCBsZWFkaW5nIHRvIGEgY29udHJvbGxlZCB0ZXh0IGZpZWxkLlxuICAgICAqL1xuICAgIHN1Z2dlc3Rpb25zPzogQXJyYXk8VD47XG4gICAgLyoqXG4gICAgICogSG93IHRvIHJlbmRlciBlYWNoIHN1Z2dlc3Rpb24gaW4gdGhlIEludGVyYWN0aXZlTGlzdFxuICAgICAqL1xuICAgIHJlbmRlclN1Z2dlc3Rpb24/KGRhdGE6IFQpOiBBdXRvc3VnZ2VzdEl0ZW07XG4gICAgLyoqXG4gICAgICogRXZlbnQgZW1pdHRlZCBldmVyeSB0aW1lIHN1Z2dlc3Rpb24gaXMgc2VsZWN0ZWQgdmlhIG1vdXNlIG9yIGtleWJvYXJkLlxuICAgICAqL1xuICAgIG9uU3VnZ2VzdGlvblNlbGVjdGVkPyhlOiBBdXRvc3VnZ2VzdFNlbGVjdEV2ZW50PFQ+KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBzdWdnZXN0aW9uIHZhbHVlLlxuICAgICAqL1xuICAgIGdldFN1Z2dlc3Rpb25WYWx1ZT8oaXRlbTogVCk6IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBUaGUgcmVuZGVyZXIgb2YgaW5wdXQgZmllbGQuXG4gICAgICovXG4gICAgaW5wdXRSZW5kZXJlcj8ocHJvcHM6IEF1dG9jb21wbGV0ZUlucHV0UHJvcHMpOiBKU1guRWxlbWVudDtcbiAgICAvKipcbiAgICAgKiBBbHdheXMgYHRydWVgIG9uIEF1dG9jb21wbGV0ZSBjb21wb25lbnRzLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBjbGVhcmFibGU/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBpbnB1dFJlZj8oaW5zdGFuY2U6IEhUTUxFbGVtZW50IHwgbnVsbCk6IHZvaWQ7XG59XG5leHBvcnQgdHlwZSBTdXBwb3J0ZWRBdXRvY29tcGxldGVQcm9wczxUPiA9IE9taXQ8QXV0b2NvbXBsZXRlUHJvcHM8VD4sICdjbGVhcmFibGUnPjtcbmV4cG9ydCBpbnRlcmZhY2UgQXV0b2NvbXBsZXRlU3RhdGUge1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG4gICAgbGlzdEZvY3VzOiBib29sZWFuO1xuICAgIGZvY3VzOiBib29sZWFuO1xuICAgIG9wZW46IGJvb2xlYW47XG4gICAgdmFsdWU6IHN0cmluZztcbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG59XG5jb25zdCBBdXRvY29tcGxldGVXcmFwcGVyID0gc3R5bGVkLmRpdiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgd2lkdGg6IDEwMCU7XG5gO1xuY29uc3QgU3R5bGVkSW50ZXJhY3RpdmVMaXN0ID0gc3R5bGVkKEludGVyYWN0aXZlTGlzdCkgYFxuICBwb3NpdGlvbjogc3RhdGljO1xuYDtcbmludGVyZmFjZSBTdHlsZWRBdXRvc3VnZ2VzdFdyYXBwZXJQcm9wcyB7XG4gICAgZGlyZWN0aW9uOiBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb247XG59XG5jb25zdCBTdHlsZWRBdXRvc3VnZ2VzdFdyYXBwZXIgPSBzdHlsZWQudWw8U3R5bGVkQXV0b3N1Z2dlc3RXcmFwcGVyUHJvcHM+KHRoZW1lZCgoeyBkaXJlY3Rpb24sIHRoZW1lOiB7IHVpMSwgdWk0IH0gfSkgPT4gY3NzIGBcbiAgICAgIGxpc3Qtc3R5bGU6IG5vbmU7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gICAgICBib3gtc2hhZG93OiBub25lO1xuICAgICAgbWFyZ2luOiAwO1xuICAgICAgcGFkZGluZzogMDtcbiAgICAgIGJhY2tncm91bmQ6ICR7dWkxfTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7dWk0fTtcbiAgICAgICR7ZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsXG4gICAgPyAnYm9yZGVyLXRvcC1jb2xvcjogdHJhbnNwYXJlbnQnXG4gICAgOiAnYm9yZGVyLWJvdHRvbS1jb2xvcjogdHJhbnNwYXJlbnQnfTtcbiAgICAgIG1heC1oZWlnaHQ6IDUwdmg7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICB0b3A6ICR7ZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsID8gJzEwMCUnIDogJzBweCd9O1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKCR7ZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsID8gMCA6IC0xMDB9JSk7XG4gICAgICBvdmVyZmxvdy15OiBhdXRvO1xuICAgICAgei1pbmRleDogMTAwO1xuICAgIGApKTtcbmZ1bmN0aW9uIGRlZmF1bHRTdWdnZXN0aW9uUmVuZGVyZXI8VD4oc3VnZ2VzdGlvbjogVCk6IEF1dG9zdWdnZXN0SXRlbSB7XG4gICAgY29uc3QgdmFsdWUgPSBTdHJpbmcoc3VnZ2VzdGlvbik7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY29udGVudDogdmFsdWUsXG4gICAgICAgIGtleTogdmFsdWUsXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGRlZmF1bHRJbnB1dFJlbmRlcmVyKHByb3BzOiBBdXRvY29tcGxldGVJbnB1dFByb3BzKTogSlNYLkVsZW1lbnQge1xuICAgIHJldHVybiA8VGV4dEZpZWxkIHsuLi5wcm9wc30vPjtcbn1cbmNvbnN0IE5vdE9wZW5Db21wb25lbnQgPSA8PjwvPjtcbmNvbnN0IEF1dG9zdWdnZXN0V3JhcHBlciA9IE9iamVjdC5hc3NpZ24oKCgoeyBib3JkZXI6IF8wLCBvcGVuLCAuLi5wcm9wcyB9KSA9PiBvcGVuID8gPFN0eWxlZEF1dG9zdWdnZXN0V3JhcHBlciB7Li4ucHJvcHN9Lz4gOiBOb3RPcGVuQ29tcG9uZW50KSBhcyBSZWFjdC5GQzxJbnRlcmFjdGl2ZUxpc3RXcmFwcGVyUHJvcHM+KSwgeyBpbm5lcjoge1xuICAgICAgICBnZXQgU3R5bGVkQXV0b3N1Z2dlc3RXcmFwcGVyKCkgeyByZXR1cm4gU3R5bGVkQXV0b3N1Z2dlc3RXcmFwcGVyIGFzIHR5cGVvZiBTdHlsZWRBdXRvc3VnZ2VzdFdyYXBwZXI7IH1cbiAgICB9IH0pO1xuQXV0b3N1Z2dlc3RXcmFwcGVyLmRpc3BsYXlOYW1lID0gJ0F1dG9zdWdnZXN0V3JhcHBlcic7XG5jbGFzcyBBdXRvY29tcGxldGVJbnQ8VD4gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8U3VwcG9ydGVkQXV0b2NvbXBsZXRlUHJvcHM8VD4gJiBGb3JtQ29udGV4dFByb3BzLCBBdXRvY29tcGxldGVTdGF0ZT4ge1xuICAgIHByaXZhdGUgZGVsYXllZEJsdXI6IG51bWJlcjtcbiAgICBwcml2YXRlIF9lbGVtZW50OiBIVE1MRWxlbWVudCB8IG51bGw7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IEF1dG9jb21wbGV0ZVByb3BzPFQ+KSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLnZhbHVlICE9PSB1bmRlZmluZWQsXG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlIHx8ICcnLFxuICAgICAgICAgICAgb3BlbjogZmFsc2UsXG4gICAgICAgICAgICBsaXN0Rm9jdXM6IGZhbHNlLFxuICAgICAgICAgICAgZm9jdXM6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6IHByb3BzLmVycm9yLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyh7IHZhbHVlID0gJycsIGVycm9yIH06IEF1dG9jb21wbGV0ZVByb3BzPFQ+KSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3IgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSB1cGRhdGVWYWx1ZSh2YWx1ZTogc3RyaW5nLCBzdWdnZXN0aW9uU2VsZWN0ZWQ6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBuYW1lID0gJycsIGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICBmb3JtID8gZm9ybS5jaGFuZ2UoeyBuYW1lLCB2YWx1ZSB9KSA6IHRoaXMuc2V0U3RhdGUoeyB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgICBzdWdnZXN0aW9uU2VsZWN0ZWQgPyB0aGlzLmhpZGUoKSA6IHRoaXMuc2hvdygpO1xuICAgICAgICB0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicgJiYgb25DaGFuZ2UoeyB2YWx1ZSB9KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBoYW5kbGVLZXlEb3duID0gKGU6IFJlYWN0LktleWJvYXJkRXZlbnQ8SFRNTEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIGNvbnN0IHsga2V5Q29kZSB9ID0gZTtcbiAgICAgICAgc3dpdGNoIChrZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmRvd246XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnVwOlxuICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICAgICAgb3BlbiAmJlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0Rm9jdXM6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBmb2N1czogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVMaXN0Q2hhbmdlID0gKGU6IEludGVyYWN0aXZlTGlzdENoYW5nZUV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgc3VnZ2VzdGlvbnMgPSBbXSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgaW5kZXggPSBlLnZhbHVlWzBdO1xuICAgICAgICBjb25zdCBzdWdnZXN0aW9uID0gc3VnZ2VzdGlvbnNbaW5kZXhdO1xuICAgICAgICB0aGlzLmhhbmRsZShzdWdnZXN0aW9uKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlKHN1Z2dlc3Rpb246IFQpIHtcbiAgICAgICAgY29uc3QgeyBnZXRTdWdnZXN0aW9uVmFsdWUsIG9uU3VnZ2VzdGlvblNlbGVjdGVkIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAodHlwZW9mIGdldFN1Z2dlc3Rpb25WYWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBnZXRTdWdnZXN0aW9uVmFsdWUoc3VnZ2VzdGlvbik7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVZhbHVlKHZhbHVlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2Ygc3VnZ2VzdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVmFsdWUoc3VnZ2VzdGlvbiwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgdHlwZW9mIG9uU3VnZ2VzdGlvblNlbGVjdGVkID09PSAnZnVuY3Rpb24nICYmIG9uU3VnZ2VzdGlvblNlbGVjdGVkKHsgdmFsdWU6IHN1Z2dlc3Rpb24gfSk7XG4gICAgfVxuICAgIHByaXZhdGUgc2hvdyA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW46IHRydWUgfSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGhpZGUgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoKCkgPT4gKHsgb3BlbjogZmFsc2UgfSksIHRoaXMucHJvcHMub25CbHVyKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlRm9jdXMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25Gb2N1cyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5kZWxheWVkQmx1cik7XG4gICAgICAgIHRoaXMuc2hvdygpO1xuICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7IGZvY3VzOiB0cnVlLCBsaXN0Rm9jdXM6IGZhbHNlIH0pKTtcbiAgICAgICAgdHlwZW9mIG9uRm9jdXMgPT09ICdmdW5jdGlvbicgJiYgb25Gb2N1cygpO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVCbHVyID0gKCkgPT4ge1xuICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLmRlbGF5ZWRCbHVyKTtcbiAgICAgICAgdGhpcy5kZWxheWVkQmx1ciA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XG4gICAgICAgICAgICAgICAgZm9jdXM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGxpc3RGb2N1czogZmFsc2UsXG4gICAgICAgICAgICB9KSwgdGhpcy5oaWRlKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNoYW5nZWQgPSAoZTogVGV4dEZpZWxkQ2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVWYWx1ZShlLnZhbHVlKTtcbiAgICB9O1xuICAgIHByaXZhdGUgc2V0Tm9kZSA9IChub2RlOiBIVE1MRWxlbWVudCB8IG51bGwpID0+IHtcbiAgICAgICAgdGhpcy5fZWxlbWVudCA9IG5vZGU7XG4gICAgICAgIGNvbnN0IHsgaW5wdXRSZWYgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHR5cGVvZiBpbnB1dFJlZiA9PT0gJ2Z1bmN0aW9uJyAmJiBpbnB1dFJlZihub2RlKTtcbiAgICB9O1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBzdWdnZXN0aW9ucyA9IFtdLCBub1N1Z2dlc3Rpb25zTWVzc2FnZSwgcmVuZGVyU3VnZ2VzdGlvbiA9IGRlZmF1bHRTdWdnZXN0aW9uUmVuZGVyZXIsIGlucHV0UmVuZGVyZXIgPSBkZWZhdWx0SW5wdXRSZW5kZXJlciwgZ2V0U3VnZ2VzdGlvblZhbHVlOiBfMSwgb25DaGFuZ2U6IF8yLCBjaGlsZHJlbjogXzMsIG9uQmx1cjogXzQsIG9uRm9jdXM6IF81LCBkZWZhdWx0VmFsdWU6IF82LCBpbnB1dFJlZjogXzcsIG9uU3VnZ2VzdGlvblNlbGVjdGVkOiBfOCwgaW5mbywgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgb3BlbiwgbGlzdEZvY3VzLCB2YWx1ZSwgZXJyb3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IGlzTGlzdE9wZW4gPSBvcGVuICYmICghIXN1Z2dlc3Rpb25zLmxlbmd0aCB8fCAhIW5vU3VnZ2VzdGlvbnNNZXNzYWdlKTtcbiAgICAgICAgcmV0dXJuICg8QXV0b2NvbXBsZXRlV3JhcHBlciBvbktleURvd249e3RoaXMuaGFuZGxlS2V5RG93bn0gb25Gb2N1cz17dGhpcy5oYW5kbGVGb2N1c30gb25CbHVyPXt0aGlzLmhhbmRsZUJsdXJ9PlxuICAgICAgICB7aW5wdXRSZW5kZXJlcih7XG4gICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgIGNsZWFyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGluZm86IGlzTGlzdE9wZW4gPyB1bmRlZmluZWQgOiBpbmZvLFxuICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMuY2hhbmdlZCxcbiAgICAgICAgICAgIGlucHV0UmVmOiB0aGlzLnNldE5vZGUsXG4gICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIGVycm9yLFxuICAgICAgICB9KX1cbiAgICAgICAgPFN0eWxlZEludGVyYWN0aXZlTGlzdCBkYXRhPXtzdWdnZXN0aW9ucy5sZW5ndGggPyBzdWdnZXN0aW9ucy5tYXAocmVuZGVyU3VnZ2VzdGlvbikgOiBbeyBrZXk6ICdkZWZhdWx0JywgY29udGVudDogbm9TdWdnZXN0aW9uc01lc3NhZ2UgfV19IGRpc2FibGVkPXtzdWdnZXN0aW9ucy5sZW5ndGggPT09IDB9IGN1c3RvbVdyYXBwZXI9e0F1dG9zdWdnZXN0V3JhcHBlcn0gZm9jdXM9e2xpc3RGb2N1c30gb25DaGFuZ2U9e3RoaXMuaGFuZGxlTGlzdENoYW5nZX0gYXV0b1Bvc2l0aW9uIG9wZW49e2lzTGlzdE9wZW59Lz5cbiAgICAgICAge2lzTGlzdE9wZW4gJiYgaW5mbyAmJiA8ZGl2PntpbmZvfTwvZGl2Pn1cbiAgICAgIDwvQXV0b2NvbXBsZXRlV3JhcHBlcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBBdXRvY29tcGxldGVXcmFwcGVyKCkgeyByZXR1cm4gQXV0b2NvbXBsZXRlV3JhcHBlciBhcyB0eXBlb2YgQXV0b2NvbXBsZXRlV3JhcHBlcjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZEludGVyYWN0aXZlTGlzdCgpIHsgcmV0dXJuIFN0eWxlZEludGVyYWN0aXZlTGlzdCBhcyB0eXBlb2YgU3R5bGVkSW50ZXJhY3RpdmVMaXN0OyB9XG4gICAgfTtcbn1cbi8qKlxuICogRXh0ZW5kcyBhIFRleHRGaWVsZCB3aXRoIGF1dG9jb21wbGV0aW9uIGNhcGFiaWxpdGllcy5cbiAqL1xuZXhwb3J0IGNvbnN0IEF1dG9jb21wbGV0ZSA9IHdpdGhGb3JtQ29udGV4dChBdXRvY29tcGxldGVJbnQpO1xuQXV0b2NvbXBsZXRlLmRpc3BsYXlOYW1lID0gJ0F1dG9jb21wbGV0ZSc7XG4iXX0=