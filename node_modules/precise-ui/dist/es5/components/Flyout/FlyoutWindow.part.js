"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var withResponsive_1 = require("../../hoc/withResponsive");
var distance_1 = require("../../distance");
var textStyles_1 = require("../../textStyles");
var toolTipArrowSize = 18;
function getFlyoutArrowPosition(_a) {
    var mainPosition = _a.mainPosition, origSecondaryPosition = _a.secondaryPosition, offset = _a.offset, targetRect = _a.targetRect, flyoutRect = _a.flyoutRect;
    var _b;
    if (mainPosition && flyoutRect.width) {
        var vertical = isVertical(mainPosition);
        var mainAxisTargetSize = vertical ? targetRect.height : targetRect.width;
        var secondaryAxisTargetSize = vertical ? targetRect.width : targetRect.height;
        var secondaryAxisContnetSize = vertical ? flyoutRect.width : flyoutRect.height;
        var mainPositionValue = mainAxisTargetSize + offset + 1 - toolTipArrowSize / 2;
        var secondaryPosition = void 0;
        var secondaryPositionValue = void 0;
        if (!origSecondaryPosition) {
            secondaryPosition = vertical ? 'left' : 'top';
            secondaryPositionValue = (secondaryAxisTargetSize - toolTipArrowSize) / 2;
        }
        else {
            secondaryPosition = origSecondaryPosition;
            secondaryPositionValue =
                secondaryAxisTargetSize / 4 > secondaryAxisContnetSize - toolTipArrowSize
                    ? secondaryAxisContnetSize - toolTipArrowSize
                    : secondaryAxisTargetSize / 4;
        }
        var rotate = {
            top: 0,
            left: -90,
            right: 90,
            bottom: 180,
        };
        return _b = {
                rotate: rotate[mainPosition]
            },
            _b[invertPosition(mainPosition)] = mainPositionValue,
            _b[secondaryPosition] = secondaryPositionValue,
            _b;
    }
    return {};
}
function getDetailedPositionInfo(_a) {
    var targetRect = _a.targetRect, dimensions = _a.dimensions, flyoutRect = _a.flyoutRect;
    var viewportPosition = {
        left: targetRect.left,
        right: dimensions.width - targetRect.right,
        top: targetRect.top,
        bottom: dimensions.height - targetRect.bottom,
    };
    var hasEnoughSpace = {};
    var hasMoreSpace = {};
    for (var _i = 0, _b = Object.keys(viewportPosition); _i < _b.length; _i++) {
        var position = _b[_i];
        if (isVertical(position)) {
            // There is always enought space for top/bottom flyout when it lays outside of the viewport.
            hasEnoughSpace[position] = targetRect.top > dimensions.height || viewportPosition[position] > flyoutRect.height;
        }
        else {
            hasEnoughSpace[position] = viewportPosition[position] > flyoutRect.width;
        }
        hasMoreSpace[position] = viewportPosition[position] > viewportPosition[invertPosition(position)];
    }
    return {
        viewportPosition: viewportPosition,
        hasEnoughSpace: hasEnoughSpace,
        hasMoreSpace: hasMoreSpace,
    };
}
function getMainAxisFlyoutPositionAndSize(_a) {
    var direction = _a.direction, targetRect = _a.targetRect, offset = _a.offset, dimensions = _a.dimensions, vertical = _a.vertical, flyoutRect = _a.flyoutRect;
    var targetSize = vertical ? targetRect.height : targetRect.width;
    var flyoutSize = vertical ? flyoutRect.height : flyoutRect.width;
    var _b = getDetailedPositionInfo({
        targetRect: targetRect,
        dimensions: dimensions,
        flyoutRect: flyoutRect,
    }), hasEnoughSpace = _b.hasEnoughSpace, viewportPosition = _b.viewportPosition;
    var sizeValue = hasEnoughSpace[direction]
        ? flyoutSize
        : viewportPosition[direction] - (offset + toolTipArrowSize / 2) - distance_1.distancePx.medium;
    return {
        position: {
            name: invertPosition(direction),
            value: targetSize + (offset + toolTipArrowSize / 2),
        },
        size: {
            name: vertical ? 'height' : 'width',
            value: sizeValue,
        },
    };
}
function getSecondaryAxisFlyoutPositionAndSize(_a) {
    var direction = _a.direction, targetRect = _a.targetRect, dimensions = _a.dimensions, vertical = _a.vertical, flyoutRect = _a.flyoutRect;
    var positionValue;
    var positionName;
    var sizeName = vertical ? 'width' : 'height';
    var targetSize = vertical ? targetRect.width : targetRect.height;
    var targetPosition = vertical ? targetRect.left : targetRect.top;
    var flyoutSize = vertical ? flyoutRect.width : flyoutRect.height;
    var windowSize = vertical ? dimensions.width : dimensions.height;
    var viewportPosition = getDetailedPositionInfo({
        targetRect: targetRect,
        dimensions: dimensions,
        flyoutRect: flyoutRect,
    }).viewportPosition;
    var sizeValue = flyoutSize;
    if (direction === undefined) {
        positionName = vertical ? 'left' : 'top';
        var centeredValue = (targetSize - flyoutSize) / 2;
        if (viewportPosition[positionName] > 0 && viewportPosition[positionName] + centeredValue < 0) {
            positionValue = -viewportPosition[positionName] + distance_1.distancePx.medium;
            sizeValue = flyoutSize > windowSize ? windowSize - distance_1.distancePx.xlarge : flyoutSize;
        }
        else {
            positionValue = centeredValue;
        }
    }
    else {
        positionName = direction;
        positionValue =
            positionName === 'top' || positionName === 'left'
                ? 0
                : targetPosition - flyoutSize > 0
                    ? targetSize - flyoutSize
                    : -targetPosition + distance_1.distancePx.medium;
        if (positionName === 'top' || positionName === 'left') {
            sizeValue =
                targetPosition + positionValue + flyoutSize > windowSize
                    ? windowSize - targetPosition + positionValue - distance_1.distancePx.medium
                    : flyoutSize;
        }
        else {
            sizeValue =
                flyoutSize > targetPosition + targetSize ? targetPosition + targetSize - distance_1.distancePx.medium : flyoutSize;
            positionName = invertPosition(positionName);
        }
    }
    return {
        position: {
            name: positionName,
            value: positionValue,
        },
        size: {
            name: sizeName,
            value: sizeValue,
        },
    };
}
function invertPosition(position) {
    var invertedPosition = {
        top: 'bottom',
        left: 'right',
        right: 'left',
        bottom: 'top',
    };
    return invertedPosition[position];
}
function isVertical(position) {
    return position === 'top' || position === 'bottom' ? true : false;
}
var StyledFlyoutWindow = styled_1.default('div')(styled_1.themed(function (_a) {
    var theme = _a.theme, size = _a.size, position = _a.position, noGutter = _a.noGutter;
    return styled_1.css(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n      ", "\n\n      position: absolute;\n      z-index: 100;\n      box-sizing: border-box;\n      box-shadow: 0 2px 6px 0 rgba(75, 78, 82, 0.2);\n      border: 1px solid ", ";\n      background: ", ";\n      color: ", ";\n      max-width: ", ";\n      max-height: ", ";\n      ", " box-sizing: border-box;\n\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      overflow: auto;\n    "], ["\n      ", "\n\n      position: absolute;\n      z-index: 100;\n      box-sizing: border-box;\n      box-shadow: 0 2px 6px 0 rgba(75, 78, 82, 0.2);\n      border: 1px solid ", ";\n      background: ", ";\n      color: ", ";\n      max-width: ", ";\n      max-height: ", ";\n      ", " box-sizing: border-box;\n\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      overflow: auto;\n    "])), textStyles_1.getFontStyle({ size: 'medium' }), theme.ui4, theme.flyout.background, theme.flyout.textColor, theme.flyout.maxWidth, theme.flyout.maxHeight, !noGutter ? "padding: " + distance_1.distance.small + " " + distance_1.distance.medium + ";" : '', size && size.width !== undefined ? "width: " + size.width + "px" : '', size && size.height !== undefined ? "height: " + size.height + "px" : '', position && position.top !== undefined ? "top: " + position.top + "px" : '', position && position.left !== undefined ? "left: " + position.left + "px" : '', position && position.bottom !== undefined ? "bottom: " + position.bottom + "px" : '', position && position.right !== undefined ? "right: " + position.right + "px" : '');
}));
var StyledFlyoutArrow = styled_1.default('div')(styled_1.themed(function (_a) {
    var top = _a.top, left = _a.left, bottom = _a.bottom, right = _a.right, rotate = _a.rotate, theme = _a.theme;
    return styled_1.css(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n      pointer-events: none;\n      position: absolute;\n      z-index: 101;\n      width: ", "px;\n      height: ", "px;\n\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n\n      :before {\n        content: ' ';\n        position: absolute;\n        top: 0;\n        left: 0;\n        border-style: solid;\n        border-width: ", "px;\n        border-color: ", " transparent transparent transparent;\n      }\n\n      :after {\n        content: ' ';\n        position: absolute;\n        top: 0;\n        left: 0;\n        border-style: solid;\n        border-width: ", "px;\n        margin-left: 1px;\n        border-color: ", " transparent transparent transparent;\n      }\n    "], ["\n      pointer-events: none;\n      position: absolute;\n      z-index: 101;\n      width: ", "px;\n      height: ", "px;\n\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n      ", ";\n\n      :before {\n        content: ' ';\n        position: absolute;\n        top: 0;\n        left: 0;\n        border-style: solid;\n        border-width: ", "px;\n        border-color: ", " transparent transparent transparent;\n      }\n\n      :after {\n        content: ' ';\n        position: absolute;\n        top: 0;\n        left: 0;\n        border-style: solid;\n        border-width: ", "px;\n        margin-left: 1px;\n        border-color: ", " transparent transparent transparent;\n      }\n    "])), toolTipArrowSize, toolTipArrowSize, top !== undefined ? "top: " + top + "px" : '', left !== undefined ? "left: " + left + "px" : '', bottom !== undefined ? "bottom: " + bottom + "px" : '', right !== undefined ? "right: " + right + "px" : '', rotate !== undefined ? "transform: rotate(" + rotate + "deg)" : '', toolTipArrowSize / 2, theme.ui4, toolTipArrowSize / 2 - 1, theme.flyout.background);
}));
var FlyoutWindowInt = /** @class */ (function (_super) {
    __extends(FlyoutWindowInt, _super);
    function FlyoutWindowInt(props) {
        var _this = _super.call(this, props) || this;
        _this.scrollPosition = { top: 0, left: 0 };
        _this.setFlyoutRef = function (el) {
            if (_this.flyoutContainer) {
                _this.flyoutContainer.removeEventListener('scroll', _this.onScroll);
            }
            if (el) {
                el.addEventListener('scroll', _this.onScroll);
            }
            _this.flyoutContainer = el;
        };
        _this.onScroll = function (e) {
            if (e.target && e.target instanceof HTMLElement) {
                _this.scrollPosition = {
                    top: e.target.scrollTop,
                    left: e.target.scrollLeft,
                };
            }
        };
        _this.state = {
            flyoutRect: undefined,
            children: undefined,
        };
        return _this;
    }
    FlyoutWindowInt.getDerivedStateFromProps = function (nextProps, prevState) {
        if (nextProps.children !== prevState.children) {
            return {
                flyoutRect: undefined,
                children: nextProps.children,
            };
        }
        return {
            children: nextProps.children,
        };
    };
    FlyoutWindowInt.prototype.componentDidMount = function () {
        if (this.flyoutContainer) {
            this.updateMeasurements();
        }
    };
    FlyoutWindowInt.prototype.componentWillUnmount = function () {
        if (this.flyoutContainer) {
            this.flyoutContainer.removeEventListener('scroll', this.onScroll);
        }
    };
    FlyoutWindowInt.prototype.componentDidUpdate = function () {
        if (this.flyoutContainer) {
            if (!this.state.flyoutRect) {
                this.updateMeasurements();
            }
            if (this.flyoutContainer.scroll) {
                this.flyoutContainer.scroll({
                    top: this.scrollPosition.top,
                    left: this.scrollPosition.left,
                });
            }
        }
    };
    FlyoutWindowInt.prototype.updateMeasurements = function () {
        if (this.flyoutContainer) {
            var flyoutRect = this.flyoutContainer.getBoundingClientRect();
            this.setState({
                flyoutRect: flyoutRect,
            });
        }
    };
    FlyoutWindowInt.prototype.getFlyoutDimensions = function () {
        var _a, _b;
        var flyoutRect = this.state.flyoutRect;
        if (!flyoutRect) {
            return {};
        }
        var _c = this.props, position = _c.position, _d = _c.defaultPosition, defaultPosition = _d === void 0 ? 'bottom' : _d, _e = _c.offset, offset = _e === void 0 ? 4 : _e, dimensions = _c.dimensions, targetRect = _c.targetRect;
        var _f = (position || defaultPosition).split('-'), mainPosition = _f[0], secondaryPosition = _f[1];
        if (!dimensions || !mainPosition) {
            return {};
        }
        var vertical = isVertical(mainPosition);
        var _g = getDetailedPositionInfo({
            targetRect: targetRect,
            dimensions: dimensions,
            flyoutRect: flyoutRect,
        }), hasMoreSpace = _g.hasMoreSpace, hasEnoughSpace = _g.hasEnoughSpace;
        var mainDirection = mainPosition;
        var main = getMainAxisFlyoutPositionAndSize({
            direction: mainDirection,
            targetRect: targetRect,
            offset: offset,
            dimensions: dimensions,
            vertical: vertical,
            flyoutRect: flyoutRect,
        });
        if (!position && !hasEnoughSpace[mainDirection] && !hasMoreSpace[mainDirection]) {
            mainDirection = invertPosition(mainDirection);
            main = getMainAxisFlyoutPositionAndSize({
                direction: mainDirection,
                targetRect: targetRect,
                offset: offset,
                dimensions: dimensions,
                vertical: vertical,
                flyoutRect: flyoutRect,
            });
        }
        var secondaryDirection = secondaryPosition;
        var secondary = getSecondaryAxisFlyoutPositionAndSize({
            direction: secondaryDirection,
            targetRect: targetRect,
            dimensions: dimensions,
            vertical: vertical,
            flyoutRect: flyoutRect,
        });
        if (!position && secondaryDirection && !hasEnoughSpace[secondaryDirection] && hasMoreSpace[secondaryDirection]) {
            secondaryDirection = invertPosition(secondaryDirection);
            secondary = getSecondaryAxisFlyoutPositionAndSize({
                direction: secondaryDirection,
                targetRect: targetRect,
                dimensions: dimensions,
                vertical: vertical,
                flyoutRect: flyoutRect,
            });
        }
        return {
            position: (_a = {},
                _a[main.position.name] = main.position.value,
                _a[secondary.position.name] = secondary.position.value,
                _a),
            size: (_b = {},
                _b[main.size.name] = main.size.value,
                _b[secondary.size.name] = secondary.size.value,
                _b),
            arrowPosition: getFlyoutArrowPosition({
                mainPosition: mainDirection,
                secondaryPosition: secondaryDirection,
                offset: offset,
                targetRect: targetRect,
                flyoutRect: flyoutRect,
            }),
        };
    };
    FlyoutWindowInt.prototype.render = function () {
        var _a = this.props, children = _a.children, _0 = _a.targetRect, _1 = _a.position, _2 = _a.offset, _3 = _a.dimensions, _4 = _a.innerRef, props = __rest(_a, ["children", "targetRect", "position", "offset", "dimensions", "innerRef"]);
        var _b = this.getFlyoutDimensions(), arrowPosition = _b.arrowPosition, flyoutDimensions = __rest(_b, ["arrowPosition"]);
        return (children && (React.createElement(React.Fragment, null,
            React.createElement(StyledFlyoutArrow, __assign({}, arrowPosition, { theme: props.theme })),
            React.createElement(StyledFlyoutWindow, __assign({}, flyoutDimensions, props, { ref: this.setFlyoutRef }), children))));
    };
    FlyoutWindowInt.inner = {
        get StyledFlyoutArrow() { return StyledFlyoutArrow; },
        get StyledFlyoutWindow() { return StyledFlyoutWindow; }
    };
    return FlyoutWindowInt;
}(React.Component));
exports.FlyoutWindowInt = FlyoutWindowInt;
exports.FlyoutWindow = withResponsive_1.withResponsive(FlyoutWindowInt);
var templateObject_1, templateObject_2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmx5b3V0V2luZG93LnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9GbHlvdXQvRmx5b3V0V2luZG93LnBhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBeUQ7QUFDekQsMkRBQW9GO0FBRXBGLDJDQUFzRDtBQUV0RCwrQ0FBZ0Q7QUFDaEQsSUFBTSxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7QUF3QjVCLFNBQVMsc0JBQXNCLENBQUMsRUFNL0I7UUFOaUMsOEJBQVksRUFBRSw0Q0FBd0MsRUFBRSxrQkFBTSxFQUFFLDBCQUFVLEVBQUUsMEJBQVU7O0lBT3BILElBQUksWUFBWSxJQUFJLFVBQVUsQ0FBQyxLQUFLLEVBQUU7UUFDbEMsSUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFDLElBQU0sa0JBQWtCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO1FBQzNFLElBQU0sdUJBQXVCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQ2hGLElBQU0sd0JBQXdCLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQ2pGLElBQU0saUJBQWlCLEdBQUcsa0JBQWtCLEdBQUcsTUFBTSxHQUFHLENBQUMsR0FBRyxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7UUFDakYsSUFBSSxpQkFBaUIsU0FBUSxDQUFDO1FBQzlCLElBQUksc0JBQXNCLFNBQVEsQ0FBQztRQUNuQyxJQUFJLENBQUMscUJBQXFCLEVB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QUFNLGVBQTJHLEVBQXpHLHNCQUFRLEVBQUUsa0JBQWMsRUFBRSxnQkFBWSxFQUFFLGNBQVUsRUFBRSxrQkFBYyxFQUFFLGdCQUFZLEVBQUUsOEZBQXVCLENBQUM7UUFDbEgsSUFBTSwrQkFBbUUsRUFBakUsZ0NBQWEsRUFBRSxnREFBa0QsQ0FBQztRQUMxRSxPQUFPLENBQUMsUUFBUSxJQUFJLENBQUM7WUFDbkIsb0JBQUMsaUJBQWlCLGVBQUssYUFBYSxJQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxJQUFHO1lBQzNELG9CQUFDLGtCQUFrQixlQUFLLGdCQUFnQixFQUFNLEtBQUssSUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLFlBQVksS0FDeEUsUUFBUSxDQUNVLENBQ3BCLENBQUMsQ0FBQyxDQUFDO0lBQ1YsQ0FBQztJQUNNLHFCQUFLLEdBQUc7UUFDWCxJQUFJLGlCQUFpQixLQUFLLE9BQU8saUJBQTZDLENBQUMsQ0FBQyxDQUFDO1FBQ2pGLElBQUksa0JBQWtCLEtBQUssT0FBTyxrQkFBK0MsQ0FBQyxDQUFDLENBQUM7S0FDdkYsQ0FBQztJQUNOLHNCQUFDO0NBQUEsQUFwS0QsQ0FBcUMsS0FBSyxDQUFDLFNBQVMsR0FvS25EO0FBcEtZLDBDQUFlO0FBcUtmLFFBQUEsWUFBWSxHQUFHLCtCQUFjLENBQUMsZUFBZSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IGNzcywgdGhlbWVkIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IHdpdGhSZXNwb25zaXZlLCBSZXNwb25zaXZlQ29tcG9uZW50UHJvcHMgfSBmcm9tICcuLi8uLi9ob2Mvd2l0aFJlc3BvbnNpdmUnO1xuaW1wb3J0IHsgRmx5b3V0UG9zaXRpb24sIEJhc2ljUG9zaXRpb24gfSBmcm9tICcuL0ZseW91dC50eXBlcy5wYXJ0JztcbmltcG9ydCB7IGRpc3RhbmNlUHgsIGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgU3RhbmRhcmRQcm9wcyB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmNvbnN0IHRvb2xUaXBBcnJvd1NpemUgPSAxODtcbmV4cG9ydCBpbnRlcmZhY2UgRGltZW5zaW9ucyB7XG4gICAgd2lkdGg6IG51bWJlcjtcbiAgICBoZWlnaHQ6IG51bWJlcjtcbn1cbmludGVyZmFjZSBJbnZlcnRlZFBvc2l0aW9uIHtcbiAgICB0b3A6ICdib3R0b20nO1xuICAgIGxlZnQ6ICdyaWdodCc7XG4gICAgcmlnaHQ6ICdsZWZ0JztcbiAgICBib3R0b206ICd0b3AnO1xufVxuZXhwb3J0IGludGVyZmFjZSBGbHlvdXRXaW5kb3dQcm9wcyBleHRlbmRzIFJlc3BvbnNpdmVDb21wb25lbnRQcm9wcywgU3RhbmRhcmRQcm9wcyB7XG4gICAgdGFyZ2V0UmVjdDogQ2xpZW50UmVjdDtcbiAgICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlO1xuICAgIHBvc2l0aW9uPzogRmx5b3V0UG9zaXRpb247XG4gICAgZGVmYXVsdFBvc2l0aW9uPzogRmx5b3V0UG9zaXRpb247XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xufVxuZXhwb3J0IGludGVyZmFjZSBQb3NpdGlvbiB7XG4gICAgdG9wPzogbnVtYmVyO1xuICAgIHJpZ2h0PzogbnVtYmVyO1xuICAgIGJvdHRvbT86IG51bWJlcjtcbiAgICBsZWZ0PzogbnVtYmVyO1xufVxuZnVuY3Rpb24gZ2V0Rmx5b3V0QXJyb3dQb3NpdGlvbih7IG1haW5Qb3NpdGlvbiwgc2Vjb25kYXJ5UG9zaXRpb246IG9yaWdTZWNvbmRhcnlQb3NpdGlvbiwgb2Zmc2V0LCB0YXJnZXRSZWN0LCBmbHlvdXRSZWN0LCB9OiB7XG4gICAgbWFpblBvc2l0aW9uOiBCYXNpY1Bvc2l0aW9uO1xuICAgIHNlY29uZGFyeVBvc2l0aW9uPzogQmFzaWNQb3NpdGlvbjtcbiAgICB0YXJnZXRSZWN0OiBDbGllbnRSZWN0O1xuICAgIGZseW91dFJlY3Q6IENsaWVudFJlY3Q7XG4gICAgb2Zmc2V0OiBudW1iZXI7XG59KSB7XG4gICAgaWYgKG1haW5Qb3NpdGlvbiAmJiBmbHlvdXRSZWN0LndpZHRoKSB7XG4gICAgICAgIGNvbnN0IHZlcnRpY2FsID0gaXNWZXJ0aWNhbChtYWluUG9zaXRpb24pO1xuICAgICAgICBjb25zdCBtYWluQXhpc1RhcmdldFNpemUgPSB2ZXJ0aWNhbCA/IHRhcmdldFJlY3QuaGVpZ2h0IDogdGFyZ2V0UmVjdC53aWR0aDtcbiAgICAgICAgY29uc3Qgc2Vjb25kYXJ5QXhpc1RhcmdldFNpemUgPSB2ZXJ0aWNhbCA/IHRhcmdldFJlY3Qud2lkdGggOiB0YXJnZXRSZWN0LmhlaWdodDtcbiAgICAgICAgY29uc3Qgc2Vjb25kYXJ5QXhpc0NvbnRuZXRTaXplID0gdmVydGljYWwgPyBmbHlvdXRSZWN0LndpZHRoIDogZmx5b3V0UmVjdC5oZWlnaHQ7XG4gICAgICAgIGNvbnN0IG1haW5Qb3NpdGlvblZhbHVlID0gbWFpbkF4aXNUYXJnZXRTaXplICsgb2Zmc2V0ICsgMSAtIHRvb2xUaXBBcnJvd1NpemUgLyAyO1xuICAgICAgICBsZXQgc2Vjb25kYXJ5UG9zaXRpb246IHN0cmluZztcbiAgICAgICAgbGV0IHNlY29uZGFyeVBvc2l0aW9uVmFsdWU6IG51bWJlcjtcbiAgICAgICAgaWYgKCFvcmlnU2Vjb25kYXJ5UG9zaXRpb24pIHtcbiAgICAgICAgICAgIHNlY29uZGFyeVBvc2l0aW9uID0gdmVydGljYWwgPyAnbGVmdCcgOiAndG9wJztcbiAgICAgICAgICAgIHNlY29uZGFyeVBvc2l0aW9uVmFsdWUgPSAoc2Vjb25kYXJ5QXhpc1RhcmdldFNpemUgLSB0b29sVGlwQXJyb3dTaXplKSAvIDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZWNvbmRhcnlQb3NpdGlvbiA9IG9yaWdTZWNvbmRhcnlQb3NpdGlvbjtcbiAgICAgICAgICAgIHNlY29uZGFyeVBvc2l0aW9uVmFsdWUgPVxuICAgICAgICAgICAgICAgIHNlY29uZGFyeUF4aXNUYXJnZXRTaXplIC8gNCA+IHNlY29uZGFyeUF4aXNDb250bmV0U2l6ZSAtIHRvb2xUaXBBcnJvd1NpemVcbiAgICAgICAgICAgICAgICAgICAgPyBzZWNvbmRhcnlBeGlzQ29udG5ldFNpemUgLSB0b29sVGlwQXJyb3dTaXplXG4gICAgICAgICAgICAgICAgICAgIDogc2Vjb25kYXJ5QXhpc1RhcmdldFNpemUgLyA0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJvdGF0ZSA9IHtcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIGxlZnQ6IC05MCxcbiAgICAgICAgICAgIHJpZ2h0OiA5MCxcbiAgICAgICAgICAgIGJvdHRvbTogMTgwLFxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcm90YXRlOiByb3RhdGVbbWFpblBvc2l0aW9uXSxcbiAgICAgICAgICAgIFtpbnZlcnRQb3NpdGlvbihtYWluUG9zaXRpb24pXTogbWFpblBvc2l0aW9uVmFsdWUsXG4gICAgICAgICAgICBbc2Vjb25kYXJ5UG9zaXRpb25dOiBzZWNvbmRhcnlQb3NpdGlvblZhbHVlLFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge307XG59XG5mdW5jdGlvbiBnZXREZXRhaWxlZFBvc2l0aW9uSW5mbyh7IHRhcmdldFJlY3QsIGRpbWVuc2lvbnMsIGZseW91dFJlY3QsIH06IHtcbiAgICB0YXJnZXRSZWN0OiBDbGllbnRSZWN0O1xuICAgIGRpbWVuc2lvbnM6IERpbWVuc2lvbnM7XG4gICAgZmx5b3V0UmVjdDogQ2xpZW50UmVjdDtcbn0pIHtcbiAgICBjb25zdCB2aWV3cG9ydFBvc2l0aW9uID0ge1xuICAgICAgICBsZWZ0OiB0YXJnZXRSZWN0LmxlZnQsXG4gICAgICAgIHJpZ2h0OiBkaW1lbnNpb25zLndpZHRoIC0gdGFyZ2V0UmVjdC5yaWdodCxcbiAgICAgICAgdG9wOiB0YXJnZXRSZWN0LnRvcCxcbiAgICAgICAgYm90dG9tOiBkaW1lbnNpb25zLmhlaWdodCAtIHRhcmdldFJlY3QuYm90dG9tLFxuICAgIH07XG4gICAgY29uc3QgaGFzRW5vdWdoU3BhY2UgPSB7fTtcbiAgICBjb25zdCBoYXNNb3JlU3BhY2UgPSB7fTtcbiAgICBmb3IgKGNvbnN0IHBvc2l0aW9uIG9mIE9iamVjdC5rZXlzKHZpZXdwb3J0UG9zaXRpb24pKSB7XG4gICAgICAgIGlmIChpc1ZlcnRpY2FsKHBvc2l0aW9uIGFzIEJhc2ljUG9zaXRpb24pKSB7XG4gICAgICAgICAgICAvLyBUaGVyZSBpcyBhbHdheXMgZW5vdWdodCBzcGFjZSBmb3IgdG9wL2JvdHRvbSBmbHlvdXQgd2hlbiBpdCBsYXlzIG91dHNpZGUgb2YgdGhlIHZpZXdwb3J0LlxuICAgICAgICAgICAgaGFzRW5vdWdoU3BhY2VbcG9zaXRpb25dID0gdGFyZ2V0UmVjdC50b3AgPiBkaW1lbnNpb25zLmhlaWdodCB8fCB2aWV3cG9ydFBvc2l0aW9uW3Bvc2l0aW9uXSA+IGZseW91dFJlY3QuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaGFzRW5vdWdoU3BhY2VbcG9zaXRpb25dID0gdmlld3BvcnRQb3NpdGlvbltwb3NpdGlvbl0gPiBmbHlvdXRSZWN0LndpZHRoO1xuICAgICAgICB9XG4gICAgICAgIGhhc01vcmVTcGFjZVtwb3NpdGlvbl0gPSB2aWV3cG9ydFBvc2l0aW9uW3Bvc2l0aW9uXSA+IHZpZXdwb3J0UG9zaXRpb25baW52ZXJ0UG9zaXRpb24ocG9zaXRpb24gYXMgQmFzaWNQb3NpdGlvbildO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICB2aWV3cG9ydFBvc2l0aW9uLFxuICAgICAgICBoYXNFbm91Z2hTcGFjZSxcbiAgICAgICAgaGFzTW9yZVNwYWNlLFxuICAgIH07XG59XG5mdW5jdGlvbiBnZXRNYWluQXhpc0ZseW91dFBvc2l0aW9uQW5kU2l6ZSh7IGRpcmVjdGlvbiwgdGFyZ2V0UmVjdCwgb2Zmc2V0LCBkaW1lbnNpb25zLCB2ZXJ0aWNhbCwgZmx5b3V0UmVjdCwgfToge1xuICAgIGRpcmVjdGlvbjogQmFzaWNQb3NpdGlvbjtcbiAgICB0YXJnZXRSZWN0OiBDbGllbnRSZWN0O1xuICAgIGZseW91dFJlY3Q6IENsaWVudFJlY3Q7XG4gICAgb2Zmc2V0OiBudW1iZXI7XG4gICAgZGltZW5zaW9uczogRGltZW5zaW9ucztcbiAgICB2ZXJ0aWNhbDogYm9vbGVhbjtcbn0pIHtcbiAgICBjb25zdCB0YXJnZXRTaXplID0gdmVydGljYWwgPyB0YXJnZXRSZWN0LmhlaWdodCA6IHRhcmdldFJlY3Qud2lkdGg7XG4gICAgY29uc3QgZmx5b3V0U2l6ZSA9IHZlcnRpY2FsID8gZmx5b3V0UmVjdC5oZWlnaHQgOiBmbHlvdXRSZWN0LndpZHRoO1xuICAgIGNvbnN0IHsgaGFzRW5vdWdoU3BhY2UsIHZpZXdwb3J0UG9zaXRpb24gfSA9IGdldERldGFpbGVkUG9zaXRpb25JbmZvKHtcbiAgICAgICAgdGFyZ2V0UmVjdCxcbiAgICAgICAgZGltZW5zaW9ucyxcbiAgICAgICAgZmx5b3V0UmVjdCxcbiAgICB9KTtcbiAgICBjb25zdCBzaXplVmFsdWUgPSBoYXNFbm91Z2hTcGFjZVtkaXJlY3Rpb25dXG4gICAgICAgID8gZmx5b3V0U2l6ZVxuICAgICAgICA6IHZpZXdwb3J0UG9zaXRpb25bZGlyZWN0aW9uXSAtIChvZmZzZXQgKyB0b29sVGlwQXJyb3dTaXplIC8gMikgLSBkaXN0YW5jZVB4Lm1lZGl1bTtcbiAgICByZXR1cm4ge1xuICAgICAgICBwb3NpdGlvbjoge1xuICAgICAgICAgICAgbmFtZTogaW52ZXJ0UG9zaXRpb24oZGlyZWN0aW9uKSxcbiAgICAgICAgICAgIHZhbHVlOiB0YXJnZXRTaXplICsgKG9mZnNldCArIHRvb2xUaXBBcnJvd1NpemUgLyAyKSxcbiAgICAgICAgfSxcbiAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgbmFtZTogdmVydGljYWwgPyAnaGVpZ2h0JyA6ICd3aWR0aCcsXG4gICAgICAgICAgICB2YWx1ZTogc2l6ZVZhbHVlLFxuICAgICAgICB9LFxuICAgIH07XG59XG5mdW5jdGlvbiBnZXRTZWNvbmRhcnlBeGlzRmx5b3V0UG9zaXRpb25BbmRTaXplKHsgZGlyZWN0aW9uLCB0YXJnZXRSZWN0LCBkaW1lbnNpb25zLCB2ZXJ0aWNhbCwgZmx5b3V0UmVjdCwgfToge1xuICAgIGRpcmVjdGlvbjogQmFzaWNQb3NpdGlvbjtcbiAgICB0YXJnZXRSZWN0OiBDbGllbnRSZWN0O1xuICAgIGRpbWVuc2lvbnM6IERpbWVuc2lvbnM7XG4gICAgdmVydGljYWw6IGJvb2xlYW47XG4gICAgZmx5b3V0UmVjdDogQ2xpZW50UmVjdDtcbn0pIHtcbiAgICBsZXQgcG9zaXRpb25WYWx1ZTogbnVtYmVyO1xuICAgIGxldCBwb3NpdGlvbk5hbWU6IEJhc2ljUG9zaXRpb247XG4gICAgY29uc3Qgc2l6ZU5hbWUgPSB2ZXJ0aWNhbCA/ICd3aWR0aCcgOiAnaGVpZ2h0JztcbiAgICBjb25zdCB0YXJnZXRTaXplID0gdmVydGljYWwgPyB0YXJnZXRSZWN0LndpZHRoIDogdGFyZ2V0UmVjdC5oZWlnaHQ7XG4gICAgY29uc3QgdGFyZ2V0UG9zaXRpb24gPSB2ZXJ0aWNhbCA/IHRhcmdldFJlY3QubGVmdCA6IHRhcmdldFJlY3QudG9wO1xuICAgIGNvbnN0IGZseW91dFNpemUgPSB2ZXJ0aWNhbCA/IGZseW91dFJlY3Qud2lkdGggOiBmbHlvdXRSZWN0LmhlaWdodDtcbiAgICBjb25zdCB3aW5kb3dTaXplID0gdmVydGljYWwgPyBkaW1lbnNpb25zLndpZHRoIDogZGltZW5zaW9ucy5oZWlnaHQ7XG4gICAgY29uc3QgeyB2aWV3cG9ydFBvc2l0aW9uIH0gPSBnZXREZXRhaWxlZFBvc2l0aW9uSW5mbyh7XG4gICAgICAgIHRhcmdldFJlY3QsXG4gICAgICAgIGRpbWVuc2lvbnMsXG4gICAgICAgIGZseW91dFJlY3QsXG4gICAgfSk7XG4gICAgbGV0IHNpemVWYWx1ZSA9IGZseW91dFNpemU7XG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHBvc2l0aW9uTmFtZSA9IHZlcnRpY2FsID8gJ2xlZnQnIDogJ3RvcCc7XG4gICAgICAgIGNvbnN0IGNlbnRlcmVkVmFsdWUgPSAodGFyZ2V0U2l6ZSAtIGZseW91dFNpemUpIC8gMjtcbiAgICAgICAgaWYgKHZpZXdwb3J0UG9zaXRpb25bcG9zaXRpb25OYW1lXSA+IDAgJiYgdmlld3BvcnRQb3NpdGlvbltwb3NpdGlvbk5hbWVdICsgY2VudGVyZWRWYWx1ZSA8IDApIHtcbiAgICAgICAgICAgIHBvc2l0aW9uVmFsdWUgPSAtdmlld3BvcnRQb3NpdGlvbltwb3NpdGlvbk5hbWVdICsgZGlzdGFuY2VQeC5tZWRpdW07XG4gICAgICAgICAgICBzaXplVmFsdWUgPSBmbHlvdXRTaXplID4gd2luZG93U2l6ZSA/IHdpbmRvd1NpemUgLSBkaXN0YW5jZVB4LnhsYXJnZSA6IGZseW91dFNpemU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBwb3NpdGlvblZhbHVlID0gY2VudGVyZWRWYWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcG9zaXRpb25OYW1lID0gZGlyZWN0aW9uO1xuICAgICAgICBwb3NpdGlvblZhbHVlID1cbiAgICAgICAgICAgIHBvc2l0aW9uTmFtZSA9PT0gJ3RvcCcgfHwgcG9zaXRpb25OYW1lID09PSAnbGVmdCdcbiAgICAgICAgICAgICAgICA/IDBcbiAgICAgICAgICAgICAgICA6IHRhcmdldFBvc2l0aW9uIC0gZmx5b3V0U2l6ZSA+IDBcbiAgICAgICAgICAgICAgICAgICAgPyB0YXJnZXRTaXplIC0gZmx5b3V0U2l6ZVxuICAgICAgICAgICAgICAgICAgICA6IC10YXJnZXRQb3NpdGlvbiArIGRpc3RhbmNlUHgubWVkaXVtO1xuICAgICAgICBpZiAocG9zaXRpb25OYW1lID09PSAndG9wJyB8fCBwb3NpdGlvbk5hbWUgPT09ICdsZWZ0Jykge1xuICAgICAgICAgICAgc2l6ZVZhbHVlID1cbiAgICAgICAgICAgICAgICB0YXJnZXRQb3NpdGlvbiArIHBvc2l0aW9uVmFsdWUgKyBmbHlvdXRTaXplID4gd2luZG93U2l6ZVxuICAgICAgICAgICAgICAgICAgICA/IHdpbmRvd1NpemUgLSB0YXJnZXRQb3NpdGlvbiArIHBvc2l0aW9uVmFsdWUgLSBkaXN0YW5jZVB4Lm1lZGl1bVxuICAgICAgICAgICAgICAgICAgICA6IGZseW91dFNpemU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzaXplVmFsdWUgPVxuICAgICAgICAgICAgICAgIGZseW91dFNpemUgPiB0YXJnZXRQb3NpdGlvbiArIHRhcmdldFNpemUgPyB0YXJnZXRQb3NpdGlvbiArIHRhcmdldFNpemUgLSBkaXN0YW5jZVB4Lm1lZGl1bSA6IGZseW91dFNpemU7XG4gICAgICAgICAgICBwb3NpdGlvbk5hbWUgPSBpbnZlcnRQb3NpdGlvbihwb3NpdGlvbk5hbWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICBuYW1lOiBwb3NpdGlvbk5hbWUsXG4gICAgICAgICAgICB2YWx1ZTogcG9zaXRpb25WYWx1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgc2l6ZToge1xuICAgICAgICAgICAgbmFtZTogc2l6ZU5hbWUsXG4gICAgICAgICAgICB2YWx1ZTogc2l6ZVZhbHVlLFxuICAgICAgICB9LFxuICAgIH07XG59XG5mdW5jdGlvbiBpbnZlcnRQb3NpdGlvbihwb3NpdGlvbjogQmFzaWNQb3NpdGlvbikge1xuICAgIGNvbnN0IGludmVydGVkUG9zaXRpb246IEludmVydGVkUG9zaXRpb24gPSB7XG4gICAgICAgIHRvcDogJ2JvdHRvbScsXG4gICAgICAgIGxlZnQ6ICdyaWdodCcsXG4gICAgICAgIHJpZ2h0OiAnbGVmdCcsXG4gICAgICAgIGJvdHRvbTogJ3RvcCcsXG4gICAgfTtcbiAgICByZXR1cm4gaW52ZXJ0ZWRQb3NpdGlvbltwb3NpdGlvbl07XG59XG5mdW5jdGlvbiBpc1ZlcnRpY2FsKHBvc2l0aW9uOiBCYXNpY1Bvc2l0aW9uKSB7XG4gICAgcmV0dXJuIHBvc2l0aW9uID09PSAndG9wJyB8fCBwb3NpdGlvbiA9PT0gJ2JvdHRvbScgPyB0cnVlIDogZmFsc2U7XG59XG5leHBvcnQgaW50ZXJmYWNlIFN0eWxlZEZseW91dFdpbmRvd1Byb3BzIHtcbiAgICBzaXplPzoge1xuICAgICAgICB3aWR0aD86IG51bWJlcjtcbiAgICAgICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgIH07XG4gICAgcG9zaXRpb24/OiBQb3NpdGlvbjtcbiAgICBub0d1dHRlcj86IGJvb2xlYW47XG59XG5jb25zdCBTdHlsZWRGbHlvdXRXaW5kb3cgPSBzdHlsZWQoJ2RpdicpPFN0eWxlZEZseW91dFdpbmRvd1Byb3BzPih0aGVtZWQoKHsgdGhlbWUsIHNpemUsIHBvc2l0aW9uLCBub0d1dHRlciB9KSA9PiBjc3MgYFxuICAgICAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnbWVkaXVtJyB9KX1cblxuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgei1pbmRleDogMTAwO1xuICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDZweCAwIHJnYmEoNzUsIDc4LCA4MiwgMC4yKTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7dGhlbWUudWk0fTtcbiAgICAgIGJhY2tncm91bmQ6ICR7dGhlbWUuZmx5b3V0LmJhY2tncm91bmR9O1xuICAgICAgY29sb3I6ICR7dGhlbWUuZmx5b3V0LnRleHRDb2xvcn07XG4gICAgICBtYXgtd2lkdGg6ICR7dGhlbWUuZmx5b3V0Lm1heFdpZHRofTtcbiAgICAgIG1heC1oZWlnaHQ6ICR7dGhlbWUuZmx5b3V0Lm1heEhlaWdodH07XG4gICAgICAkeyFub0d1dHRlciA/IGBwYWRkaW5nOiAke2Rpc3RhbmNlLnNtYWxsfSAke2Rpc3RhbmNlLm1lZGl1bX07YCA6ICcnfSBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuXG4gICAgICAke3NpemUgJiYgc2l6ZS53aWR0aCAhPT0gdW5kZWZpbmVkID8gYHdpZHRoOiAke3NpemUud2lkdGh9cHhgIDogJyd9O1xuICAgICAgJHtzaXplICYmIHNpemUuaGVpZ2h0ICE9PSB1bmRlZmluZWQgPyBgaGVpZ2h0OiAke3NpemUuaGVpZ2h0fXB4YCA6ICcnfTtcbiAgICAgICR7cG9zaXRpb24gJiYgcG9zaXRpb24udG9wICE9PSB1bmRlZmluZWQgPyBgdG9wOiAke3Bvc2l0aW9uLnRvcH1weGAgOiAnJ307XG4gICAgICAke3Bvc2l0aW9uICYmIHBvc2l0aW9uLmxlZnQgIT09IHVuZGVmaW5lZCA/IGBsZWZ0OiAke3Bvc2l0aW9uLmxlZnR9cHhgIDogJyd9O1xuICAgICAgJHtwb3NpdGlvbiAmJiBwb3NpdGlvbi5ib3R0b20gIT09IHVuZGVmaW5lZCA/IGBib3R0b206ICR7cG9zaXRpb24uYm90dG9tfXB4YCA6ICcnfTtcbiAgICAgICR7cG9zaXRpb24gJiYgcG9zaXRpb24ucmlnaHQgIT09IHVuZGVmaW5lZCA/IGByaWdodDogJHtwb3NpdGlvbi5yaWdodH1weGAgOiAnJ307XG4gICAgICBvdmVyZmxvdzogYXV0bztcbiAgICBgKSk7XG5pbnRlcmZhY2UgU3R5bGVkRmx5b3V0QXJyb3dQcm9wcyBleHRlbmRzIFBvc2l0aW9uIHtcbiAgICByb3RhdGU/OiBudW1iZXI7XG59XG5jb25zdCBTdHlsZWRGbHlvdXRBcnJvdyA9IHN0eWxlZCgnZGl2Jyk8U3R5bGVkRmx5b3V0QXJyb3dQcm9wcz4odGhlbWVkKCh7IHRvcCwgbGVmdCwgYm90dG9tLCByaWdodCwgcm90YXRlLCB0aGVtZSB9KSA9PiBjc3MgYFxuICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICB6LWluZGV4OiAxMDE7XG4gICAgICB3aWR0aDogJHt0b29sVGlwQXJyb3dTaXplfXB4O1xuICAgICAgaGVpZ2h0OiAke3Rvb2xUaXBBcnJvd1NpemV9cHg7XG5cbiAgICAgICR7dG9wICE9PSB1bmRlZmluZWQgPyBgdG9wOiAke3RvcH1weGAgOiAnJ307XG4gICAgICAke2xlZnQgIT09IHVuZGVmaW5lZCA/IGBsZWZ0OiAke2xlZnR9cHhgIDogJyd9O1xuICAgICAgJHtib3R0b20gIT09IHVuZGVmaW5lZCA/IGBib3R0b206ICR7Ym90dG9tfXB4YCA6ICcnfTtcbiAgICAgICR7cmlnaHQgIT09IHVuZGVmaW5lZCA/IGByaWdodDogJHtyaWdodH1weGAgOiAnJ307XG4gICAgICAke3JvdGF0ZSAhPT0gdW5kZWZpbmVkID8gYHRyYW5zZm9ybTogcm90YXRlKCR7cm90YXRlfWRlZylgIDogJyd9O1xuXG4gICAgICA6YmVmb3JlIHtcbiAgICAgICAgY29udGVudDogJyAnO1xuICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgIHRvcDogMDtcbiAgICAgICAgbGVmdDogMDtcbiAgICAgICAgYm9yZGVyLXN0eWxlOiBzb2xpZDtcbiAgICAgICAgYm9yZGVyLXdpZHRoOiAke3Rvb2xUaXBBcnJvd1NpemUgLyAyfXB4O1xuICAgICAgICBib3JkZXItY29sb3I6ICR7dGhlbWUudWk0fSB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudDtcbiAgICAgIH1cblxuICAgICAgOmFmdGVyIHtcbiAgICAgICAgY29udGVudDogJyAnO1xuICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICAgIHRvcDogMDtcbiAgICAgICAgbGVmdDogMDtcbiAgICAgICAgYm9yZGVyLXN0eWxlOiBzb2xpZDtcbiAgICAgICAgYm9yZGVyLXdpZHRoOiAke3Rvb2xUaXBBcnJvd1NpemUgLyAyIC0gMX1weDtcbiAgICAgICAgbWFyZ2luLWxlZnQ6IDFweDtcbiAgICAgICAgYm9yZGVyLWNvbG9yOiAke3RoZW1lLmZseW91dC5iYWNrZ3JvdW5kfSB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudDtcbiAgICAgIH1cbiAgICBgKSk7XG5leHBvcnQgaW50ZXJmYWNlIEZseW91dFdpbmRvd1N0YXRlIHtcbiAgICBmbHlvdXRSZWN0PzogQ2xpZW50UmVjdDtcbiAgICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTtcbn1cbmludGVyZmFjZSBTY3JvbGxQb3NpdGlvbiB7XG4gICAgdG9wOiBudW1iZXI7XG4gICAgbGVmdDogbnVtYmVyO1xufVxuZXhwb3J0IGNsYXNzIEZseW91dFdpbmRvd0ludCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxGbHlvdXRXaW5kb3dQcm9wcywgRmx5b3V0V2luZG93U3RhdGU+IHtcbiAgICBwcml2YXRlIGZseW91dENvbnRhaW5lcjogSFRNTERpdkVsZW1lbnQgfCBudWxsO1xuICAgIHByaXZhdGUgc2Nyb2xsUG9zaXRpb246IFNjcm9sbFBvc2l0aW9uID0geyB0b3A6IDAsIGxlZnQ6IDAgfTtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogRmx5b3V0V2luZG93UHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgZmx5b3V0UmVjdDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgY2hpbGRyZW46IHVuZGVmaW5lZCxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc3RhdGljIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhuZXh0UHJvcHM6IEZseW91dFdpbmRvd1Byb3BzLCBwcmV2U3RhdGU6IEZseW91dFdpbmRvd1N0YXRlKSB7XG4gICAgICAgIGlmIChuZXh0UHJvcHMuY2hpbGRyZW4gIT09IHByZXZTdGF0ZS5jaGlsZHJlbikge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBmbHlvdXRSZWN0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgY2hpbGRyZW46IG5leHRQcm9wcy5jaGlsZHJlbixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNoaWxkcmVuOiBuZXh0UHJvcHMuY2hpbGRyZW4sXG4gICAgICAgIH07XG4gICAgfVxuICAgIHByaXZhdGUgc2V0Rmx5b3V0UmVmID0gKGVsOiBIVE1MRGl2RWxlbWVudCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5mbHlvdXRDb250YWluZXIpIHtcbiAgICAgICAgICAgIHRoaXMuZmx5b3V0Q29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMub25TY3JvbGwpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbCkge1xuICAgICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5vblNjcm9sbCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mbHlvdXRDb250YWluZXIgPSBlbDtcbiAgICB9O1xuICAgIHByaXZhdGUgb25TY3JvbGwgPSAoZTogVUlFdmVudCkgPT4ge1xuICAgICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxQb3NpdGlvbiA9IHtcbiAgICAgICAgICAgICAgICB0b3A6IGUudGFyZ2V0LnNjcm9sbFRvcCxcbiAgICAgICAgICAgICAgICBsZWZ0OiBlLnRhcmdldC5zY3JvbGxMZWZ0LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGlmICh0aGlzLmZseW91dENvbnRhaW5lcikge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVNZWFzdXJlbWVudHMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZmx5b3V0Q29udGFpbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmZseW91dENvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLmZseW91dENvbnRhaW5lcikge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmZseW91dFJlY3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU1lYXN1cmVtZW50cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuZmx5b3V0Q29udGFpbmVyLnNjcm9sbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmx5b3V0Q29udGFpbmVyLnNjcm9sbCh7XG4gICAgICAgICAgICAgICAgICAgIHRvcDogdGhpcy5zY3JvbGxQb3NpdGlvbi50b3AsXG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMuc2Nyb2xsUG9zaXRpb24ubGVmdCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIHVwZGF0ZU1lYXN1cmVtZW50cygpIHtcbiAgICAgICAgaWYgKHRoaXMuZmx5b3V0Q29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb25zdCBmbHlvdXRSZWN0ID0gdGhpcy5mbHlvdXRDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBmbHlvdXRSZWN0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBnZXRGbHlvdXREaW1lbnNpb25zKCk6IHtcbiAgICAgICAgc2l6ZT86IHtcbiAgICAgICAgICAgIHdpZHRoPzogbnVtYmVyO1xuICAgICAgICAgICAgaGVpZ2h0PzogbnVtYmVyO1xuICAgICAgICB9O1xuICAgICAgICBwb3NpdGlvbj86IFBvc2l0aW9uO1xuICAgICAgICBhcnJvd1Bvc2l0aW9uPzogUG9zaXRpb24gJiB7XG4gICAgICAgICAgICByb3RhdGU/OiBudW1iZXI7XG4gICAgICAgIH07XG4gICAgfSB7XG4gICAgICAgIGNvbnN0IHsgZmx5b3V0UmVjdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFmbHlvdXRSZWN0KSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBwb3NpdGlvbiwgZGVmYXVsdFBvc2l0aW9uID0gJ2JvdHRvbScsIG9mZnNldCA9IDQsIGRpbWVuc2lvbnMsIHRhcmdldFJlY3QgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IFttYWluUG9zaXRpb24sIHNlY29uZGFyeVBvc2l0aW9uXSA9IChwb3NpdGlvbiB8fCBkZWZhdWx0UG9zaXRpb24pLnNwbGl0KCctJykgYXMgQXJyYXk8QmFzaWNQb3NpdGlvbj47XG4gICAgICAgIGlmICghZGltZW5zaW9ucyB8fCAhbWFpblBvc2l0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdmVydGljYWwgPSBpc1ZlcnRpY2FsKG1haW5Qb3NpdGlvbik7XG4gICAgICAgIGNvbnN0IHsgaGFzTW9yZVNwYWNlLCBoYXNFbm91Z2hTcGFjZSB9ID0gZ2V0RGV0YWlsZWRQb3NpdGlvbkluZm8oe1xuICAgICAgICAgICAgdGFyZ2V0UmVjdCxcbiAgICAgICAgICAgIGRpbWVuc2lvbnMsXG4gICAgICAgICAgICBmbHlvdXRSZWN0LFxuICAgICAgICB9KTtcbiAgICAgICAgbGV0IG1haW5EaXJlY3Rpb24gPSBtYWluUG9zaXRpb247XG4gICAgICAgIGxldCBtYWluID0gZ2V0TWFpbkF4aXNGbHlvdXRQb3NpdGlvbkFuZFNpemUoe1xuICAgICAgICAgICAgZGlyZWN0aW9uOiBtYWluRGlyZWN0aW9uLFxuICAgICAgICAgICAgdGFyZ2V0UmVjdCxcbiAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgIGRpbWVuc2lvbnMsXG4gICAgICAgICAgICB2ZXJ0aWNhbCxcbiAgICAgICAgICAgIGZseW91dFJlY3QsXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXBvc2l0aW9uICYmICFoYXNFbm91Z2hTcGFjZVttYWluRGlyZWN0aW9uXSAmJiAhaGFzTW9yZVNwYWNlW21haW5EaXJlY3Rpb25dKSB7XG4gICAgICAgICAgICBtYWluRGlyZWN0aW9uID0gaW52ZXJ0UG9zaXRpb24obWFpbkRpcmVjdGlvbik7XG4gICAgICAgICAgICBtYWluID0gZ2V0TWFpbkF4aXNGbHlvdXRQb3NpdGlvbkFuZFNpemUoe1xuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogbWFpbkRpcmVjdGlvbixcbiAgICAgICAgICAgICAgICB0YXJnZXRSZWN0LFxuICAgICAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgICAgICBkaW1lbnNpb25zLFxuICAgICAgICAgICAgICAgIHZlcnRpY2FsLFxuICAgICAgICAgICAgICAgIGZseW91dFJlY3QsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2Vjb25kYXJ5RGlyZWN0aW9uID0gc2Vjb25kYXJ5UG9zaXRpb247XG4gICAgICAgIGxldCBzZWNvbmRhcnkgPSBnZXRTZWNvbmRhcnlBeGlzRmx5b3V0UG9zaXRpb25BbmRTaXplKHtcbiAgICAgICAgICAgIGRpcmVjdGlvbjogc2Vjb25kYXJ5RGlyZWN0aW9uLFxuICAgICAgICAgICAgdGFyZ2V0UmVjdCxcbiAgICAgICAgICAgIGRpbWVuc2lvbnMsXG4gICAgICAgICAgICB2ZXJ0aWNhbCxcbiAgICAgICAgICAgIGZseW91dFJlY3QsXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXBvc2l0aW9uICYmIHNlY29uZGFyeURpcmVjdGlvbiAmJiAhaGFzRW5vdWdoU3BhY2Vbc2Vjb25kYXJ5RGlyZWN0aW9uXSAmJiBoYXNNb3JlU3BhY2Vbc2Vjb25kYXJ5RGlyZWN0aW9uXSkge1xuICAgICAgICAgICAgc2Vjb25kYXJ5RGlyZWN0aW9uID0gaW52ZXJ0UG9zaXRpb24oc2Vjb25kYXJ5RGlyZWN0aW9uKTtcbiAgICAgICAgICAgIHNlY29uZGFyeSA9IGdldFNlY29uZGFyeUF4aXNGbHlvdXRQb3NpdGlvbkFuZFNpemUoe1xuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogc2Vjb25kYXJ5RGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgIHRhcmdldFJlY3QsXG4gICAgICAgICAgICAgICAgZGltZW5zaW9ucyxcbiAgICAgICAgICAgICAgICB2ZXJ0aWNhbCxcbiAgICAgICAgICAgICAgICBmbHlvdXRSZWN0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgICAgICAgW21haW4ucG9zaXRpb24ubmFtZV06IG1haW4ucG9zaXRpb24udmFsdWUsXG4gICAgICAgICAgICAgICAgW3NlY29uZGFyeS5wb3NpdGlvbi5uYW1lXTogc2Vjb25kYXJ5LnBvc2l0aW9uLnZhbHVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNpemU6IHtcbiAgICAgICAgICAgICAgICBbbWFpbi5zaXplLm5hbWVdOiBtYWluLnNpemUudmFsdWUsXG4gICAgICAgICAgICAgICAgW3NlY29uZGFyeS5zaXplLm5hbWVdOiBzZWNvbmRhcnkuc2l6ZS52YWx1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhcnJvd1Bvc2l0aW9uOiBnZXRGbHlvdXRBcnJvd1Bvc2l0aW9uKHtcbiAgICAgICAgICAgICAgICBtYWluUG9zaXRpb246IG1haW5EaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgc2Vjb25kYXJ5UG9zaXRpb246IHNlY29uZGFyeURpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBvZmZzZXQsXG4gICAgICAgICAgICAgICAgdGFyZ2V0UmVjdCxcbiAgICAgICAgICAgICAgICBmbHlvdXRSZWN0LFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBjaGlsZHJlbiwgdGFyZ2V0UmVjdDogXzAsIHBvc2l0aW9uOiBfMSwgb2Zmc2V0OiBfMiwgZGltZW5zaW9uczogXzMsIGlubmVyUmVmOiBfNCwgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgYXJyb3dQb3NpdGlvbiwgLi4uZmx5b3V0RGltZW5zaW9ucyB9ID0gdGhpcy5nZXRGbHlvdXREaW1lbnNpb25zKCk7XG4gICAgICAgIHJldHVybiAoY2hpbGRyZW4gJiYgKDw+XG4gICAgICAgICAgPFN0eWxlZEZseW91dEFycm93IHsuLi5hcnJvd1Bvc2l0aW9ufSB0aGVtZT17cHJvcHMudGhlbWV9Lz5cbiAgICAgICAgICA8U3R5bGVkRmx5b3V0V2luZG93IHsuLi5mbHlvdXREaW1lbnNpb25zfSB7Li4ucHJvcHN9IHJlZj17dGhpcy5zZXRGbHlvdXRSZWZ9PlxuICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgIDwvU3R5bGVkRmx5b3V0V2luZG93PlxuICAgICAgICA8Lz4pKTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgU3R5bGVkRmx5b3V0QXJyb3coKSB7IHJldHVybiBTdHlsZWRGbHlvdXRBcnJvdyBhcyB0eXBlb2YgU3R5bGVkRmx5b3V0QXJyb3c7IH0sXG4gICAgICAgIGdldCBTdHlsZWRGbHlvdXRXaW5kb3coKSB7IHJldHVybiBTdHlsZWRGbHlvdXRXaW5kb3cgYXMgdHlwZW9mIFN0eWxlZEZseW91dFdpbmRvdzsgfVxuICAgIH07XG59XG5leHBvcnQgY29uc3QgRmx5b3V0V2luZG93ID0gd2l0aFJlc3BvbnNpdmUoRmx5b3V0V2luZG93SW50KTtcbiJdfQ==