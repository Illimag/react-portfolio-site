"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var react_onclickoutside_1 = require("react-onclickoutside");
var styled_1 = require("../../utils/styled");
var FlyoutWindow_part_1 = require("./FlyoutWindow.part");
var FlyoutContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n  display: inline-block;\n  width: fit-content;\n"], ["\n  position: relative;\n  display: inline-block;\n  width: fit-content;\n"])));
var StyledTargetWrapper = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject([""], [""])));
var FlyoutInt = /** @class */ (function (_super) {
    __extends(FlyoutInt, _super);
    function FlyoutInt(props) {
        var _this = _super.call(this, props) || this;
        _this.handleClickOutside = function () {
            _this.state.open && !_this.state.controlled && _this.setOpen(false);
        };
        _this.setTargetRef = function (el) {
            _this.targetContainer = el;
        };
        _this.onClick = function () {
            if (!_this.state.controlled) {
                _this.setOpen(!_this.state.open);
            }
        };
        _this.state = {
            controlled: props.open !== undefined,
            open: props.open || false,
            targetRect: undefined,
            dirtyFlag: false,
        };
        return _this;
    }
    FlyoutInt.prototype.componentDidMount = function () {
        this.updateMeasurements();
    };
    FlyoutInt.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {
        if (this.state.controlled && nextProps.open !== undefined) {
            this.setOpen(nextProps.open);
        }
    };
    FlyoutInt.prototype.componentDidUpdate = function () {
        var dirtyFlag = this.state.dirtyFlag;
        if (dirtyFlag) {
            this.updateMeasurements();
            this.setState({
                dirtyFlag: false,
            });
        }
    };
    FlyoutInt.prototype.updateMeasurements = function () {
        if (this.targetContainer) {
            var targetRect = this.targetContainer.getBoundingClientRect();
            this.setState({
                targetRect: targetRect,
            });
        }
    };
    FlyoutInt.prototype.setOpen = function (open) {
        var onChange = this.props.onChange;
        if (typeof onChange === 'function') {
            onChange({ open: open });
        }
        this.setState({
            open: open,
            dirtyFlag: open === true,
        });
    };
    FlyoutInt.prototype.render = function () {
        var _a = this.props, children = _a.children, content = _a.content, _0 = _a.open, _1 = _a.onChange, props = __rest(_a, ["children", "content", "open", "onChange"]);
        var targetRect = this.state.targetRect;
        var open = this.state.open;
        return (React.createElement(FlyoutContainer, { ref: this.setTargetRef },
            React.createElement(StyledTargetWrapper, { onClick: this.onClick }, children),
            !!content && targetRect && open && (React.createElement(FlyoutWindow_part_1.FlyoutWindow, __assign({}, props, { targetRect: targetRect }), content))));
    };
    FlyoutInt.inner = {
        get FlyoutContainer() { return FlyoutContainer; },
        get StyledTargetWrapper() { return StyledTargetWrapper; },
        get FlyoutWindow() { return FlyoutWindow_part_1.FlyoutWindow; }
    };
    return FlyoutInt;
}(React.Component));
exports.Flyout = react_onclickoutside_1.default(FlyoutInt);
exports.Flyout.displayName = 'Flyout';
var templateObject_1, templateObject_2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9GbHlvdXQvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2REFBdUU7QUFDdkUsNkNBQXdDO0FBQ3hDLHlEQUFtRDtBQUduRCxJQUFNLGVBQWUsR0FBRyxnQkFBTSxDQUFDLEdBQUcsK0lBQUMsNEVBSWxDLElBQUEsQ0FBQztBQUNGLElBQU0sbUJBQW1CLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLHFFQUFDLEVBQUUsSUFBQSxDQUFDO0FBTzFDO0lBQXdCLDZCQUF5QztJQUU3RCxtQkFBWSxLQUFrQjtRQUE5QixZQUNJLGtCQUFNLEtBQUssQ0FBQyxTQU9mO1FBQ0Qsd0JBQWtCLEdBQUc7WUFDakIsS0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsSUFBSSxLQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JFLENBQUMsQ0FBQztRQTBCTSxrQkFBWSxHQUFHLFVBQUMsRUFBeUI7WUFDN0MsS0FBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDOUIsQ0FBQyxDQUFDO1FBV00sYUFBTyxHQUFHO1lBQ2QsSUFBSSxDQUFDLEtBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFO2dCQUN4QixLQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNsQztRQUNMLENBQUMsQ0FBQztRQXBERSxLQUFJLENBQUMsS0FBSyxHQUFHO1lBQ1QsVUFBVSxFQUFFLEtBQUssQ0FBQyxJQUFJLEtBQUssU0FBUztZQUNwQyxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksSUFBSSxLQUFLO1lBQ3pCLFVBQVUsRUFBRSxTQUFTO1lBQ3JCLFNBQVMsRUFBRSxLQUFLO1NBQ25CLENBQUM7O0lBQ04sQ0FBQztJQUlELHFDQUFpQixHQUFqQjtRQUNJLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFDRCxvREFBZ0MsR0FBaEMsVUFBaUMsU0FBc0I7UUFDbkQsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsSUFBSSxTQUFTLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRTtZQUN2RCxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7SUFDRCxzQ0FBa0IsR0FBbEI7UUFDWSxJQUFBLGdDQUFTLENBQWdCO1FBQ2pDLElBQUksU0FBUyxFQUFFO1lBQ1gsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDMUIsSUFBSSxDQUFDLFFBQVEsQ0FBQztnQkFDVixTQUFTLEVBQUUsS0FBSzthQUNuQixDQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7SUFDTyxzQ0FBa0IsR0FBMUI7UUFDSSxJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDdEIsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBQ2hFLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQ1YsVUFBVSxZQUFBO2FBQ2IsQ0FBQyxDQUFDO1NBQ047SUFDTCxDQUFDO0lBSU8sMkJBQU8sR0FBZixVQUFnQixJQUFhO1FBQ2pCLElBQUEsOEJBQVEsQ0FBZ0I7UUFDaEMsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLEVBQUU7WUFDaEMsUUFBUSxDQUFDLEVBQUUsSUFBSSxNQUFBLEVBQUUsQ0FBQyxDQUFDO1NBQ3RCO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUNWLElBQUksTUFBQTtZQUNKLFNBQVMsRUFBRSxJQUFJLEtBQUssSUFBSTtTQUMzQixDQUFDLENBQUM7SUFDUCxDQUFDO0lBTUQsMEJBQU0sR0FBTjtRQUNJLElBQU0sZUFBb0UsRUFBbEUsc0JBQVEsRUFBRSxvQkFBTyxFQUFFLFlBQVEsRUFBRSxnQkFBWSxFQUFFLCtEQUF1QixDQUFDO1FBQ25FLElBQUEsa0NBQVUsQ0FBZ0I7UUFDMUIsSUFBQSxzQkFBSSxDQUFnQjtRQUM1QixPQUFPLENBQUMsb0JBQUMsZUFBZSxJQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsWUFBWTtZQUMvQyxvQkFBQyxtQkFBbUIsSUFBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE9BQU8sSUFBRyxRQUFRLENBQXVCO1lBQzNFLENBQUMsQ0FBQyxPQUFPLElBQUksVUFBVSxJQUFJLElBQUksSUFBSSxDQUFDLG9CQUFDLGdDQUFZLGVBQUssS0FBSyxJQUFFLFVBQVUsRUFBRSxVQUFVLEtBQy9FLE9BQU8sQ0FDSyxDQUFDLENBQ0YsQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFDTSxlQUFLLEdBQUc7UUFDWCxJQUFJLGVBQWUsS0FBSyxPQUFPLGVBQXlDLENBQUMsQ0FBQyxDQUFDO1FBQzNFLElBQUksbUJBQW1CLEtBQUssT0FBTyxtQkFBaUQsQ0FBQyxDQUFDLENBQUM7UUFDdkYsSUFBSSxZQUFZLEtBQUssT0FBTyxnQ0FBbUMsQ0FBQyxDQUFDLENBQUM7S0FDckUsQ0FBQztJQUNOLGdCQUFDO0NBQUEsQUF6RUQsQ0FBd0IsS0FBSyxDQUFDLFNBQVMsR0F5RXRDO0FBQ1ksUUFBQSxNQUFNLEdBQXdELDhCQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDckcsY0FBTSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgb25DbGlja091dHNpZGUsIHsgQWRkaXRpb25hbFByb3BzIH0gZnJvbSAncmVhY3Qtb25jbGlja291dHNpZGUnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgRmx5b3V0V2luZG93IH0gZnJvbSAnLi9GbHlvdXRXaW5kb3cucGFydCc7XG5pbXBvcnQgeyBGbHlvdXRQcm9wcyB9IGZyb20gJy4vRmx5b3V0LnR5cGVzLnBhcnQnO1xuZXhwb3J0IHsgRmx5b3V0UG9zaXRpb24sIEZseW91dENoYW5nZUV2ZW50LCBGbHlvdXRQcm9wcyB9IGZyb20gJy4vRmx5b3V0LnR5cGVzLnBhcnQnO1xuY29uc3QgRmx5b3V0Q29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB3aWR0aDogZml0LWNvbnRlbnQ7XG5gO1xuY29uc3QgU3R5bGVkVGFyZ2V0V3JhcHBlciA9IHN0eWxlZC5kaXYgYGA7XG5leHBvcnQgaW50ZXJmYWNlIEZseW91dFN0YXRlIHtcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xuICAgIHRhcmdldFJlY3Q/OiBDbGllbnRSZWN0O1xuICAgIGRpcnR5RmxhZzogYm9vbGVhbjtcbiAgICBvcGVuOiBib29sZWFuO1xufVxuY2xhc3MgRmx5b3V0SW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PEZseW91dFByb3BzLCBGbHlvdXRTdGF0ZT4ge1xuICAgIHByaXZhdGUgdGFyZ2V0Q29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCB8IG51bGw7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IEZseW91dFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLm9wZW4gIT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9wZW46IHByb3BzLm9wZW4gfHwgZmFsc2UsXG4gICAgICAgICAgICB0YXJnZXRSZWN0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBkaXJ0eUZsYWc6IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBoYW5kbGVDbGlja091dHNpZGUgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc3RhdGUub3BlbiAmJiAhdGhpcy5zdGF0ZS5jb250cm9sbGVkICYmIHRoaXMuc2V0T3BlbihmYWxzZSk7XG4gICAgfTtcbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgdGhpcy51cGRhdGVNZWFzdXJlbWVudHMoKTtcbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBGbHlvdXRQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb250cm9sbGVkICYmIG5leHRQcm9wcy5vcGVuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0T3BlbihuZXh0UHJvcHMub3Blbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgICAgICBjb25zdCB7IGRpcnR5RmxhZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKGRpcnR5RmxhZykge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVNZWFzdXJlbWVudHMoKTtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGRpcnR5RmxhZzogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIHVwZGF0ZU1lYXN1cmVtZW50cygpIHtcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0Q29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb25zdCB0YXJnZXRSZWN0ID0gdGhpcy50YXJnZXRDb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB0YXJnZXRSZWN0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZXRUYXJnZXRSZWYgPSAoZWw6IEhUTUxEaXZFbGVtZW50IHwgbnVsbCkgPT4ge1xuICAgICAgICB0aGlzLnRhcmdldENvbnRhaW5lciA9IGVsO1xuICAgIH07XG4gICAgcHJpdmF0ZSBzZXRPcGVuKG9wZW46IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2UoeyBvcGVuIH0pO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgb3BlbixcbiAgICAgICAgICAgIGRpcnR5RmxhZzogb3BlbiA9PT0gdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25DbGljayA9ICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0T3BlbighdGhpcy5zdGF0ZS5vcGVuKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGNoaWxkcmVuLCBjb250ZW50LCBvcGVuOiBfMCwgb25DaGFuZ2U6IF8xLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB0YXJnZXRSZWN0IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiAoPEZseW91dENvbnRhaW5lciByZWY9e3RoaXMuc2V0VGFyZ2V0UmVmfT5cbiAgICAgICAgPFN0eWxlZFRhcmdldFdyYXBwZXIgb25DbGljaz17dGhpcy5vbkNsaWNrfT57Y2hpbGRyZW59PC9TdHlsZWRUYXJnZXRXcmFwcGVyPlxuICAgICAgICB7ISFjb250ZW50ICYmIHRhcmdldFJlY3QgJiYgb3BlbiAmJiAoPEZseW91dFdpbmRvdyB7Li4ucHJvcHN9IHRhcmdldFJlY3Q9e3RhcmdldFJlY3R9PlxuICAgICAgICAgICAge2NvbnRlbnR9XG4gICAgICAgICAgPC9GbHlvdXRXaW5kb3c+KX1cbiAgICAgIDwvRmx5b3V0Q29udGFpbmVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IEZseW91dENvbnRhaW5lcigpIHsgcmV0dXJuIEZseW91dENvbnRhaW5lciBhcyB0eXBlb2YgRmx5b3V0Q29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgU3R5bGVkVGFyZ2V0V3JhcHBlcigpIHsgcmV0dXJuIFN0eWxlZFRhcmdldFdyYXBwZXIgYXMgdHlwZW9mIFN0eWxlZFRhcmdldFdyYXBwZXI7IH0sXG4gICAgICAgIGdldCBGbHlvdXRXaW5kb3coKSB7IHJldHVybiBGbHlvdXRXaW5kb3cgYXMgdHlwZW9mIEZseW91dFdpbmRvdzsgfVxuICAgIH07XG59XG5leHBvcnQgY29uc3QgRmx5b3V0OiBSZWFjdC5Db21wb25lbnRDbGFzczxGbHlvdXRQcm9wcyAmIEFkZGl0aW9uYWxQcm9wcz4gPSBvbkNsaWNrT3V0c2lkZShGbHlvdXRJbnQpO1xuRmx5b3V0LmRpc3BsYXlOYW1lID0gJ0ZseW91dCc7XG4iXX0=