"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var Button_1 = require("../Button");
var Spinner_1 = require("../Spinner");
var distance_1 = require("../../distance");
var Container = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  height: ", ";\n  overflow: ", ";\n"], ["\n  height: ", ";\n  overflow: ", ";\n"])), function (_a) {
    var height = _a.height;
    return (height ? height + "px" : 'auto');
}, function (_a) {
    var height = _a.height;
    return (height ? 'auto' : 'visible');
});
var Footer = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  margin-top: ", ";\n"], ["\n  margin-top: ", ";\n"])), distance_1.distance.small);
var DefaultButton = styled_1.default(Button_1.Button)(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  width: 100%;\n  display: flex;\n  justify-content: center;\n"], ["\n  width: 100%;\n  display: flex;\n  justify-content: center;\n"])));
var InfiniteScroll = /** @class */ (function (_super) {
    __extends(InfiniteScroll, _super);
    function InfiniteScroll(props) {
        var _this = _super.call(this, props) || this;
        _this.handleOnScroll = function () {
            var scrolledToBottom = _this.reachedBottom();
            if (scrolledToBottom && _this.props.hasMore) {
                _this.loadItems();
            }
        };
        _this.loadItems = function () {
            var data = _this.props.data;
            _this.setState({ isLoading: true });
            return _this.props.loadItems(data.length);
        };
        _this.setContainer = function (node) {
            _this.node = node;
            if (_this.node) {
                _this.node.removeEventListener('scroll', _this.handleOnScroll);
            }
            if (node && !_this.props.useWindow) {
                node.addEventListener('scroll', _this.handleOnScroll);
            }
            _this.node = node;
        };
        _this.state = {
            isButtonMode: !!_this.props.button,
            isLoading: false,
        };
        return _this;
    }
    InfiniteScroll.prototype.componentDidMount = function () {
        var isButtonMode = this.state.isButtonMode;
        if (!isButtonMode) {
            var useWindow = this.props.useWindow;
            if (useWindow) {
                window.addEventListener('scroll', this.handleOnScroll);
            }
        }
    };
    InfiniteScroll.prototype.componentWillUnmount = function () {
        var isButtonMode = this.state.isButtonMode;
        if (!isButtonMode) {
            var useWindow = this.props.useWindow;
            if (useWindow) {
                window.removeEventListener('scroll', this.handleOnScroll);
            }
            else if (this.node && !useWindow) {
                this.node.removeEventListener('scroll', this.handleOnScroll);
            }
        }
    };
    InfiniteScroll.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {
        if (nextProps.data.length !== this.props.data.length || nextProps.hasMore !== this.props.hasMore) {
            this.setState({
                isLoading: false,
            });
        }
    };
    InfiniteScroll.prototype.reachedBottom = function () {
        var edgeOffset = this.props.edgeOffset || 0;
        var documentElement = document.documentElement, body = document.body;
        var useWindow = this.props.useWindow;
        var scrollTop = useWindow
            ? (documentElement && documentElement.scrollTop) || body.scrollTop
            : (this.node && this.node.scrollTop) || 0;
        var scrollHeight = useWindow
            ? (documentElement && documentElement.scrollHeight) || body.scrollHeight
            : (this.node && this.node.scrollHeight) || 0;
        var innerHeight = useWindow ? window.innerHeight : (this.node && this.node.clientHeight) || 0;
        var scrolledToBottom = Math.ceil(scrollTop + innerHeight + edgeOffset) >= scrollHeight;
        return scrolledToBottom;
    };
    InfiniteScroll.prototype.renderButton = function () {
        var _a = this.props, data = _a.data, CustomButton = _a.button, hasMore = _a.hasMore;
        var isLoading = this.state.isLoading;
        if (!hasMore || data.length === 0 || isLoading) {
            return undefined;
        }
        if (CustomButton && typeof CustomButton !== 'boolean' && typeof CustomButton !== 'string') {
            return React.createElement(CustomButton, { onClick: this.loadItems });
        }
        return (React.createElement(DefaultButton, { buttonStyle: "secondary", onClick: this.loadItems, theme: { buttonIconPosition: 'left' }, icon: "Add" }, typeof CustomButton === 'string' ? CustomButton : 'Show more'));
    };
    InfiniteScroll.prototype.render = function () {
        var _a = this.props, _b = _a.host, Host = _b === void 0 ? 'div' : _b, data = _a.data, containerHeight = _a.containerHeight, loadingIndicator = _a.loadingIndicator;
        var _c = this.state, isButtonMode = _c.isButtonMode, isLoading = _c.isLoading;
        return (React.createElement(Container, { ref: this.setContainer, height: containerHeight },
            React.createElement(Host, null, data),
            React.createElement(Footer, null,
                isLoading && (loadingIndicator || React.createElement(Spinner_1.Spinner, { size: "x-small" })),
                isButtonMode && this.renderButton())));
    };
    InfiniteScroll.inner = {
        get DefaultButton() { return DefaultButton; },
        get Container() { return Container; },
        get Footer() { return Footer; },
        get Spinner() { return Spinner_1.Spinner; }
    };
    return InfiniteScroll;
}(React.Component));
exports.InfiniteScroll = InfiniteScroll;
var templateObject_1, templateObject_2, templateObject_3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9JbmZpbml0ZVNjcm9sbC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBd0M7QUFDeEMsb0NBQW1DO0FBQ25DLHNDQUFxQztBQUNyQywyQ0FBMEM7QUE4RDFDLElBQU0sU0FBUyxHQUFHLGdCQUFNLENBQUMsR0FBRywyR0FBdUIsY0FDdkMsRUFBaUQsaUJBQy9DLEVBQTZDLEtBQzFELEtBRlcsVUFBQyxFQUFVO1FBQVIsa0JBQU07SUFBTyxPQUFBLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBSSxNQUFNLE9BQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0FBQWpDLENBQWlDLEVBQy9DLFVBQUMsRUFBVTtRQUFSLGtCQUFNO0lBQU8sT0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7QUFBN0IsQ0FBNkIsQ0FDMUQsQ0FBQztBQUNGLElBQU0sTUFBTSxHQUFHLGdCQUFNLENBQUMsR0FBRyw0RkFBQyxrQkFDVixFQUFjLEtBQzdCLEtBRGUsbUJBQVEsQ0FBQyxLQUFLLENBQzdCLENBQUM7QUFDRixJQUFNLGFBQWEsR0FBRyxnQkFBTSxDQUFDLGVBQU0sQ0FBQyxxSUFBQyxrRUFJcEMsSUFBQSxDQUFDO0FBQ0Y7SUFBb0Msa0NBQXlEO0lBRXpGLHdCQUFZLEtBQTBCO1FBQXRDLFlBQ0ksa0JBQU0sS0FBSyxDQUFDLFNBS2Y7UUE2Qk8sb0JBQWMsR0FBRztZQUNyQixJQUFNLGdCQUFnQixHQUFHLEtBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUM5QyxJQUFJLGdCQUFnQixJQUFJLEtBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFO2dCQUN4QyxLQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7YUFDcEI7UUFD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QUFXLENBQ2hELENBQUMsQ0FBQztJQUNwQixDQUFDO0lBV0QsK0JBQU0sR0FBTjtRQUNVLElBQUEsZUFBNEUsRUFBMUUsWUFBa0IsRUFBbEIsaUNBQWtCLEVBQUUsY0FBSSxFQUFFLG9DQUFlLEVBQUUsc0NBQStCLENBQUM7UUFDN0UsSUFBQSxlQUF3QyxFQUF0Qyw4QkFBWSxFQUFFLHdCQUF3QixDQUFDO1FBQy9DLE9BQU8sQ0FBQyxvQkFBQyxTQUFTLElBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxFQUFFLGVBQWU7WUFDbEUsb0JBQUMsSUFBSSxRQUFFLElBQUksQ0FBUTtZQUNuQixvQkFBQyxNQUFNO2dCQUNKLFNBQVMsSUFBSSxDQUFDLGdCQUFnQixJQUFJLG9CQUFDLGlCQUFPLElBQUMsSUFBSSxFQUFDLFNBQVMsR0FBRSxDQUFDO2dCQUM1RCxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRSxDQUM3QixDQUNDLENBQUMsQ0FBQztJQUNoQixDQUFDO0lBQ00sb0JBQUssR0FBRztRQUNYLElBQUksYUFBYSxLQUFLLE9BQU8sYUFBcUMsQ0FBQyxDQUFDLENBQUM7UUFDckUsSUFBSSxTQUFTLEtBQUssT0FBTyxTQUE2QixDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLE1BQU0sS0FBSyxPQUFPLE1BQXVCLENBQUMsQ0FBQyxDQUFDO1FBQ2hELElBQUksT0FBTyxLQUFLLE9BQU8saUJBQXlCLENBQUMsQ0FBQyxDQUFDO0tBQ3RELENBQUM7SUFDTixxQkFBQztDQUFBLEFBdEdELENBQW9DLEtBQUssQ0FBQyxTQUFTLEdBc0dsRDtBQXRHWSx3Q0FBYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJy4uL0J1dHRvbic7XG5pbXBvcnQgeyBTcGlubmVyIH0gZnJvbSAnLi4vU3Bpbm5lcic7XG5pbXBvcnQgeyBkaXN0YW5jZSB9IGZyb20gJy4uLy4uL2Rpc3RhbmNlJztcbmV4cG9ydCBpbnRlcmZhY2UgSW5maW5pdGVTY3JvbGxQcm9wcyB7XG4gICAgLyoqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogdm9pZDtcbiAgICAvKipcbiAgICAgKiBNZXRob2QgdG8gbG9hZCBtb3JlIGl0ZW1zLlxuICAgICAqL1xuICAgIGxvYWRJdGVtcyhvZmZzZXQ6IG51bWJlcik6IHZvaWQ7XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgYnV0dG9uIG1vZGUuIElmIHRydWUgdGhlIGNvbXBvbmVudCB3aWxsIHJlbmRlciB0aGUgZGVmYXVsdFxuICAgICAqICdTaG93IE1vcmUnIGJ1dHRvbi4gSW4gY2FzZSBhIHN0cmluZyBpcyBzdXBwbGllZCB0aGUgZGVmYXVsdCBidXR0b25cbiAgICAgKiB3aWxsIGJlIHJlbmRlcmVkIHdpdGggdGhlIGdpdmVuIHN0cmluZy4gT3RoZXJ3aXNlLCBpZiBhIFJlYWN0IGNvbXBvbmVudFxuICAgICAqIGlzIHByb3ZpZGVkIGl0IHdpbGwgcmVuZGVyIHRoZSBwcm92aWRlZCBjb21wb25lbnQuXG4gICAgICovXG4gICAgYnV0dG9uPzogYm9vbGVhbiB8IHN0cmluZyB8IFJlYWN0LkNvbXBvbmVudFR5cGU8TG9hZGVyQnV0dG9uUHJvcHM+O1xuICAgIC8qKlxuICAgICAqIFBpeGVscyBsZWZ0IHRvIGJvdHRvbSBvZiB0aGUgcGFnZSwgYXQgd2hpY2ggbG9hZEl0ZW1zKCkgZnVuY3Rpb24gd2lsbFxuICAgICAqIGJlIGNhbGxlZC4gVXNlZCAnc2Nyb2xsJyBtb2RlLlxuICAgICAqIEBkZWZhdWx0IDBweFxuICAgICAqL1xuICAgIGVkZ2VPZmZzZXQ/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhlIGhlaWdodCBvZiB0aGUgc2Nyb2xsaW5nIGNvbnRhaW5lciBpbiBwaXhlbHMuIFRoaXMgaXMgYSByZXF1aXJlZFxuICAgICAqIHByb3AgaWYgdXNlV2luZG93IGlzIG5vdCBzZXQgdG8gdHJ1ZS5cbiAgICAgKiBAZGVmYXVsdCAwcHhcbiAgICAgKi9cbiAgICBjb250YWluZXJIZWlnaHQ/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogVGhpcyBvcHRpb24gYWxsb3dzIHRoZSB3aW5kb3cgdG8gYmUgdXNlZCBhcyB0aGUgc2Nyb2xsIGNvbnRhaW5lciwgaW5zdGVhZFxuICAgICAqIG9mIGFuIGFyYml0cmFyeSBkaXYgY3JlYXRlZCBieSB0aGlzIGNvbXBvbmVudCwgd2hlbiBpdCBpcyBzZXQgdG8gdHJ1ZS5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIHVzZVdpbmRvdz86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogVGhlIG9wdGlvbmFsIGhvc3QgZWxlbWVudCB0byBiZSB1c2VkLlxuICAgICAqL1xuICAgIGhvc3Q/OiBzdHJpbmcgfCBSZWFjdC5Db21wb25lbnRDbGFzcyB8IFJlYWN0LlN0YXRlbGVzc0NvbXBvbmVudDtcbiAgICAvKipcbiAgICAgKiBUaGlzIHByb3AgcmVjZWl2ZXMgZGF0YSB0aGF0IGlzIGRpc3BsYXllZCBpbiB0aGlzIGNvbXBvbmVudC5cbiAgICAgKi9cbiAgICBkYXRhOiBSZWFjdC5SZWFjdE5vZGVBcnJheTtcbiAgICAvKipcbiAgICAgKiBUaGlzIHByb3AgbGV0J3MgY29tcG9uZW50IGtub3cgaWYgdGhlcmUgaXMgbW9yZSBkYXRhIHRvIGxvYWQgYW5kIGNhbGwgbG9hZEl0ZW1zIGZ1bmN0aW9uIG9uIHNjcm9sbCBvciB0byBkaXNwbGF5IHRoZSBidXR0b24uXG4gICAgICovXG4gICAgaGFzTW9yZTogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBDdXN0b20gbG9hZGluZyBpbmRpY2F0b3JcbiAgICAgKi9cbiAgICBsb2FkaW5nSW5kaWNhdG9yPzogUmVhY3QuUmVhY3ROb2RlO1xufVxuZXhwb3J0IGludGVyZmFjZSBJbmZpbml0ZVNjcm9sbFN0YXRlIHtcbiAgICBpc0J1dHRvbk1vZGU6IGJvb2xlYW47XG4gICAgaXNMb2FkaW5nOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIFN0eWxlZENvbnRhaW5lclByb3BzIHtcbiAgICBoZWlnaHQ/OiBudW1iZXI7XG59XG5leHBvcnQgaW50ZXJmYWNlIExvYWRlckJ1dHRvblByb3BzIHtcbiAgICBvbkNsaWNrKCk6IHZvaWQ7XG59XG5jb25zdCBDb250YWluZXIgPSBzdHlsZWQuZGl2PFN0eWxlZENvbnRhaW5lclByb3BzPiBgXG4gIGhlaWdodDogJHsoeyBoZWlnaHQgfSkgPT4gKGhlaWdodCA/IGAke2hlaWdodH1weGAgOiAnYXV0bycpfTtcbiAgb3ZlcmZsb3c6ICR7KHsgaGVpZ2h0IH0pID0+IChoZWlnaHQgPyAnYXV0bycgOiAndmlzaWJsZScpfTtcbmA7XG5jb25zdCBGb290ZXIgPSBzdHlsZWQuZGl2IGBcbiAgbWFyZ2luLXRvcDogJHtkaXN0YW5jZS5zbWFsbH07XG5gO1xuY29uc3QgRGVmYXVsdEJ1dHRvbiA9IHN0eWxlZChCdXR0b24pIGBcbiAgd2lkdGg6IDEwMCU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuYDtcbmV4cG9ydCBjbGFzcyBJbmZpbml0ZVNjcm9sbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxJbmZpbml0ZVNjcm9sbFByb3BzLCBJbmZpbml0ZVNjcm9sbFN0YXRlPiB7XG4gICAgcHJpdmF0ZSBub2RlOiBIVE1MRGl2RWxlbWVudCB8IG51bGw7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IEluZmluaXRlU2Nyb2xsUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgaXNCdXR0b25Nb2RlOiAhIXRoaXMucHJvcHMuYnV0dG9uLFxuICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgaXNCdXR0b25Nb2RlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWlzQnV0dG9uTW9kZSkge1xuICAgICAgICAgICAgY29uc3QgeyB1c2VXaW5kb3cgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgICAgICBpZiAodXNlV2luZG93KSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuaGFuZGxlT25TY3JvbGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGlzQnV0dG9uTW9kZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFpc0J1dHRvbk1vZGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgdXNlV2luZG93IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICAgICAgaWYgKHVzZVdpbmRvdykge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLmhhbmRsZU9uU2Nyb2xsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMubm9kZSAmJiAhdXNlV2luZG93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuaGFuZGxlT25TY3JvbGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wczogSW5maW5pdGVTY3JvbGxQcm9wcykge1xuICAgICAgICBpZiAobmV4dFByb3BzLmRhdGEubGVuZ3RoICE9PSB0aGlzLnByb3BzLmRhdGEubGVuZ3RoIHx8IG5leHRQcm9wcy5oYXNNb3JlICE9PSB0aGlzLnByb3BzLmhhc01vcmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGhhbmRsZU9uU2Nyb2xsID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBzY3JvbGxlZFRvQm90dG9tID0gdGhpcy5yZWFjaGVkQm90dG9tKCk7XG4gICAgICAgIGlmIChzY3JvbGxlZFRvQm90dG9tICYmIHRoaXMucHJvcHMuaGFzTW9yZSkge1xuICAgICAgICAgICAgdGhpcy5sb2FkSXRlbXMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSByZWFjaGVkQm90dG9tKCkge1xuICAgICAgICBjb25zdCBlZGdlT2Zmc2V0ID0gdGhpcy5wcm9wcy5lZGdlT2Zmc2V0IHx8IDA7XG4gICAgICAgIGNvbnN0IHsgZG9jdW1lbnRFbGVtZW50LCBib2R5IH0gPSBkb2N1bWVudDtcbiAgICAgICAgY29uc3QgeyB1c2VXaW5kb3cgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHNjcm9sbFRvcCA9IHVzZVdpbmRvd1xuICAgICAgICAgICAgPyAoZG9jdW1lbnRFbGVtZW50ICYmIGRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApIHx8IGJvZHkuc2Nyb2xsVG9wXG4gICAgICAgICAgICA6ICh0aGlzLm5vZGUgJiYgdGhpcy5ub2RlLnNjcm9sbFRvcCkgfHwgMDtcbiAgICAgICAgY29uc3Qgc2Nyb2xsSGVpZ2h0ID0gdXNlV2luZG93XG4gICAgICAgICAgICA/IChkb2N1bWVudEVsZW1lbnQgJiYgZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCkgfHwgYm9keS5zY3JvbGxIZWlnaHRcbiAgICAgICAgICAgIDogKHRoaXMubm9kZSAmJiB0aGlzLm5vZGUuc2Nyb2xsSGVpZ2h0KSB8fCAwO1xuICAgICAgICBjb25zdCBpbm5lckhlaWdodCA9IHVzZVdpbmRvdyA/IHdpbmRvdy5pbm5lckhlaWdodCA6ICh0aGlzLm5vZGUgJiYgdGhpcy5ub2RlLmNsaWVudEhlaWdodCkgfHwgMDtcbiAgICAgICAgY29uc3Qgc2Nyb2xsZWRUb0JvdHRvbSA9IE1hdGguY2VpbChzY3JvbGxUb3AgKyBpbm5lckhlaWdodCArIGVkZ2VPZmZzZXQpID49IHNjcm9sbEhlaWdodDtcbiAgICAgICAgcmV0dXJuIHNjcm9sbGVkVG9Cb3R0b207XG4gICAgfVxuICAgIHByaXZhdGUgbG9hZEl0ZW1zID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IGRhdGEgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpc0xvYWRpbmc6IHRydWUgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3BzLmxvYWRJdGVtcyhkYXRhLmxlbmd0aCk7XG4gICAgfTtcbiAgICBwcml2YXRlIHJlbmRlckJ1dHRvbigpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhLCBidXR0b246IEN1c3RvbUJ1dHRvbiwgaGFzTW9yZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBpc0xvYWRpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghaGFzTW9yZSB8fCBkYXRhLmxlbmd0aCA9PT0gMCB8fCBpc0xvYWRpbmcpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEN1c3RvbUJ1dHRvbiAmJiB0eXBlb2YgQ3VzdG9tQnV0dG9uICE9PSAnYm9vbGVhbicgJiYgdHlwZW9mIEN1c3RvbUJ1dHRvbiAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiA8Q3VzdG9tQnV0dG9uIG9uQ2xpY2s9e3RoaXMubG9hZEl0ZW1zfS8+O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoPERlZmF1bHRCdXR0b24gYnV0dG9uU3R5bGU9XCJzZWNvbmRhcnlcIiBvbkNsaWNrPXt0aGlzLmxvYWRJdGVtc30gdGhlbWU9e3sgYnV0dG9uSWNvblBvc2l0aW9uOiAnbGVmdCcgfX0gaWNvbj1cIkFkZFwiPlxuICAgICAgICB7dHlwZW9mIEN1c3RvbUJ1dHRvbiA9PT0gJ3N0cmluZycgPyBDdXN0b21CdXR0b24gOiAnU2hvdyBtb3JlJ31cbiAgICAgIDwvRGVmYXVsdEJ1dHRvbj4pO1xuICAgIH1cbiAgICBwcml2YXRlIHNldENvbnRhaW5lciA9IChub2RlOiBIVE1MRGl2RWxlbWVudCB8IG51bGwpID0+IHtcbiAgICAgICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgICAgICAgaWYgKHRoaXMubm9kZSkge1xuICAgICAgICAgICAgdGhpcy5ub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHRoaXMuaGFuZGxlT25TY3JvbGwpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlICYmICF0aGlzLnByb3BzLnVzZVdpbmRvdykge1xuICAgICAgICAgICAgbm9kZS5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLmhhbmRsZU9uU2Nyb2xsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGhvc3Q6IEhvc3QgPSAnZGl2JywgZGF0YSwgY29udGFpbmVySGVpZ2h0LCBsb2FkaW5nSW5kaWNhdG9yIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGlzQnV0dG9uTW9kZSwgaXNMb2FkaW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gKDxDb250YWluZXIgcmVmPXt0aGlzLnNldENvbnRhaW5lcn0gaGVpZ2h0PXtjb250YWluZXJIZWlnaHR9PlxuICAgICAgICA8SG9zdD57ZGF0YX08L0hvc3Q+XG4gICAgICAgIDxGb290ZXI+XG4gICAgICAgICAge2lzTG9hZGluZyAmJiAobG9hZGluZ0luZGljYXRvciB8fCA8U3Bpbm5lciBzaXplPVwieC1zbWFsbFwiLz4pfVxuICAgICAgICAgIHtpc0J1dHRvbk1vZGUgJiYgdGhpcy5yZW5kZXJCdXR0b24oKX1cbiAgICAgICAgPC9Gb290ZXI+XG4gICAgICA8L0NvbnRhaW5lcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBEZWZhdWx0QnV0dG9uKCkgeyByZXR1cm4gRGVmYXVsdEJ1dHRvbiBhcyB0eXBlb2YgRGVmYXVsdEJ1dHRvbjsgfSxcbiAgICAgICAgZ2V0IENvbnRhaW5lcigpIHsgcmV0dXJuIENvbnRhaW5lciBhcyB0eXBlb2YgQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgRm9vdGVyKCkgeyByZXR1cm4gRm9vdGVyIGFzIHR5cGVvZiBGb290ZXI7IH0sXG4gICAgICAgIGdldCBTcGlubmVyKCkgeyByZXR1cm4gU3Bpbm5lciBhcyB0eXBlb2YgU3Bpbm5lcjsgfVxuICAgIH07XG59XG4iXX0=