"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var colors_1 = require("../../colors");
var IndicatorKnob_1 = require("../IndicatorKnob");
var InteractiveSurface_1 = require("../InteractiveSurface");
var hoc_1 = require("../../hoc");
var input_1 = require("../../utils/input");
var distance_1 = require("../../distance");
var utils_1 = require("../../utils");
var Tooltip_1 = require("../Tooltip");
function percent(value) {
    return typeof value === 'number' ? value * 100 + "%" : '50%';
}
var transitionDuration = '0.3s';
var transitionEase = 'cubic-bezier(0, 0, 0.25, 1)';
var SliderContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n  outline: 0;\n  height: 100%;\n"], ["\n  position: relative;\n  outline: 0;\n  height: 100%;\n"])));
var SliderBar = styled_1.default(InteractiveSurface_1.InteractiveSurface)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  position: relative;\n  padding: ", ";\n  height: ", ";\n  width: ", ";\n  box-sizing: content-box;\n\n  &:after {\n    content: '';\n    display: block;\n    border-radius: ", ";\n    height: 100%;\n    width: 100%;\n    background: ", ";\n    transition: background ", " ", ";\n  }\n\n  &:hover {\n    cursor: pointer;\n\n    &:after {\n      background: ", ";\n    }\n  }\n"], ["\n  position: relative;\n  padding: ", ";\n  height: ", ";\n  width: ", ";\n  box-sizing: content-box;\n\n  &:after {\n    content: '';\n    display: block;\n    border-radius: ", ";\n    height: 100%;\n    width: 100%;\n    background: ",
    ";\n    transition: background ", " ", ";\n  }\n\n  &:hover {\n    cursor: pointer;\n\n    &:after {\n      background: ", ";\n    }\n  }\n"])), function (props) { return (props.orientation === 'vertical' ? "0 " + distance_1.distance.small : distance_1.distance.small + " 0"); }, function (props) { return (props.orientation === 'vertical' ? '100%' : distance_1.distance.xsmall); }, function (props) { return (props.orientation === 'vertical' ? distance_1.distance.xsmall : '100%'); }, distance_1.distance.small, styled_1.themed(function (props) { return props.disabled
    ? props.theme.ui3
    : props.active
        ? utils_1.transparentize(colors_1.ocean, 0.25)
        : utils_1.transparentize(props.theme.ui4, 0.25); }), transitionDuration, transitionEase, utils_1.transparentize(colors_1.ocean, 0.25));
var IndicatorBar = styled_1.default('div')(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  border-radius: ", ";\n  background: ", ";\n  transition: background ", " ", ";\n  height: ", ";\n  width: ", ";\n  position: absolute;\n  margin: auto;\n"], ["\n  border-radius: ", ";\n  background: ", ";\n  transition: background ", " ", ";\n  height: ", ";\n  width: ", ";\n  position: absolute;\n  margin: auto;\n"])), distance_1.distance.small, styled_1.themed(function (props) { return props.disabled ? props.theme.ui4 : props.active ? colors_1.ocean : utils_1.transparentize(props.theme.ui5, 0.75); }), transitionDuration, transitionEase, function (props) { return (props.vertical ? '100%' : distance_1.distance.xsmall); }, function (props) { return (props.vertical ? distance_1.distance.xsmall : 'auto'); });
var TooltipContainer = styled_1.default('div')(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  position: absolute;\n  ", ";\n  ", ";\n  width: 0;\n  height: 0;\n\n  > div {\n    display: ", ";\n  }\n"], ["\n  position: absolute;\n  ", ";\n  ", ";\n  width: 0;\n  height: 0;\n\n  > div {\n    display: ", ";\n  }\n"])), function (props) { return (props.vertical ? "top: " + props.value : "left: " + props.value); }, function (props) { return (props.vertical ? "left: " + distance_1.distance.large : "top: -" + distance_1.distance.large); }, function (props) { return (props.vertical ? "block" : "inline-block"); });
var SliderInt = /** @class */ (function (_super) {
    __extends(SliderInt, _super);
    function SliderInt(props) {
        var _this = _super.call(this, props) || this;
        _this.updateValue = function (e) {
            var _a = _this.props, _b = _a.maximum, maximum = _b === void 0 ? 1 : _b, _c = _a.minimum, minimum = _c === void 0 ? 0 : _c;
            var v = _this.state.vertical ? 1 - e.y : e.x;
            var position = minimum + v * (maximum - minimum);
            var value = _this.state.value;
            var length = Array.isArray(value) ? value.length : 1;
            var multi = length > 1;
            var knob = _this.state.active || (multi ? _this.getClosestKnob(position) : 1);
            _this.setValue(position, e.active ? knob : 0);
        };
        _this.control = function (e) {
            var _a = _this.props, _b = _a.minimum, minimum = _b === void 0 ? 0 : _b, _c = _a.maximum, maximum = _c === void 0 ? 1 : _c, onInput = _a.onInput;
            var _d = _this.props.step, step = _d === void 0 ? Math.min(1, (maximum - minimum) / 10) : _d;
            var _e = _this.state, active = _e.active, vertical = _e.vertical;
            var knob = active || 1;
            switch (e.keyCode) {
                case 38 /* up */:
                case 40 /* down */:
                    _this.controlKnob(vertical, 39 - e.keyCode, step);
                    break;
                case 37 /* left */:
                case 39 /* right */:
                    _this.controlKnob(!vertical, e.keyCode - 38, step);
                    break;
                case 36 /* home */:
                    _this.setValue(minimum, knob);
                    break;
                case 35 /* end */:
                    _this.setValue(maximum, knob);
                    break;
                case 27 /* escape */:
                    _this.setState({
                        active: 0,
                    });
                case 13 /* enter */:
                case 32 /* space */:
                default:
                    if (typeof onInput === 'function') {
                        onInput();
                    }
                    return;
            }
            e.preventDefault();
        };
        _this.handleMouseEnter = function () {
            _this.setState({ hovered: true });
        };
        _this.handleMouseLeave = function () {
            _this.setState({ hovered: false });
        };
        _this.updateTooltipValue = function (val) {
            var _a = _this.props, _b = _a.maximum, maximum = _b === void 0 ? 1 : _b, step = _a.step;
            var decimalPlaces = step && step < 1 ? _this.countDecimals(step) : 0;
            return !step && maximum <= 1 ? "" + val.toFixed(1) : "" + val.toFixed(decimalPlaces);
        };
        var value = props.value || props.defaultValue;
        _this.state = {
            value: Array.isArray(value) ? value : [value || 0],
            vertical: props.orientation === 'vertical',
            active: 0,
            controlled: typeof props.value !== 'undefined',
            hovered: false,
            error: props.error,
        };
        return _this;
    }
    SliderInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    SliderInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    SliderInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.value, value = _b === void 0 ? this.state.value : _b, error = _a.error, orientation = _a.orientation;
        if (this.state.controlled) {
            this.setState({ value: value });
        }
        this.setState({
            vertical: orientation === 'vertical',
            error: error,
        });
    };
    SliderInt.prototype.getClosestKnob = function (current) {
        var values = this.state.value;
        if (Array.isArray(values)) {
            var dists = values.map(function (val) { return Math.abs(val - current); });
            var length_1 = dists.length;
            var minIndex = 0;
            for (var i = 0; i < length_1; i++) {
                var curValue = dists[i];
                var minValue = dists[minIndex];
                if (curValue < minValue || (curValue === minValue && current > values[i])) {
                    minIndex = i;
                }
            }
            return minIndex + 1;
        }
        return 1;
    };
    SliderInt.prototype.selectValue = function (selected, knob) {
        var _a = this.props.margin, margin = _a === void 0 ? 0 : _a;
        var current = this.state.value;
        if (Array.isArray(current)) {
            var value = current.slice();
            var upper = value[knob];
            var lower = value[knob - 2];
            if (lower + margin > selected) {
                value[knob - 1] = lower + margin;
            }
            else if (upper - margin < selected) {
                value[knob - 1] = upper - margin;
            }
            else {
                value[knob - 1] = selected;
            }
            return value;
        }
        return selected;
    };
    SliderInt.prototype.setValue = function (position, knob) {
        var _a = this.props, onChange = _a.onChange, onChangeDone = _a.onChangeDone, _b = _a.maximum, maximum = _b === void 0 ? 1 : _b, _c = _a.minimum, minimum = _c === void 0 ? 0 : _c, _d = _a.step, step = _d === void 0 ? 0 : _d, disabled = _a.disabled, form = _a.form, _e = _a.name, name = _e === void 0 ? '' : _e;
        if (!disabled) {
            var current = this.state.value;
            var length_2 = Array.isArray(current) ? current.length : 1;
            var multi = length_2 > 1;
            var previous = Array.isArray(current) ? current[knob - 1] : current;
            var valid = Math.abs(position - previous) >= step && position >= minimum && position <= maximum;
            var selected = position - (step && (position - previous) % step);
            if (!this.state.controlled && valid) {
                var value = this.selectValue(selected, knob);
                if (form) {
                    form.change({
                        name: name,
                        value: value,
                    });
                }
                else {
                    this.setState({
                        value: value,
                    });
                }
            }
            var event_1 = {
                value: selected,
                index: knob - 1,
                type: multi ? 'multi' : 'single',
            };
            if (valid && typeof onChange === 'function') {
                onChange(event_1);
            }
            if (knob !== this.state.active) {
                this.setState({
                    active: knob,
                });
                if (!knob && valid && typeof onChangeDone === 'function') {
                    onChangeDone(event_1);
                }
            }
        }
    };
    SliderInt.prototype.controlKnob = function (change, dir, step) {
        var _a = this.state, active = _a.active, value = _a.value;
        var length = Array.isArray(value) ? value.length : 1;
        var multi = length > 1;
        var knob = active || 1;
        if (change) {
            this.setValue(value[knob - 1] + dir * step, knob);
        }
        else if (multi) {
            var newActive = knob + dir;
            if (newActive <= length && newActive > 0) {
                this.setState({
                    active: newActive,
                });
            }
        }
    };
    SliderInt.prototype.countDecimals = function (val) {
        if (Math.floor(val) === val) {
            return 0;
        }
        return val.toString().split('.')[1].length || 0;
    };
    SliderInt.prototype.render = function () {
        var _this = this;
        var _a;
        var _b = this.props, _0 = _b.children, _1 = _b.value, _2 = _b.defaultValue, disabled = _b.disabled, _3 = _b.onChange, _4 = _b.onChangeDone, _5 = _b.margin, step = _b.step, _c = _b.minimum, minimum = _c === void 0 ? 0 : _c, _d = _b.maximum, maximum = _d === void 0 ? 1 : _d, color = _b.color, theme = _b.theme, info = _b.info, onBlur = _b.onBlur, onFocus = _b.onFocus, showTooltip = _b.showTooltip, props = __rest(_b, ["children", "value", "defaultValue", "disabled", "onChange", "onChangeDone", "margin", "step", "minimum", "maximum", "color", "theme", "info", "onBlur", "onFocus", "showTooltip"]);
        var _e = this.state, value = _e.value, active = _e.active, vertical = _e.vertical, hovered = _e.hovered, error = _e.error;
        var values = Array.isArray(value) ? value : [value];
        var ind = values.length === 1 ? (100 * (values[0] - minimum)) / (maximum - minimum) : 0;
        return (React.createElement(SliderContainer, { theme: theme, tabIndex: 0, onKeyDown: this.control, onBlur: onBlur, onFocus: onFocus, onMouseEnter: this.handleMouseEnter, onMouseLeave: this.handleMouseLeave },
            React.createElement(SliderBar, __assign({}, props, { theme: theme, onChange: this.updateValue, active: active !== 0, disabled: disabled }),
                ind > 0 && (React.createElement(IndicatorBar, { style: (_a = {}, _a[vertical ? 'height' : 'width'] = ind + "%", _a), vertical: vertical, active: active !== 0 || hovered, disabled: disabled })),
                values.map(function (val, index) { return (React.createElement("div", { key: index },
                    showTooltip && (React.createElement(TooltipContainer, { vertical: vertical, value: percent(vertical ? 1.0 - (val - minimum) / (maximum - minimum) : (val - minimum) / (maximum - minimum)) },
                        React.createElement(Tooltip_1.Tooltip, { content: _this.updateTooltipValue(val), position: vertical ? 'right' : 'top', open: active === index + 1 }))),
                    React.createElement(IndicatorKnob_1.IndicatorKnob, { x: vertical ? 0.5 : (val - minimum) / (maximum - minimum), y: vertical ? 1.0 - (val - minimum) / (maximum - minimum) : 0.5, key: index, color: color, active: active === index + 1 || hovered, theme: theme, disabled: disabled }))); })),
            input_1.showInputInfo(error, info)));
    };
    SliderInt.inner = {
        get SliderContainer() { return SliderContainer; },
        get SliderBar() { return SliderBar; },
        get IndicatorBar() { return IndicatorBar; },
        get TooltipContainer() { return TooltipContainer; },
        get Tooltip() { return Tooltip_1.Tooltip; },
        get IndicatorKnob() { return IndicatorKnob_1.IndicatorKnob; }
    };
    return SliderInt;
}(React.PureComponent));
/**
 * The slider component displays a data value picker in form of a sliding bar.
 */
exports.Slider = hoc_1.withFormContext(SliderInt);
exports.Slider.displayName = 'Slider';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TbGlkZXIvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBb0Q7QUFDcEQsdUNBQXFDO0FBRXJDLGtEQUFpRDtBQUNqRCw0REFBbUg7QUFDbkgsaUNBQThEO0FBQzlELDJDQUFrRDtBQUVsRCwyQ0FBMEM7QUFDMUMscUNBQTZDO0FBQzdDLHNDQUFxQztBQXNGckMsU0FBUyxPQUFPLENBQUMsS0FBYztJQUMzQixPQUFPLE9BQU8sS0FBSyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUksS0FBSyxHQUFHLEdBQUcsTUFBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7QUFDakUsQ0FBQztBQUNELElBQU0sa0JBQWtCLEdBQUcsTUFBTSxDQUFDO0FBQ2xDLElBQU0sY0FBYyxHQUFHLDZCQUE2QixDQUFDO0FBQ3JELElBQU0sZUFBZSxHQUFHLGdCQUFNLENBQUMsR0FBRyw4SEFBQywyREFJbEMsSUFBQSxDQUFDO0FBQ0YsSUFBTSxTQUFTLEdBQUcsZ0JBQU0sQ0FBQyx1Q0FBa0IsQ0FBQyxnY0FBaUIsc0NBRWhELEVBQTJGLGVBQzVGLEVBQXNFLGNBQ3ZFLEVBQXNFLDBHQU01RCxFQUFjLDBEQUdqQjtJQUk4QixnQ0FDbkIsRUFBa0IsR0FBSSxFQUFjLGtGQU83QyxFQUEyQixpQkFHOUMsS0ExQlksVUFBQSxLQUFLLElBQUksT0FBQSxDQUFDLEtBQUssQ0FBQyxXQUFXLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQyxPQUFLLG1CQUFRLENBQUMsS0FBTyxDQUFDLENBQUMsQ0FBSSxtQkFBUSxDQUFDLEtBQUssT0FBSSxDQUFDLEVBQWxGLENBQWtGLEVBQzVGLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FBQyxLQUFLLENBQUMsV0FBVyxLQUFL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SyxPQUFPLGdCQUEyQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxJQUFJLE9BQU8sS0FBSyxPQUFPLGlCQUF5QixDQUFDLENBQUMsQ0FBQztRQUNuRCxJQUFJLGFBQWEsS0FBSyxPQUFPLDZCQUFxQyxDQUFDLENBQUMsQ0FBQztLQUN4RSxDQUFDO0lBQ04sZ0JBQUM7Q0FBQSxBQTFORCxDQUF3QixLQUFLLENBQUMsYUFBYSxHQTBOMUM7QUFDRDs7R0FFRztBQUNVLFFBQUEsTUFBTSxHQUFHLHFCQUFlLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDakQsY0FBTSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBvY2VhbiB9IGZyb20gJy4uLy4uL2NvbG9ycyc7XG5pbXBvcnQgeyBJbnB1dFByb3BzLCBJbnB1dENoYW5nZUV2ZW50IH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IEluZGljYXRvcktub2IgfSBmcm9tICcuLi9JbmRpY2F0b3JLbm9iJztcbmltcG9ydCB7IEludGVyYWN0aXZlU3VyZmFjZSwgSW50ZXJhY3RpdmVTdXJmYWNlQ2hhbmdlRXZlbnQsIEludGVyYWN0aXZlU3VyZmFjZVByb3BzIH0gZnJvbSAnLi4vSW50ZXJhY3RpdmVTdXJmYWNlJztcbmltcG9ydCB7IHdpdGhGb3JtQ29udGV4dCwgRm9ybUNvbnRleHRQcm9wcyB9IGZyb20gJy4uLy4uL2hvYyc7XG5pbXBvcnQgeyBzaG93SW5wdXRJbmZvIH0gZnJvbSAnLi4vLi4vdXRpbHMvaW5wdXQnO1xuaW1wb3J0IHsgS2V5Q29kZXMgfSBmcm9tICcuLi8uLi91dGlscyc7XG5pbXBvcnQgeyBkaXN0YW5jZSB9IGZyb20gJy4uLy4uL2Rpc3RhbmNlJztcbmltcG9ydCB7IHRyYW5zcGFyZW50aXplIH0gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJy4uL1Rvb2x0aXAnO1xuZXhwb3J0IGludGVyZmFjZSBTbGlkZXJDaGFuZ2VFdmVudCBleHRlbmRzIElucHV0Q2hhbmdlRXZlbnQ8bnVtYmVyPiB7XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgdHlwZSBvZiB0aGUgY2hhbmdlZCB2YWx1ZS5cbiAgICAgKi9cbiAgICB0eXBlOiAnc2luZ2xlJyB8ICdtdWx0aSc7XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgaW5kZXggb2YgdGhlIGtub2IuXG4gICAgICovXG4gICAgaW5kZXg6IG51bWJlcjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgU2xpZGVyUHJvcHMgZXh0ZW5kcyBJbnB1dFByb3BzPG51bWJlciB8IEFycmF5PG51bWJlcj4+IHtcbiAgICAvKipcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgY2hpbGRyZW4/OiB2b2lkO1xuICAgIC8qKlxuICAgICAqIERlZmluZXMgdGhlIGNvbG9yIG9mIHRoZSBpbmRpY2F0b3IuXG4gICAgICovXG4gICAgY29sb3I/OiBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogT3B0aW9uYWxseSBzZXRzIHRoZSBtaW5pbXVtIHZhbHVlIG9mIHRoZSBzbGlkZXIuIEJ5IGRlZmF1bHQgaXMgc2V0IHRvIDAuXG4gICAgICogQGRlZmF1bHQgMFxuICAgICAqL1xuICAgIG1pbmltdW0/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogT3B0aW9uYWxseSBzZXRzIHRoZSBtYXhpbXVtIHZhbHVlIG9mIHRoZSBzbGlkZXIuIEJ5IGRlZmF1bHQgaXMgc2V0IHRvIDEuXG4gICAgICogQGRlZmF1bHQgMVxuICAgICAqL1xuICAgIG1heGltdW0/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogT3B0aW9uYWxseSBzZXRzIHRoZSBtYXJnaW4gYmV0d2VlbiB0aGUgdmFsdWVzLlxuICAgICAqL1xuICAgIG1hcmdpbj86IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBUaGUgc3RlcHBpbmcgdG8gdXNlLiBCeSBkZWZhdWx0IGlzIHNldCB0byAwLCBpLmUuLCBubyBmaXhlZCBzdGVwcGluZyAvIGNvbnRpbnVvdXMgbW9kZS5cbiAgICAgKiBAZGVmYXVsdCAwXG4gICAgICovXG4gICAgc3RlcD86IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBvcmllbmF0YXRpb24gb2YgdGhlIHNsaWRlci4gQnkgZGVmYXVsdCBpcyBzZXQgdG8gaG9yaXpvbnRhbC5cbiAgICAgKiBAZGVmYXVsdCBob3Jpem9udGFsXG4gICAgICovXG4gICAgb3JpZW50YXRpb24/OiAnaG9yaXpvbnRhbCcgfCAndmVydGljYWwnO1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHNsaWRlciBhcyBkaXNhYmxlZCwgaS5lLiwgbm90IG1vdmFibGUuXG4gICAgICogQGRlZmF1bHQgZmFsc2VcbiAgICAgKi9cbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogU2hvdyBzdGF0dXMgdG9vbHRpcFxuICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICovXG4gICAgc2hvd1Rvb2x0aXA/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIEVtaXR0ZWQgb25jZSB0aGUgc2xpZGVyJ3MgdmFsdWUgY2hhbmdlZC5cbiAgICAgKi9cbiAgICBvbkNoYW5nZT8oZTogU2xpZGVyQ2hhbmdlRXZlbnQpOiB2b2lkO1xuICAgIC8qKlxuICAgICAqIEVtaXR0ZWQgb25jZSB0aGUgc2xpZGVyJ3MgdmFsdWUgY2hhbmdpbmcgZG9uZSBhbmQgdmFsdWUgaXMgcmVhZHkuXG4gICAgICovXG4gICAgb25DaGFuZ2VEb25lPyhlOiBTbGlkZXJDaGFuZ2VFdmVudCk6IHZvaWQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIFNsaWRlclN0YXRlIHtcbiAgICB2YWx1ZTogbnVtYmVyIHwgQXJyYXk8bnVtYmVyPjtcbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgYWN0aXZlOiBudW1iZXI7XG4gICAgY29udHJvbGxlZDogYm9vbGVhbjtcbiAgICB2ZXJ0aWNhbDogYm9vbGVhbjtcbiAgICBob3ZlcmVkOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIFNsaWRlckJhclByb3BzIGV4dGVuZHMgSW50ZXJhY3RpdmVTdXJmYWNlUHJvcHMge1xuICAgIG9yaWVudGF0aW9uPzogJ3ZlcnRpY2FsJyB8ICdob3Jpem9udGFsJztcbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XG4gICAgYWN0aXZlPzogYm9vbGVhbjtcbiAgICB0aGVtZTogYW55O1xufVxuaW50ZXJmYWNlIEluZGljYXRvckJhclByb3BzIHtcbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XG4gICAgYWN0aXZlPzogYm9vbGVhbjtcbiAgICB2ZXJ0aWNhbDogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBUb29sdGlwQ29udGFpbmVyUHJvcHMge1xuICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgdmVydGljYWw6IGJvb2xlYW47XG59XG5mdW5jdGlvbiBwZXJjZW50KHZhbHVlPzogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgPyBgJHt2YWx1ZSAqIDEwMH0lYCA6ICc1MCUnO1xufVxuY29uc3QgdHJhbnNpdGlvbkR1cmF0aW9uID0gJzAuM3MnO1xuY29uc3QgdHJhbnNpdGlvbkVhc2UgPSAnY3ViaWMtYmV6aWVyKDAsIDAsIDAuMjUsIDEpJztcbmNvbnN0IFNsaWRlckNvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG91dGxpbmU6IDA7XG4gIGhlaWdodDogMTAwJTtcbmA7XG5jb25zdCBTbGlkZXJCYXIgPSBzdHlsZWQoSW50ZXJhY3RpdmVTdXJmYWNlKTxTbGlkZXJCYXJQcm9wcz4gYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIHBhZGRpbmc6ICR7cHJvcHMgPT4gKHByb3BzLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnID8gYDAgJHtkaXN0YW5jZS5zbWFsbH1gIDogYCR7ZGlzdGFuY2Uuc21hbGx9IDBgKX07XG4gIGhlaWdodDogJHtwcm9wcyA9PiAocHJvcHMub3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcgPyAnMTAwJScgOiBkaXN0YW5jZS54c21hbGwpfTtcbiAgd2lkdGg6ICR7cHJvcHMgPT4gKHByb3BzLm9yaWVudGF0aW9uID09PSAndmVydGljYWwnID8gZGlzdGFuY2UueHNtYWxsIDogJzEwMCUnKX07XG4gIGJveC1zaXppbmc6IGNvbnRlbnQtYm94O1xuXG4gICY6YWZ0ZXIge1xuICAgIGNvbnRlbnQ6ICcnO1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIGJvcmRlci1yYWRpdXM6ICR7ZGlzdGFuY2Uuc21hbGx9O1xuICAgIGhlaWdodDogMTAwJTtcbiAgICB3aWR0aDogMTAwJTtcbiAgICBiYWNrZ3JvdW5kOiAke3RoZW1lZChwcm9wcyA9PiBwcm9wcy5kaXNhYmxlZFxuICAgID8gcHJvcHMudGhlbWUudWkzXG4gICAgOiBwcm9wcy5hY3RpdmVcbiAgICAgICAgPyB0cmFuc3BhcmVudGl6ZShvY2VhbiwgMC4yNSlcbiAgICAgICAgOiB0cmFuc3BhcmVudGl6ZShwcm9wcy50aGVtZS51aTQsIDAuMjUpKX07XG4gICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAke3RyYW5zaXRpb25EdXJhdGlvbn0gJHt0cmFuc2l0aW9uRWFzZX07XG4gIH1cblxuICAmOmhvdmVyIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG5cbiAgICAmOmFmdGVyIHtcbiAgICAgIGJhY2tncm91bmQ6ICR7dHJhbnNwYXJlbnRpemUob2NlYW4sIDAuMjUpfTtcbiAgICB9XG4gIH1cbmA7XG5jb25zdCBJbmRpY2F0b3JCYXIgPSBzdHlsZWQoJ2RpdicpPEluZGljYXRvckJhclByb3BzPiBgXG4gIGJvcmRlci1yYWRpdXM6ICR7ZGlzdGFuY2Uuc21hbGx9O1xuICBiYWNrZ3JvdW5kOiAke3RoZW1lZChwcm9wcyA9PiBwcm9wcy5kaXNhYmxlZCA/IHByb3BzLnRoZW1lLnVpNCA6IHByb3BzLmFjdGl2ZSA/IG9jZWFuIDogdHJhbnNwYXJlbnRpemUocHJvcHMudGhlbWUudWk1LCAwLjc1KSl9O1xuICB0cmFuc2l0aW9uOiBiYWNrZ3JvdW5kICR7dHJhbnNpdGlvbkR1cmF0aW9ufSAke3RyYW5zaXRpb25FYXNlfTtcbiAgaGVpZ2h0OiAke3Byb3BzID0+IChwcm9wcy52ZXJ0aWNhbCA/ICcxMDAlJyA6IGRpc3RhbmNlLnhzbWFsbCl9O1xuICB3aWR0aDogJHtwcm9wcyA9PiAocHJvcHMudmVydGljYWwgPyBkaXN0YW5jZS54c21hbGwgOiAnYXV0bycpfTtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBtYXJnaW46IGF1dG87XG5gO1xuY29uc3QgVG9vbHRpcENvbnRhaW5lciA9IHN0eWxlZCgnZGl2Jyk8VG9vbHRpcENvbnRhaW5lclByb3BzPiBgXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgJHtwcm9wcyA9PiAocHJvcHMudmVydGljYWwgPyBgdG9wOiAke3Byb3BzLnZhbHVlfWAgOiBgbGVmdDogJHtwcm9wcy52YWx1ZX1gKX07XG4gICR7cHJvcHMgPT4gKHByb3BzLnZlcnRpY2FsID8gYGxlZnQ6ICR7ZGlzdGFuY2UubGFyZ2V9YCA6IGB0b3A6IC0ke2Rpc3RhbmNlLmxhcmdlfWApfTtcbiAgd2lkdGg6IDA7XG4gIGhlaWdodDogMDtcblxuICA+IGRpdiB7XG4gICAgZGlzcGxheTogJHtwcm9wcyA9PiAocHJvcHMudmVydGljYWwgPyBgYmxvY2tgIDogYGlubGluZS1ibG9ja2ApfTtcbiAgfVxuYDtcbmNsYXNzIFNsaWRlckludCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8U2xpZGVyUHJvcHMgJiBGb3JtQ29udGV4dFByb3BzLCBTbGlkZXJTdGF0ZT4ge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBTbGlkZXJQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgdmFsdWU6IEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUgOiBbdmFsdWUgfHwgMF0sXG4gICAgICAgICAgICB2ZXJ0aWNhbDogcHJvcHMub3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcsXG4gICAgICAgICAgICBhY3RpdmU6IDAsXG4gICAgICAgICAgICBjb250cm9sbGVkOiB0eXBlb2YgcHJvcHMudmFsdWUgIT09ICd1bmRlZmluZWQnLFxuICAgICAgICAgICAgaG92ZXJlZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyB2YWx1ZSA9IHRoaXMuc3RhdGUudmFsdWUsIGVycm9yLCBvcmllbnRhdGlvbiB9OiBTbGlkZXJQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICB2ZXJ0aWNhbDogb3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcsXG4gICAgICAgICAgICBlcnJvcixcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgZ2V0Q2xvc2VzdEtub2IoY3VycmVudDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlcykpIHtcbiAgICAgICAgICAgIGNvbnN0IGRpc3RzID0gdmFsdWVzLm1hcCh2YWwgPT4gTWF0aC5hYnModmFsIC0gY3VycmVudCkpO1xuICAgICAgICAgICAgY29uc3QgbGVuZ3RoID0gZGlzdHMubGVuZ3RoO1xuICAgICAgICAgICAgbGV0IG1pbkluZGV4ID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJWYWx1ZSA9IGRpc3RzW2ldO1xuICAgICAgICAgICAgICAgIGNvbnN0IG1pblZhbHVlID0gZGlzdHNbbWluSW5kZXhdO1xuICAgICAgICAgICAgICAgIGlmIChjdXJWYWx1ZSA8IG1pblZhbHVlIHx8IChjdXJWYWx1ZSA9PT0gbWluVmFsdWUgJiYgY3VycmVudCA+IHZhbHVlc1tpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbWluSW5kZXggPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtaW5JbmRleCArIDE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHByaXZhdGUgc2VsZWN0VmFsdWUoc2VsZWN0ZWQ6IG51bWJlciwga25vYjogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgbWFyZ2luID0gMCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGN1cnJlbnQpKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IFsuLi5jdXJyZW50XTtcbiAgICAgICAgICAgIGNvbnN0IHVwcGVyID0gdmFsdWVba25vYl07XG4gICAgICAgICAgICBjb25zdCBsb3dlciA9IHZhbHVlW2tub2IgLSAyXTtcbiAgICAgICAgICAgIGlmIChsb3dlciArIG1hcmdpbiA+IHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVba25vYiAtIDFdID0gbG93ZXIgKyBtYXJnaW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh1cHBlciAtIG1hcmdpbiA8IHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgdmFsdWVba25vYiAtIDFdID0gdXBwZXIgLSBtYXJnaW47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YWx1ZVtrbm9iIC0gMV0gPSBzZWxlY3RlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2VsZWN0ZWQ7XG4gICAgfVxuICAgIHByaXZhdGUgc2V0VmFsdWUocG9zaXRpb246IG51bWJlciwga25vYjogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIG9uQ2hhbmdlRG9uZSwgbWF4aW11bSA9IDEsIG1pbmltdW0gPSAwLCBzdGVwID0gMCwgZGlzYWJsZWQsIGZvcm0sIG5hbWUgPSAnJyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkaXNhYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgICAgICBjb25zdCBsZW5ndGggPSBBcnJheS5pc0FycmF5KGN1cnJlbnQpID8gY3VycmVudC5sZW5ndGggOiAxO1xuICAgICAgICAgICAgY29uc3QgbXVsdGkgPSBsZW5ndGggPiAxO1xuICAgICAgICAgICAgY29uc3QgcHJldmlvdXMgPSBBcnJheS5pc0FycmF5KGN1cnJlbnQpID8gY3VycmVudFtrbm9iIC0gMV0gOiBjdXJyZW50O1xuICAgICAgICAgICAgY29uc3QgdmFsaWQgPSBNYXRoLmFicyhwb3NpdGlvbiAtIHByZXZpb3VzKSA+PSBzdGVwICYmIHBvc2l0aW9uID49IG1pbmltdW0gJiYgcG9zaXRpb24gPD0gbWF4aW11bTtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gcG9zaXRpb24gLSAoc3RlcCAmJiAocG9zaXRpb24gLSBwcmV2aW91cykgJSBzdGVwKTtcbiAgICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkICYmIHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnNlbGVjdFZhbHVlKHNlbGVjdGVkLCBrbm9iKTtcbiAgICAgICAgICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgICAgICBmb3JtLmNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZXZlbnQ6IFNsaWRlckNoYW5nZUV2ZW50ID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBzZWxlY3RlZCxcbiAgICAgICAgICAgICAgICBpbmRleDoga25vYiAtIDEsXG4gICAgICAgICAgICAgICAgdHlwZTogbXVsdGkgPyAnbXVsdGknIDogJ3NpbmdsZScsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHZhbGlkICYmIHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uQ2hhbmdlKGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChrbm9iICE9PSB0aGlzLnN0YXRlLmFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGtub2IsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFrbm9iICYmIHZhbGlkICYmIHR5cGVvZiBvbkNoYW5nZURvbmUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2VEb25lKGV2ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSB1cGRhdGVWYWx1ZSA9IChlOiBJbnRlcmFjdGl2ZVN1cmZhY2VDaGFuZ2VFdmVudCkgPT4ge1xuICAgICAgICBjb25zdCB7IG1heGltdW0gPSAxLCBtaW5pbXVtID0gMCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgdiA9IHRoaXMuc3RhdGUudmVydGljYWwgPyAxIC0gZS55IDogZS54O1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1pbmltdW0gKyB2ICogKG1heGltdW0gLSBtaW5pbXVtKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLnN0YXRlLnZhbHVlO1xuICAgICAgICBjb25zdCBsZW5ndGggPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlLmxlbmd0aCA6IDE7XG4gICAgICAgIGNvbnN0IG11bHRpID0gbGVuZ3RoID4gMTtcbiAgICAgICAgY29uc3Qga25vYiA9IHRoaXMuc3RhdGUuYWN0aXZlIHx8IChtdWx0aSA/IHRoaXMuZ2V0Q2xvc2VzdEtub2IocG9zaXRpb24pIDogMSk7XG4gICAgICAgIHRoaXMuc2V0VmFsdWUocG9zaXRpb24sIGUuYWN0aXZlID8ga25vYiA6IDApO1xuICAgIH07XG4gICAgcHJpdmF0ZSBjb250cm9sS25vYihjaGFuZ2U6IGJvb2xlYW4sIGRpcjogbnVtYmVyLCBzdGVwOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBhY3RpdmUsIHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBsZW5ndGggPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlLmxlbmd0aCA6IDE7XG4gICAgICAgIGNvbnN0IG11bHRpID0gbGVuZ3RoID4gMTtcbiAgICAgICAgY29uc3Qga25vYiA9IGFjdGl2ZSB8fCAxO1xuICAgICAgICBpZiAoY2hhbmdlKSB7XG4gICAgICAgICAgICB0aGlzLnNldFZhbHVlKHZhbHVlW2tub2IgLSAxXSArIGRpciAqIHN0ZXAsIGtub2IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG11bHRpKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdBY3RpdmUgPSBrbm9iICsgZGlyO1xuICAgICAgICAgICAgaWYgKG5ld0FjdGl2ZSA8PSBsZW5ndGggJiYgbmV3QWN0aXZlID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IG5ld0FjdGl2ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGNvbnRyb2wgPSAoZTogUmVhY3QuS2V5Ym9hcmRFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgY29uc3QgeyBtaW5pbXVtID0gMCwgbWF4aW11bSA9IDEsIG9uSW5wdXQgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgc3RlcCA9IE1hdGgubWluKDEsIChtYXhpbXVtIC0gbWluaW11bSkgLyAxMCkgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgYWN0aXZlLCB2ZXJ0aWNhbCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3Qga25vYiA9IGFjdGl2ZSB8fCAxO1xuICAgICAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy51cDpcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZG93bjpcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xLbm9iKHZlcnRpY2FsLCAzOSAtIGUua2V5Q29kZSwgc3RlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmxlZnQ6XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnJpZ2h0OlxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbEtub2IoIXZlcnRpY2FsLCBlLmtleUNvZGUgLSAzOCwgc3RlcCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmhvbWU6XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShtaW5pbXVtLCBrbm9iKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZW5kOlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUobWF4aW11bSwga25vYik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmVzY2FwZTpcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZlOiAwLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuc3BhY2U6XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb25JbnB1dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBvbklucHV0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGhhbmRsZU1vdXNlRW50ZXIgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBob3ZlcmVkOiB0cnVlIH0pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVNb3VzZUxlYXZlID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHsgaG92ZXJlZDogZmFsc2UgfSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNvdW50RGVjaW1hbHModmFsOiBudW1iZXIpIHtcbiAgICAgICAgaWYgKE1hdGguZmxvb3IodmFsKSA9PT0gdmFsKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsLnRvU3RyaW5nKCkuc3BsaXQoJy4nKVsxXS5sZW5ndGggfHwgMDtcbiAgICB9XG4gICAgcHJpdmF0ZSB1cGRhdGVUb29sdGlwVmFsdWUgPSAodmFsOiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgeyBtYXhpbXVtID0gMSwgc3RlcCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgZGVjaW1hbFBsYWNlcyA9IHN0ZXAgJiYgc3RlcCA8IDEgPyB0aGlzLmNvdW50RGVjaW1hbHMoc3RlcCkgOiAwO1xuICAgICAgICByZXR1cm4gIXN0ZXAgJiYgbWF4aW11bSA8PSAxID8gYCR7dmFsLnRvRml4ZWQoMSl9YCA6IGAke3ZhbC50b0ZpeGVkKGRlY2ltYWxQbGFjZXMpfWA7XG4gICAgfTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW46IF8wLCB2YWx1ZTogXzEsIGRlZmF1bHRWYWx1ZTogXzIsIGRpc2FibGVkLCBvbkNoYW5nZTogXzMsIG9uQ2hhbmdlRG9uZTogXzQsIG1hcmdpbjogXzUsIHN0ZXAsIG1pbmltdW0gPSAwLCBtYXhpbXVtID0gMSwgY29sb3IsIHRoZW1lLCBpbmZvLCBvbkJsdXIsIG9uRm9jdXMsIHNob3dUb29sdGlwLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgYWN0aXZlLCB2ZXJ0aWNhbCwgaG92ZXJlZCwgZXJyb3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUgOiBbdmFsdWVdO1xuICAgICAgICBjb25zdCBpbmQgPSB2YWx1ZXMubGVuZ3RoID09PSAxID8gKDEwMCAqICh2YWx1ZXNbMF0gLSBtaW5pbXVtKSkgLyAobWF4aW11bSAtIG1pbmltdW0pIDogMDtcbiAgICAgICAgcmV0dXJuICg8U2xpZGVyQ29udGFpbmVyIHRoZW1lPXt0aGVtZX0gdGFiSW5kZXg9ezB9IG9uS2V5RG93bj17dGhpcy5jb250cm9sfSBvbkJsdXI9e29uQmx1cn0gb25Gb2N1cz17b25Gb2N1c30gb25Nb3VzZUVudGVyPXt0aGlzLmhhbmRsZU1vdXNlRW50ZXJ9IG9uTW91c2VMZWF2ZT17dGhpcy5oYW5kbGVNb3VzZUxlYXZlfT5cbiAgICAgICAgPFNsaWRlckJhciB7Li4ucHJvcHN9IHRoZW1lPXt0aGVtZX0gb25DaGFuZ2U9e3RoaXMudXBkYXRlVmFsdWV9IGFjdGl2ZT17YWN0aXZlICE9PSAwfSBkaXNhYmxlZD17ZGlzYWJsZWR9PlxuICAgICAgICAgIHtpbmQgPiAwICYmICg8SW5kaWNhdG9yQmFyIHN0eWxlPXt7IFt2ZXJ0aWNhbCA/ICdoZWlnaHQnIDogJ3dpZHRoJ106IGAke2luZH0lYCB9fSB2ZXJ0aWNhbD17dmVydGljYWx9IGFjdGl2ZT17YWN0aXZlICE9PSAwIHx8IGhvdmVyZWR9IGRpc2FibGVkPXtkaXNhYmxlZH0vPil9XG4gICAgICAgICAge3ZhbHVlcy5tYXAoKHZhbCwgaW5kZXgpID0+ICg8ZGl2IGtleT17aW5kZXh9PlxuICAgICAgICAgICAgICB7c2hvd1Rvb2x0aXAgJiYgKDxUb29sdGlwQ29udGFpbmVyIHZlcnRpY2FsPXt2ZXJ0aWNhbH0gdmFsdWU9e3BlcmNlbnQodmVydGljYWwgPyAxLjAgLSAodmFsIC0gbWluaW11bSkgLyAobWF4aW11bSAtIG1pbmltdW0pIDogKHZhbCAtIG1pbmltdW0pIC8gKG1heGltdW0gLSBtaW5pbXVtKSl9PlxuICAgICAgICAgICAgICAgICAgPFRvb2x0aXAgY29udGVudD17dGhpcy51cGRhdGVUb29sdGlwVmFsdWUodmFsKX0gcG9zaXRpb249e3ZlcnRpY2FsID8gJ3JpZ2h0JyA6ICd0b3AnfSBvcGVuPXthY3RpdmUgPT09IGluZGV4ICsgMX0vPlxuICAgICAgICAgICAgICAgIDwvVG9vbHRpcENvbnRhaW5lcj4pfVxuICAgICAgICAgICAgICA8SW5kaWNhdG9yS25vYiB4PXt2ZXJ0aWNhbCA/IDAuNSA6ICh2YWwgLSBtaW5pbXVtKSAvIChtYXhpbXVtIC0gbWluaW11bSl9IHk9e3ZlcnRpY2FsID8gMS4wIC0gKHZhbCAtIG1pbmltdW0pIC8gKG1heGltdW0gLSBtaW5pbXVtKSA6IDAuNX0ga2V5PXtpbmRleH0gY29sb3I9e2NvbG9yfSBhY3RpdmU9e2FjdGl2ZSA9PT0gaW5kZXggKyAxIHx8IGhvdmVyZWR9IHRoZW1lPXt0aGVtZX0gZGlzYWJsZWQ9e2Rpc2FibGVkfS8+XG4gICAgICAgICAgICA8L2Rpdj4pKX1cbiAgICAgICAgPC9TbGlkZXJCYXI+XG4gICAgICAgIHtzaG93SW5wdXRJbmZvKGVycm9yLCBpbmZvKX1cbiAgICAgIDwvU2xpZGVyQ29udGFpbmVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFNsaWRlckNvbnRhaW5lcigpIHsgcmV0dXJuIFNsaWRlckNvbnRhaW5lciBhcyB0eXBlb2YgU2xpZGVyQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgU2xpZGVyQmFyKCkgeyByZXR1cm4gU2xpZGVyQmFyIGFzIHR5cGVvZiBTbGlkZXJCYXI7IH0sXG4gICAgICAgIGdldCBJbmRpY2F0b3JCYXIoKSB7IHJldHVybiBJbmRpY2F0b3JCYXIgYXMgdHlwZW9mIEluZGljYXRvckJhcjsgfSxcbiAgICAgICAgZ2V0IFRvb2x0aXBDb250YWluZXIoKSB7IHJldHVybiBUb29sdGlwQ29udGFpbmVyIGFzIHR5cGVvZiBUb29sdGlwQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgVG9vbHRpcCgpIHsgcmV0dXJuIFRvb2x0aXAgYXMgdHlwZW9mIFRvb2x0aXA7IH0sXG4gICAgICAgIGdldCBJbmRpY2F0b3JLbm9iKCkgeyByZXR1cm4gSW5kaWNhdG9yS25vYiBhcyB0eXBlb2YgSW5kaWNhdG9yS25vYjsgfVxuICAgIH07XG59XG4vKipcbiAqIFRoZSBzbGlkZXIgY29tcG9uZW50IGRpc3BsYXlzIGEgZGF0YSB2YWx1ZSBwaWNrZXIgaW4gZm9ybSBvZiBhIHNsaWRpbmcgYmFyLlxuICovXG5leHBvcnQgY29uc3QgU2xpZGVyID0gd2l0aEZvcm1Db250ZXh0KFNsaWRlckludCk7XG5TbGlkZXIuZGlzcGxheU5hbWUgPSAnU2xpZGVyJztcbiJdfQ==