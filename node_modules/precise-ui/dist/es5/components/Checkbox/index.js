"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var themes_1 = require("../../themes");
var Label_1 = require("../Label");
var Icon_1 = require("../Icon");
var hoc_1 = require("../../hoc");
var withGroupContext_1 = require("../../hoc/withGroupContext");
var InputNotification_1 = require("../InputNotification");
var PaddedContainer_1 = require("../PaddedContainer");
var CheckboxContainer = styled_1.default('div')(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n  display: inline-block;\n  opacity: ", ";\n  cursor: ", ";\n"], ["\n  position: relative;\n  display: inline-block;\n  opacity: ", ";\n  cursor: ", ";\n"])), function (props) { return (props.disabled ? '0.5' : '1.0'); }, function (props) { return (props.disabled ? 'not-allowed' : 'pointer'); });
var CheckboxBox = styled_1.default('div')(styled_1.themed(function (_a) {
    var disabled = _a.disabled, checked = _a.checked, _b = _a.theme, ui0 = _b.ui0, ui1 = _b.ui1, ui4 = _b.ui4, ui5 = _b.ui5;
    return styled_1.css(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n      outline: 0;\n      flex: 0 0 1.0625em;\n      max-width: 1.0625em;\n      height: 1.0625em;\n      position: relative;\n      background: ", ";\n      transition: all 0.2s cubic-bezier(0, 0, 0.25, 1);\n      overflow: hidden;\n      border-radius: 2px;\n      border: 2px solid ", ";\n      box-sizing: border-box;\n\n      &:focus {\n        outline: ", " solid 2px;\n      }\n\n      > i {\n        position: relative;\n        top: -2px;\n        left: -2px;\n        transition: all 0.2s;\n        opacity: ", ";\n        transform: ", ";\n      }\n    "], ["\n      outline: 0;\n      flex: 0 0 1.0625em;\n      max-width: 1.0625em;\n      height: 1.0625em;\n      position: relative;\n      background: ", ";\n      transition: all 0.2s cubic-bezier(0, 0, 0.25, 1);\n      overflow: hidden;\n      border-radius: 2px;\n      border: 2px solid ", ";\n      box-sizing: border-box;\n\n      &:focus {\n        outline: ", " solid 2px;\n      }\n\n      > i {\n        position: relative;\n        top: -2px;\n        left: -2px;\n        transition: all 0.2s;\n        opacity: ", ";\n        transform: ", ";\n      }\n    "])), checked ? ui5 : ui1, disabled ? (checked ? ui5 : ui4) : ui5, ui0, checked ? '1' : '0', checked ? 'scale(1)' : 'scale(0)');
}));
var RealCheckbox = styled_1.default.input(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  display: none;\n"], ["\n  display: none;\n"])));
var FlexContainer = styled_1.default.div(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  display: flex;\n  padding-right: 0.25em;\n  align-items: ", ";\n"], ["\n  display: flex;\n  padding-right: 0.25em;\n  align-items: ", ";\n"])), function (_a) {
    var withInputInfo = _a.withInputInfo;
    return (withInputInfo ? 'start' : 'center');
});
var CheckboxInt = /** @class */ (function (_super) {
    __extends(CheckboxInt, _super);
    function CheckboxInt(props) {
        var _this = _super.call(this, props) || this;
        _this.setValue = function (value) {
            var onChange = _this.props.onChange;
            _this.setState({
                value: value,
            });
            if (typeof onChange === 'function') {
                onChange({
                    value: value,
                });
            }
        };
        _this.toggle = function () {
            var _a = _this.props, onChange = _a.onChange, disabled = _a.disabled, form = _a.form, group = _a.group, _b = _a.name, name = _b === void 0 ? '' : _b;
            if (!disabled) {
                var _c = _this.state, controlled = _c.controlled, value = _c.value;
                var checked = !value;
                if (!controlled) {
                    if (group) {
                        group.select(_this);
                    }
                    else if (form) {
                        form.change({
                            name: name,
                            value: checked,
                        });
                    }
                    else {
                        _this.setState({
                            value: checked,
                        });
                    }
                }
                if (typeof onChange === 'function') {
                    onChange({
                        value: checked,
                    });
                }
            }
        };
        _this.changeValue = function (e) {
            _this.toggle();
            e.preventDefault();
        };
        _this.control = function (e) {
            switch (e.keyCode) {
                case 13 /* enter */:
                case 32 /* space */:
                    _this.toggle();
                    break;
                default:
                    return;
            }
            e.stopPropagation();
            e.preventDefault();
        };
        _this.name = props.name;
        _this.state = {
            controlled: typeof props.value !== 'undefined',
            value: props.value || props.defaultValue || false,
            error: props.error,
        };
        return _this;
    }
    CheckboxInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.value, value = _b === void 0 ? false : _b, error = _a.error;
        if (this.state.controlled) {
            this.setState({ value: value });
        }
        this.setState({ error: error });
    };
    CheckboxInt.prototype.componentDidMount = function () {
        var _a = this.props, group = _a.group, form = _a.form;
        var controlled = this.state.controlled;
        if (!controlled) {
            if (group) {
                group.subscribe(this);
            }
            else if (form) {
                form.subscribe(this);
            }
        }
    };
    CheckboxInt.prototype.componentWillUnmount = function () {
        var _a = this.props, group = _a.group, form = _a.form;
        var controlled = this.state.controlled;
        if (!controlled) {
            if (group) {
                group.unsubscribe(this);
            }
            else if (form) {
                form.unsubscribe(this);
            }
        }
    };
    CheckboxInt.prototype.render = function () {
        var _a = this.props, children = _a.children, disabled = _a.disabled, theme = _a.theme, _0 = _a.value, _1 = _a.defaultValue, _2 = _a.onChange, _3 = _a.onInput, info = _a.info, props = __rest(_a, ["children", "disabled", "theme", "value", "defaultValue", "onChange", "onInput", "info"]);
        var _b = this.state, value = _b.value, error = _b.error;
        var containerProps = __assign({}, props, { theme: theme, onClick: this.changeValue, disabled: disabled });
        var boxProps = {
            checked: value,
            disabled: !!disabled,
            onKeyDown: this.control,
            theme: theme,
            tabIndex: disabled ? undefined : 0,
        };
        var InputInfo = (error || info) && (React.createElement(PaddedContainer_1.PaddedContainer, { top: "xsmall", bottom: "xsmall" },
            React.createElement(InputNotification_1.InputNotification, { error: error, info: info })));
        return (React.createElement(CheckboxContainer, __assign({}, containerProps),
            React.createElement(RealCheckbox, { type: "checkbox", defaultChecked: value }),
            React.createElement(FlexContainer, { withInputInfo: !!(error || info) },
                React.createElement(CheckboxBox, __assign({}, boxProps),
                    React.createElement(Icon_1.Icon, { name: "Check", color: theme ? theme.ui1 : themes_1.light.ui1, size: 1.0625 })),
                children && (React.createElement(Label_1.Label, { attached: true, theme: theme },
                    children,
                    InputInfo))),
            !children && InputInfo));
    };
    CheckboxInt.inner = {
        get PaddedContainer() { return PaddedContainer_1.PaddedContainer; },
        get InputNotification() { return InputNotification_1.InputNotification; },
        get CheckboxContainer() { return CheckboxContainer; },
        get RealCheckbox() { return RealCheckbox; },
        get FlexContainer() { return FlexContainer; },
        get CheckboxBox() { return CheckboxBox; },
        get Icon() { return Icon_1.Icon; },
        get Label() { return Label_1.Label; }
    };
    return CheckboxInt;
}(React.PureComponent));
exports.CheckboxInt = CheckboxInt;
/**
 * The checkbox input field.
 */
exports.Checkbox = hoc_1.withFormContext(withGroupContext_1.withGroupContext(CheckboxInt));
exports.Checkbox.displayName = 'Checkbox';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9DaGVja2JveC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkJBQStCO0FBQy9CLDZDQUF5RDtBQUN6RCx1Q0FBcUM7QUFDckMsa0NBQWlDO0FBQ2pDLGdDQUErQjtBQUUvQixpQ0FBOEQ7QUFDOUQsK0RBQWlGO0FBRWpGLDBEQUF5RDtBQUN6RCxzREFBcUQ7QUFxQnJELElBQU0saUJBQWlCLEdBQUcsZ0JBQU0sQ0FBQyxLQUFLLENBQUMsMkpBQXlCLGdFQUduRCxFQUF5QyxlQUMxQyxFQUFxRCxLQUNoRSxLQUZZLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFoQyxDQUFnQyxFQUMxQyxVQUFBLEtBQUssSUFBSSxPQUFBLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsRUFBNUMsQ0FBNEMsQ0FDaEUsQ0FBQztBQUNGLElBQU0sV0FBVyxHQUFHLGdCQUFNLENBQUMsS0FBSyxDQUFDLENBQW1CLGVBQU0sQ0FBQyxVQUFDLEVBQW9EO1FBQWxELHNCQUFRLEVBQUUsb0JBQU8sRUFBRSxhQUE2QixFQUFwQixZQUFHLEVBQUUsWUFBRyxFQUFFLFlBQUcsRUFBRSxZQUFHO0lBQVMsT0FBQSxZQUFHLDBuQkFBQyxvSkFNckcsRUFBbUIsMElBSWIsRUFBc0Msd0VBSTdDLEVBQUcsNkpBUUgsRUFBbUIsd0JBQ2pCLEVBQWlDLGtCQUVqRCxLQW5CZSxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUliLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxP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Y0FBSyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxHQUFHLENBQzVEO2dCQUNiLFFBQVEsSUFBSSxDQUFDLG9CQUFDLGFBQUssSUFBQyxRQUFRLFFBQUMsS0FBSyxFQUFFLEtBQUs7b0JBQ3JDLFFBQVE7b0JBQ1IsU0FBUyxDQUNKLENBQUMsQ0FDRztZQUNmLENBQUMsUUFBUSxJQUFJLFNBQVMsQ0FDTCxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUNNLGlCQUFLLEdBQUc7UUFDWCxJQUFJLGVBQWUsS0FBSyxPQUFPLGlDQUF5QyxDQUFDLENBQUMsQ0FBQztRQUMzRSxJQUFJLGlCQUFpQixLQUFLLE9BQU8scUNBQTZDLENBQUMsQ0FBQyxDQUFDO1FBQ2pGLElBQUksaUJBQWlCLEtBQUssT0FBTyxpQkFBNkMsQ0FBQyxDQUFDLENBQUM7UUFDakYsSUFBSSxZQUFZLEtBQUssT0FBTyxZQUFtQyxDQUFDLENBQUMsQ0FBQztRQUNsRSxJQUFJLGFBQWEsS0FBSyxPQUFPLGFBQXFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JFLElBQUksV0FBVyxLQUFLLE9BQU8sV0FBaUMsQ0FBQyxDQUFDLENBQUM7UUFDL0QsSUFBSSxJQUFJLEtBQUssT0FBTyxXQUFtQixDQUFDLENBQUMsQ0FBQztRQUMxQyxJQUFJLEtBQUssS0FBSyxPQUFPLGFBQXFCLENBQUMsQ0FBQyxDQUFDO0tBQ2hELENBQUM7SUFDTixrQkFBQztDQUFBLEFBM0lELENBQWlDLEtBQUssQ0FBQyxhQUFhLEdBMkluRDtBQTNJWSxrQ0FBVztBQTRJeEI7O0dBRUc7QUFDVSxRQUFBLFFBQVEsR0FBRyxxQkFBZSxDQUFDLG1DQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7QUFDdkUsZ0JBQVEsQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwgeyBjc3MsIHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBsaWdodCB9IGZyb20gJy4uLy4uL3RoZW1lcyc7XG5pbXBvcnQgeyBMYWJlbCB9IGZyb20gJy4uL0xhYmVsJztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9JY29uJztcbmltcG9ydCB7IElucHV0Q2hhbmdlRXZlbnQsIElucHV0UHJvcHMgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgRm9ybUNvbnRleHRQcm9wcywgd2l0aEZvcm1Db250ZXh0IH0gZnJvbSAnLi4vLi4vaG9jJztcbmltcG9ydCB7IEdyb3VwQ29udGV4dFByb3BzLCB3aXRoR3JvdXBDb250ZXh0IH0gZnJvbSAnLi4vLi4vaG9jL3dpdGhHcm91cENvbnRleHQnO1xuaW1wb3J0IHsgS2V5Q29kZXMgfSBmcm9tICcuLi8uLi91dGlscyc7XG5pbXBvcnQgeyBJbnB1dE5vdGlmaWNhdGlvbiB9IGZyb20gJy4uL0lucHV0Tm90aWZpY2F0aW9uJztcbmltcG9ydCB7IFBhZGRlZENvbnRhaW5lciB9IGZyb20gJy4uL1BhZGRlZENvbnRhaW5lcic7XG5leHBvcnQgdHlwZSBDaGVja2JveENoYW5nZUV2ZW50ID0gSW5wdXRDaGFuZ2VFdmVudDxib29sZWFuPjtcbmV4cG9ydCBpbnRlcmZhY2UgQ2hlY2tib3hQcm9wcyBleHRlbmRzIElucHV0UHJvcHM8Ym9vbGVhbj4sIEZvcm1Db250ZXh0UHJvcHMsIEdyb3VwQ29udGV4dFByb3BzIHtcbiAgICAvKipcbiAgICAgKiBUaGUgY29udGVudCBvZiB0aGUgY2hlY2tib3guXG4gICAgICovXG4gICAgY2hpbGRyZW4/OiBSZWFjdC5SZWFjdE5vZGU7XG59XG5leHBvcnQgaW50ZXJmYWNlIENoZWNrYm94U3RhdGUge1xuICAgIHZhbHVlOiBib29sZWFuO1xuICAgIGVycm9yPzogUmVhY3QuUmVhY3RDaGlsZDtcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIENoZWNrYm94Q29udGFpbmVyUHJvcHMge1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBDaGVja2JveEJveFByb3BzIHtcbiAgICBjaGVja2VkOiBib29sZWFuO1xuICAgIGRpc2FibGVkOiBib29sZWFuO1xuICAgIHRoZW1lOiBhbnk7XG59XG5jb25zdCBDaGVja2JveENvbnRhaW5lciA9IHN0eWxlZCgnZGl2Jyk8Q2hlY2tib3hDb250YWluZXJQcm9wcz4gYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgb3BhY2l0eTogJHtwcm9wcyA9PiAocHJvcHMuZGlzYWJsZWQgPyAnMC41JyA6ICcxLjAnKX07XG4gIGN1cnNvcjogJHtwcm9wcyA9PiAocHJvcHMuZGlzYWJsZWQgPyAnbm90LWFsbG93ZWQnIDogJ3BvaW50ZXInKX07XG5gO1xuY29uc3QgQ2hlY2tib3hCb3ggPSBzdHlsZWQoJ2RpdicpPENoZWNrYm94Qm94UHJvcHM+KHRoZW1lZCgoeyBkaXNhYmxlZCwgY2hlY2tlZCwgdGhlbWU6IHsgdWkwLCB1aTEsIHVpNCwgdWk1IH0gfSkgPT4gY3NzIGBcbiAgICAgIG91dGxpbmU6IDA7XG4gICAgICBmbGV4OiAwIDAgMS4wNjI1ZW07XG4gICAgICBtYXgtd2lkdGg6IDEuMDYyNWVtO1xuICAgICAgaGVpZ2h0OiAxLjA2MjVlbTtcbiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgIGJhY2tncm91bmQ6ICR7Y2hlY2tlZCA/IHVpNSA6IHVpMX07XG4gICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBjdWJpYy1iZXppZXIoMCwgMCwgMC4yNSwgMSk7XG4gICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgYm9yZGVyLXJhZGl1czogMnB4O1xuICAgICAgYm9yZGVyOiAycHggc29saWQgJHtkaXNhYmxlZCA/IChjaGVja2VkID8gdWk1IDogdWk0KSA6IHVpNX07XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuXG4gICAgICAmOmZvY3VzIHtcbiAgICAgICAgb3V0bGluZTogJHt1aTB9IHNvbGlkIDJweDtcbiAgICAgIH1cblxuICAgICAgPiBpIHtcbiAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICB0b3A6IC0ycHg7XG4gICAgICAgIGxlZnQ6IC0ycHg7XG4gICAgICAgIHRyYW5zaXRpb246IGFsbCAwLjJzO1xuICAgICAgICBvcGFjaXR5OiAke2NoZWNrZWQgPyAnMScgOiAnMCd9O1xuICAgICAgICB0cmFuc2Zvcm06ICR7Y2hlY2tlZCA/ICdzY2FsZSgxKScgOiAnc2NhbGUoMCknfTtcbiAgICAgIH1cbiAgICBgKSk7XG5jb25zdCBSZWFsQ2hlY2tib3ggPSBzdHlsZWQuaW5wdXQgYFxuICBkaXNwbGF5OiBub25lO1xuYDtcbmNvbnN0IEZsZXhDb250YWluZXIgPSBzdHlsZWQuZGl2PHtcbiAgICB3aXRoSW5wdXRJbmZvPzogYm9vbGVhbjtcbn0+IGBcbiAgZGlzcGxheTogZmxleDtcbiAgcGFkZGluZy1yaWdodDogMC4yNWVtO1xuICBhbGlnbi1pdGVtczogJHsoeyB3aXRoSW5wdXRJbmZvIH0pID0+ICh3aXRoSW5wdXRJbmZvID8gJ3N0YXJ0JyA6ICdjZW50ZXInKX07XG5gO1xuZXhwb3J0IGNsYXNzIENoZWNrYm94SW50IGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxDaGVja2JveFByb3BzLCBDaGVja2JveFN0YXRlPiB7XG4gICAgcmVhZG9ubHkgbmFtZT86IHN0cmluZztcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogQ2hlY2tib3hQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIHRoaXMubmFtZSA9IHByb3BzLm5hbWU7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBjb250cm9sbGVkOiB0eXBlb2YgcHJvcHMudmFsdWUgIT09ICd1bmRlZmluZWQnLFxuICAgICAgICAgICAgdmFsdWU6IHByb3BzLnZhbHVlIHx8IHByb3BzLmRlZmF1bHRWYWx1ZSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyB2YWx1ZSA9IGZhbHNlLCBlcnJvciB9OiBDaGVja2JveFByb3BzKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3IgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGdyb3VwLCBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgaWYgKGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXAuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGdyb3VwLCBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgaWYgKGdyb3VwKSB7XG4gICAgICAgICAgICAgICAgZ3JvdXAudW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgZm9ybS51bnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBzZXRWYWx1ZSA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgdG9nZ2xlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBkaXNhYmxlZCwgZm9ybSwgZ3JvdXAsIG5hbWUgPSAnJyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkaXNhYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgeyBjb250cm9sbGVkLCB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGNoZWNrZWQgPSAhdmFsdWU7XG4gICAgICAgICAgICBpZiAoIWNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZ3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgZ3JvdXAuc2VsZWN0KHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm0uY2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2hlY2tlZCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjaGVja2VkLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogY2hlY2tlZCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBjaGFuZ2VWYWx1ZSA9IChlOiBSZWFjdC5Nb3VzZUV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLnRvZ2dsZSgpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNvbnRyb2wgPSAoZTogUmVhY3QuS2V5Ym9hcmRFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZW50ZXI6XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnNwYWNlOlxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgY2hpbGRyZW4sIGRpc2FibGVkLCB0aGVtZSwgdmFsdWU6IF8wLCBkZWZhdWx0VmFsdWU6IF8xLCBvbkNoYW5nZTogXzIsIG9uSW5wdXQ6IF8zLCBpbmZvLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgZXJyb3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lclByb3BzID0ge1xuICAgICAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgICAgICB0aGVtZSxcbiAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuY2hhbmdlVmFsdWUsXG4gICAgICAgICAgICBkaXNhYmxlZCxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgYm94UHJvcHMgPSB7XG4gICAgICAgICAgICBjaGVja2VkOiB2YWx1ZSxcbiAgICAgICAgICAgIGRpc2FibGVkOiAhIWRpc2FibGVkLFxuICAgICAgICAgICAgb25LZXlEb3duOiB0aGlzLmNvbnRyb2wsXG4gICAgICAgICAgICB0aGVtZSxcbiAgICAgICAgICAgIHRhYkluZGV4OiBkaXNhYmxlZCA/IHVuZGVmaW5lZCA6IDAsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IElucHV0SW5mbyA9IChlcnJvciB8fCBpbmZvKSAmJiAoPFBhZGRlZENvbnRhaW5lciB0b3A9XCJ4c21hbGxcIiBib3R0b209XCJ4c21hbGxcIj5cbiAgICAgICAgPElucHV0Tm90aWZpY2F0aW9uIGVycm9yPXtlcnJvcn0gaW5mbz17aW5mb30vPlxuICAgICAgPC9QYWRkZWRDb250YWluZXI+KTtcbiAgICAgICAgcmV0dXJuICg8Q2hlY2tib3hDb250YWluZXIgey4uLmNvbnRhaW5lclByb3BzfT5cbiAgICAgICAgPFJlYWxDaGVja2JveCB0eXBlPVwiY2hlY2tib3hcIiBkZWZhdWx0Q2hlY2tlZD17dmFsdWV9Lz5cbiAgICAgICAgPEZsZXhDb250YWluZXIgd2l0aElucHV0SW5mbz17ISEoZXJyb3IgfHwgaW5mbyl9PlxuICAgICAgICAgIDxDaGVja2JveEJveCB7Li4uYm94UHJvcHN9PlxuICAgICAgICAgICAgPEljb24gbmFtZT1cIkNoZWNrXCIgY29sb3I9e3RoZW1lID8gdGhlbWUudWkxIDogbGlnaHQudWkxfSBzaXplPXsxLjA2MjV9Lz5cbiAgICAgICAgICA8L0NoZWNrYm94Qm94PlxuICAgICAgICAgIHtjaGlsZHJlbiAmJiAoPExhYmVsIGF0dGFjaGVkIHRoZW1lPXt0aGVtZX0+XG4gICAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICAgICAge0lucHV0SW5mb31cbiAgICAgICAgICAgIDwvTGFiZWw+KX1cbiAgICAgICAgPC9GbGV4Q29udGFpbmVyPlxuICAgICAgICB7IWNoaWxkcmVuICYmIElucHV0SW5mb31cbiAgICAgIDwvQ2hlY2tib3hDb250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgUGFkZGVkQ29udGFpbmVyKCkgeyByZXR1cm4gUGFkZGVkQ29udGFpbmVyIGFzIHR5cGVvZiBQYWRkZWRDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBJbnB1dE5vdGlmaWNhdGlvbigpIHsgcmV0dXJuIElucHV0Tm90aWZpY2F0aW9uIGFzIHR5cGVvZiBJbnB1dE5vdGlmaWNhdGlvbjsgfSxcbiAgICAgICAgZ2V0IENoZWNrYm94Q29udGFpbmVyKCkgeyByZXR1cm4gQ2hlY2tib3hDb250YWluZXIgYXMgdHlwZW9mIENoZWNrYm94Q29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgUmVhbENoZWNrYm94KCkgeyByZXR1cm4gUmVhbENoZWNrYm94IGFzIHR5cGVvZiBSZWFsQ2hlY2tib3g7IH0sXG4gICAgICAgIGdldCBGbGV4Q29udGFpbmVyKCkgeyByZXR1cm4gRmxleENvbnRhaW5lciBhcyB0eXBlb2YgRmxleENvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IENoZWNrYm94Qm94KCkgeyByZXR1cm4gQ2hlY2tib3hCb3ggYXMgdHlwZW9mIENoZWNrYm94Qm94OyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH0sXG4gICAgICAgIGdldCBMYWJlbCgpIHsgcmV0dXJuIExhYmVsIGFzIHR5cGVvZiBMYWJlbDsgfVxuICAgIH07XG59XG4vKipcbiAqIFRoZSBjaGVja2JveCBpbnB1dCBmaWVsZC5cbiAqL1xuZXhwb3J0IGNvbnN0IENoZWNrYm94ID0gd2l0aEZvcm1Db250ZXh0KHdpdGhHcm91cENvbnRleHQoQ2hlY2tib3hJbnQpKTtcbkNoZWNrYm94LmRpc3BsYXlOYW1lID0gJ0NoZWNrYm94JztcbiJdfQ==