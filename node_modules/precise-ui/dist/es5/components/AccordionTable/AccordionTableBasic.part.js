"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var remCalc_1 = require("../../utils/remCalc");
var Table_1 = require("../Table");
var TableShared_part_1 = require("../Table/TableShared.part");
var Icon_1 = require("../Icon");
var AccordionTableRow_1 = require("../AccordionTableRow");
var indexHelper_1 = require("./helpers/indexHelper");
var distance_1 = require("../../distance");
var textStyles_1 = require("../../textStyles");
var animationDuration = '0.3s';
var animationFunction = 'cubic-bezier(0, 0, 0.25, 1)';
var StyledTable = styled_1.default(Table_1.Table)(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  th,\n  td {\n    padding-right: ", ";\n    padding-left: ", ";\n  }\n"], ["\n  th,\n  td {\n    padding-right: ", ";\n    padding-left: ", ";\n  }\n"])), distance_1.distance.medium, distance_1.distance.medium);
var StyledTableRowCollapse = styled_1.default.tr(styled_1.themed(function (_a) {
    var theme = _a.theme, active = _a.active;
    return styled_1.css(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n      border: ", ";\n      ", "\n    "], ["\n      border: ", ";\n      ", "\n    "])), active ? "1px solid " + theme.ui5 : 'none', !active ? 'display: none;' : '');
}));
var StyledCollapseAnimator = styled_1.default('div')(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  transition: all ", " ", ";\n  max-height: ", ";\n  opacity: ", ";\n"], ["\n  transition: all ", " ", ";\n  max-height: ", ";\n  opacity: ", ";\n"])), animationDuration, animationFunction, function (_a) {
    var active = _a.active;
    return (active ? '10000px' : '0');
}, function (_a) {
    var active = _a.active;
    return (active ? '1' : '0');
});
var GroupTableCell = styled_1.default.td(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  ", "\n\n  padding-left: 0.5em !important;\n"], ["\n  ", "\n\n  padding-left: 0.5em !important;\n"])), textStyles_1.getFontStyle({ weight: 'bold' }));
var StyledDetailsContainer = styled_1.default.td(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  /*\n    AccordionTable is a Table abstraction.\n    Table has default paddings for it's cells.\n    Expanded AccordionTable row is a container and should not have any paddings.\n  */\n  padding: 0 !important;\n"], ["\n  /*\n    AccordionTable is a Table abstraction.\n    Table has default paddings for it's cells.\n    Expanded AccordionTable row is a container and should not have any paddings.\n  */\n  padding: 0 !important;\n"])));
var StyledIconInt = Object.assign((function (_a) {
    var _0 = _a.isRotated, props = __rest(_a, ["isRotated"]);
    return React.createElement(Icon_1.Icon, __assign({}, props));
}), { inner: {
        get Icon() { return Icon_1.Icon; }
    } });
var StyledIcon = styled_1.default(StyledIconInt)(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  display: block;\n  font-size: ", ";\n  height: 18px;\n  width: 18px;\n  transition: transform ", " ", ";\n  transform: ", ";\n"], ["\n  display: block;\n  font-size: ", ";\n  height: 18px;\n  width: 18px;\n  transition: transform ", " ", ";\n  transform: ", ";\n"])), remCalc_1.remCalc('18px'), animationDuration, animationFunction, function (_a) {
    var isRotated = _a.isRotated;
    return "rotate(" + (isRotated ? 90 : 0) + "deg)";
});
function defaultGroupRenderer(e) {
    return (React.createElement(React.Fragment, null,
        e.group ? e.group.toString() : e.group,
        " (",
        e.items.length,
        ")"));
}
var AccordionTableBasic = /** @class */ (function (_super) {
    __extends(AccordionTableBasic, _super);
    function AccordionTableBasic(props) {
        var _this = _super.call(this, props) || this;
        _this.getGroupByValue = function (rowData) {
            var _a = _this.props, groupBy = _a.groupBy, noValueGroupLabel = _a.noValueGroupLabel;
            if (groupBy) {
                var rowValue = rowData[groupBy];
                if (rowValue || rowValue === 0) {
                    if (Array.isArray(rowValue) && rowValue.length === 0) {
                        return noValueGroupLabel;
                    }
                    else {
                        return rowValue;
                    }
                }
                else {
                    return noValueGroupLabel;
                }
            }
            return undefined;
        };
        _this.rowRenderer = function (_a) {
            var cells = _a.cells, index = _a.index, data = _a.data, key = _a.key, state = _a.state;
            var _b = _this.props, detailsRenderer = _b.detailsRenderer, rowRenderer = _b.rowRenderer, theme = _b.theme, arrowToggle = _b.arrowToggle;
            var _c = _this.state, selectedIndex = _c.selectedIndex, expandedGroups = _c.expandedGroups;
            var _d = state.groupedRows, groupedRows = _d === void 0 ? [] : _d;
            var active = indexHelper_1.hasIndex(selectedIndex, index);
            var count = React.Children.count(cells);
            var col = _this.getGroupByValue(data);
            var open = !(col || col === 0) || AccordionTableBasic.arrayIncludes(col, expandedGroups);
            var renderData = { cells: cells, index: index, data: data, active: active, key: key, state: state };
            var isNewGroup = (col || col === 0) && !AccordionTableBasic.arrayIncludes(col, groupedRows);
            if (isNewGroup) {
                state.groupedRows = groupedRows.concat([col]);
            }
            return (React.createElement(React.Fragment, { key: key },
                isNewGroup && _this.groupRenderer(col, count, open),
                open && (React.createElement(React.Fragment, null,
                    (rowRenderer && rowRenderer(renderData)) || (React.createElement(AccordionTableRow_1.AccordionTableRow, { active: active, clickable: !arrowToggle, onClick: function () { return _this.handleClick(index, data); }, theme: theme }, cells)),
                    React.createElement(StyledTableRowCollapse, { active: active },
                        React.createElement(StyledDetailsContainer, { colSpan: count },
                            React.createElement(StyledCollapseAnimator, { active: active }, active && detailsRenderer && detailsRenderer({ index: index, data: data }))))))));
        };
        _this.cellRenderer = function (e) {
            var row = e.row, data = e.data;
            if (e.column === 0) {
                return (React.createElement(StyledIcon, { isRotated: indexHelper_1.hasIndex(_this.state.selectedIndex, row), name: "KeyboardArrowRight", onClick: function () { return data && _this.handleClick(row, data); } }));
            }
            var cellRenderer = _this.props.cellRenderer;
            return typeof cellRenderer === 'function' ? cellRenderer(e) : TableShared_part_1.defaultCellRenderer(e);
        };
        var controlledDetails = props.selectedIndex !== undefined;
        var controlledGroups = Array.isArray(props.expandedGroups);
        _this.state = {
            selectedIndex: indexHelper_1.normalizeIndex(props.selectedIndex),
            controlledIndex: controlledDetails,
            controlledGroups: controlledGroups,
            expandedGroups: controlledGroups ? props.expandedGroups || [] : [],
        };
        return _this;
    }
    AccordionTableBasic.getDerivedStateFromProps = function (props, state) {
        var selectedIndex = props.selectedIndex, expandedGroups = props.expandedGroups;
        var newIndex = state.controlledIndex && selectedIndex !== undefined;
        var newGroups = state.controlledGroups && expandedGroups !== undefined;
        if (newIndex || newGroups) {
            return __assign({}, state, { selectedIndex: newIndex ? indexHelper_1.normalizeIndex(selectedIndex) : state.selectedIndex, expandedGroups: newGroups ? expandedGroups : state.expandedGroups });
        }
        return state;
    };
    AccordionTableBasic.prototype.getGroupItems = function (data, groupBy, group) {
        var noValueGroupLabel = this.props.noValueGroupLabel;
        if (groupBy) {
            if (group === noValueGroupLabel) {
                return data.filter(function (m) {
                    var value = m[groupBy];
                    // the number '0' shouldn't be in the no-value-group.
                    if (typeof value === 'number' && value === 0) {
                        return false;
                    }
                    else {
                        // empty arrays should be in the no-value-group
                        return !value || (Array.isArray(value) && value.length === 0);
                    }
                });
            }
            else {
                return data.filter(function (m) {
                    var value = m[groupBy];
                    if (value === group) {
                        return true;
                    }
                    else {
                        // special handling for arrays is needed because '===' doesn't work for arrays
                        if (Array.isArray(value) && Array.isArray(group)) {
                            return value.toString() === group.toString();
                        }
                        else {
                            return false;
                        }
                    }
                });
            }
        }
        return [];
    };
    AccordionTableBasic.prototype.handleClick = function (target, data) {
        var _a = this.props, onChange = _a.onChange, multiple = _a.multiple;
        var _b = this.state, controlledIndex = _b.controlledIndex, selectedIndex = _b.selectedIndex;
        var nextIndexes = indexHelper_1.toggleIndex(selectedIndex, target, multiple);
        if (typeof onChange === 'function') {
            onChange({
                selectedIndex: multiple ? nextIndexes : nextIndexes[0] !== undefined ? nextIndexes[0] : -1,
                previousIndex: multiple ? selectedIndex : selectedIndex[0] !== undefined ? selectedIndex[0] : -1,
                data: data,
            });
        }
        if (!controlledIndex) {
            this.setState({
                selectedIndex: nextIndexes,
            });
        }
    };
    AccordionTableBasic.prototype.toggleGroup = function (group) {
        var _a = this.props, data = _a.data, onToggleGroup = _a.onToggleGroup, groupBy = _a.groupBy;
        var _b = this.state, expandedGroups = _b.expandedGroups, controlledGroups = _b.controlledGroups;
        if (typeof onToggleGroup === 'function') {
            onToggleGroup({
                group: group,
                type: 'expand',
                items: this.getGroupItems(data, groupBy, group),
            });
        }
        if (!controlledGroups) {
            if (expandedGroups.indexOf(group) !== -1) {
                this.setState({
                    expandedGroups: expandedGroups.filter(function (m) { return m !== group; }),
                });
            }
            else {
                this.setState({
                    expandedGroups: expandedGroups.concat([group]),
                });
            }
        }
    };
    AccordionTableBasic.prototype.groupRenderer = function (group, count, expanded) {
        var _this = this;
        var _a = this.props, theme = _a.theme, _b = _a.groupRenderer, groupRenderer = _b === void 0 ? defaultGroupRenderer : _b, data = _a.data, groupBy = _a.groupBy;
        var items = this.getGroupItems(data, groupBy, group);
        return (React.createElement(React.Fragment, null,
            React.createElement(AccordionTableRow_1.AccordionTableRow, { clickable: true, onClick: function () { return _this.toggleGroup(group); }, theme: theme },
                React.createElement(GroupTableCell, null,
                    React.createElement(StyledIcon, { isRotated: expanded, name: "KeyboardArrowRight" })),
                React.createElement(GroupTableCell, { colSpan: count - 1 }, groupRenderer({ expanded: expanded, group: group, items: items }))),
            React.createElement(StyledTableRowCollapse, null)));
    };
    /**
     * helper method to check if an element is included in an array.
     * This method has special handling for arrays of arrays. In this case normal strict equality checking (===)
     * wouldn't work.
     */
    AccordionTableBasic.arrayIncludes = function (element, arr) {
        return ((Array.isArray(element) ? JSON.stringify(arr).indexOf(JSON.stringify(element)) : arr.indexOf(element)) !== -1);
    };
    AccordionTableBasic.prototype.getColumns = function () {
        var _a = this.props, data = _a.data, columns = _a.columns, indexed = _a.indexed;
        if (columns || (data && data.length)) {
            var cols = {
                '': {
                    header: '',
                    width: remCalc_1.remCalc('50px'),
                    sortable: false,
                },
            };
            if (indexed) {
                cols['#'] = {
                    header: '#',
                    sortable: false,
                };
            }
            var keys = Object.keys(columns || data[0]);
            return keys.reduce(function (acc, key) {
                acc[key] = columns ? columns[key] : key;
                return acc;
            }, cols);
        }
        return {};
    };
    AccordionTableBasic.prototype.render = function () {
        var _a = this.props, _0 = _a.detailsRenderer, _1 = _a.columns, _2 = _a.indexed, _3 = _a.groupRenderer, _4 = _a.expandedGroups, _5 = _a.onToggleGroup, _6 = _a.openLabel, _7 = _a.closeLabel, _8 = _a.multiple, props = __rest(_a, ["detailsRenderer", "columns", "indexed", "groupRenderer", "expandedGroups", "onToggleGroup", "openLabel", "closeLabel", "multiple"]);
        return (React.createElement(StyledTable, __assign({}, props, { mode: "table", columns: this.getColumns(), rowRenderer: this.rowRenderer, cellRenderer: this.cellRenderer })));
    };
    AccordionTableBasic.defaultProps = {
        multiple: false,
        noValueGroupLabel: '—',
    };
    AccordionTableBasic.inner = {
        get AccordionTableRow() { return AccordionTableRow_1.AccordionTableRow; },
        get GroupTableCell() { return GroupTableCell; },
        get StyledIcon() { return StyledIcon; },
        get StyledTableRowCollapse() { return StyledTableRowCollapse; },
        get StyledDetailsContainer() { return StyledDetailsContainer; },
        get StyledCollapseAnimator() { return StyledCollapseAnimator; },
        get StyledTable() { return StyledTable; }
    };
    return AccordionTableBasic;
}(React.Component));
exports.AccordionTableBasic = AccordionTableBasic;
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWNjb3JkaW9uVGFibGVCYXNpYy5wYXJ0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvQWNjb3JkaW9uVGFibGUvQWNjb3JkaW9uVGFibGVCYXNpYy5wYXJ0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQXlEO0FBQ3pELCtDQUE4QztBQUM5QyxrQ0FBZ0Q7QUFDaEQsOERBQWdFO0FBQ2hFLGdDQUEwQztBQUMxQywwREFBeUQ7QUFFekQscURBQThFO0FBQzlFLDJDQUEwQztBQUUxQywrQ0FBZ0Q7QUFhaEQsSUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUM7QUFDakMsSUFBTSxpQkFBaUIsR0FBRyw2QkFBNkIsQ0FBQztBQUN4RCxJQUFNLFdBQVcsR0FBRyxnQkFBTSxDQUFDLGFBQUssQ0FBQyw4SUFBQyxzQ0FHYixFQUFlLHVCQUNoQixFQUFlLFVBRWxDLEtBSG9CLG1CQUFRLENBQUMsTUFBTSxFQUNoQixtQkFBUSxDQUFDLE1BQU0sQ0FFbEMsQ0FBQztBQUNGLElBQU0sc0JBQXNCLEdBQUcsZ0JBQU0sQ0FBQyxFQUFFLENBQTBCLGVBQU0sQ0FBQyxVQUFDLEVBQWlCO1FBQWYsZ0JBQUssRUFBRSxrQkFBTTtJQUFPLE9BQUEsWUFBRyw0R0FBQyxrQkFDcEYsRUFBMEMsV0FDbEQsRUFBK0IsUUFDbEMsS0FGVyxNQUFNLENBQUMsQ0FBQyxDQUFDLGVBQWEsS0FBSyxDQUFDLEdBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUNsRCxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLEVBQUU7QUFGeUQsQ0FHM0YsQ0FBQyxDQUFDLENBQUM7QUFDUixJQUFNLHNCQUFzQixHQUFHLGdCQUFNLENBQUMsS0FBSyxDQUFDLDRJQUEwQixzQkFDbEQsRUFBaUIsR0FBSSxF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bnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwgeyB0aGVtZWQsIGNzcyB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyByZW1DYWxjIH0gZnJvbSAnLi4vLi4vdXRpbHMvcmVtQ2FsYyc7XG5pbXBvcnQgeyBUYWJsZSwgVGFibGVSb3dFdmVudCB9IGZyb20gJy4uL1RhYmxlJztcbmltcG9ydCB7IGRlZmF1bHRDZWxsUmVuZGVyZXIgfSBmcm9tICcuLi9UYWJsZS9UYWJsZVNoYXJlZC5wYXJ0JztcbmltcG9ydCB7IEljb24sIEljb25Qcm9wcyB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgQWNjb3JkaW9uVGFibGVSb3cgfSBmcm9tICcuLi9BY2NvcmRpb25UYWJsZVJvdyc7XG5pbXBvcnQgeyBBY2NvcmRpb25UYWJsZVByb3BzLCBBY2NvcmRpb25Hcm91cFJlbmRlckV2ZW50IH0gZnJvbSAnLi9BY2NvcmRpb25UYWJsZS50eXBlcy5wYXJ0JztcbmltcG9ydCB7IG5vcm1hbGl6ZUluZGV4LCB0b2dnbGVJbmRleCwgaGFzSW5kZXggfSBmcm9tICcuL2hlbHBlcnMvaW5kZXhIZWxwZXInO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBUYWJsZUNlbGxSZW5kZXJFdmVudCB9IGZyb20gJy4uL1RhYmxlL1RhYmxlLnR5cGVzLnBhcnQnO1xuaW1wb3J0IHsgZ2V0Rm9udFN0eWxlIH0gZnJvbSAnLi4vLi4vdGV4dFN0eWxlcyc7XG5leHBvcnQgaW50ZXJmYWNlIEFjY29yZGlvblRhYmxlQmFzaWNTdGF0ZSB7XG4gICAgc2VsZWN0ZWRJbmRleDogQXJyYXk8bnVtYmVyPjtcbiAgICBleHBhbmRlZEdyb3VwczogQXJyYXk8YW55PjtcbiAgICBjb250cm9sbGVkSW5kZXg6IGJvb2xlYW47XG4gICAgY29udHJvbGxlZEdyb3VwczogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBBY2NvcmRpb25UYWJsZUl0ZW1Qcm9wcyB7XG4gICAgYWN0aXZlPzogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBTdHlsZWRBcnJvd1Byb3BzIGV4dGVuZHMgSWNvblByb3BzIHtcbiAgICBpc1JvdGF0ZWQ6IGJvb2xlYW47XG59XG5jb25zdCBhbmltYXRpb25EdXJhdGlvbiA9ICcwLjNzJztcbmNvbnN0IGFuaW1hdGlvbkZ1bmN0aW9uID0gJ2N1YmljLWJlemllcigwLCAwLCAwLjI1LCAxKSc7XG5jb25zdCBTdHlsZWRUYWJsZSA9IHN0eWxlZChUYWJsZSkgYFxuICB0aCxcbiAgdGQge1xuICAgIHBhZGRpbmctcmlnaHQ6ICR7ZGlzdGFuY2UubWVkaXVtfTtcbiAgICBwYWRkaW5nLWxlZnQ6ICR7ZGlzdGFuY2UubWVkaXVtfTtcbiAgfVxuYDtcbmNvbnN0IFN0eWxlZFRhYmxlUm93Q29sbGFwc2UgPSBzdHlsZWQudHI8QWNjb3JkaW9uVGFibGVJdGVtUHJvcHM+KHRoZW1lZCgoeyB0aGVtZSwgYWN0aXZlIH0pID0+IGNzcyBgXG4gICAgICBib3JkZXI6ICR7YWN0aXZlID8gYDFweCBzb2xpZCAke3RoZW1lLnVpNX1gIDogJ25vbmUnfTtcbiAgICAgICR7IWFjdGl2ZSA/ICdkaXNwbGF5OiBub25lOycgOiAnJ31cbiAgICBgKSk7XG5jb25zdCBTdHlsZWRDb2xsYXBzZUFuaW1hdG9yID0gc3R5bGVkKCdkaXYnKTxBY2NvcmRpb25UYWJsZUl0ZW1Qcm9wcz4gYFxuICB0cmFuc2l0aW9uOiBhbGwgJHthbmltYXRpb25EdXJhdGlvbn0gJHthbmltYXRpb25GdW5jdGlvbn07XG4gIG1heC1oZWlnaHQ6ICR7KHsgYWN0aXZlIH0pID0+IChhY3RpdmUgPyAnMTAwMDBweCcgOiAnMCcpfTtcbiAgb3BhY2l0eTogJHsoeyBhY3RpdmUgfSkgPT4gKGFjdGl2ZSA/ICcxJyA6ICcwJyl9O1xuYDtcbmNvbnN0IEdyb3VwVGFibGVDZWxsID0gc3R5bGVkLnRkIGBcbiAgJHtnZXRGb250U3R5bGUoeyB3ZWlnaHQ6ICdib2xkJyB9KX1cblxuICBwYWRkaW5nLWxlZnQ6IDAuNWVtICFpbXBvcnRhbnQ7XG5gO1xuY29uc3QgU3R5bGVkRGV0YWlsc0NvbnRhaW5lciA9IHN0eWxlZC50ZCBgXG4gIC8qXG4gICAgQWNjb3JkaW9uVGFibGUgaXMgYSBUYWJsZSBhYnN0cmFjdGlvbi5cbiAgICBUYWJsZSBoYXMgZGVmYXVsdCBwYWRkaW5ncyBmb3IgaXQncyBjZWxscy5cbiAgICBFeHBhbmRlZCBBY2NvcmRpb25UYWJsZSByb3cgaXMgYSBjb250YWluZXIgYW5kIHNob3VsZCBub3QgaGF2ZSBhbnkgcGFkZGluZ3MuXG4gICovXG4gIHBhZGRpbmc6IDAgIWltcG9ydGFudDtcbmA7XG5jb25zdCBTdHlsZWRJY29uSW50ID0gT2JqZWN0LmFzc2lnbigoKCh7IGlzUm90YXRlZDogXzAsIC4uLnByb3BzIH0pID0+IDxJY29uIHsuLi5wcm9wc30vPikgYXMgUmVhY3QuU0ZDPFN0eWxlZEFycm93UHJvcHM+KSwgeyBpbm5lcjoge1xuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH1cbiAgICB9IH0pO1xuY29uc3QgU3R5bGVkSWNvbiA9IHN0eWxlZChTdHlsZWRJY29uSW50KTxTdHlsZWRBcnJvd1Byb3BzPiBgXG4gIGRpc3BsYXk6IGJsb2NrO1xuICBmb250LXNpemU6ICR7cmVtQ2FsYygnMThweCcpfTtcbiAgaGVpZ2h0OiAxOHB4O1xuICB3aWR0aDogMThweDtcbiAgdHJhbnNpdGlvbjogdHJhbnNmb3JtICR7YW5pbWF0aW9uRHVyYXRpb259ICR7YW5pbWF0aW9uRnVuY3Rpb259O1xuICB0cmFuc2Zvcm06ICR7KHsgaXNSb3RhdGVkIH0pID0+IGByb3RhdGUoJHtpc1JvdGF0ZWQgPyA5MCA6IDB9ZGVnKWB9O1xuYDtcbmZ1bmN0aW9uIGRlZmF1bHRHcm91cFJlbmRlcmVyPFQ+KGU6IEFjY29yZGlvbkdyb3VwUmVuZGVyRXZlbnQ8VD4pOiBSZWFjdC5SZWFjdENoaWxkIHtcbiAgICByZXR1cm4gKDw+XG4gICAgICB7ZS5ncm91cCA/IGUuZ3JvdXAudG9TdHJpbmcoKSA6IGUuZ3JvdXB9ICh7ZS5pdGVtcy5sZW5ndGh9KVxuICAgIDwvPik7XG59XG5leHBvcnQgY2xhc3MgQWNjb3JkaW9uVGFibGVCYXNpYzxUPiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxBY2NvcmRpb25UYWJsZVByb3BzPFQ+LCBBY2NvcmRpb25UYWJsZUJhc2ljU3RhdGU+IHtcbiAgICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgICAgICBtdWx0aXBsZTogZmFsc2UsXG4gICAgICAgIG5vVmFsdWVHcm91cExhYmVsOiAn4oCUJyxcbiAgICB9O1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBBY2NvcmRpb25UYWJsZVByb3BzPFQ+KSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgY29uc3QgY29udHJvbGxlZERldGFpbHMgPSBwcm9wcy5zZWxlY3RlZEluZGV4ICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZWRHcm91cHMgPSBBcnJheS5pc0FycmF5KHByb3BzLmV4cGFuZGVkR3JvdXBzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IG5vcm1hbGl6ZUluZGV4KHByb3BzLnNlbGVjdGVkSW5kZXgpLFxuICAgICAgICAgICAgY29udHJvbGxlZEluZGV4OiBjb250cm9sbGVkRGV0YWlscyxcbiAgICAgICAgICAgIGNvbnRyb2xsZWRHcm91cHM6IGNvbnRyb2xsZWRHcm91cHMsXG4gICAgICAgICAgICBleHBhbmRlZEdyb3VwczogY29udHJvbGxlZEdyb3VwcyA/IHByb3BzLmV4cGFuZGVkR3JvdXBzIHx8IFtdIDogW10sXG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YXRpYyBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHM6IEFjY29yZGlvblRhYmxlUHJvcHM8YW55Piwgc3RhdGU6IEFjY29yZGlvblRhYmxlQmFzaWNTdGF0ZSkge1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkSW5kZXgsIGV4cGFuZGVkR3JvdXBzIH0gPSBwcm9wcztcbiAgICAgICAgY29uc3QgbmV3SW5kZXggPSBzdGF0ZS5jb250cm9sbGVkSW5kZXggJiYgc2VsZWN0ZWRJbmRleCAhPT0gdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBuZXdHcm91cHMgPSBzdGF0ZS5jb250cm9sbGVkR3JvdXBzICYmIGV4cGFuZGVkR3JvdXBzICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChuZXdJbmRleCB8fCBuZXdHcm91cHMpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogbmV3SW5kZXggPyBub3JtYWxpemVJbmRleChzZWxlY3RlZEluZGV4KSA6IHN0YXRlLnNlbGVjdGVkSW5kZXgsXG4gICAgICAgICAgICAgICAgZXhwYW5kZWRHcm91cHM6IG5ld0dyb3VwcyA/IGV4cGFuZGVkR3JvdXBzIDogc3RhdGUuZXhwYW5kZWRHcm91cHMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG4gICAgcHJpdmF0ZSBnZXRHcm91cEl0ZW1zPFQ+KGRhdGE6IEFycmF5PFQ+LCBncm91cEJ5Pzoga2V5b2YgVCwgZ3JvdXA/OiBhbnkpIHtcbiAgICAgICAgY29uc3QgeyBub1ZhbHVlR3JvdXBMYWJlbCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKGdyb3VwQnkpIHtcbiAgICAgICAgICAgIGlmIChncm91cCA9PT0gbm9WYWx1ZUdyb3VwTGFiZWwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5maWx0ZXIobSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbVtncm91cEJ5XTtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIG51bWJlciAnMCcgc2hvdWxkbid0IGJlIGluIHRoZSBuby12YWx1ZS1ncm91cC5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgdmFsdWUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVtcHR5IGFycmF5cyBzaG91bGQgYmUgaW4gdGhlIG5vLXZhbHVlLWdyb3VwXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIXZhbHVlIHx8IChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YS5maWx0ZXIobSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gbVtncm91cEJ5XTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBncm91cCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzcGVjaWFsIGhhbmRsaW5nIGZvciBhcnJheXMgaXMgbmVlZGVkIGJlY2F1c2UgJz09PScgZG9lc24ndCB3b3JrIGZvciBhcnJheXNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiBBcnJheS5pc0FycmF5KGdyb3VwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpID09PSBncm91cC50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBwcml2YXRlIGhhbmRsZUNsaWNrKHRhcmdldDogbnVtYmVyLCBkYXRhOiBUKSB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIG11bHRpcGxlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWRJbmRleCwgc2VsZWN0ZWRJbmRleCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgbmV4dEluZGV4ZXMgPSB0b2dnbGVJbmRleChzZWxlY3RlZEluZGV4LCB0YXJnZXQsIG11bHRpcGxlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IG11bHRpcGxlID8gbmV4dEluZGV4ZXMgOiBuZXh0SW5kZXhlc1swXSAhPT0gdW5kZWZpbmVkID8gbmV4dEluZGV4ZXNbMF0gOiAtMSxcbiAgICAgICAgICAgICAgICBwcmV2aW91c0luZGV4OiBtdWx0aXBsZSA/IHNlbGVjdGVkSW5kZXggOiBzZWxlY3RlZEluZGV4WzBdICE9PSB1bmRlZmluZWQgPyBzZWxlY3RlZEluZGV4WzBdIDogLTEsXG4gICAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udHJvbGxlZEluZGV4KSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZEluZGV4OiBuZXh0SW5kZXhlcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgdG9nZ2xlR3JvdXAoZ3JvdXA6IGFueSkge1xuICAgICAgICBjb25zdCB7IGRhdGEsIG9uVG9nZ2xlR3JvdXAsIGdyb3VwQnkgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgZXhwYW5kZWRHcm91cHMsIGNvbnRyb2xsZWRHcm91cHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICh0eXBlb2Ygb25Ub2dnbGVHcm91cCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25Ub2dnbGVHcm91cCh7XG4gICAgICAgICAgICAgICAgZ3JvdXAsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2V4cGFuZCcsXG4gICAgICAgICAgICAgICAgaXRlbXM6IHRoaXMuZ2V0R3JvdXBJdGVtcyhkYXRhLCBncm91cEJ5LCBncm91cCksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRyb2xsZWRHcm91cHMpIHtcbiAgICAgICAgICAgIGlmIChleHBhbmRlZEdyb3Vwcy5pbmRleE9mKGdyb3VwKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgZXhwYW5kZWRHcm91cHM6IGV4cGFuZGVkR3JvdXBzLmZpbHRlcihtID0+IG0gIT09IGdyb3VwKSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICBleHBhbmRlZEdyb3VwczogWy4uLmV4cGFuZGVkR3JvdXBzLCBncm91cF0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBncm91cFJlbmRlcmVyKGdyb3VwOiBhbnksIGNvdW50OiBudW1iZXIsIGV4cGFuZGVkOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IHsgdGhlbWUsIGdyb3VwUmVuZGVyZXIgPSBkZWZhdWx0R3JvdXBSZW5kZXJlciwgZGF0YSwgZ3JvdXBCeSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmdldEdyb3VwSXRlbXMoZGF0YSwgZ3JvdXBCeSwgZ3JvdXApO1xuICAgICAgICByZXR1cm4gKDw+XG4gICAgICAgIDxBY2NvcmRpb25UYWJsZVJvdyBjbGlja2FibGUgb25DbGljaz17KCkgPT4gdGhpcy50b2dnbGVHcm91cChncm91cCl9IHRoZW1lPXt0aGVtZX0+XG4gICAgICAgICAgPEdyb3VwVGFibGVDZWxsPlxuICAgICAgICAgICAgPFN0eWxlZEljb24gaXNSb3RhdGVkPXtleHBhbmRlZH0gbmFtZT1cIktleWJvYXJkQXJyb3dSaWdodFwiLz5cbiAgICAgICAgICA8L0dyb3VwVGFibGVDZWxsPlxuICAgICAgICAgIDxHcm91cFRhYmxlQ2VsbCBjb2xTcGFuPXtjb3VudCAtIDF9Pntncm91cFJlbmRlcmVyKHsgZXhwYW5kZWQsIGdyb3VwLCBpdGVtcyB9KX08L0dyb3VwVGFibGVDZWxsPlxuICAgICAgICA8L0FjY29yZGlvblRhYmxlUm93PlxuICAgICAgICA8U3R5bGVkVGFibGVSb3dDb2xsYXBzZSAvPlxuICAgICAgPC8+KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBnZXRHcm91cEJ5VmFsdWUgPSAocm93RGF0YTogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZ3JvdXBCeSwgbm9WYWx1ZUdyb3VwTGFiZWwgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChncm91cEJ5KSB7XG4gICAgICAgICAgICBjb25zdCByb3dWYWx1ZSA9IHJvd0RhdGFbZ3JvdXBCeV07XG4gICAgICAgICAgICBpZiAocm93VmFsdWUgfHwgcm93VmFsdWUgPT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyb3dWYWx1ZSkgJiYgcm93VmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBub1ZhbHVlR3JvdXBMYWJlbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByb3dWYWx1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9WYWx1ZUdyb3VwTGFiZWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGhlbHBlciBtZXRob2QgdG8gY2hlY2sgaWYgYW4gZWxlbWVudCBpcyBpbmNsdWRlZCBpbiBhbiBhcnJheS5cbiAgICAgKiBUaGlzIG1ldGhvZCBoYXMgc3BlY2lhbCBoYW5kbGluZyBmb3IgYXJyYXlzIG9mIGFycmF5cy4gSW4gdGhpcyBjYXNlIG5vcm1hbCBzdHJpY3QgZXF1YWxpdHkgY2hlY2tpbmcgKD09PSlcbiAgICAgKiB3b3VsZG4ndCB3b3JrLlxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIGFycmF5SW5jbHVkZXM8RT4oZWxlbWVudDogRSwgYXJyOiBBcnJheTxFPik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gKChBcnJheS5pc0FycmF5KGVsZW1lbnQpID8gSlNPTi5zdHJpbmdpZnkoYXJyKS5pbmRleE9mKEpTT04uc3RyaW5naWZ5KGVsZW1lbnQpKSA6IGFyci5pbmRleE9mKGVsZW1lbnQpKSAhPT0gLTEpO1xuICAgIH1cbiAgICBwcml2YXRlIHJvd1JlbmRlcmVyID0gKHsgY2VsbHMsIGluZGV4LCBkYXRhLCBrZXksIHN0YXRlIH06IFRhYmxlUm93RXZlbnQ8VD4pID0+IHtcbiAgICAgICAgY29uc3QgeyBkZXRhaWxzUmVuZGVyZXIsIHJvd1JlbmRlcmVyLCB0aGVtZSwgYXJyb3dUb2dnbGUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgc2VsZWN0ZWRJbmRleCwgZXhwYW5kZWRHcm91cHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgZ3JvdXBlZFJvd3MgPSBbXSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGFjdGl2ZSA9IGhhc0luZGV4KHNlbGVjdGVkSW5kZXgsIGluZGV4KTtcbiAgICAgICAgY29uc3QgY291bnQgPSBSZWFjdC5DaGlsZHJlbi5jb3VudChjZWxscyk7XG4gICAgICAgIGNvbnN0IGNvbCA9IHRoaXMuZ2V0R3JvdXBCeVZhbHVlKGRhdGEpO1xuICAgICAgICBjb25zdCBvcGVuID0gIShjb2wgfHwgY29sID09PSAwKSB8fCBBY2NvcmRpb25UYWJsZUJhc2ljLmFycmF5SW5jbHVkZXMoY29sLCBleHBhbmRlZEdyb3Vwcyk7XG4gICAgICAgIGNvbnN0IHJlbmRlckRhdGEgPSB7IGNlbGxzLCBpbmRleCwgZGF0YSwgYWN0aXZlLCBrZXksIHN0YXRlIH07XG4gICAgICAgIGNvbnN0IGlzTmV3R3JvdXAgPSAoY29sIHx8IGNvbCA9PT0gMCkgJiYgIUFjY29yZGlvblRhYmxlQmFzaWMuYXJyYXlJbmNsdWRlcyhjb2wsIGdyb3VwZWRSb3dzKTtcbiAgICAgICAgaWYgKGlzTmV3R3JvdXApIHtcbiAgICAgICAgICAgIHN0YXRlLmdyb3VwZWRSb3dzID0gWy4uLmdyb3VwZWRSb3dzLCBjb2xdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoPFJlYWN0LkZyYWdtZW50IGtleT17a2V5fT5cbiAgICAgICAge2lzTmV3R3JvdXAgJiYgdGhpcy5ncm91cFJlbmRlcmVyKGNvbCwgY291bnQsIG9wZW4pfVxuICAgICAgICB7b3BlbiAmJiAoPD5cbiAgICAgICAgICAgIHsocm93UmVuZGVyZXIgJiYgcm93UmVuZGVyZXIocmVuZGVyRGF0YSkpIHx8ICg8QWNjb3JkaW9uVGFibGVSb3cgYWN0aXZlPXthY3RpdmV9IGNsaWNrYWJsZT17IWFycm93VG9nZ2xlfSBvbkNsaWNrPXsoKSA9PiB0aGlzLmhhbmRsZUNsaWNrKGluZGV4LCBkYXRhKX0gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgICAgICB7Y2VsbHN9XG4gICAgICAgICAgICAgIDwvQWNjb3JkaW9uVGFibGVSb3c+KX1cbiAgICAgICAgICAgIDxTdHlsZWRUYWJsZVJvd0NvbGxhcHNlIGFjdGl2ZT17YWN0aXZlfT5cbiAgICAgICAgICAgICAgPFN0eWxlZERldGFpbHNDb250YWluZXIgY29sU3Bhbj17Y291bnR9PlxuICAgICAgICAgICAgICAgIDxTdHlsZWRDb2xsYXBzZUFuaW1hdG9yIGFjdGl2ZT17YWN0aXZlfT5cbiAgICAgICAgICAgICAgICAgIHthY3RpdmUgJiYgZGV0YWlsc1JlbmRlcmVyICYmIGRldGFpbHNSZW5kZXJlcih7IGluZGV4LCBkYXRhIH0pfVxuICAgICAgICAgICAgICAgIDwvU3R5bGVkQ29sbGFwc2VBbmltYXRvcj5cbiAgICAgICAgICAgICAgPC9TdHlsZWREZXRhaWxzQ29udGFpbmVyPlxuICAgICAgICAgICAgPC9TdHlsZWRUYWJsZVJvd0NvbGxhcHNlPlxuICAgICAgICAgIDwvPil9XG4gICAgICA8L1JlYWN0LkZyYWdtZW50Pik7XG4gICAgfTtcbiAgICBwcml2YXRlIGNlbGxSZW5kZXJlciA9IChlOiBUYWJsZUNlbGxSZW5kZXJFdmVudDxUPikgPT4ge1xuICAgICAgICBjb25zdCB7IHJvdywgZGF0YSB9ID0gZTtcbiAgICAgICAgaWYgKGUuY29sdW1uID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gKDxTdHlsZWRJY29uIGlzUm90YXRlZD17aGFzSW5kZXgodGhpcy5zdGF0ZS5zZWxlY3RlZEluZGV4LCByb3cpfSBuYW1lPVwiS2V5Ym9hcmRBcnJvd1JpZ2h0XCIgb25DbGljaz17KCkgPT4gZGF0YSAmJiB0aGlzLmhhbmRsZUNsaWNrKHJvdywgZGF0YSl9Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgY2VsbFJlbmRlcmVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gdHlwZW9mIGNlbGxSZW5kZXJlciA9PT0gJ2Z1bmN0aW9uJyA/IGNlbGxSZW5kZXJlcihlKSA6IGRlZmF1bHRDZWxsUmVuZGVyZXIoZSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGdldENvbHVtbnMoKSB7XG4gICAgICAgIGNvbnN0IHsgZGF0YSwgY29sdW1ucywgaW5kZXhlZCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKGNvbHVtbnMgfHwgKGRhdGEgJiYgZGF0YS5sZW5ndGgpKSB7XG4gICAgICAgICAgICBjb25zdCBjb2xzID0ge1xuICAgICAgICAgICAgICAgICcnOiB7XG4gICAgICAgICAgICAgICAgICAgIGhlYWRlcjogJycsXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiByZW1DYWxjKCc1MHB4JyksXG4gICAgICAgICAgICAgICAgICAgIHNvcnRhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChpbmRleGVkKSB7XG4gICAgICAgICAgICAgICAgY29sc1snIyddID0ge1xuICAgICAgICAgICAgICAgICAgICBoZWFkZXI6ICcjJyxcbiAgICAgICAgICAgICAgICAgICAgc29ydGFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoY29sdW1ucyB8fCBkYXRhWzBdKTtcbiAgICAgICAgICAgIHJldHVybiBrZXlzLnJlZHVjZSgoYWNjLCBrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBhY2Nba2V5XSA9IGNvbHVtbnMgPyBjb2x1bW5zW2tleV0gOiBrZXk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH0sIGNvbHMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGRldGFpbHNSZW5kZXJlcjogXzAsIGNvbHVtbnM6IF8xLCBpbmRleGVkOiBfMiwgZ3JvdXBSZW5kZXJlcjogXzMsIGV4cGFuZGVkR3JvdXBzOiBfNCwgb25Ub2dnbGVHcm91cDogXzUsIG9wZW5MYWJlbDogXzYsIGNsb3NlTGFiZWw6IF83LCBtdWx0aXBsZTogXzgsIC4uLnByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gKDxTdHlsZWRUYWJsZSB7Li4ucHJvcHN9IG1vZGU9XCJ0YWJsZVwiIGNvbHVtbnM9e3RoaXMuZ2V0Q29sdW1ucygpfSByb3dSZW5kZXJlcj17dGhpcy5yb3dSZW5kZXJlcn0gY2VsbFJlbmRlcmVyPXt0aGlzLmNlbGxSZW5kZXJlcn0vPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IEFjY29yZGlvblRhYmxlUm93KCkgeyByZXR1cm4gQWNjb3JkaW9uVGFibGVSb3cgYXMgdHlwZW9mIEFjY29yZGlvblRhYmxlUm93OyB9LFxuICAgICAgICBnZXQgR3JvdXBUYWJsZUNlbGwoKSB7IHJldHVybiBHcm91cFRhYmxlQ2VsbCBhcyB0eXBlb2YgR3JvdXBUYWJsZUNlbGw7IH0sXG4gICAgICAgIGdldCBTdHlsZWRJY29uKCkgeyByZXR1cm4gU3R5bGVkSWNvbiBhcyB0eXBlb2YgU3R5bGVkSWNvbjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZFRhYmxlUm93Q29sbGFwc2UoKSB7IHJldHVybiBTdHlsZWRUYWJsZVJvd0NvbGxhcHNlIGFzIHR5cGVvZiBTdHlsZWRUYWJsZVJvd0NvbGxhcHNlOyB9LFxuICAgICAgICBnZXQgU3R5bGVkRGV0YWlsc0NvbnRhaW5lcigpIHsgcmV0dXJuIFN0eWxlZERldGFpbHNDb250YWluZXIgYXMgdHlwZW9mIFN0eWxlZERldGFpbHNDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBTdHlsZWRDb2xsYXBzZUFuaW1hdG9yKCkgeyByZXR1cm4gU3R5bGVkQ29sbGFwc2VBbmltYXRvciBhcyB0eXBlb2YgU3R5bGVkQ29sbGFwc2VBbmltYXRvcjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZFRhYmxlKCkgeyByZXR1cm4gU3R5bGVkVGFibGUgYXMgdHlwZW9mIFN0eWxlZFRhYmxlOyB9XG4gICAgfTtcbn1cbiJdfQ==