"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var withFormContext_1 = require("../../hoc/withFormContext");
var RadioButtonGroupContext_1 = require("../../contexts/RadioButtonGroupContext");
var RadioButtonGroupInt = /** @class */ (function (_super) {
    __extends(RadioButtonGroupInt, _super);
    function RadioButtonGroupInt(props) {
        var _this = _super.call(this, props) || this;
        _this.buttons = [];
        _this.ctx = _this.createContext();
        _this.getNextValue = function (groupItemName) {
            var multiple = _this.props.multiple;
            var value = _this.state.value;
            if (value && Array.isArray(value) && groupItemName) {
                if (value.indexOf(groupItemName) !== -1) {
                    return value.filter(function (f) { return f !== groupItemName; });
                }
                return value.concat([groupItemName]);
            }
            return multiple && groupItemName ? [groupItemName] : groupItemName;
        };
        var controlled = props.value !== undefined;
        var propValue = props.value, defaultValue = props.defaultValue;
        var value = controlled ? propValue : defaultValue;
        _this.state = {
            controlled: controlled,
            value: value,
        };
        return _this;
    }
    RadioButtonGroupInt.prototype.setState = function (state) {
        var value = state.value;
        if (value) {
            for (var _i = 0, _a = this.buttons; _i < _a.length; _i++) {
                var button = _a[_i];
                var selected = Array.isArray(value) && button.name ? value.indexOf(button.name) !== -1 : button.name === value;
                button.setValue(selected);
            }
            _super.prototype.setState.call(this, __assign({}, state, { value: value }));
        }
        _super.prototype.setState.call(this, state);
    };
    RadioButtonGroupInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    RadioButtonGroupInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    RadioButtonGroupInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var value = _a.value;
        var controlled = this.state.controlled;
        if (controlled) {
            this.setState({
                value: value,
            });
        }
    };
    RadioButtonGroupInt.prototype.createContext = function () {
        var _this = this;
        return {
            select: function (rb) {
                var _a = _this.props, onChange = _a.onChange, form = _a.form, _b = _a.name, name = _b === void 0 ? '' : _b;
                var controlled = _this.state.controlled;
                var value = _this.getNextValue(rb.name);
                if (!controlled) {
                    if (form) {
                        form.change({
                            name: name,
                            value: value,
                        });
                    }
                    else if (value) {
                        _this.setState({
                            value: value,
                        });
                    }
                    else {
                        for (var _i = 0, _c = _this.buttons; _i < _c.length; _i++) {
                            var button = _c[_i];
                            button.setValue(button === rb);
                        }
                        _super.prototype.setState.call(_this, {
                            value: undefined,
                        });
                    }
                }
                if (typeof onChange === 'function' && value) {
                    onChange({
                        value: value,
                    });
                }
            },
            subscribe: function (rb) {
                var value = _this.state.value;
                _this.buttons.push(rb);
                if (value !== undefined) {
                    var selected = Array.isArray(value) && rb.name ? value.indexOf(rb.name) !== -1 : rb.name === value;
                    rb.setValue(selected);
                }
            },
            unsubscribe: function (rb) {
                var index = _this.buttons.indexOf(rb);
                index >= 0 && _this.buttons.splice(index, 1);
            },
        };
    };
    RadioButtonGroupInt.prototype.render = function () {
        return React.createElement(RadioButtonGroupContext_1.RadioButtonGroupContext.Provider, { value: this.ctx }, this.props.children);
    };
    return RadioButtonGroupInt;
}(React.PureComponent));
/**
 * The radio button group manages a group of radio buttons.
 */
exports.RadioButtonGroup = withFormContext_1.withFormContext(RadioButtonGroupInt);
exports.RadioButtonGroup.displayName = 'RadioButtonGroup';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9SYWRpb0J1dHRvbkdyb3VwL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUUvQiw2REFBOEU7QUFDOUUsa0ZBQXlJO0FBY3pJO0lBQWtDLHVDQUFvRjtJQUdsSCw2QkFBWSxLQUE0QjtRQUF4QyxZQUNJLGtCQUFNLEtBQUssQ0FBQyxTQVFmO1FBWGdCLGFBQU8sR0FBb0MsRUFBRSxDQUFDO1FBQzlDLFNBQUcsR0FBZ0MsS0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBNENqRSxrQkFBWSxHQUFHLFVBQUMsYUFBc0I7WUFDbEMsSUFBQSwrQkFBUSxDQUFnQjtZQUN4QixJQUFBLHlCQUFLLENBQWdCO1lBQzdCLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksYUFBYSxFQUFFO2dCQUNoRCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7b0JBQ3JDLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsS0FBSyxhQUFhLEVBQW5CLENBQW1CLENBQUMsQ0FBQztpQkFDakQ7Z0JBQ0QsT0FBVyxLQUFLLFNBQUUsYUFBYSxHQUFFO2FBQ3BDO1lBQ0QsT0FBTyxRQUFRLElBQUksYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUM7UUFDdkUsQ0FBQyxDQUFDO1FBbkRFLElBQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDO1FBQ3JDLElBQUEsdUJBQWdCLEVBQUUsaUNBQVksQ0FBVztRQUNqRCxJQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1FBQ3BELEtBQUksQ0FBQyxLQUFLLEdBQUc7WUFDVCxVQUFVLFlBQUE7WUFDVixLQUFLLE9BQUE7U0FDUixDQUFDOztJQUNOLENBQUM7SUFDRCxzQ0FBUSxHQUFSLFVBQWdELEtBQXFDO1FBQ2pGLElBQU0sS0FBSyxHQUFJLEtBQThDLENBQUMsS0FBSyxDQUFDO1FBQ3BFLElBQUksS0FBSyxFQUFFO1lBQ1AsS0FBcUIsVUFBWSxFQUFaLEtBQUEsSUFBSSxDQUFDLE9BQU8sRUFBWixjQUFZLEVBQVosSUFBWSxFQUFFO2dCQUE5QixJQUFNLE1BQU0sU0FBQTtnQkFDYixJQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQztnQkFDakgsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUM3QjtZQUNELGlCQUFNLFFBQVEseUJBQU0sS0FBSyxJQUFFLEtBQUssT0FBQSxJQUFHLENBQUM7U0FDdkM7UUFDRCxpQkFBTSxRQUFRLFlBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUNELCtDQUFpQixHQUFqQjtRQUNZLElBQUEsc0JBQUksQ0FBZ0I7UUFDcEIsSUFBQSxrQ0FBVSxDQUFnQjtRQUNsQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksRUFBRTtZQUNyQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3hCO0lBQ0wsQ0FBQztJQUNELGtEQUFvQixHQUFwQjtRQUNZLElBQUEsc0JBQUksQ0FBZ0I7UUFDcEIsSUFBQSxrQ0FBVSxDQUFnQjtRQUNsQyxJQUFJLENBQUMsVUFBVSxJQUFJLElBQUksRUFBRTtZQUNyQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzFCO0lBQ0wsQ0FBQztJQUNELDhEQUFnQyxHQUFoQyxVQUFpQyxFQUFnQztZQUE5QixnQkFBSztRQUM1QixJQUFBLGtDQUFVLENBQWdCO1FBQ2xDLElBQUksVUFBVSxFQUFFO1lBQ1osSUFBSSxDQUFDLFFBQVEsQ0FBQztnQkFDVixLQUFLLE9BQUE7YUFDUixDQUFDLENBQUM7U0FDTjtJQUNMLENBQUM7SUFZTywyQ0FBYSxHQUFyQjtRQUFBLGlCQThDQztRQTdDRyxPQUFPO1lBQ0gsTUFBTSxFQUFFLFVBQUMsRUFBNEI7Z0JBQzNCLElBQUEsZ0JBQTBDLEVBQXhDLHNCQUFRLEVBQUUsY0FBSSxFQUFFLFlBQVMsRUFBVCw4QkFBd0IsQ0FBQztnQkFDekMsSUFBQSxtQ0FBVSxDQUFnQjtnQkFDbEMsSUFBTSxLQUFLLEdBQUcsS0FBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3pDLElBQUksQ0FBQyxVQUFVLEVBQUU7b0JBQ2IsSUFBSSxJQUFJLEVBQUU7d0JBQ04sSUFBSSxDQUFDLE1BQU0sQ0FBQzs0QkFDUixJQUFJLE1BQUE7NEJBQ0osS0FBSyxPQUFBO3lCQUNSLENBQUMsQ0FBQztxQkFDTjt5QkFDSSxJQUFJLEtBQUssRUFBRTt3QkFDWixLQUFJLENBQUMsUUFBUSxDQUFDOzRCQUNWLEtBQUssT0FBQTt5QkFDUixDQUFDLENBQUM7cUJBQ047eUJBQ0k7d0JBQ0QsS0FBcUIsVUFBWSxFQUFaLEtBQUEsS0FBSSxDQUFDLE9BQU8sRUFBWixjQUFZLEVBQVosSUFBWSxFQUFFOzRCQUE5QixJQUFNLE1BQU0sU0FBQTs0QkFDYixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxFQUFFLENBQUMsQ0FBQzt5QkFDbEM7d0JBQ0QsaUJBQU0sUUFBUSxhQUFDOzRCQUNYLEtBQUssRUFBRSxTQUFTO3lCQUNuQixDQUFDLENBQUM7cUJBQ047aUJBQ0o7Z0JBQ0QsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLElBQUksS0FBSyxFQUFFO29CQUN6QyxRQUFRLENBQUM7d0JBQ0wsS0FBSyxPQUFBO3FCQUNSLENBQUMsQ0FBQztpQkFDTjtZQUNMLENBQUM7WUFDRCxTQUFTLEVBQUUsVUFBQyxFQUE0QjtnQkFDNUIsSUFBQSx5QkFBSyxDQUFnQjtnQkFDN0IsS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3RCLElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtvQkFDckIsSUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksS0FBSyxLQUFLLENBQUM7b0JBQ3JHLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQ3pCO1lBQ0wsQ0FBQztZQUNELFdBQVcsRUFBRSxVQUFDLEVBQTRCO2dCQUN0QyxJQUFNLEtBQUssR0FBRyxLQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDdkMsS0FBSyxJQUFJLENBQUMsSUFBSSxLQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDaEQsQ0FBQztTQUNKLENBQUM7SUFDTixDQUFDO0lBQ0Qsb0NBQU0sR0FBTjtRQUNJLE9BQU8sb0JBQUMsaURBQXVCLENBQUMsUUFBUSxJQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsR0FBRyxJQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFvQyxDQUFDO0lBQ3ZILENBQUM7SUFDTCwwQkFBQztBQUFELENBQUMsQUEzR0QsQ0FBa0MsS0FBSyxDQUFDLGFBQWEsR0EyR3BEO0FBQ0Q7O0dBRUc7QUFDVSxRQUFBLGdCQUFnQixHQUFHLGlDQUFlLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUNyRSx3QkFBZ0IsQ0FBQyxXQUFXLEdBQUcsa0JBQWtCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBJbnB1dFByb3BzLCBJbnB1dENoYW5nZUV2ZW50IH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IEZvcm1Db250ZXh0UHJvcHMsIHdpdGhGb3JtQ29udGV4dCB9IGZyb20gJy4uLy4uL2hvYy93aXRoRm9ybUNvbnRleHQnO1xuaW1wb3J0IHsgUmFkaW9CdXR0b25Hcm91cENvbnRleHQsIFJhZGlvQnV0dG9uR3JvdXBDb250ZXh0VHlwZSwgUmFkaW9CdXR0b25Hcm91cE5vdGlmaWVyLCB9IGZyb20gJy4uLy4uL2NvbnRleHRzL1JhZGlvQnV0dG9uR3JvdXBDb250ZXh0JztcbmV4cG9ydCB0eXBlIFJhZGlvQnV0dG9uR3JvdXBDaGFuZ2VFdmVudCA9IElucHV0Q2hhbmdlRXZlbnQ8c3RyaW5nPjtcbmV4cG9ydCBpbnRlcmZhY2UgUmFkaW9CdXR0b25Hcm91cFByb3BzIGV4dGVuZHMgSW5wdXRQcm9wczxzdHJpbmcgfCBBcnJheTxzdHJpbmc+PiB7XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgZ3JvdXAncyBjaGlsZHJlbi5cbiAgICAgKi9cbiAgICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTtcbiAgICBtdWx0aXBsZT86IGJvb2xlYW47XG59XG5leHBvcnQgdHlwZSBTdGF0ZVZhbHVlID0gQXJyYXk8c3RyaW5nPiB8IHN0cmluZyB8IHVuZGVmaW5lZDtcbmV4cG9ydCBpbnRlcmZhY2UgUmFkaW9CdXR0b25Hcm91cFN0YXRlIHtcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xuICAgIHZhbHVlOiBTdGF0ZVZhbHVlO1xufVxuY2xhc3MgUmFkaW9CdXR0b25Hcm91cEludCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8UmFkaW9CdXR0b25Hcm91cFByb3BzICYgRm9ybUNvbnRleHRQcm9wcywgUmFkaW9CdXR0b25Hcm91cFN0YXRlPiB7XG4gICAgcHJpdmF0ZSByZWFkb25seSBidXR0b25zOiBBcnJheTxSYWRpb0J1dHRvbkdyb3VwTm90aWZpZXI+ID0gW107XG4gICAgcHJpdmF0ZSByZWFkb25seSBjdHg6IFJhZGlvQnV0dG9uR3JvdXBDb250ZXh0VHlwZSA9IHRoaXMuY3JlYXRlQ29udGV4dCgpO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBSYWRpb0J1dHRvbkdyb3VwUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCBjb250cm9sbGVkID0gcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgY29uc3QgeyB2YWx1ZTogcHJvcFZhbHVlLCBkZWZhdWx0VmFsdWUgfSA9IHByb3BzO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGNvbnRyb2xsZWQgPyBwcm9wVmFsdWUgOiBkZWZhdWx0VmFsdWU7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBjb250cm9sbGVkLFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHNldFN0YXRlPEsgZXh0ZW5kcyBrZXlvZiBSYWRpb0J1dHRvbkdyb3VwU3RhdGU+KHN0YXRlOiBQaWNrPFJhZGlvQnV0dG9uR3JvdXBTdGF0ZSwgSz4pIHtcbiAgICAgICAgY29uc3QgdmFsdWUgPSAoc3RhdGUgYXMgUGljazxSYWRpb0J1dHRvbkdyb3VwU3RhdGUsICd2YWx1ZSc+KS52YWx1ZTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGJ1dHRvbiBvZiB0aGlzLmJ1dHRvbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IEFycmF5LmlzQXJyYXkodmFsdWUpICYmIGJ1dHRvbi5uYW1lID8gdmFsdWUuaW5kZXhPZihidXR0b24ubmFtZSkgIT09IC0xIDogYnV0dG9uLm5hbWUgPT09IHZhbHVlO1xuICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRWYWx1ZShzZWxlY3RlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzdXBlci5zZXRTdGF0ZSh7IC4uLnN0YXRlLCB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgICBzdXBlci5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyB2YWx1ZSB9OiBSYWRpb0J1dHRvbkdyb3VwUHJvcHMpIHtcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGdldE5leHRWYWx1ZSA9IChncm91cEl0ZW1OYW1lPzogc3RyaW5nKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgbXVsdGlwbGUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICh2YWx1ZSAmJiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiBncm91cEl0ZW1OYW1lKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUuaW5kZXhPZihncm91cEl0ZW1OYW1lKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuZmlsdGVyKGYgPT4gZiAhPT0gZ3JvdXBJdGVtTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gWy4uLnZhbHVlLCBncm91cEl0ZW1OYW1lXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbXVsdGlwbGUgJiYgZ3JvdXBJdGVtTmFtZSA/IFtncm91cEl0ZW1OYW1lXSA6IGdyb3VwSXRlbU5hbWU7XG4gICAgfTtcbiAgICBwcml2YXRlIGNyZWF0ZUNvbnRleHQoKTogUmFkaW9CdXR0b25Hcm91cENvbnRleHRUeXBlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlbGVjdDogKHJiOiBSYWRpb0J1dHRvbkdyb3VwTm90aWZpZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBmb3JtLCBuYW1lID0gJycgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXROZXh0VmFsdWUocmIubmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtLmNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBidXR0b24gb2YgdGhpcy5idXR0b25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLnNldFZhbHVlKGJ1dHRvbiA9PT0gcmIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXIuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nICYmIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3Vic2NyaWJlOiAocmI6IFJhZGlvQnV0dG9uR3JvdXBOb3RpZmllcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICAgICAgdGhpcy5idXR0b25zLnB1c2gocmIpO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgcmIubmFtZSA/IHZhbHVlLmluZGV4T2YocmIubmFtZSkgIT09IC0xIDogcmIubmFtZSA9PT0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIHJiLnNldFZhbHVlKHNlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdW5zdWJzY3JpYmU6IChyYjogUmFkaW9CdXR0b25Hcm91cE5vdGlmaWVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmJ1dHRvbnMuaW5kZXhPZihyYik7XG4gICAgICAgICAgICAgICAgaW5kZXggPj0gMCAmJiB0aGlzLmJ1dHRvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgcmV0dXJuIDxSYWRpb0J1dHRvbkdyb3VwQ29udGV4dC5Qcm92aWRlciB2YWx1ZT17dGhpcy5jdHh9Pnt0aGlzLnByb3BzLmNoaWxkcmVufTwvUmFkaW9CdXR0b25Hcm91cENvbnRleHQuUHJvdmlkZXI+O1xuICAgIH1cbn1cbi8qKlxuICogVGhlIHJhZGlvIGJ1dHRvbiBncm91cCBtYW5hZ2VzIGEgZ3JvdXAgb2YgcmFkaW8gYnV0dG9ucy5cbiAqL1xuZXhwb3J0IGNvbnN0IFJhZGlvQnV0dG9uR3JvdXAgPSB3aXRoRm9ybUNvbnRleHQoUmFkaW9CdXR0b25Hcm91cEludCk7XG5SYWRpb0J1dHRvbkdyb3VwLmRpc3BsYXlOYW1lID0gJ1JhZGlvQnV0dG9uR3JvdXAnO1xuIl19