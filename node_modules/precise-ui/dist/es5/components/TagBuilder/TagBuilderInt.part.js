"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var input_1 = require("../../utils/input");
var text_1 = require("../../utils/text");
var Icon_1 = require("../Icon");
var InputIcon_1 = require("../InputIcon");
var colors_1 = require("../../colors");
var distance_1 = require("../../distance");
var withFormContext_1 = require("../../hoc/withFormContext");
var quarks_1 = require("../../quarks");
var textStyles_1 = require("../../textStyles");
var finishTagKeys = [13 /* enter */, 32 /* space */, 188 /* comma */, 186 /* semicolon */];
var StyledIcon = styled_1.default(Icon_1.Icon)(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  ", "\n\n  cursor: pointer;\n  vertical-align: middle;\n  color: ", ";\n  font-family: ", ";\n  margin-left: ", ";\n"], ["\n  ", "\n\n  cursor: pointer;\n  vertical-align: middle;\n  color: ", ";\n  font-family: ", ";\n  margin-left: ", ";\n"])), textStyles_1.getFontStyle({ size: 'small' }), styled_1.themed(function (props) { return props.theme.ui5; }), styled_1.themed(function (props) { return props.theme.fontFamily; }), distance_1.distance.small);
var TagBuilderContainer = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject([""], [""])));
function getContainerPadding(props) {
    var tagRenderer = props.tagRenderer, labelShown = props.labelShown;
    if (!tagRenderer) {
        return !labelShown
            ? distance_1.distance.medium + " " + distance_1.distance.medium + " " + distance_1.distance.small
            : distance_1.distance.large + " " + distance_1.distance.medium + " 0";
    }
    return !labelShown ? "" + distance_1.distance.medium : distance_1.distance.large + " " + distance_1.distance.medium + " " + distance_1.distance.small;
}
var StyledTagsContainer = styled_1.default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  padding: ", ";\n  margin: 0;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n"], ["\n  padding: ", ";\n  margin: 0;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n"])), getContainerPadding);
var StyledInput = styled_1.default('input')(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  ", "\n  box-sizing: content-box;\n  box-shadow: none;\n  border: none;\n  border-radius: 0;\n  margin: 0;\n  outline: none;\n  outline-color: transparent !important;\n  background: ", ";\n  width: ", ";\n  color: ", ";\n  cursor: ", ";\n  font-family: inherit;\n"], ["\n  ", "\n  box-sizing: content-box;\n  box-shadow: none;\n  border: none;\n  border-radius: 0;\n  margin: 0;\n  outline: none;\n  outline-color: transparent !important;\n  background: ", ";\n  width: ", ";\n  color: ", ";\n  cursor: ", ";\n  font-family: inherit;\n"])), textStyles_1.getFontSize('medium'), colors_1.transparent, function (props) { return (props.value.length > 2 ? props.value.length * 10 + 'px' : '20px'); }, styled_1.themed(function (_a) {
    var disabled = _a.disabled, theme = _a.theme, valid = _a.valid;
    return (valid ? (disabled ? theme.textDisabled : colors_1.dark) : colors_1.purpleRed);
}), function (props) { return (props.disabled ? 'not-allowed' : 'auto'); });
var RestyledTagItem = styled_1.default(quarks_1.StyledTagItem)(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  margin: 0 ", " ", " 0;\n"], ["\n  margin: 0 ", " ", " 0;\n"])), distance_1.distance.small, distance_1.distance.small);
var InputContainer = styled_1.default('div')(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  display: inline;\n  padding-bottom: ", ";\n"], ["\n  display: inline;\n  padding-bottom: ", ";\n"])), function (_a) {
    var tagRenderer = _a.tagRenderer;
    return (!tagRenderer ? "" + distance_1.distance.small : '0');
});
var StyledText = styled_1.default.span(templateObject_7 || (templateObject_7 = __makeTemplateObject(["\n  display: inline-block;\n  vertical-align: middle;\n"], ["\n  display: inline-block;\n  vertical-align: middle;\n"])));
var CloseIcon = Object.assign((function (_a) {
    var theme = _a.theme, onClick = _a.onClick, onMouseDown = _a.onMouseDown;
    return (React.createElement(StyledIcon, { theme: theme, name: "Close", onClick: onClick, onMouseDown: onMouseDown }));
}), { inner: {
        get StyledIcon() { return StyledIcon; }
    } });
var TagBuilderInt = /** @class */ (function (_super) {
    __extends(TagBuilderInt, _super);
    function TagBuilderInt(props) {
        var _this = _super.call(this, props) || this;
        _this.inputChanged = function (e) {
            var onInput = _this.props.onInput;
            var _a = _this.state, controlled = _a.controlled, prevTags = _a.value;
            var value = e.currentTarget.value;
            if (typeof onInput === 'function') {
                onInput({ value: value });
            }
            if (!controlled) {
                _this.setState({ inputValue: value, valid: value.length > 0 ? prevTags.indexOf(value) === -1 : true });
            }
        };
        _this.keyDownHandler = function (e) {
            var _a = _this.state, inputValue = _a.inputValue, controlled = _a.controlled;
            var shouldFinishTag = _this.props.shouldFinishTag;
            var isHandled = false;
            var handleKeyEvent = function () {
                e.stopPropagation();
                e.preventDefault();
                isHandled = true;
            };
            if (inputValue.length === 0) {
                switch (e.keyCode) {
                    case 8 /* backspace */:
                        _this.removePrevTag();
                        handleKeyEvent();
                        break;
                    case 46 /* delete */:
                        _this.removeNextTag();
                        handleKeyEvent();
                        break;
                }
            }
            if (!isHandled && !controlled) {
                if (typeof shouldFinishTag === 'function') {
                    if (shouldFinishTag(e)) {
                        _this.addTag(inputValue);
                        handleKeyEvent();
                        return;
                    }
                }
                else if (finishTagKeys.indexOf(e.keyCode) !== -1) {
                    _this.addTag(inputValue);
                    handleKeyEvent();
                }
                if (inputValue.length === 0) {
                    switch (e.keyCode) {
                        case 35 /* end */:
                            _this.inputMoveEnd();
                            handleKeyEvent();
                            break;
                        case 36 /* home */:
                            _this.inputMoveHome();
                            handleKeyEvent();
                            break;
                        case 37 /* left */:
                            _this.inputMoveLeft();
                            handleKeyEvent();
                            break;
                        case 39 /* right */:
                            _this.inputMoveRight();
                            handleKeyEvent();
                            break;
                    }
                }
            }
        };
        _this.inputFocused = function () {
            var onFocus = _this.props.onFocus;
            _this.setState({
                focused: true,
            }, onFocus);
        };
        _this.inputBlurred = function () {
            var _a = _this.props, onBlur = _a.onBlur, appendTagOnBlur = _a.appendTagOnBlur;
            if (!!appendTagOnBlur && !_this.state.controlled) {
                var inputValue = _this.state.inputValue;
                if (inputValue) {
                    _this.addTag(inputValue);
                }
            }
            _this.setState({
                focused: false,
            }, onBlur);
        };
        _this.setFocus = function () {
            _this._input && _this._input.focus();
        };
        _this.removeTagMouseDownHandler = function (event) {
            event.preventDefault();
        };
        _this.renderTag = function (e) {
            var _a = _this.props, theme = _a.theme, disabled = _a.disabled;
            return (React.createElement(RestyledTagItem, { theme: theme, key: e.item + e.index },
                React.createElement(StyledText, null, e.item),
                !disabled && (React.createElement(CloseIcon, { theme: theme, onMouseDown: _this.removeTagMouseDownHandler, onClick: function () { return _this.removeTag(e.index); } }))));
        };
        _this.setContainer = function (node) {
            _this._input = node;
            var inputRef = _this.props.inputRef;
            if (typeof inputRef === 'function') {
                inputRef(node);
            }
        };
        var tags = (props.value || props.defaultValue || []).map(text_1.lowerize);
        _this.state = {
            value: tags,
            inputValue: props.inputValue || '',
            controlled: props.value !== undefined || props.inputValue !== undefined,
            focused: false,
            valid: true,
            error: props.error,
        };
        return _this;
    }
    TagBuilderInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var value = _a.value, _b = _a.inputValue, inputValue = _b === void 0 ? '' : _b, error = _a.error;
        if (this.state.controlled && value !== undefined) {
            this.setState({
                value: value.slice(),
                inputValue: inputValue,
            });
        }
        this.setState({ error: error });
    };
    TagBuilderInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    TagBuilderInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    TagBuilderInt.prototype.fireBeforeTagRemoveEvent = function (index) {
        var onBeforeTagRemove = this.props.onBeforeTagRemove;
        if (typeof onBeforeTagRemove === 'function') {
            onBeforeTagRemove(index);
        }
    };
    TagBuilderInt.prototype.inputMoveLeft = function () {
        var value = this.state.value;
        var _a = this.state.inputPosition, inputPosition = _a === void 0 ? value.length : _a;
        if (inputPosition > 0) {
            this.setState({ inputPosition: inputPosition - 1 });
        }
    };
    TagBuilderInt.prototype.inputMoveRight = function () {
        var _a = this.state, value = _a.value, inputPosition = _a.inputPosition;
        if (inputPosition !== undefined && inputPosition < value.length) {
            this.setState({ inputPosition: inputPosition + 1 });
        }
    };
    TagBuilderInt.prototype.inputMoveEnd = function () {
        var value = this.state.value;
        this.setState({ inputPosition: value.length });
    };
    TagBuilderInt.prototype.inputMoveHome = function () {
        this.setState({ inputPosition: 0 });
    };
    TagBuilderInt.prototype.addTag = function (inputValue) {
        var _this = this;
        var _a = this.state, prevTags = _a.value, valid = _a.valid;
        var _b = this.state.inputPosition, inputPosition = _b === void 0 ? prevTags.length : _b;
        inputValue = inputValue.trim().toLowerCase();
        if (inputValue.length > 0 && valid) {
            var tags_1 = prevTags.slice();
            tags_1.splice(inputPosition, 0, inputValue);
            this.setState({ inputValue: '', inputPosition: inputPosition + 1 }, function () { return _this.onChange(tags_1); });
        }
    };
    TagBuilderInt.prototype.removePrevTag = function () {
        var prevTags = this.state.value;
        var _a = this.state.inputPosition, inputPosition = _a === void 0 ? prevTags.length : _a;
        if (inputPosition > 0) {
            this.removeTag(inputPosition - 1);
            this.setState({ inputPosition: inputPosition - 1 });
        }
    };
    TagBuilderInt.prototype.removeNextTag = function () {
        var _a = this.state, prevTags = _a.value, inputPosition = _a.inputPosition;
        if (inputPosition !== undefined && inputPosition < prevTags.length) {
            this.removeTag(inputPosition);
        }
    };
    TagBuilderInt.prototype.removeTag = function (index) {
        var prevTags = this.state.value;
        this.fireBeforeTagRemoveEvent(index);
        var tags = prevTags.slice(0, index).concat(prevTags.slice(index + 1));
        this.onChange(tags);
    };
    TagBuilderInt.prototype.onChange = function (value) {
        var _a = this.props, onChange = _a.onChange, _b = _a.name, name = _b === void 0 ? '' : _b, form = _a.form;
        if (!this.state.controlled) {
            if (form) {
                form.change({
                    name: name,
                    value: value,
                });
            }
            else {
                this.setState({
                    value: value,
                });
            }
        }
        if (typeof onChange === 'function') {
            onChange({
                value: value,
            });
        }
    };
    TagBuilderInt.prototype.render = function () {
        var _a = this.props, tagRenderer = _a.tagRenderer, info = _a.info, disabled = _a.disabled, borderless = _a.borderless, theme = _a.theme, label = _a.label, placeholder = _a.placeholder;
        var _b = this.state, value = _b.value, inputValue = _b.inputValue, focused = _b.focused, valid = _b.valid, error = _b.error;
        var _c = this.state.inputPosition, inputPosition = _c === void 0 ? value.length : _c;
        var border = quarks_1.getTextFieldBorderType(borderless, !!error, focused);
        var renderer = tagRenderer || this.renderTag;
        var children = value.map(function (item, index) { return renderer({ item: item, index: index, tags: value }); });
        var hasValue = !!inputValue || value.length > 0;
        children.splice(inputPosition, 0, React.createElement(InputContainer, { key: "input", onKeyDown: this.keyDownHandler, tagRenderer: !!tagRenderer },
            React.createElement(StyledInput, { theme: theme, disabled: disabled, ref: this.setContainer, type: "text", value: inputValue, onChange: this.inputChanged, onFocus: this.inputFocused, onBlur: this.inputBlurred, valid: valid })));
        return (React.createElement(TagBuilderContainer, null,
            React.createElement(quarks_1.StyledInputBox, { border: border, disabled: disabled, focused: focused, hasValue: hasValue },
                React.createElement(quarks_1.StyledInputRow, { onClick: this.setFocus, label: label, hasValue: hasValue, placeholder: placeholder, error: !!error, focused: focused },
                    React.createElement(StyledTagsContainer, { labelShown: !!label, tagRenderer: !!tagRenderer }, children)),
                React.createElement(InputIcon_1.InputIcon, { disabled: disabled, theme: theme, error: error, hasValue: hasValue })),
            input_1.showInputInfo(error, info)));
    };
    TagBuilderInt.inner = {
        get RestyledTagItem() { return RestyledTagItem; },
        get StyledText() { return StyledText; },
        get CloseIcon() { return CloseIcon; },
        get InputContainer() { return InputContainer; },
        get StyledInput() { return StyledInput; },
        get TagBuilderContainer() { return TagBuilderContainer; },
        get StyledInputBox() { return quarks_1.StyledInputBox; },
        get StyledInputRow() { return quarks_1.StyledInputRow; },
        get StyledTagsContainer() { return StyledTagsContainer; },
        get InputIcon() { return InputIcon_1.InputIcon; }
    };
    return TagBuilderInt;
}(React.Component));
exports.TagBuilderInt = TagBuilderInt;
exports.TagBuilder = withFormContext_1.withFormContext(TagBuilderInt);
exports.TagBuilder.displayName = 'TagBuilder';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGFnQnVpbGRlckludC5wYXJ0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVGFnQnVpbGRlci9UYWdCdWlsZGVySW50LnBhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQW9EO0FBRXBELDJDQUFrRDtBQUVsRCx5Q0FBNEM7QUFDNUMsZ0NBQStCO0FBQy9CLDBDQUF5QztBQUN6Qyx1Q0FBNEQ7QUFDNUQsMkNBQTBDO0FBQzFDLDZEQUE4RTtBQUU5RSx1Q0FBcUc7QUFDckcsK0NBQTZEO0FBQzdELElBQU0sYUFBYSxHQUFHLHNFQUFvRSxDQUFDO0FBQzNGLElBQU0sVUFBVSxHQUFHLGdCQUFNLENBQUMsV0FBSSxDQUFDLDRMQUFDLE1BQzVCLEVBQStCLDhEQUl4QixFQUFnQyxvQkFDMUIsRUFBdUMsb0JBQ3ZDLEVBQWMsS0FDOUIsS0FQRyx5QkFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBSXhCLGVBQU0sQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFmLENBQWUsQ0FBQyxFQUMxQixlQUFNLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBdEIsQ0FBc0IsQ0FBQyxFQUN2QyxtQkFBUSxDQUFDLEtBQUssQ0FDOUIsQ0FBQztBQUNGLElBQU0sbUJBQW1CLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLHFFQUFDLEVBQUUsSUFBQSxDQUFDO0FBSzFDLFNBQVMsbUJBQW1CLENBQUMsS0FBK0I7SUFDaEQsSUFBQSwrQkFBVyxFQUFFLDZCQUFVLENBQVc7SUFDMUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtRQUNkLE9BQU8sQ0FBQyxVQUFVO1lBQ2QsQ0FBQyxDQUFJLG1CQUFRLENBQUMsTUFBTSxTQUFJLG1CQUFRLENB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RixJQUFJLFNBQVMsS0FBSyxPQUFPLHFCQUE2QixDQUFDLENBQUMsQ0FBQztLQUM1RCxDQUFDO0lBQ04sb0JBQUM7Q0FBQSxBQTdQRCxDQUFtQyxLQUFLLENBQUMsU0FBUyxHQTZQakQ7QUE3UFksc0NBQWE7QUE4UGIsUUFBQSxVQUFVLEdBQUcsaUNBQWUsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN6RCxrQkFBVSxDQUFDLFdBQVcsR0FBRyxZQUFZLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBQcmVjaXNlVGhlbWUgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgc2hvd0lucHV0SW5mbyB9IGZyb20gJy4uLy4uL3V0aWxzL2lucHV0JztcbmltcG9ydCB7IEtleUNvZGVzIH0gZnJvbSAnLi4vLi4vdXRpbHMva2V5Q29kZXMnO1xuaW1wb3J0IHsgbG93ZXJpemUgfSBmcm9tICcuLi8uLi91dGlscy90ZXh0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9JY29uJztcbmltcG9ydCB7IElucHV0SWNvbiB9IGZyb20gJy4uL0lucHV0SWNvbic7XG5pbXBvcnQgeyB0cmFuc3BhcmVudCwgZGFyaywgcHVycGxlUmVkIH0gZnJvbSAnLi4vLi4vY29sb3JzJztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgRm9ybUNvbnRleHRQcm9wcywgd2l0aEZvcm1Db250ZXh0IH0gZnJvbSAnLi4vLi4vaG9jL3dpdGhGb3JtQ29udGV4dCc7XG5pbXBvcnQgeyBUYWdCdWlsZGVyUmVuZGVyRXZlbnQsIFRhZ0J1aWxkZXJQcm9wcyB9IGZyb20gJy4vVGFnQnVpbGRlci50eXBlcy5wYXJ0JztcbmltcG9ydCB7IFN0eWxlZElucHV0Um93LCBTdHlsZWRJbnB1dEJveCwgZ2V0VGV4dEZpZWxkQm9yZGVyVHlwZSwgU3R5bGVkVGFnSXRlbSB9IGZyb20gJy4uLy4uL3F1YXJrcyc7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUsIGdldEZvbnRTaXplIH0gZnJvbSAnLi4vLi4vdGV4dFN0eWxlcyc7XG5jb25zdCBmaW5pc2hUYWdLZXlzID0gW0tleUNvZGVzLmVudGVyLCBLZXlDb2Rlcy5zcGFjZSwgS2V5Q29kZXMuY29tbWEsIEtleUNvZGVzLnNlbWljb2xvbl07XG5jb25zdCBTdHlsZWRJY29uID0gc3R5bGVkKEljb24pIGBcbiAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnc21hbGwnIH0pfVxuXG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgdmVydGljYWwtYWxpZ246IG1pZGRsZTtcbiAgY29sb3I6ICR7dGhlbWVkKHByb3BzID0+IHByb3BzLnRoZW1lLnVpNSl9O1xuICBmb250LWZhbWlseTogJHt0aGVtZWQocHJvcHMgPT4gcHJvcHMudGhlbWUuZm9udEZhbWlseSl9O1xuICBtYXJnaW4tbGVmdDogJHtkaXN0YW5jZS5zbWFsbH07XG5gO1xuY29uc3QgVGFnQnVpbGRlckNvbnRhaW5lciA9IHN0eWxlZC5kaXYgYGA7XG5pbnRlcmZhY2UgU3R5bGVkVGFnc0NvbnRhaW5lclByb3BzIHtcbiAgICBsYWJlbFNob3duOiBib29sZWFuO1xuICAgIHRhZ1JlbmRlcmVyOiBib29sZWFuO1xufVxuZnVuY3Rpb24gZ2V0Q29udGFpbmVyUGFkZGluZyhwcm9wczogU3R5bGVkVGFnc0NvbnRhaW5lclByb3BzKSB7XG4gICAgY29uc3QgeyB0YWdSZW5kZXJlciwgbGFiZWxTaG93biB9ID0gcHJvcHM7XG4gICAgaWYgKCF0YWdSZW5kZXJlcikge1xuICAgICAgICByZXR1cm4gIWxhYmVsU2hvd25cbiAgICAgICAgICAgID8gYCR7ZGlzdGFuY2UubWVkaXVtfSAke2Rpc3RhbmNlLm1lZGl1bX0gJHtkaXN0YW5jZS5zbWFsbH1gXG4gICAgICAgICAgICA6IGAke2Rpc3RhbmNlLmxhcmdlfSAke2Rpc3RhbmNlLm1lZGl1bX0gMGA7XG4gICAgfVxuICAgIHJldHVybiAhbGFiZWxTaG93biA/IGAke2Rpc3RhbmNlLm1lZGl1bX1gIDogYCR7ZGlzdGFuY2UubGFyZ2V9ICR7ZGlzdGFuY2UubWVkaXVtfSAke2Rpc3RhbmNlLnNtYWxsfWA7XG59XG5jb25zdCBTdHlsZWRUYWdzQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7Z2V0Q29udGFpbmVyUGFkZGluZ307XG4gIG1hcmdpbjogMDtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC13cmFwOiB3cmFwO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuYDtcbmludGVyZmFjZSBTdHlsZWRJbnB1dFByb3BzIHtcbiAgICB2YWx1ZTogc3RyaW5nO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgICB0aGVtZTogYW55O1xuICAgIHZhbGlkPzogYm9vbGVhbjtcbn1cbmNvbnN0IFN0eWxlZElucHV0ID0gc3R5bGVkKCdpbnB1dCcpPFN0eWxlZElucHV0UHJvcHM+IGBcbiAgJHtnZXRGb250U2l6ZSgnbWVkaXVtJyl9XG4gIGJveC1zaXppbmc6IGNvbnRlbnQtYm94O1xuICBib3gtc2hhZG93OiBub25lO1xuICBib3JkZXI6IG5vbmU7XG4gIGJvcmRlci1yYWRpdXM6IDA7XG4gIG1hcmdpbjogMDtcbiAgb3V0bGluZTogbm9uZTtcbiAgb3V0bGluZS1jb2xvcjogdHJhbnNwYXJlbnQgIWltcG9ydGFudDtcbiAgYmFja2dyb3VuZDogJHt0cmFuc3BhcmVudH07XG4gIHdpZHRoOiAke3Byb3BzID0+IChwcm9wcy52YWx1ZS5sZW5ndGggPiAyID8gcHJvcHMudmFsdWUubGVuZ3RoICogMTAgKyAncHgnIDogJzIwcHgnKX07XG4gIGNvbG9yOiAke3RoZW1lZCgoeyBkaXNhYmxlZCwgdGhlbWUsIHZhbGlkIH0pID0+ICh2YWxpZCA/IChkaXNhYmxlZCA/IHRoZW1lLnRleHREaXNhYmxlZCA6IGRhcmspIDogcHVycGxlUmVkKSl9O1xuICBjdXJzb3I6ICR7cHJvcHMgPT4gKHByb3BzLmRpc2FibGVkID8gJ25vdC1hbGxvd2VkJyA6ICdhdXRvJyl9O1xuICBmb250LWZhbWlseTogaW5oZXJpdDtcbmA7XG5jb25zdCBSZXN0eWxlZFRhZ0l0ZW0gPSBzdHlsZWQoU3R5bGVkVGFnSXRlbSkgYFxuICBtYXJnaW46IDAgJHtkaXN0YW5jZS5zbWFsbH0gJHtkaXN0YW5jZS5zbWFsbH0gMDtcbmA7XG5pbnRlcmZhY2UgSW5wdXRDb250YWluZXJQcm9wcyB7XG4gICAgdGFnUmVuZGVyZXI6IGJvb2xlYW47XG59XG5jb25zdCBJbnB1dENvbnRhaW5lciA9IHN0eWxlZCgnZGl2Jyk8SW5wdXRDb250YWluZXJQcm9wcz4gYFxuICBkaXNwbGF5OiBpbmxpbmU7XG4gIHBhZGRpbmctYm90dG9tOiAkeyh7IHRhZ1JlbmRlcmVyIH0pID0+ICghdGFnUmVuZGVyZXIgPyBgJHtkaXN0YW5jZS5zbWFsbH1gIDogJzAnKX07XG5gO1xuY29uc3QgU3R5bGVkVGV4dCA9IHN0eWxlZC5zcGFuIGBcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xuYDtcbmludGVyZmFjZSBDbG9zZUljb25Qcm9wcyB7XG4gICAgb25DbGljaz8oKTogdm9pZDtcbiAgICBvbk1vdXNlRG93bj8oZXZlbnQ6IFJlYWN0Lk1vdXNlRXZlbnQpOiB2b2lkO1xuICAgIHRoZW1lPzogUHJlY2lzZVRoZW1lO1xufVxuY29uc3QgQ2xvc2VJY29uID0gT2JqZWN0LmFzc2lnbigoKCh7IHRoZW1lLCBvbkNsaWNrLCBvbk1vdXNlRG93biB9KSA9PiAoPFN0eWxlZEljb24gdGhlbWU9e3RoZW1lfSBuYW1lPVwiQ2xvc2VcIiBvbkNsaWNrPXtvbkNsaWNrfSBvbk1vdXNlRG93bj17b25Nb3VzZURvd259Lz4pKSBhcyBSZWFjdC5TRkM8Q2xvc2VJY29uUHJvcHM+KSwgeyBpbm5lcjoge1xuICAgICAgICBnZXQgU3R5bGVkSWNvbigpIHsgcmV0dXJuIFN0eWxlZEljb24gYXMgdHlwZW9mIFN0eWxlZEljb247IH1cbiAgICB9IH0pO1xuZXhwb3J0IGludGVyZmFjZSBUYWdCdWlsZGVyU3RhdGUge1xuICAgIGlucHV0VmFsdWU6IHN0cmluZztcbiAgICB2YWx1ZTogQXJyYXk8c3RyaW5nPjtcbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgZm9jdXNlZDogYm9vbGVhbjtcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xuICAgIGlucHV0UG9zaXRpb24/OiBudW1iZXI7XG4gICAgdmFsaWQ/OiBib29sZWFuO1xufVxuZXhwb3J0IGNsYXNzIFRhZ0J1aWxkZXJJbnQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8VGFnQnVpbGRlclByb3BzICYgRm9ybUNvbnRleHRQcm9wcywgVGFnQnVpbGRlclN0YXRlPiB7XG4gICAgcHJpdmF0ZSBfaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBUYWdCdWlsZGVyUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB0YWdzID0gKHByb3BzLnZhbHVlIHx8IHByb3BzLmRlZmF1bHRWYWx1ZSB8fCBbXSkubWFwKGxvd2VyaXplKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiB0YWdzLFxuICAgICAgICAgICAgaW5wdXRWYWx1ZTogcHJvcHMuaW5wdXRWYWx1ZSB8fCAnJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLnZhbHVlICE9PSB1bmRlZmluZWQgfHwgcHJvcHMuaW5wdXRWYWx1ZSAhPT0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgZm9jdXNlZDogZmFsc2UsXG4gICAgICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyB2YWx1ZSwgaW5wdXRWYWx1ZSA9ICcnLCBlcnJvciB9OiBUYWdCdWlsZGVyUHJvcHMpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuY29udHJvbGxlZCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogWy4uLnZhbHVlXSxcbiAgICAgICAgICAgICAgICBpbnB1dFZhbHVlOiBpbnB1dFZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yIH0pO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnVuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgZmlyZUJlZm9yZVRhZ1JlbW92ZUV2ZW50KGluZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgeyBvbkJlZm9yZVRhZ1JlbW92ZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiBvbkJlZm9yZVRhZ1JlbW92ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25CZWZvcmVUYWdSZW1vdmUoaW5kZXgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgaW5wdXRDaGFuZ2VkID0gKGU6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25JbnB1dCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkLCB2YWx1ZTogcHJldlRhZ3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IGUuY3VycmVudFRhcmdldDtcbiAgICAgICAgaWYgKHR5cGVvZiBvbklucHV0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbklucHV0KHsgdmFsdWU6IHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlucHV0VmFsdWU6IHZhbHVlLCB2YWxpZDogdmFsdWUubGVuZ3RoID4gMCA/IHByZXZUYWdzLmluZGV4T2YodmFsdWUpID09PSAtMSA6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUga2V5RG93bkhhbmRsZXIgPSAoZTogUmVhY3QuS2V5Ym9hcmRFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgY29uc3QgeyBpbnB1dFZhbHVlLCBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IHNob3VsZEZpbmlzaFRhZyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgbGV0IGlzSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgICBjb25zdCBoYW5kbGVLZXlFdmVudCA9ICgpID0+IHtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBpc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoaW5wdXRWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5iYWNrc3BhY2U6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlUHJldlRhZygpO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVLZXlFdmVudCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLmRlbGV0ZTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVOZXh0VGFnKCk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUtleUV2ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghaXNIYW5kbGVkICYmICFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNob3VsZEZpbmlzaFRhZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGlmIChzaG91bGRGaW5pc2hUYWcoZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRUYWcoaW5wdXRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUtleUV2ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaW5pc2hUYWdLZXlzLmluZGV4T2YoZS5rZXlDb2RlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFRhZyhpbnB1dFZhbHVlKTtcbiAgICAgICAgICAgICAgICBoYW5kbGVLZXlFdmVudCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlucHV0VmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbmQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0TW92ZUVuZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlS2V5RXZlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLmhvbWU6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0TW92ZUhvbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUtleUV2ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5sZWZ0OlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnB1dE1vdmVMZWZ0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVLZXlFdmVudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMucmlnaHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlucHV0TW92ZVJpZ2h0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVLZXlFdmVudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIGlucHV0Rm9jdXNlZCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkZvY3VzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGZvY3VzZWQ6IHRydWUsXG4gICAgICAgIH0sIG9uRm9jdXMpO1xuICAgIH07XG4gICAgcHJpdmF0ZSBpbnB1dEJsdXJyZWQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25CbHVyLCBhcHBlbmRUYWdPbkJsdXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICghIWFwcGVuZFRhZ09uQmx1ciAmJiAhdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICBjb25zdCB7IGlucHV0VmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoaW5wdXRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkVGFnKGlucHV0VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZm9jdXNlZDogZmFsc2UsXG4gICAgICAgIH0sIG9uQmx1cik7XG4gICAgfTtcbiAgICBwcml2YXRlIGlucHV0TW92ZUxlZnQoKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaW5wdXRQb3NpdGlvbiA9IHZhbHVlLmxlbmd0aCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKGlucHV0UG9zaXRpb24gPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaW5wdXRQb3NpdGlvbjogaW5wdXRQb3NpdGlvbiAtIDEgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBpbnB1dE1vdmVSaWdodCgpIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgaW5wdXRQb3NpdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKGlucHV0UG9zaXRpb24gIT09IHVuZGVmaW5lZCAmJiBpbnB1dFBvc2l0aW9uIDwgdmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgaW5wdXRQb3NpdGlvbjogaW5wdXRQb3NpdGlvbiArIDEgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBpbnB1dE1vdmVFbmQoKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBpbnB1dFBvc2l0aW9uOiB2YWx1ZS5sZW5ndGggfSk7XG4gICAgfVxuICAgIHByaXZhdGUgaW5wdXRNb3ZlSG9tZSgpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlucHV0UG9zaXRpb246IDAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgc2V0Rm9jdXMgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2lucHV0ICYmIHRoaXMuX2lucHV0LmZvY3VzKCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGFkZFRhZyhpbnB1dFZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZTogcHJldlRhZ3MsIHZhbGlkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGlucHV0UG9zaXRpb24gPSBwcmV2VGFncy5sZW5ndGggfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlucHV0VmFsdWUgPSBpbnB1dFZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoaW5wdXRWYWx1ZS5sZW5ndGggPiAwICYmIHZhbGlkKSB7XG4gICAgICAgICAgICBjb25zdCB0YWdzID0gWy4uLnByZXZUYWdzXTtcbiAgICAgICAgICAgIHRhZ3Muc3BsaWNlKGlucHV0UG9zaXRpb24sIDAsIGlucHV0VmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlucHV0VmFsdWU6ICcnLCBpbnB1dFBvc2l0aW9uOiBpbnB1dFBvc2l0aW9uICsgMSB9LCAoKSA9PiB0aGlzLm9uQ2hhbmdlKHRhZ3MpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIHJlbW92ZVByZXZUYWcoKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWU6IHByZXZUYWdzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGlucHV0UG9zaXRpb24gPSBwcmV2VGFncy5sZW5ndGggfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmIChpbnB1dFBvc2l0aW9uID4gMCkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVUYWcoaW5wdXRQb3NpdGlvbiAtIDEpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlucHV0UG9zaXRpb246IGlucHV0UG9zaXRpb24gLSAxIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgcmVtb3ZlTmV4dFRhZygpIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZTogcHJldlRhZ3MsIGlucHV0UG9zaXRpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmIChpbnB1dFBvc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgaW5wdXRQb3NpdGlvbiA8IHByZXZUYWdzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVUYWcoaW5wdXRQb3NpdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSByZW1vdmVUYWcoaW5kZXg6IG51bWJlcikge1xuICAgICAgICBjb25zdCB7IHZhbHVlOiBwcmV2VGFncyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgdGhpcy5maXJlQmVmb3JlVGFnUmVtb3ZlRXZlbnQoaW5kZXgpO1xuICAgICAgICBjb25zdCB0YWdzID0gWy4uLnByZXZUYWdzLnNsaWNlKDAsIGluZGV4KSwgLi4ucHJldlRhZ3Muc2xpY2UoaW5kZXggKyAxKV07XG4gICAgICAgIHRoaXMub25DaGFuZ2UodGFncyk7XG4gICAgfVxuICAgIHByaXZhdGUgb25DaGFuZ2UodmFsdWU6IEFycmF5PHN0cmluZz4pIHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgbmFtZSA9ICcnLCBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuY29udHJvbGxlZCkge1xuICAgICAgICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICBmb3JtLmNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgcmVtb3ZlVGFnTW91c2VEb3duSGFuZGxlciA9IChldmVudDogUmVhY3QuTW91c2VFdmVudCkgPT4ge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH07XG4gICAgcHJpdmF0ZSByZW5kZXJUYWcgPSAoZTogVGFnQnVpbGRlclJlbmRlckV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgdGhlbWUsIGRpc2FibGVkIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gKDxSZXN0eWxlZFRhZ0l0ZW0gdGhlbWU9e3RoZW1lfSBrZXk9e2UuaXRlbSArIGUuaW5kZXh9PlxuICAgICAgICA8U3R5bGVkVGV4dD57ZS5pdGVtfTwvU3R5bGVkVGV4dD5cbiAgICAgICAgeyFkaXNhYmxlZCAmJiAoPENsb3NlSWNvbiB0aGVtZT17dGhlbWV9IG9uTW91c2VEb3duPXt0aGlzLnJlbW92ZVRhZ01vdXNlRG93bkhhbmRsZXJ9IG9uQ2xpY2s9eygpID0+IHRoaXMucmVtb3ZlVGFnKGUuaW5kZXgpfS8+KX1cbiAgICAgIDwvUmVzdHlsZWRUYWdJdGVtPik7XG4gICAgfTtcbiAgICBwcml2YXRlIHNldENvbnRhaW5lciA9IChub2RlOiBIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCkgPT4ge1xuICAgICAgICB0aGlzLl9pbnB1dCA9IG5vZGU7XG4gICAgICAgIGNvbnN0IHsgaW5wdXRSZWYgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0eXBlb2YgaW5wdXRSZWYgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGlucHV0UmVmKG5vZGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgdGFnUmVuZGVyZXIsIGluZm8sIGRpc2FibGVkLCBib3JkZXJsZXNzLCB0aGVtZSwgbGFiZWwsIHBsYWNlaG9sZGVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBpbnB1dFZhbHVlLCBmb2N1c2VkLCB2YWxpZCwgZXJyb3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaW5wdXRQb3NpdGlvbiA9IHZhbHVlLmxlbmd0aCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgYm9yZGVyID0gZ2V0VGV4dEZpZWxkQm9yZGVyVHlwZShib3JkZXJsZXNzLCAhIWVycm9yLCBmb2N1c2VkKTtcbiAgICAgICAgY29uc3QgcmVuZGVyZXIgPSB0YWdSZW5kZXJlciB8fCB0aGlzLnJlbmRlclRhZztcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB2YWx1ZS5tYXAoKGl0ZW0sIGluZGV4KSA9PiByZW5kZXJlcih7IGl0ZW0sIGluZGV4LCB0YWdzOiB2YWx1ZSB9KSk7XG4gICAgICAgIGNvbnN0IGhhc1ZhbHVlID0gISFpbnB1dFZhbHVlIHx8IHZhbHVlLmxlbmd0aCA+IDA7XG4gICAgICAgIGNoaWxkcmVuLnNwbGljZShpbnB1dFBvc2l0aW9uLCAwLCA8SW5wdXRDb250YWluZXIga2V5PVwiaW5wdXRcIiBvbktleURvd249e3RoaXMua2V5RG93bkhhbmRsZXJ9IHRhZ1JlbmRlcmVyPXshIXRhZ1JlbmRlcmVyfT5cbiAgICAgICAgPFN0eWxlZElucHV0IHRoZW1lPXt0aGVtZX0gZGlzYWJsZWQ9e2Rpc2FibGVkfSByZWY9e3RoaXMuc2V0Q29udGFpbmVyfSB0eXBlPVwidGV4dFwiIHZhbHVlPXtpbnB1dFZhbHVlfSBvbkNoYW5nZT17dGhpcy5pbnB1dENoYW5nZWR9IG9uRm9jdXM9e3RoaXMuaW5wdXRGb2N1c2VkfSBvbkJsdXI9e3RoaXMuaW5wdXRCbHVycmVkfSB2YWxpZD17dmFsaWR9Lz5cbiAgICAgIDwvSW5wdXRDb250YWluZXI+KTtcbiAgICAgICAgcmV0dXJuICg8VGFnQnVpbGRlckNvbnRhaW5lcj5cbiAgICAgICAgPFN0eWxlZElucHV0Qm94IGJvcmRlcj17Ym9yZGVyfSBkaXNhYmxlZD17ZGlzYWJsZWR9IGZvY3VzZWQ9e2ZvY3VzZWR9IGhhc1ZhbHVlPXtoYXNWYWx1ZX0+XG4gICAgICAgICAgPFN0eWxlZElucHV0Um93IG9uQ2xpY2s9e3RoaXMuc2V0Rm9jdXN9IGxhYmVsPXtsYWJlbH0gaGFzVmFsdWU9e2hhc1ZhbHVlfSBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9IGVycm9yPXshIWVycm9yfSBmb2N1c2VkPXtmb2N1c2VkfT5cbiAgICAgICAgICAgIDxTdHlsZWRUYWdzQ29udGFpbmVyIGxhYmVsU2hvd249eyEhbGFiZWx9IHRhZ1JlbmRlcmVyPXshIXRhZ1JlbmRlcmVyfT5cbiAgICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgICAgPC9TdHlsZWRUYWdzQ29udGFpbmVyPlxuICAgICAgICAgIDwvU3R5bGVkSW5wdXRSb3c+XG4gICAgICAgICAgPElucHV0SWNvbiBkaXNhYmxlZD17ZGlzYWJsZWR9IHRoZW1lPXt0aGVtZX0gZXJyb3I9e2Vycm9yfSBoYXNWYWx1ZT17aGFzVmFsdWV9Lz5cbiAgICAgICAgPC9TdHlsZWRJbnB1dEJveD5cbiAgICAgICAge3Nob3dJbnB1dEluZm8oZXJyb3IsIGluZm8pfVxuICAgICAgPC9UYWdCdWlsZGVyQ29udGFpbmVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFJlc3R5bGVkVGFnSXRlbSgpIHsgcmV0dXJuIFJlc3R5bGVkVGFnSXRlbSBhcyB0eXBlb2YgUmVzdHlsZWRUYWdJdGVtOyB9LFxuICAgICAgICBnZXQgU3R5bGVkVGV4dCgpIHsgcmV0dXJuIFN0eWxlZFRleHQgYXMgdHlwZW9mIFN0eWxlZFRleHQ7IH0sXG4gICAgICAgIGdldCBDbG9zZUljb24oKSB7IHJldHVybiBDbG9zZUljb24gYXMgdHlwZW9mIENsb3NlSWNvbjsgfSxcbiAgICAgICAgZ2V0IElucHV0Q29udGFpbmVyKCkgeyByZXR1cm4gSW5wdXRDb250YWluZXIgYXMgdHlwZW9mIElucHV0Q29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgU3R5bGVkSW5wdXQoKSB7IHJldHVybiBTdHlsZWRJbnB1dCBhcyB0eXBlb2YgU3R5bGVkSW5wdXQ7IH0sXG4gICAgICAgIGdldCBUYWdCdWlsZGVyQ29udGFpbmVyKCkgeyByZXR1cm4gVGFnQnVpbGRlckNvbnRhaW5lciBhcyB0eXBlb2YgVGFnQnVpbGRlckNvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZElucHV0Qm94KCkgeyByZXR1cm4gU3R5bGVkSW5wdXRCb3ggYXMgdHlwZW9mIFN0eWxlZElucHV0Qm94OyB9LFxuICAgICAgICBnZXQgU3R5bGVkSW5wdXRSb3coKSB7IHJldHVybiBTdHlsZWRJbnB1dFJvdyBhcyB0eXBlb2YgU3R5bGVkSW5wdXRSb3c7IH0sXG4gICAgICAgIGdldCBTdHlsZWRUYWdzQ29udGFpbmVyKCkgeyByZXR1cm4gU3R5bGVkVGFnc0NvbnRhaW5lciBhcyB0eXBlb2YgU3R5bGVkVGFnc0NvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IElucHV0SWNvbigpIHsgcmV0dXJuIElucHV0SWNvbiBhcyB0eXBlb2YgSW5wdXRJY29uOyB9XG4gICAgfTtcbn1cbmV4cG9ydCBjb25zdCBUYWdCdWlsZGVyID0gd2l0aEZvcm1Db250ZXh0KFRhZ0J1aWxkZXJJbnQpO1xuVGFnQnVpbGRlci5kaXNwbGF5TmFtZSA9ICdUYWdCdWlsZGVyJztcbiJdfQ==