"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var Slider_1 = require("../Slider");
var IndicatorKnob_1 = require("../IndicatorKnob");
var InteractiveSurface_1 = require("../InteractiveSurface");
var colors_1 = require("../../utils/colors");
var withFormContext_1 = require("../../hoc/withFormContext");
var distance_1 = require("../../distance");
var PaddedContainer_1 = require("../PaddedContainer");
var InputNotification_1 = require("../InputNotification");
function rgb(c) {
    return "rgb(" + c.r + ", " + c.g + ", " + c.b + ")";
}
function computeColor(color) {
    var fc = color;
    if (typeof color === 'string') {
        color = colors_1.parseColor(color);
    }
    else if (typeof fc.h === 'number') {
        return {
            hsv: fc,
            color: color,
            base: colors_1.hsvToRgb(fc.h, 1, 1),
        };
    }
    else {
        color = {
            r: color.r,
            g: color.g,
            b: color.b,
            a: color.a,
        };
    }
    var hsv = colors_1.rgbToHsv(color.r, color.g, color.b, color.a);
    return {
        hsv: hsv,
        color: color,
        base: colors_1.hsvToRgb(hsv.h, 1, 1),
    };
}
var PickerContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  margin: ", ";\n"], ["\n  margin: ", ";\n"])), distance_1.distance.small);
var PickerSurface = styled_1.default(InteractiveSurface_1.InteractiveSurface)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  width: ", ";\n  height: ", ";\n  position: relative;\n  background-color: ", ";\n"], ["\n  width: ", ";\n  height: ", ";\n  position: relative;\n  background-color: ", ";\n"])), function (props) { return props.width; }, function (props) { return props.height; }, function (props) { return props.color; });
var PickerSaturation = styled_1.default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: linear-gradient(to bottom, transparent 0%, black 100%);\n"], ["\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: linear-gradient(to bottom, transparent 0%, black 100%);\n"])));
var PickerValue = styled_1.default.div(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: linear-gradient(to right, white 0%, transparent 100%);\n"], ["\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  background: linear-gradient(to right, white 0%, transparent 100%);\n"])));
var ColorSlider = styled_1.default(Slider_1.Slider)(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  margin: ", " 0 -", " 0;\n  background: linear-gradient(\n    to left,\n    red 0,\n    #f09 10%,\n    #cd00ff 20%,\n    #3200ff 30%,\n    #06f 40%,\n    #00fffd 50%,\n    #0f6 60%,\n    #35ff00 70%,\n    #cdff00 80%,\n    #f90 90%,\n    red 100%\n  );\n"], ["\n  margin: ", " 0 -", " 0;\n  background: linear-gradient(\n    to left,\n    red 0,\n    #f09 10%,\n    #cd00ff 20%,\n    #3200ff 30%,\n    #06f 40%,\n    #00fffd 50%,\n    #0f6 60%,\n    #35ff00 70%,\n    #cdff00 80%,\n    #f90 90%,\n    red 100%\n  );\n"])), distance_1.distance.large, distance_1.distance.xsmall);
var OpacitySlider = styled_1.default(Slider_1.Slider)(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  margin: ", " 0 -", " 0;\n  background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAJUlEQVQYV2N89erVfwY0ICYmxoguxjgUFKI7GsTH5m4M3w1ChQC1/Ca8i2n1WgAAAABJRU5ErkJggg==');\n  &:before {\n    background: linear-gradient(to right, transparent 0px, rgba(0, 117, 120, 0.357) 100%);\n    border-radius: 10px;\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    content: '';\n  }\n"], ["\n  margin: ", " 0 -", " 0;\n  background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAJUlEQVQYV2N89erVfwY0ICYmxoguxjgUFKI7GsTH5m4M3w1ChQC1/Ca8i2n1WgAAAABJRU5ErkJggg==');\n  &:before {\n    background: linear-gradient(to right, transparent 0px, rgba(0, 117, 120, 0.357) 100%);\n    border-radius: 10px;\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    content: '';\n  }\n"])), distance_1.distance.large, distance_1.distance.xsmall);
var ColorIndicator = styled_1.default(IndicatorKnob_1.IndicatorKnob)(templateObject_7 || (templateObject_7 = __makeTemplateObject(["\n  box-shadow: 0 0 20px -5px ", ";\n  border: 2px solid ", ";\n"], ["\n  box-shadow: 0 0 20px -5px ", ";\n  border: 2px solid ", ";\n"])), function (props) { return (props.disabled ? 'transparent' : '#000'); }, function (props) { return (props.disabled ? '#ccc' : props.active ? '#eee' : '#fff'); });
var ColorPickerInt = /** @class */ (function (_super) {
    __extends(ColorPickerInt, _super);
    function ColorPickerInt(props) {
        var _this = _super.call(this, props) || this;
        _this.changeColor = function (e) {
            var s = e.x;
            var v = 1 - e.y;
            var notify = _this.props.onChange;
            var current = _this.state.value;
            var rgb = colors_1.hsvToRgb(current.h, s, v, current.a);
            var selected = __assign({}, current, { s: s, v: v }, rgb);
            if (!_this.state.controlled) {
                _this.changeTo({
                    value: selected,
                });
            }
            _this.setState({
                active: e.active,
            });
            if (typeof notify === 'function') {
                notify({
                    value: selected,
                });
            }
        };
        _this.changeBackground = function (e) {
            var h = e.value;
            var notify = _this.props.onChange;
            var current = _this.state.value;
            var rgb = colors_1.hsvToRgb(h, current.s, current.v, current.a);
            var selected = __assign({}, current, { h: h, s: current.s, v: current.v }, rgb);
            if (!_this.state.controlled) {
                var base = colors_1.hsvToRgb(h, 1, 1);
                _this.changeTo({
                    base: base,
                    value: selected,
                });
            }
            if (typeof notify === 'function') {
                notify({
                    value: selected,
                });
            }
        };
        _this.changeOpacity = function (e) {
            var alpha = e.value;
            var notify = _this.props.onChange;
            var current = _this.state.value;
            var selected = __assign({}, current, { a: alpha });
            if (!_this.state.controlled) {
                _this.changeTo({
                    value: selected,
                });
            }
            if (typeof notify === 'function') {
                notify({
                    value: selected,
                });
            }
        };
        var _a = computeColor(props.value || props.defaultValue || { r: 0, g: 0, b: 0 }), hsv = _a.hsv, color = _a.color, base = _a.base;
        _this.state = {
            controlled: props.value !== undefined,
            active: false,
            value: __assign({ a: 1 }, color, { h: hsv.h, s: hsv.s, v: hsv.v }),
            base: base,
            error: props.error,
        };
        return _this;
    }
    ColorPickerInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var value = _a.value, error = _a.error;
        if (value && value !== this.state.value) {
            var _b = computeColor(value || this.state.value), hsv = _b.hsv, color = _b.color, base = _b.base;
            this.setState({
                value: __assign({ a: 1 }, color, { h: hsv.h, s: hsv.s, v: hsv.v }),
                base: base,
            });
        }
        this.setState({ error: error });
    };
    ColorPickerInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    ColorPickerInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    ColorPickerInt.prototype.changeTo = function (state) {
        var _a = this.props, form = _a.form, _b = _a.name, name = _b === void 0 ? '' : _b;
        if (form) {
            form.change({
                name: name,
                value: state.value,
            });
        }
        else {
            this.setState(state);
        }
    };
    ColorPickerInt.prototype.render = function () {
        var _a = this.state, value = _a.value, active = _a.active, base = _a.base, error = _a.error;
        var _b = this.props, _0 = _b.defaultValue, _1 = _b.value, _2 = _b.onChange, _3 = _b.onInput, allowOpacity = _b.allowOpacity, hideBar = _b.hideBar, _c = _b.width, width = _c === void 0 ? '100%' : _c, _d = _b.height, height = _d === void 0 ? '200px' : _d, info = _b.info, props = __rest(_b, ["defaultValue", "value", "onChange", "onInput", "allowOpacity", "hideBar", "width", "height", "info"]);
        var baseRgb = rgb(base);
        var currentRgb = rgb(value);
        var surface = {
            color: baseRgb,
            width: width,
            height: height,
        };
        return (React.createElement(PickerContainer, __assign({}, props),
            React.createElement(PickerSurface, __assign({}, surface, { onChange: this.changeColor }),
                React.createElement(PickerValue, null),
                React.createElement(PickerSaturation, null),
                React.createElement(ColorIndicator, { x: value.s, y: 1 - value.v, color: currentRgb, active: active })),
            !hideBar && React.createElement(ColorSlider, { onChange: this.changeBackground, value: value.h, color: baseRgb }),
            allowOpacity && React.createElement(OpacitySlider, { onChange: this.changeOpacity, value: value.a }),
            (error || info) && (React.createElement(PaddedContainer_1.PaddedContainer, { top: "small", bottom: "xsmall" },
                React.createElement(InputNotification_1.InputNotification, { error: error, info: info })))));
    };
    ColorPickerInt.inner = {
        get PickerContainer() { return PickerContainer; },
        get PickerSurface() { return PickerSurface; },
        get PickerValue() { return PickerValue; },
        get PickerSaturation() { return PickerSaturation; },
        get ColorIndicator() { return ColorIndicator; },
        get ColorSlider() { return ColorSlider; },
        get OpacitySlider() { return OpacitySlider; },
        get PaddedContainer() { return PaddedContainer_1.PaddedContainer; },
        get InputNotification() { return InputNotification_1.InputNotification; }
    };
    return ColorPickerInt;
}(React.PureComponent));
/**
 * A color picker for selecting a color in the UI.
 */
exports.ColorPicker = withFormContext_1.withFormContext(ColorPickerInt);
exports.ColorPicker.displayName = 'ColorPicker';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Db2xvclBpY2tlci9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkJBQStCO0FBQy9CLDZDQUF3QztBQUV4QyxvQ0FBc0Q7QUFDdEQsa0RBQWlEO0FBQ2pELDREQUEwRjtBQUMxRiw2Q0FBb0U7QUFDcEUsNkRBQThFO0FBRTlFLDJDQUEwQztBQUMxQyxzREFBcUQ7QUFDckQsMERBQXlEO0FBbUV6RCxTQUFTLEdBQUcsQ0FBQyxDQUFZO0lBQ3JCLE9BQU8sU0FBTyxDQUFDLENBQUMsQ0FBQyxVQUFLLENBQUMsQ0FBQyxDQUFDLFVBQUssQ0FBQyxDQUFDLENBQUMsTUFBRyxDQUFDO0FBQ3pDLENBQUM7QUFDRCxTQUFTLFlBQVksQ0FBQyxLQUFxQztJQUN2RCxJQUFNLEVBQUUsR0FBRyxLQUFrQixDQUFDO0lBQzlCLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1FBQzNCLEtBQUssR0FBRyxtQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQzdCO1NBQ0ksSUFBSSxPQUFPLEVBQUUsQ0FBQyxDQUFDLEtBQUssUUFBUSxFQUFFO1FBQy9CLE9BQU87WUFDSCxHQUFHLEVBQUUsRUFBRTtZQUNQLEtBQUssT0FBQTtZQUNMLElBQUksRUFBRSxpQkFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUM3QixDQUFDO0tBQ0w7U0FDSTtRQUNELEtBQUssR0FBRztZQUNKLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNWLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNWLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNWLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNiLENBQUM7S0FDTDtJQUNELElBQU0s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aW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgSW5wdXRQcm9wcyB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5pbXBvcnQgeyBTbGlkZXIsIFNsaWRlckNoYW5nZUV2ZW50IH0gZnJvbSAnLi4vU2xpZGVyJztcbmltcG9ydCB7IEluZGljYXRvcktub2IgfSBmcm9tICcuLi9JbmRpY2F0b3JLbm9iJztcbmltcG9ydCB7IEludGVyYWN0aXZlU3VyZmFjZSwgSW50ZXJhY3RpdmVTdXJmYWNlQ2hhbmdlRXZlbnQgfSBmcm9tICcuLi9JbnRlcmFjdGl2ZVN1cmZhY2UnO1xuaW1wb3J0IHsgcmdiVG9Ic3YsIGhzdlRvUmdiLCBwYXJzZUNvbG9yIH0gZnJvbSAnLi4vLi4vdXRpbHMvY29sb3JzJztcbmltcG9ydCB7IHdpdGhGb3JtQ29udGV4dCwgRm9ybUNvbnRleHRQcm9wcyB9IGZyb20gJy4uLy4uL2hvYy93aXRoRm9ybUNvbnRleHQnO1xuaW1wb3J0IHsgc2hvd0lucHV0SW5mbyB9IGZyb20gJy4uLy4uL3V0aWxzL2lucHV0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgUGFkZGVkQ29udGFpbmVyIH0gZnJvbSAnLi4vUGFkZGVkQ29udGFpbmVyJztcbmltcG9ydCB7IElucHV0Tm90aWZpY2F0aW9uIH0gZnJvbSAnLi4vSW5wdXROb3RpZmljYXRpb24nO1xuZXhwb3J0IGludGVyZmFjZSBDb2xvckNoYW5nZUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBzZWxlY3RlZCBjb2xvci5cbiAgICAgKi9cbiAgICB2YWx1ZTogRnVsbENvbG9yO1xufVxuZXhwb3J0IGludGVyZmFjZSBGdWxsQ29sb3Ige1xuICAgIGg6IG51bWJlcjtcbiAgICBzOiBudW1iZXI7XG4gICAgdjogbnVtYmVyO1xuICAgIHI6IG51bWJlcjtcbiAgICBnOiBudW1iZXI7XG4gICAgYjogbnVtYmVyO1xuICAgIGE6IG51bWJlcjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUmdiYUNvbG9yIHtcbiAgICAvKipcbiAgICAgKiBUaGUgcmVkIHBhcnQgb2YgdGhlIGNvbG9yLlxuICAgICAqL1xuICAgIHI6IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBUaGUgZ3JlZW4gcGFydCBvZiB0aGUgY29sb3IuXG4gICAgICovXG4gICAgZzogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIFRoZSBibHVlIHBhcnQgb2YgdGhlIGNvbG9yLlxuICAgICAqL1xuICAgIGI6IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBUaGUgb3B0aW9uYWwgYWxwaGEgcGFydCBvZiB0aGUgY29sb3IgLSBieSBkZWZhdWx0IDEuXG4gICAgICovXG4gICAgYT86IG51bWJlcjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgQ29sb3JQaWNrZXJQcm9wcyBleHRlbmRzIElucHV0UHJvcHM8RnVsbENvbG9yIHwgUmdiYUNvbG9yIHwgc3RyaW5nPiB7XG4gICAgLyoqXG4gICAgICogU2V0cyBpZiB0aGUgY29sb3Igd2hlZWwgYmFyIHNob3VsZCBiZSBoaWRkZW4uXG4gICAgICovXG4gICAgaGlkZUJhcj86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogU2V0cyBpZiB0aGUgdHJhbnNwYXJlbmN5IGNhbiBiZSBjaGFuZ2VkLlxuICAgICAqL1xuICAgIGFsbG93T3BhY2l0eT86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRW1pdHRlZCBvbmNlIGNvbG9yIGNoYW5nZWQuXG4gICAgICovXG4gICAgb25DaGFuZ2U/KGU6IENvbG9yQ2hhbmdlRXZlbnQpOiB2b2lkO1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGhlaWdodCBvZiB0aGUgcGlja2VyIGFyZWEsIHVzdWFsbHkgMjAwcHguXG4gICAgICovXG4gICAgaGVpZ2h0Pzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHdpZHRoIG9mIHRoZSBwaWNrZXIgYXJlYSwgdXN1YWxseSAxMDAlLlxuICAgICAqL1xuICAgIHdpZHRoPzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBjaGlsZHJlbj86IHZvaWQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIENvbG9yUGlja2VyU3RhdGUge1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG4gICAgdmFsdWU6IEZ1bGxDb2xvcjtcbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgYmFzZTogUmdiYUNvbG9yO1xuICAgIGFjdGl2ZTogYm9vbGVhbjtcbn1cbmZ1bmN0aW9uIHJnYihjOiBSZ2JhQ29sb3IpIHtcbiAgICByZXR1cm4gYHJnYigke2Mucn0sICR7Yy5nfSwgJHtjLmJ9KWA7XG59XG5mdW5jdGlvbiBjb21wdXRlQ29sb3IoY29sb3I6IEZ1bGxDb2xvciB8IFJnYmFDb2xvciB8IHN0cmluZykge1xuICAgIGNvbnN0IGZjID0gY29sb3IgYXMgRnVsbENvbG9yO1xuICAgIGlmICh0eXBlb2YgY29sb3IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGNvbG9yID0gcGFyc2VDb2xvcihjb2xvcik7XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBmYy5oID09PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaHN2OiBmYyxcbiAgICAgICAgICAgIGNvbG9yLFxuICAgICAgICAgICAgYmFzZTogaHN2VG9SZ2IoZmMuaCwgMSwgMSksXG4gICAgICAgIH07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb2xvciA9IHtcbiAgICAgICAgICAgIHI6IGNvbG9yLnIsXG4gICAgICAgICAgICBnOiBjb2xvci5nLFxuICAgICAgICAgICAgYjogY29sb3IuYixcbiAgICAgICAgICAgIGE6IGNvbG9yLmEsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IGhzdiA9IHJnYlRvSHN2KGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIsIGNvbG9yLmEpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGhzdixcbiAgICAgICAgY29sb3IsXG4gICAgICAgIGJhc2U6IGhzdlRvUmdiKGhzdi5oLCAxLCAxKSxcbiAgICB9O1xufVxuY29uc3QgUGlja2VyQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIG1hcmdpbjogJHtkaXN0YW5jZS5zbWFsbH07XG5gO1xuaW50ZXJmYWNlIFBpY2tlclN1cmZhY2VQcm9wcyB7XG4gICAgY29sb3I6IHN0cmluZztcbiAgICB3aWR0aDogc3RyaW5nO1xuICAgIGhlaWdodDogc3RyaW5nO1xufVxuY29uc3QgUGlja2VyU3VyZmFjZSA9IHN0eWxlZChJbnRlcmFjdGl2ZVN1cmZhY2UpPFBpY2tlclN1cmZhY2VQcm9wcz4gYFxuICB3aWR0aDogJHtwcm9wcyA9PiBwcm9wcy53aWR0aH07XG4gIGhlaWdodDogJHtwcm9wcyA9PiBwcm9wcy5oZWlnaHR9O1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMuY29sb3J9O1xuYDtcbmNvbnN0IFBpY2tlclNhdHVyYXRpb24gPSBzdHlsZWQuZGl2IGBcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBsZWZ0OiAwO1xuICByaWdodDogMDtcbiAgdG9wOiAwO1xuICBib3R0b206IDA7XG4gIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20sIHRyYW5zcGFyZW50IDAlLCBibGFjayAxMDAlKTtcbmA7XG5jb25zdCBQaWNrZXJWYWx1ZSA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGxlZnQ6IDA7XG4gIHJpZ2h0OiAwO1xuICB0b3A6IDA7XG4gIGJvdHRvbTogMDtcbiAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCB3aGl0ZSAwJSwgdHJhbnNwYXJlbnQgMTAwJSk7XG5gO1xuY29uc3QgQ29sb3JTbGlkZXIgPSBzdHlsZWQoU2xpZGVyKSBgXG4gIG1hcmdpbjogJHtkaXN0YW5jZS5sYXJnZX0gMCAtJHtkaXN0YW5jZS54c21hbGx9IDA7XG4gIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudChcbiAgICB0byBsZWZ0LFxuICAgIHJlZCAwLFxuICAgICNmMDkgMTAlLFxuICAgICNjZDAwZmYgMjAlLFxuICAgICMzMjAwZmYgMzAlLFxuICAgICMwNmYgNDAlLFxuICAgICMwMGZmZmQgNTAlLFxuICAgICMwZjYgNjAlLFxuICAgICMzNWZmMDAgNzAlLFxuICAgICNjZGZmMDAgODAlLFxuICAgICNmOTAgOTAlLFxuICAgIHJlZCAxMDAlXG4gICk7XG5gO1xuY29uc3QgT3BhY2l0eVNsaWRlciA9IHN0eWxlZChTbGlkZXIpIGBcbiAgbWFyZ2luOiAke2Rpc3RhbmNlLmxhcmdlfSAwIC0ke2Rpc3RhbmNlLnhzbWFsbH0gMDtcbiAgYmFja2dyb3VuZDogdXJsKCdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUFvQUFBQUtDQVlBQUFDTk1zKzlBQUFBSlVsRVFWUVlWMk44OWVyVmZ3WTBJQ1lteG9ndXhqZ1VGS0k3R3NUSDVtNE0zdzFDaFFDMS9DYThpMm4xV2dBQUFBQkpSVTVFcmtKZ2dnPT0nKTtcbiAgJjpiZWZvcmUge1xuICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byByaWdodCwgdHJhbnNwYXJlbnQgMHB4LCByZ2JhKDAsIDExNywgMTIwLCAwLjM1NykgMTAwJSk7XG4gICAgYm9yZGVyLXJhZGl1czogMTBweDtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgbGVmdDogMDtcbiAgICByaWdodDogMDtcbiAgICB0b3A6IDA7XG4gICAgYm90dG9tOiAwO1xuICAgIGNvbnRlbnQ6ICcnO1xuICB9XG5gO1xuaW50ZXJmYWNlIENvbG9ySW5kaWNhdG9yUHJvcHMge1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgICBhY3RpdmU6IGJvb2xlYW47XG59XG5jb25zdCBDb2xvckluZGljYXRvciA9IHN0eWxlZChJbmRpY2F0b3JLbm9iKTxDb2xvckluZGljYXRvclByb3BzPiBgXG4gIGJveC1zaGFkb3c6IDAgMCAyMHB4IC01cHggJHtwcm9wcyA9PiAocHJvcHMuZGlzYWJsZWQgPyAndHJhbnNwYXJlbnQnIDogJyMwMDAnKX07XG4gIGJvcmRlcjogMnB4IHNvbGlkICR7cHJvcHMgPT4gKHByb3BzLmRpc2FibGVkID8gJyNjY2MnIDogcHJvcHMuYWN0aXZlID8gJyNlZWUnIDogJyNmZmYnKX07XG5gO1xuY2xhc3MgQ29sb3JQaWNrZXJJbnQgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PENvbG9yUGlja2VyUHJvcHMgJiBGb3JtQ29udGV4dFByb3BzLCBDb2xvclBpY2tlclN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IENvbG9yUGlja2VyUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB7IGhzdiwgY29sb3IsIGJhc2UgfSA9IGNvbXB1dGVDb2xvcihwcm9wcy52YWx1ZSB8fCBwcm9wcy5kZWZhdWx0VmFsdWUgfHwgeyByOiAwLCBnOiAwLCBiOiAwIH0pO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgY29udHJvbGxlZDogcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGFjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgIGE6IDEsXG4gICAgICAgICAgICAgICAgLi4uY29sb3IsXG4gICAgICAgICAgICAgICAgaDogaHN2LmgsXG4gICAgICAgICAgICAgICAgczogaHN2LnMsXG4gICAgICAgICAgICAgICAgdjogaHN2LnYsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmFzZSxcbiAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyB2YWx1ZSwgZXJyb3IgfTogQ29sb3JQaWNrZXJQcm9wcykge1xuICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUgIT09IHRoaXMuc3RhdGUudmFsdWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaHN2LCBjb2xvciwgYmFzZSB9ID0gY29tcHV0ZUNvbG9yKHZhbHVlIHx8IHRoaXMuc3RhdGUudmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgYTogMSxcbiAgICAgICAgICAgICAgICAgICAgLi4uY29sb3IsXG4gICAgICAgICAgICAgICAgICAgIGg6IGhzdi5oLFxuICAgICAgICAgICAgICAgICAgICBzOiBoc3YucyxcbiAgICAgICAgICAgICAgICAgICAgdjogaHN2LnYsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBiYXNlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yIH0pO1xuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghY29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnVuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgY2hhbmdlVG88SyBleHRlbmRzIGtleW9mIENvbG9yUGlja2VyU3RhdGU+KHN0YXRlOiBQaWNrPENvbG9yUGlja2VyU3RhdGUsIEs+KSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSwgbmFtZSA9ICcnIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChzdGF0ZSBhcyBQaWNrPENvbG9yUGlja2VyU3RhdGUsICd2YWx1ZSc+KS52YWx1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBjaGFuZ2VDb2xvciA9IChlOiBJbnRlcmFjdGl2ZVN1cmZhY2VDaGFuZ2VFdmVudCkgPT4ge1xuICAgICAgICBjb25zdCBzID0gZS54O1xuICAgICAgICBjb25zdCB2ID0gMSAtIGUueTtcbiAgICAgICAgY29uc3Qgbm90aWZ5ID0gdGhpcy5wcm9wcy5vbkNoYW5nZTtcbiAgICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuc3RhdGUudmFsdWU7XG4gICAgICAgIGNvbnN0IHJnYiA9IGhzdlRvUmdiKGN1cnJlbnQuaCwgcywgdiwgY3VycmVudC5hKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB7XG4gICAgICAgICAgICAuLi5jdXJyZW50LFxuICAgICAgICAgICAgczogcyxcbiAgICAgICAgICAgIHY6IHYsXG4gICAgICAgICAgICAuLi5yZ2IsXG4gICAgICAgIH07XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZVRvKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGFjdGl2ZTogZS5hY3RpdmUsXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodHlwZW9mIG5vdGlmeSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgbm90aWZ5KHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBjaGFuZ2VCYWNrZ3JvdW5kID0gKGU6IFNsaWRlckNoYW5nZUV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGggPSBlLnZhbHVlO1xuICAgICAgICBjb25zdCBub3RpZnkgPSB0aGlzLnByb3BzLm9uQ2hhbmdlO1xuICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICAgICAgY29uc3QgcmdiID0gaHN2VG9SZ2IoaCwgY3VycmVudC5zLCBjdXJyZW50LnYsIGN1cnJlbnQuYSk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkID0ge1xuICAgICAgICAgICAgLi4uY3VycmVudCxcbiAgICAgICAgICAgIGgsXG4gICAgICAgICAgICBzOiBjdXJyZW50LnMsXG4gICAgICAgICAgICB2OiBjdXJyZW50LnYsXG4gICAgICAgICAgICAuLi5yZ2IsXG4gICAgICAgIH07XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICBjb25zdCBiYXNlID0gaHN2VG9SZ2IoaCwgMSwgMSk7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZVRvKHtcbiAgICAgICAgICAgICAgICBiYXNlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBzZWxlY3RlZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygbm90aWZ5ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBub3RpZnkoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBzZWxlY3RlZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIGNoYW5nZU9wYWNpdHkgPSAoZTogU2xpZGVyQ2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgYWxwaGEgPSBlLnZhbHVlO1xuICAgICAgICBjb25zdCBub3RpZnkgPSB0aGlzLnByb3BzLm9uQ2hhbmdlO1xuICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5zdGF0ZS52YWx1ZTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSB7XG4gICAgICAgICAgICAuLi5jdXJyZW50LFxuICAgICAgICAgICAgYTogYWxwaGEsXG4gICAgICAgIH07XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLmNoYW5nZVRvKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG5vdGlmeSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgbm90aWZ5KHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogc2VsZWN0ZWQsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBhY3RpdmUsIGJhc2UsIGVycm9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGRlZmF1bHRWYWx1ZTogXzAsIHZhbHVlOiBfMSwgb25DaGFuZ2U6IF8yLCBvbklucHV0OiBfMywgYWxsb3dPcGFjaXR5LCBoaWRlQmFyLCB3aWR0aCA9ICcxMDAlJywgaGVpZ2h0ID0gJzIwMHB4JywgaW5mbywgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGJhc2VSZ2IgPSByZ2IoYmFzZSk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRSZ2IgPSByZ2IodmFsdWUpO1xuICAgICAgICBjb25zdCBzdXJmYWNlID0ge1xuICAgICAgICAgICAgY29sb3I6IGJhc2VSZ2IsXG4gICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodCxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuICg8UGlja2VyQ29udGFpbmVyIHsuLi5wcm9wc30+XG4gICAgICAgIDxQaWNrZXJTdXJmYWNlIHsuLi5zdXJmYWNlfSBvbkNoYW5nZT17dGhpcy5jaGFuZ2VDb2xvcn0+XG4gICAgICAgICAgPFBpY2tlclZhbHVlIC8+XG4gICAgICAgICAgPFBpY2tlclNhdHVyYXRpb24gLz5cbiAgICAgICAgICA8Q29sb3JJbmRpY2F0b3IgeD17dmFsdWUuc30geT17MSAtIHZhbHVlLnZ9IGNvbG9yPXtjdXJyZW50UmdifSBhY3RpdmU9e2FjdGl2ZX0vPlxuICAgICAgICA8L1BpY2tlclN1cmZhY2U+XG4gICAgICAgIHshaGlkZUJhciAmJiA8Q29sb3JTbGlkZXIgb25DaGFuZ2U9e3RoaXMuY2hhbmdlQmFja2dyb3VuZH0gdmFsdWU9e3ZhbHVlLmh9IGNvbG9yPXtiYXNlUmdifS8+fVxuICAgICAgICB7YWxsb3dPcGFjaXR5ICYmIDxPcGFjaXR5U2xpZGVyIG9uQ2hhbmdlPXt0aGlzLmNoYW5nZU9wYWNpdHl9IHZhbHVlPXt2YWx1ZS5hfS8+fVxuICAgICAgICB7KGVycm9yIHx8IGluZm8pICYmICg8UGFkZGVkQ29udGFpbmVyIHRvcD1cInNtYWxsXCIgYm90dG9tPVwieHNtYWxsXCI+XG4gICAgICAgICAgICA8SW5wdXROb3RpZmljYXRpb24gZXJyb3I9e2Vycm9yfSBpbmZvPXtpbmZvfS8+XG4gICAgICAgICAgPC9QYWRkZWRDb250YWluZXI+KX1cbiAgICAgIDwvUGlja2VyQ29udGFpbmVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFBpY2tlckNvbnRhaW5lcigpIHsgcmV0dXJuIFBpY2tlckNvbnRhaW5lciBhcyB0eXBlb2YgUGlja2VyQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgUGlja2VyU3VyZmFjZSgpIHsgcmV0dXJuIFBpY2tlclN1cmZhY2UgYXMgdHlwZW9mIFBpY2tlclN1cmZhY2U7IH0sXG4gICAgICAgIGdldCBQaWNrZXJWYWx1ZSgpIHsgcmV0dXJuIFBpY2tlclZhbHVlIGFzIHR5cGVvZiBQaWNrZXJWYWx1ZTsgfSxcbiAgICAgICAgZ2V0IFBpY2tlclNhdHVyYXRpb24oKSB7IHJldHVybiBQaWNrZXJTYXR1cmF0aW9uIGFzIHR5cGVvZiBQaWNrZXJTYXR1cmF0aW9uOyB9LFxuICAgICAgICBnZXQgQ29sb3JJbmRpY2F0b3IoKSB7IHJldHVybiBDb2xvckluZGljYXRvciBhcyB0eXBlb2YgQ29sb3JJbmRpY2F0b3I7IH0sXG4gICAgICAgIGdldCBDb2xvclNsaWRlcigpIHsgcmV0dXJuIENvbG9yU2xpZGVyIGFzIHR5cGVvZiBDb2xvclNsaWRlcjsgfSxcbiAgICAgICAgZ2V0IE9wYWNpdHlTbGlkZXIoKSB7IHJldHVybiBPcGFjaXR5U2xpZGVyIGFzIHR5cGVvZiBPcGFjaXR5U2xpZGVyOyB9LFxuICAgICAgICBnZXQgUGFkZGVkQ29udGFpbmVyKCkgeyByZXR1cm4gUGFkZGVkQ29udGFpbmVyIGFzIHR5cGVvZiBQYWRkZWRDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBJbnB1dE5vdGlmaWNhdGlvbigpIHsgcmV0dXJuIElucHV0Tm90aWZpY2F0aW9uIGFzIHR5cGVvZiBJbnB1dE5vdGlmaWNhdGlvbjsgfVxuICAgIH07XG59XG4vKipcbiAqIEEgY29sb3IgcGlja2VyIGZvciBzZWxlY3RpbmcgYSBjb2xvciBpbiB0aGUgVUkuXG4gKi9cbmV4cG9ydCBjb25zdCBDb2xvclBpY2tlciA9IHdpdGhGb3JtQ29udGV4dChDb2xvclBpY2tlckludCk7XG5Db2xvclBpY2tlci5kaXNwbGF5TmFtZSA9ICdDb2xvclBpY2tlcic7XG4iXX0=