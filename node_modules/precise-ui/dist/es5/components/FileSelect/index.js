"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var quarks_1 = require("../../quarks");
var withFormContext_1 = require("../../hoc/withFormContext");
var Button_1 = require("../Button");
var Icon_1 = require("../Icon");
var Spinner_1 = require("../Spinner");
var input_1 = require("../../utils/input");
var FileInput = styled_1.default.input(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  display: none;\n"], ["\n  display: none;\n"])));
var Remove = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  cursor: pointer;\n  line-height: 1;\n"], ["\n  cursor: pointer;\n  line-height: 1;\n"])));
function getFiles(target, files) {
    if (files === void 0) { files = []; }
    target.push.apply(target, files);
    return target;
}
var FileSelectInt = /** @class */ (function (_super) {
    __extends(FileSelectInt, _super);
    function FileSelectInt(props) {
        var _this = _super.call(this, props) || this;
        _this.addFileEntries = function (ev) {
            var _a = _this.props, multiple = _a.multiple, form = _a.form, _b = _a.name, name = _b === void 0 ? '' : _b;
            var files = ev.target.files;
            if (!_this.state.controlled) {
                if (form) {
                    form.change({
                        name: name,
                        value: getFiles(multiple ? _this.state.value.slice() : [], files),
                    });
                }
                else {
                    _this.setState(function (prevState) { return ({
                        value: getFiles(multiple ? prevState.value.slice() : [], files),
                        previews: [],
                    }); }, function () { return _this.notifyChanges(_this.state.value); });
                }
            }
            else {
                _this.notifyChanges(getFiles(multiple ? _this.state.value.slice() : [], files));
            }
        };
        _this.setInputRef = function (el) {
            _this.fileInput = el;
        };
        _this.openFilePicker = function () {
            var onOpen = _this.props.onOpen;
            var open = true;
            if (typeof onOpen === 'function') {
                onOpen({
                    preventDefault: function () {
                        open = false;
                    },
                });
            }
            if (open && _this.fileInput) {
                _this.fileInput.click();
            }
        };
        var value = props.value || props.defaultValue || [];
        _this.state = {
            value: value,
            controlled: props.value !== undefined,
            previews: [],
            error: props.error,
        };
        return _this;
    }
    FileSelectInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    FileSelectInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    FileSelectInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.value, value = _b === void 0 ? [] : _b, error = _a.error;
        if (this.state.controlled && value && this.state.value !== value) {
            this.setState({
                value: value,
                previews: [],
            });
        }
        this.setState({ error: error });
    };
    FileSelectInt.prototype.removeFileEntry = function (f) {
        var _this = this;
        var _a = this.props, form = _a.form, _b = _a.name, name = _b === void 0 ? '' : _b;
        if (!this.state.controlled) {
            if (form) {
                form.change({
                    name: name,
                    value: this.state.value.filter(function (file) { return f !== file; }),
                });
            }
            else {
                this.setState(function (prevState) { return ({
                    value: prevState.value.filter(function (file) { return f !== file; }),
                    previews: prevState.previews.filter(function (preview) { return preview.file !== f; }),
                }); }, function () { return _this.notifyChanges(_this.state.value); });
            }
        }
        else {
            var files = this.state.value.filter(function (file) { return f !== file; });
            this.notifyChanges(files);
        }
    };
    FileSelectInt.prototype.notifyChanges = function (files) {
        var onChange = this.props.onChange;
        if (typeof onChange === 'function') {
            onChange({
                value: files,
            });
        }
    };
    FileSelectInt.prototype.renderPreview = function (f) {
        var _this = this;
        var preview = this.state.previews.filter(function (preview) { return preview.file === f; })[0];
        if (f.size > 1000000 || !f.type.match(/image/)) {
            return this.renderItem(f);
        }
        if (preview) {
            return (React.createElement(quarks_1.StyledFileImagePreview, { src: preview.data },
                React.createElement(Remove, { onClick: function () { return _this.removeFileEntry(f); } },
                    React.createElement(Icon_1.Icon, { name: "RemoveCircle", size: 1 }))));
        }
        var reader = new FileReader();
        reader.onload = (function (file) { return function () {
            var result = reader.result;
            typeof result === 'string' &&
                _this.setState(function (prevState) { return ({
                    previews: prevState.previews.concat([
                        {
                            file: file,
                            data: result,
                        },
                    ]),
                }); });
        }; })(f);
        reader.readAsDataURL(f);
        return (React.createElement(quarks_1.StyledFileImagePreview, null,
            React.createElement(Spinner_1.Spinner, { size: "small" })));
    };
    FileSelectInt.prototype.renderItem = function (f) {
        var _this = this;
        return (React.createElement(quarks_1.StyledFileItem, { key: f.name, name: f.name },
            React.createElement(Remove, { onClick: function () { return _this.removeFileEntry(f); } },
                React.createElement(Icon_1.Icon, { name: "RemoveCircle", size: 1 }))));
    };
    FileSelectInt.prototype.render = function () {
        var _this = this;
        var _a = this.props, children = _a.children, disabled = _a.disabled, multiple = _a.multiple, info = _a.info;
        var _b = this.state, value = _b.value, error = _b.error;
        return (React.createElement("div", null,
            React.createElement(Button_1.Button, { onClick: this.openFilePicker, disabled: disabled, buttonStyle: "secondary", type: "button" }, children),
            React.createElement(FileInput, { ref: this.setInputRef, type: "file", multiple: multiple, onChange: this.addFileEntries, value: "" }),
            value && value.length > 0 && (React.createElement(quarks_1.StyledFileList, null, value.map(function (file) { return (_this.props.preview ? _this.renderPreview(file) : _this.renderItem(file)); }))),
            input_1.showInputInfo(error, info)));
    };
    FileSelectInt.inner = {
        get StyledFileImagePreview() { return quarks_1.StyledFileImagePreview; },
        get Remove() { return Remove; },
        get Icon() { return Icon_1.Icon; },
        get Spinner() { return Spinner_1.Spinner; },
        get StyledFileItem() { return quarks_1.StyledFileItem; },
        get Button() { return Button_1.Button; },
        get FileInput() { return FileInput; },
        get StyledFileList() { return quarks_1.StyledFileList; }
    };
    return FileSelectInt;
}(React.Component));
/**
 * A custom field for handling file selection.
 */
exports.FileSelect = withFormContext_1.withFormContext(FileSelectInt);
exports.FileSelect.displayName = 'FileSelect';
var templateObject_1, templateObject_2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9GaWxlU2VsZWN0L2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkJBQStCO0FBQy9CLDZDQUF3QztBQUN4Qyx1Q0FBd0c7QUFDeEcsNkRBQThFO0FBRTlFLG9DQUFtQztBQUNuQyxnQ0FBK0I7QUFDL0Isc0NBQXFDO0FBQ3JDLDJDQUFrRDtBQTZCbEQsSUFBTSxTQUFTLEdBQUcsZ0JBQU0sQ0FBQyxLQUFLLHlGQUFDLHNCQUU5QixJQUFBLENBQUM7QUFDRixJQUFNLE1BQU0sR0FBRyxnQkFBTSxDQUFDLEdBQUcsOEdBQUMsMkNBR3pCLElBQUEsQ0FBQztBQUNGLFNBQVMsUUFBUSxDQUFDLE1BQW1CLEVBQUUsS0FBZTtJQUFmLHNCQUFBLEVBQUEsVUFBZTtJQUNsRCxNQUFNLENBQUMsSUFBSSxPQUFYLE1BQU0sRUFBUyxLQUFLLEVBQUU7SUFDdEIsT0FBTyxNQUFNLENBQUM7QUFDbEIsQ0FBQztBQUNEO0lBQTRCLGlDQUFvRTtJQUU1Rix1QkFBWSxLQUFzQjtRQUFsQyxZQUNJLGtCQUFNLEtBQUssQ0FBQyxTQVFmO1FBd0JPLG9CQUFjLEdBQUcsVUFBQyxFQUF1QztZQUN2RCxJQUFBLGdCQUEwQyxFQUF4QyxzQkFBUSxFQUFFLGNBQUksRUFBRSxZQUFTLEVBQVQsOEJBQXdCLENBQUM7WUFDakQsSUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDOUIsSUFBSSxDQUFDLEtBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFFO2dCQUN4QixJQUFJLElBQUksRUFBRTtvQkFDTixJQUFJLENBQUMsTUFBTSxDQUFDO3dCQUNSLElBQUksTUFBQTt3QkFDSixLQUFLLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUssS0FBSSxDQUFDLEtBQUssQ0FBQyxL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QUFBLFVBQVUsR0FBRyxpQ0FBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3pELGtCQUFVLENBQUMsV0FBVyxHQUFHLFlBQVksQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IEZpbGVJbWFnZVByZXZpZXcsIFN0eWxlZEZpbGVJbWFnZVByZXZpZXcsIFN0eWxlZEZpbGVJdGVtLCBTdHlsZWRGaWxlTGlzdCB9IGZyb20gJy4uLy4uL3F1YXJrcyc7XG5pbXBvcnQgeyBGb3JtQ29udGV4dFByb3BzLCB3aXRoRm9ybUNvbnRleHQgfSBmcm9tICcuLi8uLi9ob2Mvd2l0aEZvcm1Db250ZXh0JztcbmltcG9ydCB7IElucHV0Q2hhbmdlRXZlbnQsIElucHV0UHJvcHMgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAnLi4vQnV0dG9uJztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9JY29uJztcbmltcG9ydCB7IFNwaW5uZXIgfSBmcm9tICcuLi9TcGlubmVyJztcbmltcG9ydCB7IHNob3dJbnB1dEluZm8gfSBmcm9tICcuLi8uLi91dGlscy9pbnB1dCc7XG5leHBvcnQgdHlwZSBGaWxlU2VsZWN0Q2hhbmdlRXZlbnQgPSBJbnB1dENoYW5nZUV2ZW50PEFycmF5PEZpbGU+PjtcbmV4cG9ydCBpbnRlcmZhY2UgRmlsZVNlbGVjdE9wZW5FdmVudCB7XG4gICAgcHJldmVudERlZmF1bHQoKTogdm9pZDtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgRmlsZVNlbGVjdFByb3BzIGV4dGVuZHMgSW5wdXRQcm9wczxBcnJheTxGaWxlPj4ge1xuICAgIC8qKlxuICAgICAqIFNob3cgcHJldmlldyBpbnN0ZWFkIG9mIGZpbGUgbGlzdC5cbiAgICAgKi9cbiAgICBwcmV2aWV3PzogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBBbGxvdyBzZWxlY3RpbmcgbXVsdGlwbGUgZmlsZXMuXG4gICAgICovXG4gICAgbXVsdGlwbGU/OiBib29sZWFuO1xuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IG9mIHRoZSBmaWxlc2VsZWN0LlxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xuICAgIC8qKlxuICAgICAqIEV2ZW50IGZpcmVkIHdoZW4gdGhlIGZpbGUgcGlja2VyIHNob3VsZCBiZSBvcGVuZWQuXG4gICAgICovXG4gICAgb25PcGVuPyhlOiBGaWxlU2VsZWN0T3BlbkV2ZW50KTogdm9pZDtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgRmlsZVNlbGVjdFN0YXRlIHtcbiAgICB2YWx1ZTogQXJyYXk8RmlsZT47XG4gICAgZXJyb3I/OiBSZWFjdC5SZWFjdENoaWxkO1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG4gICAgcHJldmlld3M6IEFycmF5PEZpbGVJbWFnZVByZXZpZXc+O1xufVxuY29uc3QgRmlsZUlucHV0ID0gc3R5bGVkLmlucHV0IGBcbiAgZGlzcGxheTogbm9uZTtcbmA7XG5jb25zdCBSZW1vdmUgPSBzdHlsZWQuZGl2IGBcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBsaW5lLWhlaWdodDogMTtcbmA7XG5mdW5jdGlvbiBnZXRGaWxlcyh0YXJnZXQ6IEFycmF5PEZpbGU+LCBmaWxlczogYW55ID0gW10pIHtcbiAgICB0YXJnZXQucHVzaCguLi5maWxlcyk7XG4gICAgcmV0dXJuIHRhcmdldDtcbn1cbmNsYXNzIEZpbGVTZWxlY3RJbnQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8RmlsZVNlbGVjdFByb3BzICYgRm9ybUNvbnRleHRQcm9wcywgRmlsZVNlbGVjdFN0YXRlPiB7XG4gICAgcHJpdmF0ZSBmaWxlSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBGaWxlU2VsZWN0UHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BzLnZhbHVlIHx8IHByb3BzLmRlZmF1bHRWYWx1ZSB8fCBbXTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgY29udHJvbGxlZDogcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHByZXZpZXdzOiBbXSxcbiAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS51bnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyh7IHZhbHVlID0gW10sIGVycm9yIH06IEZpbGVTZWxlY3RQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb250cm9sbGVkICYmIHZhbHVlICYmIHRoaXMuc3RhdGUudmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICBwcmV2aWV3czogW10sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3IgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgYWRkRmlsZUVudHJpZXMgPSAoZXY6IFJlYWN0LkNoYW5nZUV2ZW50PEhUTUxJbnB1dEVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIGNvbnN0IHsgbXVsdGlwbGUsIGZvcm0sIG5hbWUgPSAnJyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgZmlsZXMgPSBldi50YXJnZXQuZmlsZXM7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm0uY2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGdldEZpbGVzKG11bHRpcGxlID8gWy4uLnRoaXMuc3RhdGUudmFsdWVdIDogW10sIGZpbGVzKSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUocHJldlN0YXRlID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBnZXRGaWxlcyhtdWx0aXBsZSA/IFsuLi5wcmV2U3RhdGUudmFsdWVdIDogW10sIGZpbGVzKSxcbiAgICAgICAgICAgICAgICAgICAgcHJldmlld3M6IFtdLFxuICAgICAgICAgICAgICAgIH0pLCAoKSA9PiB0aGlzLm5vdGlmeUNoYW5nZXModGhpcy5zdGF0ZS52YWx1ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlDaGFuZ2VzKGdldEZpbGVzKG11bHRpcGxlID8gWy4uLnRoaXMuc3RhdGUudmFsdWVdIDogW10sIGZpbGVzKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgcmVtb3ZlRmlsZUVudHJ5KGY6IEZpbGUpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtLCBuYW1lID0gJycgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICBpZiAoZm9ybSkge1xuICAgICAgICAgICAgICAgIGZvcm0uY2hhbmdlKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUuZmlsdGVyKGZpbGUgPT4gZiAhPT0gZmlsZSksXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHByZXZTdGF0ZSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcHJldlN0YXRlLnZhbHVlLmZpbHRlcihmaWxlID0+IGYgIT09IGZpbGUpLFxuICAgICAgICAgICAgICAgICAgICBwcmV2aWV3czogcHJldlN0YXRlLnByZXZpZXdzLmZpbHRlcihwcmV2aWV3ID0+IHByZXZpZXcuZmlsZSAhPT0gZiksXG4gICAgICAgICAgICAgICAgfSksICgpID0+IHRoaXMubm90aWZ5Q2hhbmdlcyh0aGlzLnN0YXRlLnZhbHVlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuc3RhdGUudmFsdWUuZmlsdGVyKGZpbGUgPT4gZiAhPT0gZmlsZSk7XG4gICAgICAgICAgICB0aGlzLm5vdGlmeUNoYW5nZXMoZmlsZXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgbm90aWZ5Q2hhbmdlcyhmaWxlczogQXJyYXk8RmlsZT4pIHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBmaWxlcyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgcmVuZGVyUHJldmlldyhmOiBGaWxlKSB7XG4gICAgICAgIGNvbnN0IHByZXZpZXcgPSB0aGlzLnN0YXRlLnByZXZpZXdzLmZpbHRlcihwcmV2aWV3ID0+IHByZXZpZXcuZmlsZSA9PT0gZilbMF07XG4gICAgICAgIGlmIChmLnNpemUgPiAxMDAwMDAwIHx8ICFmLnR5cGUubWF0Y2goL2ltYWdlLykpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckl0ZW0oZik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiAoPFN0eWxlZEZpbGVJbWFnZVByZXZpZXcgc3JjPXtwcmV2aWV3LmRhdGF9PlxuICAgICAgICAgIDxSZW1vdmUgb25DbGljaz17KCkgPT4gdGhpcy5yZW1vdmVGaWxlRW50cnkoZil9PlxuICAgICAgICAgICAgPEljb24gbmFtZT1cIlJlbW92ZUNpcmNsZVwiIHNpemU9ezF9Lz5cbiAgICAgICAgICA8L1JlbW92ZT5cbiAgICAgICAgPC9TdHlsZWRGaWxlSW1hZ2VQcmV2aWV3Pik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChmaWxlID0+ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlYWRlci5yZXN1bHQ7XG4gICAgICAgICAgICB0eXBlb2YgcmVzdWx0ID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUocHJldlN0YXRlID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIHByZXZpZXdzOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5wcmV2U3RhdGUucHJldmlld3MsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkoZik7XG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGYpO1xuICAgICAgICByZXR1cm4gKDxTdHlsZWRGaWxlSW1hZ2VQcmV2aWV3PlxuICAgICAgICA8U3Bpbm5lciBzaXplPVwic21hbGxcIi8+XG4gICAgICA8L1N0eWxlZEZpbGVJbWFnZVByZXZpZXc+KTtcbiAgICB9XG4gICAgcHJpdmF0ZSByZW5kZXJJdGVtKGY6IEZpbGUpIHtcbiAgICAgICAgcmV0dXJuICg8U3R5bGVkRmlsZUl0ZW0ga2V5PXtmLm5hbWV9IG5hbWU9e2YubmFtZX0+XG4gICAgICAgIDxSZW1vdmUgb25DbGljaz17KCkgPT4gdGhpcy5yZW1vdmVGaWxlRW50cnkoZil9PlxuICAgICAgICAgIDxJY29uIG5hbWU9XCJSZW1vdmVDaXJjbGVcIiBzaXplPXsxfS8+XG4gICAgICAgIDwvUmVtb3ZlPlxuICAgICAgPC9TdHlsZWRGaWxlSXRlbT4pO1xuICAgIH1cbiAgICBwcml2YXRlIHNldElucHV0UmVmID0gKGVsOiBIVE1MSW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICAgIHRoaXMuZmlsZUlucHV0ID0gZWw7XG4gICAgfTtcbiAgICBwcml2YXRlIG9wZW5GaWxlUGlja2VyID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IG9uT3BlbiB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgbGV0IG9wZW4gPSB0cnVlO1xuICAgICAgICBpZiAodHlwZW9mIG9uT3BlbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25PcGVuKHtcbiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdCgpIHtcbiAgICAgICAgICAgICAgICAgICAgb3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3BlbiAmJiB0aGlzLmZpbGVJbnB1dCkge1xuICAgICAgICAgICAgdGhpcy5maWxlSW5wdXQuY2xpY2soKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGNoaWxkcmVuLCBkaXNhYmxlZCwgbXVsdGlwbGUsIGluZm8gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIGVycm9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgIDxCdXR0b24gb25DbGljaz17dGhpcy5vcGVuRmlsZVBpY2tlcn0gZGlzYWJsZWQ9e2Rpc2FibGVkfSBidXR0b25TdHlsZT1cInNlY29uZGFyeVwiIHR5cGU9XCJidXR0b25cIj5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgICA8RmlsZUlucHV0IHJlZj17dGhpcy5zZXRJbnB1dFJlZn0gdHlwZT1cImZpbGVcIiBtdWx0aXBsZT17bXVsdGlwbGV9IG9uQ2hhbmdlPXt0aGlzLmFkZEZpbGVFbnRyaWVzfSB2YWx1ZT1cIlwiLz5cbiAgICAgICAge3ZhbHVlICYmIHZhbHVlLmxlbmd0aCA+IDAgJiYgKDxTdHlsZWRGaWxlTGlzdD5cbiAgICAgICAgICAgIHt2YWx1ZS5tYXAoZmlsZSA9PiAodGhpcy5wcm9wcy5wcmV2aWV3ID8gdGhpcy5yZW5kZXJQcmV2aWV3KGZpbGUpIDogdGhpcy5yZW5kZXJJdGVtKGZpbGUpKSl9XG4gICAgICAgICAgPC9TdHlsZWRGaWxlTGlzdD4pfVxuICAgICAgICB7c2hvd0lucHV0SW5mbyhlcnJvciwgaW5mbyl9XG4gICAgICA8L2Rpdj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWRGaWxlSW1hZ2VQcmV2aWV3KCkgeyByZXR1cm4gU3R5bGVkRmlsZUltYWdlUHJldmlldyBhcyB0eXBlb2YgU3R5bGVkRmlsZUltYWdlUHJldmlldzsgfSxcbiAgICAgICAgZ2V0IFJlbW92ZSgpIHsgcmV0dXJuIFJlbW92ZSBhcyB0eXBlb2YgUmVtb3ZlOyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH0sXG4gICAgICAgIGdldCBTcGlubmVyKCkgeyByZXR1cm4gU3Bpbm5lciBhcyB0eXBlb2YgU3Bpbm5lcjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZEZpbGVJdGVtKCkgeyByZXR1cm4gU3R5bGVkRmlsZUl0ZW0gYXMgdHlwZW9mIFN0eWxlZEZpbGVJdGVtOyB9LFxuICAgICAgICBnZXQgQnV0dG9uKCkgeyByZXR1cm4gQnV0dG9uIGFzIHR5cGVvZiBCdXR0b247IH0sXG4gICAgICAgIGdldCBGaWxlSW5wdXQoKSB7IHJldHVybiBGaWxlSW5wdXQgYXMgdHlwZW9mIEZpbGVJbnB1dDsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZEZpbGVMaXN0KCkgeyByZXR1cm4gU3R5bGVkRmlsZUxpc3QgYXMgdHlwZW9mIFN0eWxlZEZpbGVMaXN0OyB9XG4gICAgfTtcbn1cbi8qKlxuICogQSBjdXN0b20gZmllbGQgZm9yIGhhbmRsaW5nIGZpbGUgc2VsZWN0aW9uLlxuICovXG5leHBvcnQgY29uc3QgRmlsZVNlbGVjdCA9IHdpdGhGb3JtQ29udGV4dChGaWxlU2VsZWN0SW50KTtcbkZpbGVTZWxlY3QuZGlzcGxheU5hbWUgPSAnRmlsZVNlbGVjdCc7XG4iXX0=