"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var input_1 = require("../../utils/input");
var InputIcon_1 = require("../InputIcon");
var colors_1 = require("../../colors");
var distance_1 = require("../../distance");
var themes_1 = require("../../themes");
var Icon_1 = require("../Icon");
var Responsive_1 = require("../Responsive");
var WindowPopup_1 = require("../WindowPopup");
var InteractiveList_1 = require("../InteractiveList");
var quarks_1 = require("../../quarks");
var textStyles_1 = require("../../textStyles");
var DropdownContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n  outline: 0;\n"], ["\n  position: relative;\n  outline: 0;\n"])));
exports.DropdownSelect = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  display: flex;\n"], ["\n  display: flex;\n"])));
var DropdownInputBox = styled_1.default(quarks_1.StyledInputBox)(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  border: 1px solid ", ";\n"], ["\n  border: 1px solid ", ";\n"])), styled_1.themed(function (_a) {
    var focused = _a.focused, ui4 = _a.theme.ui4;
    return (focused ? ui4 : colors_1.transparent);
}));
var DropdownOptionText = styled_1.default.div(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  ", "\n  padding: ", ";\n  margin: 0;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  color: ", ";\n  font-family: inherit;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  cursor: ", ";\n"], ["\n  ", "\n  padding: ", ";\n  margin: 0;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  color: ", ";\n  font-family: inherit;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  cursor: ", ";\n"])), textStyles_1.getFontStyle({ size: 'medium' }), function (props) { return !props.labelShown ? "" + distance_1.distance.medium : distance_1.distance.large + " " + distance_1.distance.medium + " " + distance_1.distance.small; }, styled_1.themed(function (_a) {
    var theme = _a.theme, disabled = _a.disabled;
    return (disabled ? theme.text3 : theme.text1);
}), function (props) { return (props.disabled ? 'not-allowed' : 'auto'); });
var SingleDropdownItem = styled_1.default.span(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  display: inline-block;\n  line-height: normal;\n  border: 0;\n  color: ", ";\n"], ["\n  display: inline-block;\n  line-height: normal;\n  border: 0;\n  color: ", ";\n"])), styled_1.themed(function (props) { return props.theme.text6; }));
var StyledStandardWrapper = styled_1.default('ul')(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  list-style: none;\n  width: 100%;\n  position: absolute;\n  transform: translateY(", "%);\n  box-sizing: border-box;\n  box-shadow: none;\n  margin: 0;\n  padding: 0;\n  background: ", ";\n  border: 1px solid\n    ", ";\n  max-height: 50vh;\n  ", ";\n  top: ", "px;\n  overflow-y: auto;\n  z-index: 100;\n"], ["\n  list-style: none;\n  width: 100%;\n  position: absolute;\n  transform: translateY(", "%);\n  box-sizing: border-box;\n  box-shadow: none;\n  margin: 0;\n  padding: 0;\n  background: ", ";\n  border: 1px solid\n    ", ";\n  max-height: 50vh;\n  ",
    ";\n  top: ", "px;\n  overflow-y: auto;\n  z-index: 100;\n"])), function (props) { return (props.direction === InteractiveList_1.InteractiveListDirection.normal ? 0 : -100); }, styled_1.themed(function (props) { return props.theme.ui1; }), styled_1.themed(function (_a) {
    var border = _a.border, _b = _a.theme, ui0 = _b.ui0, ui4 = _b.ui4;
    return (border === 0 /* none */ ? ui0 : ui4);
}), function (props) { return props.direction === InteractiveList_1.InteractiveListDirection.normal
    ? 'border-top-color: transparent'
    : 'border-bottom-color: transparent'; }, function (props) { return (props.direction === InteractiveList_1.InteractiveListDirection.normal ? -1 : -53); });
var StyledLabel = styled_1.default.div(templateObject_7 || (templateObject_7 = __makeTemplateObject(["\n  padding-left: ", ";\n"], ["\n  padding-left: ", ";\n"])), distance_1.distance.medium);
var DropdownPopup = styled_1.default(WindowPopup_1.WindowPopup)(templateObject_8 || (templateObject_8 = __makeTemplateObject(["\n  border: 2em solid transparent;\n"], ["\n  border: 2em solid transparent;\n"])));
// tslint:disable-next-line
var NotOpenComponent = null;
var StandardWrapper = Object.assign((function (_a) {
    var open = _a.open, props = __rest(_a, ["open"]);
    return open ? React.createElement(StyledStandardWrapper, __assign({}, props)) : NotOpenComponent;
}), { inner: {
        get StyledStandardWrapper() { return StyledStandardWrapper; }
    } });
StandardWrapper.displayName = 'StandardWrapper';
var getMobileWrapper = function (label) { return function (_a) {
    var onClick = _a.onClick, children = _a.children, open = _a.open;
    return open ? (React.createElement(DropdownPopup, { onClose: onClick, label: label }, children)) : (NotOpenComponent);
}; };
function getChosen(selected, multiple) {
    if (multiple) {
        return Array.isArray(selected) ? selected : [selected];
    }
    else {
        return [Array.isArray(selected) ? selected[0] : selected];
    }
}
function getKeys(data, selected) {
    return selected.map(function (index) {
        var item = data[index];
        return typeof item === 'string' ? item : item.key;
    });
}
function getIndices(data, selected, multiple) {
    var chosen = getChosen(selected, multiple);
    var indices = [];
    for (var i = 0; i < data.length; i++) {
        var item = data[i];
        var key = typeof item === 'string' ? item : item.key;
        if (chosen.indexOf(key) !== -1) {
            indices.push(i);
        }
    }
    if (!multiple && indices.length > 1) {
        indices.splice(1);
    }
    return indices;
}
function getContent(item) {
    if (typeof item !== 'string') {
        return item.content || item.key;
    }
    return item;
}
function getSingleContent(item, theme) {
    var key = typeof item === 'string' ? item : item.key;
    return (React.createElement(SingleDropdownItem, { theme: theme, key: key }, getContent(item)));
}
var MultipleDropdownItem = styled_1.default(quarks_1.StyledTagItem)(templateObject_9 || (templateObject_9 = __makeTemplateObject(["\n  margin: 0 ", " 0 0;\n"], ["\n  margin: 0 ", " 0 0;\n"])), distance_1.distance.small);
function getMultipleContent(item, theme) {
    var key = typeof item === 'string' ? item : item.key;
    return (React.createElement(MultipleDropdownItem, { theme: theme, key: key }, getContent(item)));
}
var DropdownFieldInt = /** @class */ (function (_super) {
    __extends(DropdownFieldInt, _super);
    function DropdownFieldInt(props) {
        var _this = _super.call(this, props) || this;
        _this.show = function () { return new Promise(function (resolve) {
            _this.setState({ open: true }, resolve);
        }); };
        _this.hide = function () { return new Promise(function (resolve) {
            _this.setState({ open: false }, resolve);
        }); };
        _this.handleClickOutside = _this.hide;
        _this.toggle = function () { return __awaiter(_this, void 0, void 0, function () {
            var _a, onToggle, disabled, open_1;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _a = this.props, onToggle = _a.onToggle, disabled = _a.disabled;
                        if (!!disabled) return [3 /*break*/, 4];
                        open_1 = this.state.open;
                        if (typeof onToggle === 'function') {
                            onToggle({
                                state: open_1 ? 'close' : 'open',
                            });
                        }
                        if (!open_1) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.hide()];
                    case 1:
                        _b.sent();
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, this.show()];
                    case 3:
                        _b.sent();
                        _b.label = 4;
                    case 4: return [2 /*return*/];
                }
            });
        }); };
        _this.control = function (e) {
            switch (e.keyCode) {
                case 13 /* enter */:
                case 32 /* space */:
                    _this.show();
                    break;
                case 27 /* escape */:
                    _this.hide();
                    break;
                case 38 /* up */:
                case 40 /* down */:
                    if (!_this.state.open) {
                        _this.show();
                    }
                    return;
                default:
                    return;
            }
            e.stopPropagation();
            e.preventDefault();
        };
        _this.handleMouseDown = function (e) {
            _this.toggle();
            e.preventDefault();
        };
        _this.handleChange = function (_a) {
            var value = _a.value;
            var controlled = _this.state.controlled;
            var _b = _this.props, onChange = _b.onChange, data = _b.data, multiple = _b.multiple, form = _b.form, _c = _b.name, name = _c === void 0 ? '' : _c;
            if (!multiple) {
                _this.hide();
            }
            if (!controlled) {
                if (form) {
                    form.change({
                        name: name,
                        value: value,
                    });
                }
                else {
                    _this.setState({
                        value: value,
                    });
                }
            }
            if (typeof onChange === 'function') {
                onChange({
                    value: value.length ? getKeys(data, value) : [],
                });
            }
        };
        _this.renderList = function (screenSize) {
            var _a = _this.props, _b = _a.data, data = _b === void 0 ? [] : _b, theme = _a.theme, disabled = _a.disabled, multiple = _a.multiple, direction = _a.direction, disabledItems = _a.disabledItems;
            var _c = _this.state, open = _c.open, value = _c.value;
            var mobile = screenSize === 'small';
            var wrapper = mobile ? getMobileWrapper(React.createElement(StyledLabel, null, _this.props.label)) : StandardWrapper;
            return (React.createElement(InteractiveList_1.InteractiveList, { theme: theme, data: data, multiple: multiple, open: open && !disabled, onChange: _this.handleChange, onClick: mobile ? _this.toggle : undefined, onBlur: mobile ? undefined : _this.hide, onKeyDown: mobile ? _this.control : undefined, indices: value, customWrapper: wrapper, onClickOutside: function () { }, direction: direction, autoPosition: undefined === direction, disabledItems: disabledItems, autoFocus: true }));
        };
        var data = props.data || [];
        var value = [];
        if (typeof props.value === 'string' || Array.isArray(props.value)) {
            value = props.value;
        }
        else if (typeof props.defaultValue === 'string' || Array.isArray(props.defaultValue)) {
            value = props.defaultValue;
        }
        _this.state = {
            value: getIndices(data, value, props.multiple),
            open: props.open === true,
            controlled: props.value !== undefined,
            error: props.error,
        };
        return _this;
    }
    DropdownFieldInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    DropdownFieldInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    DropdownFieldInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.data, data = _b === void 0 ? [] : _b, _c = _a.value, value = _c === void 0 ? [] : _c, error = _a.error, multiple = _a.multiple;
        var controlled = this.state.controlled;
        if (controlled) {
            this.setState({
                value: getIndices(data, value, multiple),
            });
        }
        this.setState({ error: error });
    };
    DropdownFieldInt.prototype.render = function () {
        var _a = this.props, borderless = _a.borderless, _0 = _a.children, _1 = _a.value, _2 = _a.defaultValue, _3 = _a.onInput, _b = _a.data, data = _b === void 0 ? [] : _b, theme = _a.theme, classNameProp = _a.className, label = _a.label, placeholder = _a.placeholder, _c = _a.maxSelectedShown, maxSelectedShown = _c === void 0 ? 8 : _c, disabled = _a.disabled, multiple = _a.multiple, info = _a.info, onChange = _a.onChange, disabledItems = _a.disabledItems, other = __rest(_a, ["borderless", "children", "value", "defaultValue", "onInput", "data", "theme", "className", "label", "placeholder", "maxSelectedShown", "disabled", "multiple", "info", "onChange", "disabledItems"]);
        var _d = this.state, openState = _d.open, value = _d.value, error = _d.error;
        var open = openState && !disabled;
        var getContent = multiple ? getMultipleContent : getSingleContent;
        var hasValue = !!value.length;
        var border = quarks_1.getTextFieldBorderType(borderless, !!error, open);
        var items = value.map(function (i) { return data[i]; });
        var th = theme || themes_1.light;
        if (value.length > maxSelectedShown) {
            var rest = 1 + value.length - maxSelectedShown;
            items.splice(maxSelectedShown - 1, rest, "+ " + rest);
        }
        return (React.createElement(DropdownContainer, __assign({}, other),
            React.createElement(exports.DropdownSelect, { onMouseDown: this.handleMouseDown, tabIndex: 0, onKeyDown: this.control },
                React.createElement(DropdownInputBox, { disabled: disabled, hasValue: hasValue, border: border, focused: open, theme: theme },
                    React.createElement(quarks_1.StyledInputRow, { label: label, placeholder: placeholder, error: !!error, focused: open, hasValue: hasValue },
                        React.createElement(DropdownOptionText, { labelShown: label !== undefined, disabled: disabled }, hasValue || label ? items.map(function (item) { return getContent(item, theme); }) : placeholder)),
                    React.createElement(InputIcon_1.InputIcon, { disabled: disabled, theme: theme, error: error, hasValue: hasValue }),
                    React.createElement(quarks_1.StyledIconContainer, null,
                        React.createElement(Icon_1.Icon, { name: open ? 'KeyboardArrowUp' : 'KeyboardArrowDown', color: disabled ? th.ui4 : th.ui5, size: "22px" })))),
            React.createElement(Responsive_1.Responsive, { render: this.renderList }),
            input_1.showInputInfo(error, info)));
    };
    DropdownFieldInt.inner = {
        get StyledLabel() { return StyledLabel; },
        get InteractiveList() { return InteractiveList_1.InteractiveList; },
        get DropdownContainer() { return DropdownContainer; },
        get DropdownSelect() { return exports.DropdownSelect; },
        get DropdownInputBox() { return DropdownInputBox; },
        get StyledInputRow() { return quarks_1.StyledInputRow; },
        get DropdownOptionText() { return DropdownOptionText; },
        get InputIcon() { return InputIcon_1.InputIcon; },
        get StyledIconContainer() { return quarks_1.StyledIconContainer; },
        get Icon() { return Icon_1.Icon; },
        get Responsive() { return Responsive_1.Responsive; }
    };
    return DropdownFieldInt;
}(React.Component));
exports.DropdownFieldInt = DropdownFieldInt;
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHJvcGRvd25GaWVsZEludC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0Ryb3Bkb3duRmllbGQvRHJvcGRvd25GaWVsZEludC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQW9EO0FBRXBELDJDQUFrRDtBQUVsRCwwQ0FBeUM7QUFFekMsdUNBQTJDO0FBQzNDLDJDQUEwQztBQUMxQyx1Q0FBcUM7QUFDckMsZ0NBQStCO0FBQy9CLDRDQUEyQztBQUMzQyw4Q0FBNkM7QUFDN0Msc0RBQW9LO0FBQ3BLLHVDQUEySDtBQUMzSCwrQ0FBZ0Q7QUFFaEQsSUFBTSxpQkFBaUIsR0FBRyxnQkFBTSxDQUFDLEdBQUcsNkdBQUMsMENBR3BDLElBQUEsQ0FBQztBQUNXLFFBQUEsY0FBYyxHQUFHLGdCQUFNLENBQUMsR0FBRyx5RkFBQyxzQkFFeEMsS0FBQztBQUtGLElBQU0sZ0JBQWdCLEdBQUcsZ0JBQU0sQ0FBQyx1QkFBYyxDQUFDLGtHQUFDLHdCQUMxQixFQUFzRSxLQUMzRixLQURxQixlQUFNLENBQUMsVUFBQyxFQUEyQjtRQUF6QixvQkFBTyxFQUFXLGtCQUFHO0lBQVMsT0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxvQkFBVyxDQUFDO0FBQTdCLENBQTZCLENBQUMsQ0FDM0YsQ0FBQztBQUNGLElBQU0sa0JBQWtCLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLDhTQUEyQixNQUM1RCxFQUFnQyxlQUN2QixFQUE0Ryx3RkFLOUcsRUFBdUUsaUhBS3RFLEVBQWtELEtBQzdELEtBWkcseUJBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUN2QixVQUFBLEtBQUssSUFBSSxPQUFB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LENBQUMsQ0FDVCxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUNNLHNCQUFLLEdBQUc7UUFDWCxJQUFJLFdBQVcsS0FBSyxPQUFPLFdBQWlDLENBQUMsQ0FBQyxDQUFDO1FBQy9ELElBQUksZUFBZSxLQUFLLE9BQU8saUNBQXlDLENBQUMsQ0FBQyxDQUFDO1FBQzNFLElBQUksaUJBQWlCLEtBQUssT0FBTyxpQkFBNkMsQ0FBQyxDQUFDLENBQUM7UUFDakYsSUFBSSxjQUFjLEtBQUssT0FBTyxzQkFBdUMsQ0FBQyxDQUFDLENBQUM7UUFDeEUsSUFBSSxnQkFBZ0IsS0FBSyxPQUFPLGdCQUEyQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxJQUFJLGNBQWMsS0FBSyxPQUFPLHVCQUF1QyxDQUFDLENBQUMsQ0FBQztRQUN4RSxJQUFJLGtCQUFrQixLQUFLLE9BQU8sa0JBQStDLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLElBQUksU0FBUyxLQUFLLE9BQU8scUJBQTZCLENBQUMsQ0FBQyxDQUFDO1FBQ3pELElBQUksbUJBQW1CLEtBQUssT0FBTyw0QkFBaUQsQ0FBQyxDQUFDLENBQUM7UUFDdkYsSUFBSSxJQUFJLEtBQUssT0FBTyxXQUFtQixDQUFDLENBQUMsQ0FBQztRQUMxQyxJQUFJLFVBQVUsS0FBSyxPQUFPLHVCQUErQixDQUFDLENBQUMsQ0FBQztLQUMvRCxDQUFDO0lBQ04sdUJBQUM7Q0FBQSxBQXRLRCxDQUFzQyxLQUFLLENBQUMsU0FBUyxHQXNLcEQ7QUF0S1ksNENBQWdCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwgeyB0aGVtZWQgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgS2V5Q29kZXMgfSBmcm9tICcuLi8uLi91dGlscy9rZXlDb2Rlcyc7XG5pbXBvcnQgeyBzaG93SW5wdXRJbmZvIH0gZnJvbSAnLi4vLi4vdXRpbHMvaW5wdXQnO1xuaW1wb3J0IHsgU2NyZWVuU2l6ZSB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5pbXBvcnQgeyBJbnB1dEljb24gfSBmcm9tICcuLi9JbnB1dEljb24nO1xuaW1wb3J0IHsgRm9ybUNvbnRleHRQcm9wcyB9IGZyb20gJy4uLy4uL2hvYy93aXRoRm9ybUNvbnRleHQnO1xuaW1wb3J0IHsgdHJhbnNwYXJlbnQgfSBmcm9tICcuLi8uLi9jb2xvcnMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBsaWdodCB9IGZyb20gJy4uLy4uL3RoZW1lcyc7XG5pbXBvcnQgeyBJY29uIH0gZnJvbSAnLi4vSWNvbic7XG5pbXBvcnQgeyBSZXNwb25zaXZlIH0gZnJvbSAnLi4vUmVzcG9uc2l2ZSc7XG5pbXBvcnQgeyBXaW5kb3dQb3B1cCB9IGZyb20gJy4uL1dpbmRvd1BvcHVwJztcbmltcG9ydCB7IEludGVyYWN0aXZlTGlzdCwgSW50ZXJhY3RpdmVMaXN0Q2hhbmdlRXZlbnQsIEludGVyYWN0aXZlTGlzdFdyYXBwZXJQcm9wcywgSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLCBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlLCB9IGZyb20gJy4uL0ludGVyYWN0aXZlTGlzdCc7XG5pbXBvcnQgeyBTdHlsZWRJbnB1dFJvdywgU3R5bGVkSW5wdXRCb3gsIGdldFRleHRGaWVsZEJvcmRlclR5cGUsIFN0eWxlZFRhZ0l0ZW0sIFN0eWxlZEljb25Db250YWluZXIsIH0gZnJvbSAnLi4vLi4vcXVhcmtzJztcbmltcG9ydCB7IGdldEZvbnRTdHlsZSB9IGZyb20gJy4uLy4uL3RleHRTdHlsZXMnO1xuaW1wb3J0IHsgRHJvcGRvd25GaWVsZEl0ZW0sIERyb3Bkb3duRmllbGRQcm9wcyB9IGZyb20gJy4vRHJvcGRvd25GaWVsZC50eXBlcy5wYXJ0JztcbmNvbnN0IERyb3Bkb3duQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgb3V0bGluZTogMDtcbmA7XG5leHBvcnQgY29uc3QgRHJvcGRvd25TZWxlY3QgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbmA7XG5pbnRlcmZhY2UgRHJvcERvd25PcHRpb25zVGV4dFByb3BzIHtcbiAgICBsYWJlbFNob3duOiBib29sZWFuO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbn1cbmNvbnN0IERyb3Bkb3duSW5wdXRCb3ggPSBzdHlsZWQoU3R5bGVkSW5wdXRCb3gpIGBcbiAgYm9yZGVyOiAxcHggc29saWQgJHt0aGVtZWQoKHsgZm9jdXNlZCwgdGhlbWU6IHsgdWk0IH0gfSkgPT4gKGZvY3VzZWQgPyB1aTQgOiB0cmFuc3BhcmVudCkpfTtcbmA7XG5jb25zdCBEcm9wZG93bk9wdGlvblRleHQgPSBzdHlsZWQuZGl2PERyb3BEb3duT3B0aW9uc1RleHRQcm9wcz4gYFxuICAke2dldEZvbnRTdHlsZSh7IHNpemU6ICdtZWRpdW0nIH0pfVxuICBwYWRkaW5nOiAke3Byb3BzID0+ICFwcm9wcy5sYWJlbFNob3duID8gYCR7ZGlzdGFuY2UubWVkaXVtfWAgOiBgJHtkaXN0YW5jZS5sYXJnZX0gJHtkaXN0YW5jZS5tZWRpdW19ICR7ZGlzdGFuY2Uuc21hbGx9YH07XG4gIG1hcmdpbjogMDtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lLCBkaXNhYmxlZCB9KSA9PiAoZGlzYWJsZWQgPyB0aGVtZS50ZXh0MyA6IHRoZW1lLnRleHQxKSl9O1xuICBmb250LWZhbWlseTogaW5oZXJpdDtcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIGN1cnNvcjogJHtwcm9wcyA9PiAocHJvcHMuZGlzYWJsZWQgPyAnbm90LWFsbG93ZWQnIDogJ2F1dG8nKX07XG5gO1xuY29uc3QgU2luZ2xlRHJvcGRvd25JdGVtID0gc3R5bGVkLnNwYW4gYFxuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIGxpbmUtaGVpZ2h0OiBub3JtYWw7XG4gIGJvcmRlcjogMDtcbiAgY29sb3I6ICR7dGhlbWVkKHByb3BzID0+IHByb3BzLnRoZW1lLnRleHQ2KX07XG5gO1xuaW50ZXJmYWNlIFN0eWxlZFN0YW5kYXJkV3JhcHBlclByb3BzIHtcbiAgICBkaXJlY3Rpb246IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbjtcbiAgICBib3JkZXI6IEludGVyYWN0aXZlTGlzdEJvcmRlclR5cGU7XG59XG5jb25zdCBTdHlsZWRTdGFuZGFyZFdyYXBwZXIgPSBzdHlsZWQoJ3VsJyk8U3R5bGVkU3RhbmRhcmRXcmFwcGVyUHJvcHM+IGBcbiAgbGlzdC1zdHlsZTogbm9uZTtcbiAgd2lkdGg6IDEwMCU7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKCR7cHJvcHMgPT4gKHByb3BzLmRpcmVjdGlvbiA9PT0gSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLm5vcm1hbCA/IDAgOiAtMTAwKX0lKTtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYm94LXNoYWRvdzogbm9uZTtcbiAgbWFyZ2luOiAwO1xuICBwYWRkaW5nOiAwO1xuICBiYWNrZ3JvdW5kOiAke3RoZW1lZChwcm9wcyA9PiBwcm9wcy50aGVtZS51aTEpfTtcbiAgYm9yZGVyOiAxcHggc29saWRcbiAgICAke3RoZW1lZCgoeyBib3JkZXIsIHRoZW1lOiB7IHVpMCwgdWk0IH0gfSkgPT4gKGJvcmRlciA9PT0gSW50ZXJhY3RpdmVMaXN0Qm9yZGVyVHlwZS5ub25lID8gdWkwIDogdWk0KSl9O1xuICBtYXgtaGVpZ2h0OiA1MHZoO1xuICAke3Byb3BzID0+IHByb3BzLmRpcmVjdGlvbiA9PT0gSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLm5vcm1hbFxuICAgID8gJ2JvcmRlci10b3AtY29sb3I6IHRyYW5zcGFyZW50J1xuICAgIDogJ2JvcmRlci1ib3R0b20tY29sb3I6IHRyYW5zcGFyZW50J307XG4gIHRvcDogJHtwcm9wcyA9PiAocHJvcHMuZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsID8gLTEgOiAtNTMpfXB4O1xuICBvdmVyZmxvdy15OiBhdXRvO1xuICB6LWluZGV4OiAxMDA7XG5gO1xuY29uc3QgU3R5bGVkTGFiZWwgPSBzdHlsZWQuZGl2IGBcbiAgcGFkZGluZy1sZWZ0OiAke2Rpc3RhbmNlLm1lZGl1bX07XG5gO1xuY29uc3QgRHJvcGRvd25Qb3B1cCA9IHN0eWxlZChXaW5kb3dQb3B1cCkgYFxuICBib3JkZXI6IDJlbSBzb2xpZCB0cmFuc3BhcmVudDtcbmA7XG4vLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmVcbmNvbnN0IE5vdE9wZW5Db21wb25lbnQgPSBudWxsO1xuY29uc3QgU3RhbmRhcmRXcmFwcGVyID0gT2JqZWN0LmFzc2lnbigoKCh7IG9wZW4sIC4uLnByb3BzIH0pID0+IG9wZW4gPyA8U3R5bGVkU3RhbmRhcmRXcmFwcGVyIHsuLi5wcm9wc30vPiA6IE5vdE9wZW5Db21wb25lbnQpIGFzIFJlYWN0LlNGQzxJbnRlcmFjdGl2ZUxpc3RXcmFwcGVyUHJvcHM+KSwgeyBpbm5lcjoge1xuICAgICAgICBnZXQgU3R5bGVkU3RhbmRhcmRXcmFwcGVyKCkgeyByZXR1cm4gU3R5bGVkU3RhbmRhcmRXcmFwcGVyIGFzIHR5cGVvZiBTdHlsZWRTdGFuZGFyZFdyYXBwZXI7IH1cbiAgICB9IH0pO1xuU3RhbmRhcmRXcmFwcGVyLmRpc3BsYXlOYW1lID0gJ1N0YW5kYXJkV3JhcHBlcic7XG5jb25zdCBnZXRNb2JpbGVXcmFwcGVyID0gKGxhYmVsPzogUmVhY3QuUmVhY3RDaGlsZCkgPT4gKHsgb25DbGljaywgY2hpbGRyZW4sIG9wZW4sIH06IEludGVyYWN0aXZlTGlzdFdyYXBwZXJQcm9wcyAmIHtcbiAgICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTtcbn0pID0+IG9wZW4gPyAoPERyb3Bkb3duUG9wdXAgb25DbG9zZT17b25DbGlja30gbGFiZWw9e2xhYmVsfT5cbiAgICAgIHtjaGlsZHJlbn1cbiAgICA8L0Ryb3Bkb3duUG9wdXA+KSA6IChOb3RPcGVuQ29tcG9uZW50KTtcbmZ1bmN0aW9uIGdldENob3NlbihzZWxlY3RlZDogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPiwgbXVsdGlwbGU/OiBib29sZWFuKSB7XG4gICAgaWYgKG11bHRpcGxlKSB7XG4gICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHNlbGVjdGVkKSA/IHNlbGVjdGVkIDogW3NlbGVjdGVkXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBbQXJyYXkuaXNBcnJheShzZWxlY3RlZCkgPyBzZWxlY3RlZFswXSA6IHNlbGVjdGVkXTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRLZXlzKGRhdGE6IEFycmF5PHN0cmluZyB8IERyb3Bkb3duRmllbGRJdGVtPiwgc2VsZWN0ZWQ6IEFycmF5PG51bWJlcj4pIHtcbiAgICByZXR1cm4gc2VsZWN0ZWQubWFwKGluZGV4ID0+IHtcbiAgICAgICAgY29uc3QgaXRlbSA9IGRhdGFbaW5kZXhdO1xuICAgICAgICByZXR1cm4gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnID8gaXRlbSA6IGl0ZW0ua2V5O1xuICAgIH0pO1xufVxuZnVuY3Rpb24gZ2V0SW5kaWNlcyhkYXRhOiBBcnJheTxzdHJpbmcgfCBEcm9wZG93bkZpZWxkSXRlbT4sIHNlbGVjdGVkOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBtdWx0aXBsZT86IGJvb2xlYW4pIHtcbiAgICBjb25zdCBjaG9zZW4gPSBnZXRDaG9zZW4oc2VsZWN0ZWQsIG11bHRpcGxlKTtcbiAgICBjb25zdCBpbmRpY2VzOiBBcnJheTxudW1iZXI+ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2ldO1xuICAgICAgICBjb25zdCBrZXkgPSB0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycgPyBpdGVtIDogaXRlbS5rZXk7XG4gICAgICAgIGlmIChjaG9zZW4uaW5kZXhPZihrZXkpICE9PSAtMSkge1xuICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICghbXVsdGlwbGUgJiYgaW5kaWNlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGluZGljZXMuc3BsaWNlKDEpO1xuICAgIH1cbiAgICByZXR1cm4gaW5kaWNlcztcbn1cbmZ1bmN0aW9uIGdldENvbnRlbnQoaXRlbTogc3RyaW5nIHwgRHJvcGRvd25GaWVsZEl0ZW0pIHtcbiAgICBpZiAodHlwZW9mIGl0ZW0gIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBpdGVtLmNvbnRlbnQgfHwgaXRlbS5rZXk7XG4gICAgfVxuICAgIHJldHVybiBpdGVtO1xufVxuZnVuY3Rpb24gZ2V0U2luZ2xlQ29udGVudChpdGVtOiBzdHJpbmcgfCBEcm9wZG93bkZpZWxkSXRlbSwgdGhlbWU/OiBhbnkpIHtcbiAgICBjb25zdCBrZXkgPSB0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycgPyBpdGVtIDogaXRlbS5rZXk7XG4gICAgcmV0dXJuICg8U2luZ2xlRHJvcGRvd25JdGVtIHRoZW1lPXt0aGVtZX0ga2V5PXtrZXl9PlxuICAgICAge2dldENvbnRlbnQoaXRlbSl9XG4gICAgPC9TaW5nbGVEcm9wZG93bkl0ZW0+KTtcbn1cbmNvbnN0IE11bHRpcGxlRHJvcGRvd25JdGVtID0gc3R5bGVkKFN0eWxlZFRhZ0l0ZW0gYXMgYW55KSBgXG4gIG1hcmdpbjogMCAke2Rpc3RhbmNlLnNtYWxsfSAwIDA7XG5gO1xuZnVuY3Rpb24gZ2V0TXVsdGlwbGVDb250ZW50KGl0ZW06IHN0cmluZyB8IERyb3Bkb3duRmllbGRJdGVtLCB0aGVtZT86IGFueSkge1xuICAgIGNvbnN0IGtleSA9IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLmtleTtcbiAgICByZXR1cm4gKDxNdWx0aXBsZURyb3Bkb3duSXRlbSB0aGVtZT17dGhlbWV9IGtleT17a2V5fT5cbiAgICAgIHtnZXRDb250ZW50KGl0ZW0pfVxuICAgIDwvTXVsdGlwbGVEcm9wZG93bkl0ZW0+KTtcbn1cbmludGVyZmFjZSBEcm9wZG93blN0YXRlIHtcbiAgICB2YWx1ZTogQXJyYXk8bnVtYmVyPjtcbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgb3BlbjogYm9vbGVhbjtcbiAgICBjb250cm9sbGVkOiBib29sZWFuO1xufVxuZXhwb3J0IGNsYXNzIERyb3Bkb3duRmllbGRJbnQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8RHJvcGRvd25GaWVsZFByb3BzICYgRm9ybUNvbnRleHRQcm9wcywgRHJvcGRvd25TdGF0ZT4ge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBEcm9wZG93bkZpZWxkUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCBkYXRhID0gcHJvcHMuZGF0YSB8fCBbXTtcbiAgICAgICAgbGV0IHZhbHVlOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+ID0gW107XG4gICAgICAgIGlmICh0eXBlb2YgcHJvcHMudmFsdWUgPT09ICdzdHJpbmcnIHx8IEFycmF5LmlzQXJyYXkocHJvcHMudmFsdWUpKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHByb3BzLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBwcm9wcy5kZWZhdWx0VmFsdWUgPT09ICdzdHJpbmcnIHx8IEFycmF5LmlzQXJyYXkocHJvcHMuZGVmYXVsdFZhbHVlKSkge1xuICAgICAgICAgICAgdmFsdWUgPSBwcm9wcy5kZWZhdWx0VmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBnZXRJbmRpY2VzKGRhdGEsIHZhbHVlLCBwcm9wcy5tdWx0aXBsZSksXG4gICAgICAgICAgICBvcGVuOiBwcm9wcy5vcGVuID09PSB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlZDogcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcixcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIWNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS51bnN1YnNjcmliZSh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyh7IGRhdGEgPSBbXSwgdmFsdWUgPSBbXSwgZXJyb3IsIG11bHRpcGxlIH06IERyb3Bkb3duRmllbGRQcm9wcykge1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmIChjb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogZ2V0SW5kaWNlcyhkYXRhLCB2YWx1ZSwgbXVsdGlwbGUpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yIH0pO1xuICAgIH1cbiAgICBwcml2YXRlIHNob3cgPSAoKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IG9wZW46IHRydWUgfSwgcmVzb2x2ZSk7XG4gICAgfSk7XG4gICAgcHJpdmF0ZSBoaWRlID0gKCkgPT4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBvcGVuOiBmYWxzZSB9LCByZXNvbHZlKTtcbiAgICB9KTtcbiAgICBoYW5kbGVDbGlja091dHNpZGUgPSB0aGlzLmhpZGU7XG4gICAgcHJpdmF0ZSB0b2dnbGUgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25Ub2dnbGUsIGRpc2FibGVkIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIWRpc2FibGVkKSB7XG4gICAgICAgICAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uVG9nZ2xlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb25Ub2dnbGUoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0ZTogb3BlbiA/ICdjbG9zZScgOiAnb3BlbicsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob3Blbikge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgY29udHJvbCA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuc3BhY2U6XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmVzY2FwZTpcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMudXA6XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLmRvd246XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLm9wZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlTW91c2VEb3duID0gKGU6IFJlYWN0Lk1vdXNlRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHRoaXMudG9nZ2xlKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlQ2hhbmdlID0gKHsgdmFsdWUgfTogSW50ZXJhY3RpdmVMaXN0Q2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBkYXRhLCBtdWx0aXBsZSwgZm9ybSwgbmFtZSA9ICcnIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIW11bHRpcGxlKSB7XG4gICAgICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS5sZW5ndGggPyBnZXRLZXlzKGRhdGEsIHZhbHVlKSA6IFtdLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgcmVuZGVyTGlzdCA9IChzY3JlZW5TaXplPzogU2NyZWVuU2l6ZSkgPT4ge1xuICAgICAgICBjb25zdCB7IGRhdGEgPSBbXSwgdGhlbWUsIGRpc2FibGVkLCBtdWx0aXBsZSwgZGlyZWN0aW9uLCBkaXNhYmxlZEl0ZW1zIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IG9wZW4sIHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBtb2JpbGUgPSBzY3JlZW5TaXplID09PSAnc21hbGwnO1xuICAgICAgICBjb25zdCB3cmFwcGVyID0gbW9iaWxlID8gZ2V0TW9iaWxlV3JhcHBlcig8U3R5bGVkTGFiZWw+e3RoaXMucHJvcHMubGFiZWx9PC9TdHlsZWRMYWJlbD4pIDogU3RhbmRhcmRXcmFwcGVyO1xuICAgICAgICByZXR1cm4gKDxJbnRlcmFjdGl2ZUxpc3QgdGhlbWU9e3RoZW1lfSBkYXRhPXtkYXRhfSBtdWx0aXBsZT17bXVsdGlwbGV9IG9wZW49e29wZW4gJiYgIWRpc2FibGVkfSBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2V9IG9uQ2xpY2s9e21vYmlsZSA/IHRoaXMudG9nZ2xlIDogdW5kZWZpbmVkfSBvbkJsdXI9e21vYmlsZSA/IHVuZGVmaW5lZCA6IHRoaXMuaGlkZX0gb25LZXlEb3duPXttb2JpbGUgPyB0aGlzLmNvbnRyb2wgOiB1bmRlZmluZWR9IGluZGljZXM9e3ZhbHVlfSBjdXN0b21XcmFwcGVyPXt3cmFwcGVyfSBvbkNsaWNrT3V0c2lkZT17KCkgPT4geyB9fSBkaXJlY3Rpb249e2RpcmVjdGlvbn0gYXV0b1Bvc2l0aW9uPXt1bmRlZmluZWQgPT09IGRpcmVjdGlvbn0gZGlzYWJsZWRJdGVtcz17ZGlzYWJsZWRJdGVtc30gYXV0b0ZvY3VzLz4pO1xuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGJvcmRlcmxlc3MsIGNoaWxkcmVuOiBfMCwgdmFsdWU6IF8xLCBkZWZhdWx0VmFsdWU6IF8yLCBvbklucHV0OiBfMywgZGF0YSA9IFtdLCB0aGVtZSwgY2xhc3NOYW1lOiBjbGFzc05hbWVQcm9wLCBsYWJlbCwgcGxhY2Vob2xkZXIsIG1heFNlbGVjdGVkU2hvd24gPSA4LCBkaXNhYmxlZCwgbXVsdGlwbGUsIGluZm8sIG9uQ2hhbmdlLCBkaXNhYmxlZEl0ZW1zLCAuLi5vdGhlciB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBvcGVuOiBvcGVuU3RhdGUsIHZhbHVlLCBlcnJvciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3Qgb3BlbiA9IG9wZW5TdGF0ZSAmJiAhZGlzYWJsZWQ7XG4gICAgICAgIGNvbnN0IGdldENvbnRlbnQgPSBtdWx0aXBsZSA/IGdldE11bHRpcGxlQ29udGVudCA6IGdldFNpbmdsZUNvbnRlbnQ7XG4gICAgICAgIGNvbnN0IGhhc1ZhbHVlID0gISF2YWx1ZS5sZW5ndGg7XG4gICAgICAgIGNvbnN0IGJvcmRlciA9IGdldFRleHRGaWVsZEJvcmRlclR5cGUoYm9yZGVybGVzcywgISFlcnJvciwgb3Blbik7XG4gICAgICAgIGNvbnN0IGl0ZW1zID0gdmFsdWUubWFwKGkgPT4gZGF0YVtpXSk7XG4gICAgICAgIGNvbnN0IHRoID0gdGhlbWUgfHwgbGlnaHQ7XG4gICAgICAgIGlmICh2YWx1ZS5sZW5ndGggPiBtYXhTZWxlY3RlZFNob3duKSB7XG4gICAgICAgICAgICBjb25zdCByZXN0ID0gMSArIHZhbHVlLmxlbmd0aCAtIG1heFNlbGVjdGVkU2hvd247XG4gICAgICAgICAgICBpdGVtcy5zcGxpY2UobWF4U2VsZWN0ZWRTaG93biAtIDEsIHJlc3QsIGArICR7cmVzdH1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxEcm9wZG93bkNvbnRhaW5lciB7Li4ub3RoZXJ9PlxuICAgICAgICA8RHJvcGRvd25TZWxlY3Qgb25Nb3VzZURvd249e3RoaXMuaGFuZGxlTW91c2VEb3dufSB0YWJJbmRleD17MH0gb25LZXlEb3duPXt0aGlzLmNvbnRyb2x9PlxuICAgICAgICAgIDxEcm9wZG93bklucHV0Qm94IGRpc2FibGVkPXtkaXNhYmxlZH0gaGFzVmFsdWU9e2hhc1ZhbHVlfSBib3JkZXI9e2JvcmRlcn0gZm9jdXNlZD17b3Blbn0gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgIDxTdHlsZWRJbnB1dFJvdyBsYWJlbD17bGFiZWx9IHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn0gZXJyb3I9eyEhZXJyb3J9IGZvY3VzZWQ9e29wZW59IGhhc1ZhbHVlPXtoYXNWYWx1ZX0+XG4gICAgICAgICAgICAgIDxEcm9wZG93bk9wdGlvblRleHQgbGFiZWxTaG93bj17bGFiZWwgIT09IHVuZGVmaW5lZH0gZGlzYWJsZWQ9e2Rpc2FibGVkfT5cbiAgICAgICAgICAgICAgICB7aGFzVmFsdWUgfHwgbGFiZWwgPyBpdGVtcy5tYXAoaXRlbSA9PiBnZXRDb250ZW50KGl0ZW0sIHRoZW1lKSkgOiBwbGFjZWhvbGRlcn1cbiAgICAgICAgICAgICAgPC9Ecm9wZG93bk9wdGlvblRleHQ+XG4gICAgICAgICAgICA8L1N0eWxlZElucHV0Um93PlxuICAgICAgICAgICAgPElucHV0SWNvbiBkaXNhYmxlZD17ZGlzYWJsZWR9IHRoZW1lPXt0aGVtZX0gZXJyb3I9e2Vycm9yfSBoYXNWYWx1ZT17aGFzVmFsdWV9Lz5cbiAgICAgICAgICAgIDxTdHlsZWRJY29uQ29udGFpbmVyPlxuICAgICAgICAgICAgICA8SWNvbiBuYW1lPXtvcGVuID8gJ0tleWJvYXJkQXJyb3dVcCcgOiAnS2V5Ym9hcmRBcnJvd0Rvd24nfSBjb2xvcj17ZGlzYWJsZWQgPyB0aC51aTQgOiB0aC51aTV9IHNpemU9XCIyMnB4XCIvPlxuICAgICAgICAgICAgPC9TdHlsZWRJY29uQ29udGFpbmVyPlxuICAgICAgICAgIDwvRHJvcGRvd25JbnB1dEJveD5cbiAgICAgICAgPC9Ecm9wZG93blNlbGVjdD5cbiAgICAgICAgPFJlc3BvbnNpdmUgcmVuZGVyPXt0aGlzLnJlbmRlckxpc3R9Lz5cbiAgICAgICAge3Nob3dJbnB1dEluZm8oZXJyb3IsIGluZm8pfVxuICAgICAgPC9Ecm9wZG93bkNvbnRhaW5lcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWRMYWJlbCgpIHsgcmV0dXJuIFN0eWxlZExhYmVsIGFzIHR5cGVvZiBTdHlsZWRMYWJlbDsgfSxcbiAgICAgICAgZ2V0IEludGVyYWN0aXZlTGlzdCgpIHsgcmV0dXJuIEludGVyYWN0aXZlTGlzdCBhcyB0eXBlb2YgSW50ZXJhY3RpdmVMaXN0OyB9LFxuICAgICAgICBnZXQgRHJvcGRvd25Db250YWluZXIoKSB7IHJldHVybiBEcm9wZG93bkNvbnRhaW5lciBhcyB0eXBlb2YgRHJvcGRvd25Db250YWluZXI7IH0sXG4gICAgICAgIGdldCBEcm9wZG93blNlbGVjdCgpIHsgcmV0dXJuIERyb3Bkb3duU2VsZWN0IGFzIHR5cGVvZiBEcm9wZG93blNlbGVjdDsgfSxcbiAgICAgICAgZ2V0IERyb3Bkb3duSW5wdXRCb3goKSB7IHJldHVybiBEcm9wZG93bklucHV0Qm94IGFzIHR5cGVvZiBEcm9wZG93bklucHV0Qm94OyB9LFxuICAgICAgICBnZXQgU3R5bGVkSW5wdXRSb3coKSB7IHJldHVybiBTdHlsZWRJbnB1dFJvdyBhcyB0eXBlb2YgU3R5bGVkSW5wdXRSb3c7IH0sXG4gICAgICAgIGdldCBEcm9wZG93bk9wdGlvblRleHQoKSB7IHJldHVybiBEcm9wZG93bk9wdGlvblRleHQgYXMgdHlwZW9mIERyb3Bkb3duT3B0aW9uVGV4dDsgfSxcbiAgICAgICAgZ2V0IElucHV0SWNvbigpIHsgcmV0dXJuIElucHV0SWNvbiBhcyB0eXBlb2YgSW5wdXRJY29uOyB9LFxuICAgICAgICBnZXQgU3R5bGVkSWNvbkNvbnRhaW5lcigpIHsgcmV0dXJuIFN0eWxlZEljb25Db250YWluZXIgYXMgdHlwZW9mIFN0eWxlZEljb25Db250YWluZXI7IH0sXG4gICAgICAgIGdldCBJY29uKCkgeyByZXR1cm4gSWNvbiBhcyB0eXBlb2YgSWNvbjsgfSxcbiAgICAgICAgZ2V0IFJlc3BvbnNpdmUoKSB7IHJldHVybiBSZXNwb25zaXZlIGFzIHR5cGVvZiBSZXNwb25zaXZlOyB9XG4gICAgfTtcbn1cbiJdfQ==