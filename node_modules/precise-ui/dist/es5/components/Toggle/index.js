"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var hoc_1 = require("../../hoc");
var distance_1 = require("../../distance");
var IndicatorKnob_1 = require("../IndicatorKnob");
var textStyles_1 = require("../../textStyles");
var InputNotification_1 = require("../InputNotification");
var PaddedContainer_1 = require("../PaddedContainer");
var transitionDuration = '0.3s';
var transitionEase = 'cubic-bezier(0, 0, 0.25, 1)';
var ToggleContainer = styled_1.default('div')(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  ", ";\n  position: relative;\n  display: inline-block;\n  cursor: ", ";\n  color: ", ";\n"], ["\n  ", ";\n  position: relative;\n  display: inline-block;\n  cursor: ", ";\n  color: ", ";\n"])), textStyles_1.getFontStyle({ size: 'medium' }), function (props) { return (props.disabled ? 'not-allowed' : 'pointer'); }, styled_1.themed(function (props) { return props.theme.text1; }));
var ToggleBoxWrapper = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  display: inline-block;\n  vertical-align: middle;\n  padding: ", " 0;\n"], ["\n  display: inline-block;\n  vertical-align: middle;\n  padding: ", " 0;\n"])), distance_1.distance.xsmall);
var StyledInput = styled_1.default.input(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  opacity: 0;\n  position: absolute;\n  top: 0;\n  left: 0;\n"], ["\n  opacity: 0;\n  position: absolute;\n  top: 0;\n  left: 0;\n"])));
var ToggleBox = styled_1.default('div')(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  outline: 0;\n  display: block;\n  width: ", ";\n  height: ", ";\n  border-radius: ", ";\n  position: relative;\n  background: ", ";\n  transition: all ", " ", ";\n"], ["\n  outline: 0;\n  display: block;\n  width: ", ";\n  height: ", ";\n  border-radius: ", ";\n  position: relative;\n  background: ", ";\n  transition: all ", " ", ";\n"])), distance_1.distance.xxlarge, distance_1.distance.medium, distance_1.distance.small, styled_1.themed(function (props) { return props.theme.ui4; }), transitionDuration, transitionEase);
var StyledLabel = styled_1.default.label(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  display: block;\n  margin-bottom: ", ";\n"], ["\n  display: block;\n  margin-bottom: ", ";\n"])), distance_1.distance.small);
var StyledDesc = styled_1.default.span(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  display: inline-block;\n  margin-left: ", ";\n  vertical-align: middle;\n"], ["\n  display: inline-block;\n  margin-left: ", ";\n  vertical-align: middle;\n"])), distance_1.distance.small);
var IndicatorKnobStyle = {
    transform: 'translate(0, -50%)',
};
var ToggleInt = /** @class */ (function (_super) {
    __extends(ToggleInt, _super);
    function ToggleInt(props) {
        var _this = _super.call(this, props) || this;
        _this.handleOnClick = function (e) {
            _this.changeValue();
            e.preventDefault();
        };
        _this.handleCheckboxChange = function () {
            _this.changeValue();
        };
        _this.handleCheckboxFocus = function () {
            _this.setState({
                focused: true,
            });
        };
        _this.handleCheckboxBlur = function () {
            _this.setState({
                focused: false,
            });
        };
        _this.state = {
            controlled: typeof props.value !== 'undefined',
            value: props.value || props.defaultValue || false,
            focused: false,
            error: props.error,
        };
        return _this;
    }
    ToggleInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    ToggleInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    ToggleInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.value, value = _b === void 0 ? false : _b, error = _a.error;
        if (this.state.controlled) {
            this.setState({ value: value });
        }
        this.setState({ error: error });
    };
    ToggleInt.prototype.changeValue = function () {
        var _a = this.props, onChange = _a.onChange, disabled = _a.disabled, form = _a.form, _b = _a.name, name = _b === void 0 ? '' : _b;
        if (!disabled) {
            var _c = this.state, controlled = _c.controlled, value = _c.value;
            var status_1 = !value;
            if (!controlled) {
                if (form) {
                    form.change({
                        name: name,
                        value: status_1,
                    });
                }
                else {
                    this.setState({
                        value: status_1,
                    });
                }
            }
            if (typeof onChange === 'function') {
                onChange({
                    value: status_1,
                });
            }
        }
    };
    ToggleInt.prototype.render = function () {
        var _a = this.props, children = _a.children, disabled = _a.disabled, theme = _a.theme, _0 = _a.value, _1 = _a.defaultValue, _2 = _a.onChange, _3 = _a.onInput, info = _a.info, label = _a.label, props = __rest(_a, ["children", "disabled", "theme", "value", "defaultValue", "onChange", "onInput", "info", "label"]);
        var _b = this.state, value = _b.value, focused = _b.focused, error = _b.error;
        var containerProps = __assign({}, props, { theme: theme, onClick: this.handleOnClick, disabled: disabled });
        var boxProps = {
            checked: value,
            theme: theme,
        };
        return (React.createElement(ToggleContainer, __assign({}, containerProps),
            label && React.createElement(StyledLabel, { theme: theme }, label),
            React.createElement(ToggleBoxWrapper, null,
                React.createElement(StyledInput, { checked: value, onChange: this.handleCheckboxChange, onFocus: this.handleCheckboxFocus, onBlur: this.handleCheckboxBlur }),
                React.createElement(ToggleBox, __assign({}, boxProps),
                    React.createElement(IndicatorKnob_1.IndicatorKnob, { style: IndicatorKnobStyle, x: value ? 0.5 : 0, active: value, focus: focused, disabled: containerProps.disabled, animate: true }))),
            children && React.createElement(StyledDesc, null, children),
            (error || info) && (React.createElement(PaddedContainer_1.PaddedContainer, { top: "xsmall", bottom: "xsmall" },
                React.createElement(InputNotification_1.InputNotification, { error: error, info: info })))));
    };
    ToggleInt.inner = {
        get ToggleContainer() { return ToggleContainer; },
        get StyledLabel() { return StyledLabel; },
        get ToggleBoxWrapper() { return ToggleBoxWrapper; },
        get StyledInput() { return StyledInput; },
        get ToggleBox() { return ToggleBox; },
        get IndicatorKnob() { return IndicatorKnob_1.IndicatorKnob; },
        get StyledDesc() { return StyledDesc; },
        get PaddedContainer() { return PaddedContainer_1.PaddedContainer; },
        get InputNotification() { return InputNotification_1.InputNotification; }
    };
    return ToggleInt;
}(React.PureComponent));
/**
 * The toggle component displays a button to toggle a checked state.
 */
exports.Toggle = hoc_1.withFormContext(ToggleInt);
exports.Toggle.displayName = 'Toggle';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Ub2dnbGUvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBb0Q7QUFFcEQsaUNBQThEO0FBQzlELDJDQUEwQztBQUMxQyxrREFBaUQ7QUFDakQsK0NBQWdEO0FBQ2hELDBEQUF5RDtBQUN6RCxzREFBcUQ7QUEwQnJELElBQU0sa0JBQWtCLEdBQUcsTUFBTSxDQUFDO0FBQ2xDLElBQU0sY0FBYyxHQUFHLDZCQUE2QixDQUFDO0FBQ3JELElBQU0sZUFBZSxHQUFHLGdCQUFNLENBQUMsS0FBSyxDQUFDLGtLQUF1QixNQUN4RCxFQUFnQyxnRUFHeEIsRUFBcUQsY0FDdEQsRUFBa0MsS0FDNUMsS0FMRyx5QkFBWSxDQUFDLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBR3hCLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxFQUE1QyxDQUE0QyxFQUN0RCxlQUFNLENBQUMsVUFBQSxLQUFLLElBQUksT0FBQSxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBakIsQ0FBaUIsQ0FBQyxDQUM1QyxDQUFDO0FBQ0YsSUFBTSxnQkFBZ0IsR0FBRyxnQkFBTSxDQUFDLEdBQUcsZ0pBQUMsb0VBR3ZCLEVBQWUsT0FDM0IsS0FEWSxtQkFBUSxDQUFDLE1BQU0sQ0FDM0IsQ0FBQztBQUNGLElBQU0sV0FBVyxHQUFHLGdCQUFNLENBQUMsS0FBSyxvSUFBQyxpRUFLaEMsSUFBQSxDQUFDO0FBQ0YsSUFBTSxTQUFTLEdBQUcsZ0JBQU0sQ0FBQyxLQUFLLENBQUMsNE9BQWlCLCtDQUdyQyxFQUFnQixlQUNmLEVBQWUsc0JBQ1IsRUFB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QUksZUFBZSxLQUFLLE9BQU8saUNBQXlDLENBQUMsQ0FBQyxDQUFDO1FBQzNFLElBQUksaUJBQWlCLEtBQUssT0FBTyxxQ0FBNkMsQ0FBQyxDQUFDLENBQUM7S0FDcEYsQ0FBQztJQUNOLGdCQUFDO0NBQUEsQUE5R0QsQ0FBd0IsS0FBSyxDQUFDLGFBQWEsR0E4RzFDO0FBQ0Q7O0dBRUc7QUFDVSxRQUFBLE1BQU0sR0FBRyxxQkFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2pELGNBQU0sQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwgeyB0aGVtZWQgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgSW5wdXRQcm9wcywgSW5wdXRDaGFuZ2VFdmVudCB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5pbXBvcnQgeyB3aXRoRm9ybUNvbnRleHQsIEZvcm1Db250ZXh0UHJvcHMgfSBmcm9tICcuLi8uLi9ob2MnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBJbmRpY2F0b3JLbm9iIH0gZnJvbSAnLi4vSW5kaWNhdG9yS25vYic7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmltcG9ydCB7IElucHV0Tm90aWZpY2F0aW9uIH0gZnJvbSAnLi4vSW5wdXROb3RpZmljYXRpb24nO1xuaW1wb3J0IHsgUGFkZGVkQ29udGFpbmVyIH0gZnJvbSAnLi4vUGFkZGVkQ29udGFpbmVyJztcbmV4cG9ydCB0eXBlIFRvZ2dsZUNoYW5nZUV2ZW50ID0gSW5wdXRDaGFuZ2VFdmVudDxib29sZWFuPjtcbmV4cG9ydCBpbnRlcmZhY2UgVG9nZ2xlUHJvcHMgZXh0ZW5kcyBJbnB1dFByb3BzPGJvb2xlYW4+IHtcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSB0ZXh0IG9mIGxhYmVsLlxuICAgICAqIEBkZWZhdWx0ICcnXG4gICAgICovXG4gICAgbGFiZWw/OiBSZWFjdC5SZWFjdENoaWxkO1xuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IG9mIHRoZSB0b2dnbGUgYnV0dG9uLlxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlO1xufVxuZXhwb3J0IGludGVyZmFjZSBUb2dnbGVTdGF0ZSB7XG4gICAgdmFsdWU6IGJvb2xlYW47XG4gICAgZXJyb3I/OiBSZWFjdC5SZWFjdENoaWxkO1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG4gICAgZm9jdXNlZDogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBUb2dnbGVDb250YWluZXJQcm9wcyB7XG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xufVxuaW50ZXJmYWNlIFRvZ2dsZUJveFByb3BzIHtcbiAgICBjaGVja2VkOiBib29sZWFuO1xuICAgIHRoZW1lOiBhbnk7XG59XG5jb25zdCB0cmFuc2l0aW9uRHVyYXRpb24gPSAnMC4zcyc7XG5jb25zdCB0cmFuc2l0aW9uRWFzZSA9ICdjdWJpYy1iZXppZXIoMCwgMCwgMC4yNSwgMSknO1xuY29uc3QgVG9nZ2xlQ29udGFpbmVyID0gc3R5bGVkKCdkaXYnKTxUb2dnbGVDb250YWluZXJQcm9wcz4gYFxuICAke2dldEZvbnRTdHlsZSh7IHNpemU6ICdtZWRpdW0nIH0pfTtcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIGN1cnNvcjogJHtwcm9wcyA9PiAocHJvcHMuZGlzYWJsZWQgPyAnbm90LWFsbG93ZWQnIDogJ3BvaW50ZXInKX07XG4gIGNvbG9yOiAke3RoZW1lZChwcm9wcyA9PiBwcm9wcy50aGVtZS50ZXh0MSl9O1xuYDtcbmNvbnN0IFRvZ2dsZUJveFdyYXBwZXIgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xuICBwYWRkaW5nOiAke2Rpc3RhbmNlLnhzbWFsbH0gMDtcbmA7XG5jb25zdCBTdHlsZWRJbnB1dCA9IHN0eWxlZC5pbnB1dCBgXG4gIG9wYWNpdHk6IDA7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgdG9wOiAwO1xuICBsZWZ0OiAwO1xuYDtcbmNvbnN0IFRvZ2dsZUJveCA9IHN0eWxlZCgnZGl2Jyk8VG9nZ2xlQm94UHJvcHM+IGBcbiAgb3V0bGluZTogMDtcbiAgZGlzcGxheTogYmxvY2s7XG4gIHdpZHRoOiAke2Rpc3RhbmNlLnh4bGFyZ2V9O1xuICBoZWlnaHQ6ICR7ZGlzdGFuY2UubWVkaXVtfTtcbiAgYm9yZGVyLXJhZGl1czogJHtkaXN0YW5jZS5zbWFsbH07XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgYmFja2dyb3VuZDogJHt0aGVtZWQocHJvcHMgPT4gcHJvcHMudGhlbWUudWk0KX07XG4gIHRyYW5zaXRpb246IGFsbCAke3RyYW5zaXRpb25EdXJhdGlvbn0gJHt0cmFuc2l0aW9uRWFzZX07XG5gO1xuY29uc3QgU3R5bGVkTGFiZWwgPSBzdHlsZWQubGFiZWwgYFxuICBkaXNwbGF5OiBibG9jaztcbiAgbWFyZ2luLWJvdHRvbTogJHtkaXN0YW5jZS5zbWFsbH07XG5gO1xuY29uc3QgU3R5bGVkRGVzYyA9IHN0eWxlZC5zcGFuIGBcbiAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICBtYXJnaW4tbGVmdDogJHtkaXN0YW5jZS5zbWFsbH07XG4gIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7XG5gO1xuY29uc3QgSW5kaWNhdG9yS25vYlN0eWxlOiBSZWFjdC5DU1NQcm9wZXJ0aWVzID0ge1xuICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwLCAtNTAlKScsXG59O1xuY2xhc3MgVG9nZ2xlSW50IGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxUb2dnbGVQcm9wcyAmIEZvcm1Db250ZXh0UHJvcHMsIFRvZ2dsZVN0YXRlPiB7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IFRvZ2dsZVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHR5cGVvZiBwcm9wcy52YWx1ZSAhPT0gJ3VuZGVmaW5lZCcsXG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlIHx8IGZhbHNlLFxuICAgICAgICAgICAgZm9jdXNlZDogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgIH07XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyB2YWx1ZSA9IGZhbHNlLCBlcnJvciB9OiBUb2dnbGVQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yIH0pO1xuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZVZhbHVlKCkge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlLCBkaXNhYmxlZCwgZm9ybSwgbmFtZSA9ICcnIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIWRpc2FibGVkKSB7XG4gICAgICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQsIHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gIXZhbHVlO1xuICAgICAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBzdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogc3RhdHVzLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgaGFuZGxlT25DbGljayA9IChlOiBSZWFjdC5Nb3VzZUV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlQ2hlY2tib3hDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuY2hhbmdlVmFsdWUoKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlQ2hlY2tib3hGb2N1cyA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBmb2N1c2VkOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlQ2hlY2tib3hCbHVyID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGZvY3VzZWQ6IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBjaGlsZHJlbiwgZGlzYWJsZWQsIHRoZW1lLCB2YWx1ZTogXzAsIGRlZmF1bHRWYWx1ZTogXzEsIG9uQ2hhbmdlOiBfMiwgb25JbnB1dDogXzMsIGluZm8sIGxhYmVsLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgZm9jdXNlZCwgZXJyb3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IGNvbnRhaW5lclByb3BzID0ge1xuICAgICAgICAgICAgLi4ucHJvcHMsXG4gICAgICAgICAgICB0aGVtZSxcbiAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuaGFuZGxlT25DbGljayxcbiAgICAgICAgICAgIGRpc2FibGVkLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBib3hQcm9wcyA9IHtcbiAgICAgICAgICAgIGNoZWNrZWQ6IHZhbHVlLFxuICAgICAgICAgICAgdGhlbWUsXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiAoPFRvZ2dsZUNvbnRhaW5lciB7Li4uY29udGFpbmVyUHJvcHN9PlxuICAgICAgICB7bGFiZWwgJiYgPFN0eWxlZExhYmVsIHRoZW1lPXt0aGVtZX0+e2xhYmVsfTwvU3R5bGVkTGFiZWw+fVxuICAgICAgICA8VG9nZ2xlQm94V3JhcHBlcj5cbiAgICAgICAgICA8U3R5bGVkSW5wdXQgY2hlY2tlZD17dmFsdWV9IG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoZWNrYm94Q2hhbmdlfSBvbkZvY3VzPXt0aGlzLmhhbmRsZUNoZWNrYm94Rm9jdXN9IG9uQmx1cj17dGhpcy5oYW5kbGVDaGVja2JveEJsdXJ9Lz5cbiAgICAgICAgICA8VG9nZ2xlQm94IHsuLi5ib3hQcm9wc30+XG4gICAgICAgICAgICA8SW5kaWNhdG9yS25vYiBzdHlsZT17SW5kaWNhdG9yS25vYlN0eWxlfSB4PXt2YWx1ZSA/IDAuNSA6IDB9IGFjdGl2ZT17dmFsdWV9IGZvY3VzPXtmb2N1c2VkfSBkaXNhYmxlZD17Y29udGFpbmVyUHJvcHMuZGlzYWJsZWR9IGFuaW1hdGUvPlxuICAgICAgICAgIDwvVG9nZ2xlQm94PlxuICAgICAgICA8L1RvZ2dsZUJveFdyYXBwZXI+XG4gICAgICAgIHtjaGlsZHJlbiAmJiA8U3R5bGVkRGVzYz57Y2hpbGRyZW59PC9TdHlsZWREZXNjPn1cbiAgICAgICAgeyhlcnJvciB8fCBpbmZvKSAmJiAoPFBhZGRlZENvbnRhaW5lciB0b3A9XCJ4c21hbGxcIiBib3R0b209XCJ4c21hbGxcIj5cbiAgICAgICAgICAgIDxJbnB1dE5vdGlmaWNhdGlvbiBlcnJvcj17ZXJyb3J9IGluZm89e2luZm99Lz5cbiAgICAgICAgICA8L1BhZGRlZENvbnRhaW5lcj4pfVxuICAgICAgPC9Ub2dnbGVDb250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgVG9nZ2xlQ29udGFpbmVyKCkgeyByZXR1cm4gVG9nZ2xlQ29udGFpbmVyIGFzIHR5cGVvZiBUb2dnbGVDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBTdHlsZWRMYWJlbCgpIHsgcmV0dXJuIFN0eWxlZExhYmVsIGFzIHR5cGVvZiBTdHlsZWRMYWJlbDsgfSxcbiAgICAgICAgZ2V0IFRvZ2dsZUJveFdyYXBwZXIoKSB7IHJldHVybiBUb2dnbGVCb3hXcmFwcGVyIGFzIHR5cGVvZiBUb2dnbGVCb3hXcmFwcGVyOyB9LFxuICAgICAgICBnZXQgU3R5bGVkSW5wdXQoKSB7IHJldHVybiBTdHlsZWRJbnB1dCBhcyB0eXBlb2YgU3R5bGVkSW5wdXQ7IH0sXG4gICAgICAgIGdldCBUb2dnbGVCb3goKSB7IHJldHVybiBUb2dnbGVCb3ggYXMgdHlwZW9mIFRvZ2dsZUJveDsgfSxcbiAgICAgICAgZ2V0IEluZGljYXRvcktub2IoKSB7IHJldHVybiBJbmRpY2F0b3JLbm9iIGFzIHR5cGVvZiBJbmRpY2F0b3JLbm9iOyB9LFxuICAgICAgICBnZXQgU3R5bGVkRGVzYygpIHsgcmV0dXJuIFN0eWxlZERlc2MgYXMgdHlwZW9mIFN0eWxlZERlc2M7IH0sXG4gICAgICAgIGdldCBQYWRkZWRDb250YWluZXIoKSB7IHJldHVybiBQYWRkZWRDb250YWluZXIgYXMgdHlwZW9mIFBhZGRlZENvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IElucHV0Tm90aWZpY2F0aW9uKCkgeyByZXR1cm4gSW5wdXROb3RpZmljYXRpb24gYXMgdHlwZW9mIElucHV0Tm90aWZpY2F0aW9uOyB9XG4gICAgfTtcbn1cbi8qKlxuICogVGhlIHRvZ2dsZSBjb21wb25lbnQgZGlzcGxheXMgYSBidXR0b24gdG8gdG9nZ2xlIGEgY2hlY2tlZCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGNvbnN0IFRvZ2dsZSA9IHdpdGhGb3JtQ29udGV4dChUb2dnbGVJbnQpO1xuVG9nZ2xlLmRpc3BsYXlOYW1lID0gJ1RvZ2dsZSc7XG4iXX0=