"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var hoc_1 = require("../../hoc");
var CustomReactDatepicker_part_1 = require("./CustomReactDatepicker.part");
var DateFieldTextField_part_1 = require("./DateFieldTextField.part");
var utils_1 = require("../../utils");
var reactDatepickerProps = {
    adjustDateOnChange: 1,
    allowSameDay: 1,
    autoComplete: 1,
    autoFocus: 1,
    calendarClassName: 1,
    calendarContainer: 1,
    children: 1,
    className: 1,
    clearButtonTitle: 1,
    customInput: 1,
    customInputRef: 1,
    dateFormat: 1,
    dateFormatCalendar: 1,
    dayClassName: 1,
    disabled: 1,
    disabledKeyboardNavigation: 1,
    dropdownMode: 1,
    endDate: 1,
    excludeDates: 1,
    excludeTimes: 1,
    filterDate: 1,
    fixedHeight: 1,
    forceShowMonthNavigation: 1,
    formatWeekDay: 1,
    formatWeekNumber: 1,
    highlightDates: 1,
    id: 1,
    includeDates: 1,
    includeTimes: 1,
    injectTimes: 1,
    inline: 1,
    isClearable: 1,
    locale: 1,
    maxDate: 1,
    maxTime: 1,
    minDate: 1,
    minTime: 1,
    monthsShown: 1,
    name: 1,
    nextMonthButtonLabel: 1,
    onBlur: 1,
    onChange: 1,
    onChangeRaw: 1,
    onClickOutside: 1,
    onFocus: 1,
    onInputClick: 1,
    onInputError: 1,
    onKeyDown: 1,
    onMonthChange: 1,
    onSelect: 1,
    onWeekSelect: 1,
    onYearChange: 1,
    open: 1,
    openToDate: 1,
    peekNextMonth: 1,
    placeholderText: 1,
    popperClassName: 1,
    popperContainer: 1,
    popperModifiers: 1,
    popperPlacement: 1,
    popperProps: 1,
    preventOpenOnFocus: 1,
    previousMonthButtonLabel: 1,
    readOnly: 1,
    renderCustomHeader: 1,
    renderDayContents: 1,
    required: 1,
    scrollableMonthYearDropdown: 1,
    scrollableYearDropdown: 1,
    selected: 1,
    selectsEnd: 1,
    selectsStart: 1,
    shouldCloseOnSelect: 1,
    showDisabledMonthNavigation: 1,
    showMonthDropdown: 1,
    showMonthYearDropdown: 1,
    showMonthYearPicker: 1,
    showTimeSelect: 1,
    showTimeSelectOnly: 1,
    showWeekNumbers: 1,
    showYearDropdown: 1,
    startDate: 1,
    startOpen: 1,
    strictParsing: 1,
    tabIndex: 1,
    timeCaption: 1,
    timeFormat: 1,
    timeIntervals: 1,
    title: 1,
    todayButton: 1,
    useShortMonthInDropdown: 1,
    useWeekdaysShort: 1,
    value: 1,
    weekLabel: 1,
    withPortal: 1,
    yearDropdownItemNumber: 1,
    timeInputLabel: 1,
    inlineFocusSelectedMonth: 1,
    onDayMouseEnter: 1,
    onMonthMouseLeave: 1,
};
var excludedReactDatePickerProps = {
    autoComplete: 1,
    onBlur: 1,
    onChange: 1,
    onFocus: 1,
    children: 1,
    todayButton: 1,
    placeholderText: 1,
    isClearable: 1,
    withPortal: 1,
    showYearDropdown: 1,
    showMonthDropdown: 1,
    useShortMonthInDropdown: 1,
    showMonthYearDropdown: 1,
    dropdownMode: 1,
    monthsShown: 1,
    showTimeInput: 1,
    showMonthYearPicker: 1,
};
var DefaultDateFormat = utils_1.getIsoDateFormat();
var DateFieldInt = /** @class */ (function (_super) {
    __extends(DateFieldInt, _super);
    function DateFieldInt(props) {
        var _this = _super.call(this, props) || this;
        _this.changeValue = function (inputDate) {
            var _a = _this.props, _b = _a.dateFormat, dateFormat = _b === void 0 ? DefaultDateFormat : _b, locale = _a.locale;
            var date = inputDate || undefined;
            var value = utils_1.safeDateFormat(date, {
                dateFormat: dateFormat,
                locale: locale,
            });
            _this.change(date, value);
        };
        _this.changeInput = function (e) {
            var onChangeRaw = _this.props.onChangeRaw;
            var value = e.target.value;
            _this.change(_this.parseDate(value), value);
            if (typeof onChangeRaw === 'function') {
                onChangeRaw(e);
            }
        };
        _this.parseDate = function (value) {
            var _a = _this.props, locale = _a.locale, _b = _a.dateFormat, dateFormat = _b === void 0 ? DefaultDateFormat : _b, strictParsing = _a.strictParsing;
            return utils_1.parseDate(value, dateFormat, locale, strictParsing) || undefined;
        };
        _this.change = function (date, value) {
            var _a = _this.props, onChange = _a.onChange, _b = _a.name, name = _b === void 0 ? '' : _b, form = _a.form;
            if (!_this.valueControlled) {
                _this.setState({ value: value, date: date }, function () {
                    form &&
                        form.change({
                            name: name,
                            value: value,
                        });
                    _this.onOpenChange(true);
                });
            }
            if (typeof onChange === 'function') {
                onChange({
                    value: value,
                    date: date,
                });
            }
        };
        _this.onClickOutside = function (event) {
            var onClickOutside = _this.props.onClickOutside;
            _this.onOpenChange(false);
            if (typeof onClickOutside === 'function') {
                onClickOutside(event);
            }
        };
        _this.onFocus = function () {
            var onFocus = _this.props.onFocus;
            _this.onOpenChange(true);
            if (typeof onFocus === 'function') {
                onFocus();
            }
        };
        _this.onBlur = function () {
            var onBlur = _this.props.onBlur;
            _this.onOpenChange(false);
            if (typeof onBlur === 'function') {
                onBlur();
            }
        };
        var value = props.value || props.defaultValue || '';
        var date = value ? _this.parseDate(value) : new Date();
        _this.valueControlled = props.value !== undefined;
        _this.state = {
            error: props.error,
            date: date,
            value: value,
        };
        return _this;
    }
    DateFieldInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.value, value = _b === void 0 ? '' : _b, error = _a.error;
        if (this.valueControlled) {
            this.setState({ value: value, date: this.parseDate(value) });
        }
        this.setState({ error: error });
    };
    DateFieldInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        if (!this.valueControlled && form) {
            form.subscribe(this);
        }
    };
    DateFieldInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        if (!this.valueControlled && form) {
            form.unsubscribe(this);
        }
    };
    DateFieldInt.prototype.onOpenChange = function (open) {
        var onOpenChange = this.props.onOpenChange;
        if (typeof onOpenChange === 'function') {
            onOpenChange({
                open: open,
            });
        }
    };
    DateFieldInt.prototype.render = function () {
        var _a = this.props, autoComplete = _a.autoComplete, months = _a.months, weekDays = _a.weekDays, open = _a.open, placeholder = _a.placeholder, _0 = _a.name, _1 = _a.value, _2 = _a.defaultValue, _3 = _a.onChange, _4 = _a.onOpenChange, _5 = _a.onClickOutside, _6 = _a.onFocus, _7 = _a.onBlur, rest = __rest(_a, ["autoComplete", "months", "weekDays", "open", "placeholder", "name", "value", "defaultValue", "onChange", "onOpenChange", "onClickOutside", "onFocus", "onBlur"]);
        var datePickerProps = {};
        var customInputProps = {};
        Object.keys(rest).forEach(function (propName) {
            if (excludedReactDatePickerProps[propName]) {
                return;
            }
            if (reactDatepickerProps[propName]) {
                datePickerProps[propName] = rest[propName];
            }
            else {
                customInputProps[propName] = rest[propName];
            }
        });
        var _b = this.state, value = _b.value, error = _b.error, date = _b.date;
        return (React.createElement(CustomReactDatepicker_part_1.CustomReactDatepicker, __assign({ customInput: React.createElement(DateFieldTextField_part_1.DatePickerTextField, __assign({}, customInputProps, { error: error, autoComplete: autoComplete })), placeholderText: placeholder, customInputRef: "inputRef", months: months, weekDays: weekDays, value: value, selected: date }, datePickerProps, { open: open, onChange: this.changeValue, onChangeRaw: this.changeInput, onClickOutside: this.onClickOutside, onFocus: this.onFocus, onBlur: this.onBlur })));
    };
    DateFieldInt.inner = {
        get CustomReactDatepicker() { return CustomReactDatepicker_part_1.CustomReactDatepicker; }
    };
    return DateFieldInt;
}(React.Component));
exports.DateField = hoc_1.withFormContext(DateFieldInt);
exports.DateField.displayName = 'DateField';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0ZUZpZWxkSW50LnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9EYXRlRmllbGQvRGF0ZUZpZWxkSW50LnBhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsNkJBQStCO0FBRy9CLGlDQUE4RDtBQUM5RCwyRUFBcUU7QUFDckUscUVBQWdFO0FBQ2hFLHFDQUEwRTtBQVExRSxJQUFNLG9CQUFvQixHQUFHO0lBQ3pCLGtCQUFrQixFQUFFLENBQUM7SUFDckIsWUFBWSxFQUFFLENBQUM7SUFDZixZQUFZLEVBQUUsQ0FBQztJQUNmLFNBQVMsRUFBRSxDQUFDO0lBQ1osaUJBQWlCLEVBQUUsQ0FBQztJQUNwQixpQkFBaUIsRUFBRSxDQUFDO0lBQ3BCLFFBQVEsRUFBRSxDQUFDO0lBQ1gsU0FBUyxFQUFFLENBQUM7SUFDWixnQkFBZ0IsRUFBRSxDQUFDO0lBQ25CLFdBQVcsRUFBRSxDQUFDO0lBQ2QsY0FBYyxFQUFFLENBQUM7SUFDakIsVUFBVSxFQUFFLENBQUM7SUFDYixrQkFBa0IsRUFBRSxDQUFDO0lBQ3JCLFlBQVksRUFBRSxDQUFDO0lBQ2YsUUFBUSxFQUFFLENBQUM7SUFDWCwwQkFBMEIsRUFBRSxDQUFDO0lBQzdCLFlBQVksRUFBRSxDQUFDO0lBQ2YsT0FBTyxFQUFFLENBQUM7SUFDVixZQUFZLEVBQUUsQ0FBQztJQUNmLFlBQVksRUFBRSxDQUFDO0lBQ2YsVUFBVSxFQUFFLENBQUM7SUFDYixXQUFXLEVBQUUsQ0FBQztJQUNkLHdCQUF3QixFQUFFLENBQUM7SUFDM0IsYUFBYSxFQUFFLENBQUM7SUFDaEIsZ0JBQWdCLEVBQUUsQ0FBQztJQUNuQixjQUFjLEVBQUUsQ0FBQztJQUNqQixFQUFFLEVBQUUsQ0FBQztJQUNMLFlBQVksRUFBRSxDQUFDO0lBQ2YsWUFBWSxFQUFFLENBQUM7SUFDZixXQUFXLEVBQUUs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QUFnQixJQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLFlBQVksSUFBRyxFQUFFLGVBQWUsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFDLFVBQVUsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxJQUFNLGVBQWUsSUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFFLGNBQWMsRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxJQUFHLENBQUMsQ0FBQztJQUNsYixDQUFDO0lBQ00sa0JBQUssR0FBRztRQUNYLElBQUkscUJBQXFCLEtBQUssT0FBTyxrREFBcUQsQ0FBQyxDQUFDLENBQUM7S0FDaEcsQ0FBQztJQUNOLG1CQUFDO0NBQUEsQUF6SEQsQ0FBMkIsS0FBSyxDQUFDLFNBQVMsR0F5SHpDO0FBQ1ksUUFBQSxTQUFTLEdBQUcscUJBQWUsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN2RCxpQkFBUyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBSZWFjdERhdGVQaWNrZXJQcm9wcyB9IGZyb20gJ3JlYWN0LWRhdGVwaWNrZXInO1xuaW1wb3J0IHsgVGV4dElucHV0UHJvcHMsIE9taXQsIElucHV0Q2hhbmdlRXZlbnQgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgRm9ybUNvbnRleHRQcm9wcywgd2l0aEZvcm1Db250ZXh0IH0gZnJvbSAnLi4vLi4vaG9jJztcbmltcG9ydCB7IEN1c3RvbVJlYWN0RGF0ZXBpY2tlciB9IGZyb20gJy4vQ3VzdG9tUmVhY3REYXRlcGlja2VyLnBhcnQnO1xuaW1wb3J0IHsgRGF0ZVBpY2tlclRleHRGaWVsZCB9IGZyb20gJy4vRGF0ZUZpZWxkVGV4dEZpZWxkLnBhcnQnO1xuaW1wb3J0IHsgcGFyc2VEYXRlLCBzYWZlRGF0ZUZvcm1hdCwgZ2V0SXNvRGF0ZUZvcm1hdCB9IGZyb20gJy4uLy4uL3V0aWxzJztcbmV4cG9ydCB7IFJlYWN0RGF0ZVBpY2tlclByb3BzIH07XG5leHBvcnQgaW50ZXJmYWNlIERhdGVGaWVsZE9wZW5DaGFuZ2VkRXZlbnQge1xuICAgIC8qKlxuICAgICAqIElmIHRoZSBjYWxlbmRhciBmbHlvdXQgaXMgc3VwcG9zZWQgdG8gYmUgb3BlbiBvciBjbG9zZWQuXG4gICAgICovXG4gICAgb3BlbjogYm9vbGVhbjtcbn1cbmNvbnN0IHJlYWN0RGF0ZXBpY2tlclByb3BzID0ge1xuICAgIGFkanVzdERhdGVPbkNoYW5nZTogMSxcbiAgICBhbGxvd1NhbWVEYXk6IDEsXG4gICAgYXV0b0NvbXBsZXRlOiAxLFxuICAgIGF1dG9Gb2N1czogMSxcbiAgICBjYWxlbmRhckNsYXNzTmFtZTogMSxcbiAgICBjYWxlbmRhckNvbnRhaW5lcjogMSxcbiAgICBjaGlsZHJlbjogMSxcbiAgICBjbGFzc05hbWU6IDEsXG4gICAgY2xlYXJCdXR0b25UaXRsZTogMSxcbiAgICBjdXN0b21JbnB1dDogMSxcbiAgICBjdXN0b21JbnB1dFJlZjogMSxcbiAgICBkYXRlRm9ybWF0OiAxLFxuICAgIGRhdGVGb3JtYXRDYWxlbmRhcjogMSxcbiAgICBkYXlDbGFzc05hbWU6IDEsXG4gICAgZGlzYWJsZWQ6IDEsXG4gICAgZGlzYWJsZWRLZXlib2FyZE5hdmlnYXRpb246IDEsXG4gICAgZHJvcGRvd25Nb2RlOiAxLFxuICAgIGVuZERhdGU6IDEsXG4gICAgZXhjbHVkZURhdGVzOiAxLFxuICAgIGV4Y2x1ZGVUaW1lczogMSxcbiAgICBmaWx0ZXJEYXRlOiAxLFxuICAgIGZpeGVkSGVpZ2h0OiAxLFxuICAgIGZvcmNlU2hvd01vbnRoTmF2aWdhdGlvbjogMSxcbiAgICBmb3JtYXRXZWVrRGF5OiAxLFxuICAgIGZvcm1hdFdlZWtOdW1iZXI6IDEsXG4gICAgaGlnaGxpZ2h0RGF0ZXM6IDEsXG4gICAgaWQ6IDEsXG4gICAgaW5jbHVkZURhdGVzOiAxLFxuICAgIGluY2x1ZGVUaW1lczogMSxcbiAgICBpbmplY3RUaW1lczogMSxcbiAgICBpbmxpbmU6IDEsXG4gICAgaXNDbGVhcmFibGU6IDEsXG4gICAgbG9jYWxlOiAxLFxuICAgIG1heERhdGU6IDEsXG4gICAgbWF4VGltZTogMSxcbiAgICBtaW5EYXRlOiAxLFxuICAgIG1pblRpbWU6IDEsXG4gICAgbW9udGhzU2hvd246IDEsXG4gICAgbmFtZTogMSxcbiAgICBuZXh0TW9udGhCdXR0b25MYWJlbDogMSxcbiAgICBvbkJsdXI6IDEsXG4gICAgb25DaGFuZ2U6IDEsXG4gICAgb25DaGFuZ2VSYXc6IDEsXG4gICAgb25DbGlja091dHNpZGU6IDEsXG4gICAgb25Gb2N1czogMSxcbiAgICBvbklucHV0Q2xpY2s6IDEsXG4gICAgb25JbnB1dEVycm9yOiAxLFxuICAgIG9uS2V5RG93bjogMSxcbiAgICBvbk1vbnRoQ2hhbmdlOiAxLFxuICAgIG9uU2VsZWN0OiAxLFxuICAgIG9uV2Vla1NlbGVjdDogMSxcbiAgICBvblllYXJDaGFuZ2U6IDEsXG4gICAgb3BlbjogMSxcbiAgICBvcGVuVG9EYXRlOiAxLFxuICAgIHBlZWtOZXh0TW9udGg6IDEsXG4gICAgcGxhY2Vob2xkZXJUZXh0OiAxLFxuICAgIHBvcHBlckNsYXNzTmFtZTogMSxcbiAgICBwb3BwZXJDb250YWluZXI6IDEsXG4gICAgcG9wcGVyTW9kaWZpZXJzOiAxLFxuICAgIHBvcHBlclBsYWNlbWVudDogMSxcbiAgICBwb3BwZXJQcm9wczogMSxcbiAgICBwcmV2ZW50T3Blbk9uRm9jdXM6IDEsXG4gICAgcHJldmlvdXNNb250aEJ1dHRvbkxhYmVsOiAxLFxuICAgIHJlYWRPbmx5OiAxLFxuICAgIHJlbmRlckN1c3RvbUhlYWRlcjogMSxcbiAgICByZW5kZXJEYXlDb250ZW50czogMSxcbiAgICByZXF1aXJlZDogMSxcbiAgICBzY3JvbGxhYmxlTW9udGhZZWFyRHJvcGRvd246IDEsXG4gICAgc2Nyb2xsYWJsZVllYXJEcm9wZG93bjogMSxcbiAgICBzZWxlY3RlZDogMSxcbiAgICBzZWxlY3RzRW5kOiAxLFxuICAgIHNlbGVjdHNTdGFydDogMSxcbiAgICBzaG91bGRDbG9zZU9uU2VsZWN0OiAxLFxuICAgIHNob3dEaXNhYmxlZE1vbnRoTmF2aWdhdGlvbjogMSxcbiAgICBzaG93TW9udGhEcm9wZG93bjogMSxcbiAgICBzaG93TW9udGhZZWFyRHJvcGRvd246IDEsXG4gICAgc2hvd01vbnRoWWVhclBpY2tlcjogMSxcbiAgICBzaG93VGltZVNlbGVjdDogMSxcbiAgICBzaG93VGltZVNlbGVjdE9ubHk6IDEsXG4gICAgc2hvd1dlZWtOdW1iZXJzOiAxLFxuICAgIHNob3dZZWFyRHJvcGRvd246IDEsXG4gICAgc3RhcnREYXRlOiAxLFxuICAgIHN0YXJ0T3BlbjogMSxcbiAgICBzdHJpY3RQYXJzaW5nOiAxLFxuICAgIHRhYkluZGV4OiAxLFxuICAgIHRpbWVDYXB0aW9uOiAxLFxuICAgIHRpbWVGb3JtYXQ6IDEsXG4gICAgdGltZUludGVydmFsczogMSxcbiAgICB0aXRsZTogMSxcbiAgICB0b2RheUJ1dHRvbjogMSxcbiAgICB1c2VTaG9ydE1vbnRoSW5Ecm9wZG93bjogMSxcbiAgICB1c2VXZWVrZGF5c1Nob3J0OiAxLFxuICAgIHZhbHVlOiAxLFxuICAgIHdlZWtMYWJlbDogMSxcbiAgICB3aXRoUG9ydGFsOiAxLFxuICAgIHllYXJEcm9wZG93bkl0ZW1OdW1iZXI6IDEsXG4gICAgdGltZUlucHV0TGFiZWw6IDEsXG4gICAgaW5saW5lRm9jdXNTZWxlY3RlZE1vbnRoOiAxLFxuICAgIG9uRGF5TW91c2VFbnRlcjogMSxcbiAgICBvbk1vbnRoTW91c2VMZWF2ZTogMSxcbn07XG5jb25zdCBleGNsdWRlZFJlYWN0RGF0ZVBpY2tlclByb3BzID0ge1xuICAgIGF1dG9Db21wbGV0ZTogMSxcbiAgICBvbkJsdXI6IDEsXG4gICAgb25DaGFuZ2U6IDEsXG4gICAgb25Gb2N1czogMSxcbiAgICBjaGlsZHJlbjogMSxcbiAgICB0b2RheUJ1dHRvbjogMSxcbiAgICBwbGFjZWhvbGRlclRleHQ6IDEsXG4gICAgaXNDbGVhcmFibGU6IDEsXG4gICAgd2l0aFBvcnRhbDogMSxcbiAgICBzaG93WWVhckRyb3Bkb3duOiAxLFxuICAgIHNob3dNb250aERyb3Bkb3duOiAxLFxuICAgIHVzZVNob3J0TW9udGhJbkRyb3Bkb3duOiAxLFxuICAgIHNob3dNb250aFllYXJEcm9wZG93bjogMSxcbiAgICBkcm9wZG93bk1vZGU6IDEsXG4gICAgbW9udGhzU2hvd246IDEsXG4gICAgc2hvd1RpbWVJbnB1dDogMSxcbiAgICBzaG93TW9udGhZZWFyUGlja2VyOiAxLFxufTtcbmV4cG9ydCBpbnRlcmZhY2UgRGF0ZVBpY2tlck9uQ2hhbmdlRXZlbnQgZXh0ZW5kcyBJbnB1dENoYW5nZUV2ZW50PHN0cmluZz4ge1xuICAgIGRhdGU/OiBEYXRlO1xufVxuZXhwb3J0IGludGVyZmFjZSBEYXRlRmllbGRCYXNpY1Byb3BzIGV4dGVuZHMgRm9ybUNvbnRleHRQcm9wcywgVGV4dElucHV0UHJvcHMge1xuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsIGFiYnJldmlhdGlvbnMgZm9yIHRoZSAxMiBtb250aHMgKEphbiAtIERlYykgb2YgdGhlIHllYXIgdG8gdXNlLlxuICAgICAqL1xuICAgIG1vbnRocz86IEFycmF5PHN0cmluZz47XG4gICAgLyoqXG4gICAgICogT3B0aW9uYWwgYWJicmV2aWF0aW9ucyBmb3IgdGhlIDcgZGF5cyAoTW9uIC0gU3VuKSBvZiB0aGUgd2VlayB0byB1c2UuXG4gICAgICovXG4gICAgd2Vla0RheXM/OiBBcnJheTxzdHJpbmc+O1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIHZpc2liaWx0eSBvZiB0aGUgY2FsZW5kYXIgZmx5b3V0LiBJZiBzZXQgdGhlIGZseW91dCB3aWxsIGJlIHNldFxuICAgICAqIHRvIGNvbnRyb2xsZWQgbW9kZSwgb3RoZXJ3aXNlIGl0IGlzIG1hbmFnZWQuXG4gICAgICovXG4gICAgb3Blbj86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRXZlbnQgZmlyZWQgd2hlbiB0aGUgZmx5b3V0IHdhbnRzIHRvIG9wZW4gb3IgY2xvc2UuXG4gICAgICovXG4gICAgb25PcGVuQ2hhbmdlPyhlOiBEYXRlRmllbGRPcGVuQ2hhbmdlZEV2ZW50KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBFdmVudCBlbWl0dGVkIG9uY2UgdGhlIHZhbHVlIGNoYW5nZXMgZHVlIHRvIHVzZXIgaW5wdXQuXG4gICAgICovXG4gICAgb25DaGFuZ2U/KGU6IERhdGVQaWNrZXJPbkNoYW5nZUV2ZW50KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgY2hpbGRyZW4/OiB2b2lkO1xufVxuZXhwb3J0IHR5cGUgRGF0ZUZpZWxkUHJvcHMgPSBEYXRlRmllbGRCYXNpY1Byb3BzICYgT21pdDxSZWFjdERhdGVQaWNrZXJQcm9wcywga2V5b2YgdHlwZW9mIGV4Y2x1ZGVkUmVhY3REYXRlUGlja2VyUHJvcHM+O1xuaW50ZXJmYWNlIERhdGVGaWVsZFN0YXRlIHtcbiAgICB2YWx1ZTogc3RyaW5nO1xuICAgIGRhdGU/OiBEYXRlO1xuICAgIGVycm9yPzogUmVhY3QuUmVhY3RDaGlsZDtcbn1cbmNvbnN0IERlZmF1bHREYXRlRm9ybWF0ID0gZ2V0SXNvRGF0ZUZvcm1hdCgpO1xuY2xhc3MgRGF0ZUZpZWxkSW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PERhdGVGaWVsZFByb3BzLCBEYXRlRmllbGRTdGF0ZT4ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdmFsdWVDb250cm9sbGVkOiBib29sZWFuO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBEYXRlRmllbGRQcm9wcykge1xuICAgICAgICBzdXBlcihwcm9wcyk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlIHx8ICcnO1xuICAgICAgICBjb25zdCBkYXRlID0gdmFsdWUgPyB0aGlzLnBhcnNlRGF0ZSh2YWx1ZSkgOiBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLnZhbHVlQ29udHJvbGxlZCA9IHByb3BzLnZhbHVlICE9PSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgICAgICBkYXRlLFxuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgIH07XG4gICAgfVxuICAgIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHsgdmFsdWUgPSAnJywgZXJyb3IgfTogRGF0ZUZpZWxkUHJvcHMpIHtcbiAgICAgICAgaWYgKHRoaXMudmFsdWVDb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUsIGRhdGU6IHRoaXMucGFyc2VEYXRlKHZhbHVlKSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3IgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICghdGhpcy52YWx1ZUNvbnRyb2xsZWQgJiYgZm9ybSkge1xuICAgICAgICAgICAgZm9ybS5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCF0aGlzLnZhbHVlQ29udHJvbGxlZCAmJiBmb3JtKSB7XG4gICAgICAgICAgICBmb3JtLnVuc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgb25PcGVuQ2hhbmdlKG9wZW46IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgeyBvbk9wZW5DaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0eXBlb2Ygb25PcGVuQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbk9wZW5DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIG9wZW4sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGNoYW5nZVZhbHVlOiBSZWFjdERhdGVQaWNrZXJQcm9wc1snb25DaGFuZ2UnXSA9IGlucHV0RGF0ZSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZGF0ZUZvcm1hdCA9IERlZmF1bHREYXRlRm9ybWF0LCBsb2NhbGUgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGRhdGUgPSBpbnB1dERhdGUgfHwgdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHNhZmVEYXRlRm9ybWF0KGRhdGUsIHtcbiAgICAgICAgICAgIGRhdGVGb3JtYXQsXG4gICAgICAgICAgICBsb2NhbGUsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNoYW5nZShkYXRlLCB2YWx1ZSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNoYW5nZUlucHV0ID0gKGU6IFJlYWN0LkZvY3VzRXZlbnQ8SFRNTElucHV0RWxlbWVudD4pID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZVJhdyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gZS50YXJnZXQ7XG4gICAgICAgIHRoaXMuY2hhbmdlKHRoaXMucGFyc2VEYXRlKHZhbHVlKSwgdmFsdWUpO1xuICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlUmF3ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNoYW5nZVJhdyhlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBwYXJzZURhdGUgPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCB7IGxvY2FsZSwgZGF0ZUZvcm1hdCA9IERlZmF1bHREYXRlRm9ybWF0LCBzdHJpY3RQYXJzaW5nIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICByZXR1cm4gcGFyc2VEYXRlKHZhbHVlLCBkYXRlRm9ybWF0LCBsb2NhbGUsIHN0cmljdFBhcnNpbmcpIHx8IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHByaXZhdGUgY2hhbmdlID0gKGRhdGU6IERhdGUgfCB1bmRlZmluZWQsIHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgbmFtZSA9ICcnLCBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIXRoaXMudmFsdWVDb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUsIGRhdGUgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGZvcm0gJiZcbiAgICAgICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uT3BlbkNoYW5nZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICBkYXRlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgb25DbGlja091dHNpZGU6IERhdGVGaWVsZFByb3BzWydvbkNsaWNrT3V0c2lkZSddID0gZXZlbnQgPT4ge1xuICAgICAgICBjb25zdCB7IG9uQ2xpY2tPdXRzaWRlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICB0aGlzLm9uT3BlbkNoYW5nZShmYWxzZSk7XG4gICAgICAgIGlmICh0eXBlb2Ygb25DbGlja091dHNpZGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2xpY2tPdXRzaWRlKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBvbkZvY3VzOiBEYXRlRmllbGRQcm9wc1snb25Gb2N1cyddID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IG9uRm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMub25PcGVuQ2hhbmdlKHRydWUpO1xuICAgICAgICBpZiAodHlwZW9mIG9uRm9jdXMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uRm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBvbkJsdXI6IERhdGVGaWVsZFByb3BzWydvbkJsdXInXSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkJsdXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIHRoaXMub25PcGVuQ2hhbmdlKGZhbHNlKTtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkJsdXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQmx1cigpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgYXV0b0NvbXBsZXRlLCBtb250aHMsIHdlZWtEYXlzLCBvcGVuLCBwbGFjZWhvbGRlciwgbmFtZTogXzAsIHZhbHVlOiBfMSwgZGVmYXVsdFZhbHVlOiBfMiwgb25DaGFuZ2U6IF8zLCBvbk9wZW5DaGFuZ2U6IF80LCBvbkNsaWNrT3V0c2lkZTogXzUsIG9uRm9jdXM6IF82LCBvbkJsdXI6IF83LCAuLi5yZXN0IH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBkYXRlUGlja2VyUHJvcHMgPSB7fSBhcyBSZWFjdERhdGVQaWNrZXJQcm9wcztcbiAgICAgICAgY29uc3QgY3VzdG9tSW5wdXRQcm9wcyA9IHt9IGFzIE9taXQ8RGF0ZUZpZWxkQmFzaWNQcm9wcywgJ29uQ2hhbmdlJyB8ICdjaGlsZHJlbic+O1xuICAgICAgICBPYmplY3Qua2V5cyhyZXN0KS5mb3JFYWNoKHByb3BOYW1lID0+IHtcbiAgICAgICAgICAgIGlmIChleGNsdWRlZFJlYWN0RGF0ZVBpY2tlclByb3BzW3Byb3BOYW1lXSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZWFjdERhdGVwaWNrZXJQcm9wc1twcm9wTmFtZV0pIHtcbiAgICAgICAgICAgICAgICBkYXRlUGlja2VyUHJvcHNbcHJvcE5hbWVdID0gcmVzdFtwcm9wTmFtZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjdXN0b21JbnB1dFByb3BzW3Byb3BOYW1lXSA9IHJlc3RbcHJvcE5hbWVdO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgZXJyb3IsIGRhdGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiAoPEN1c3RvbVJlYWN0RGF0ZXBpY2tlciBjdXN0b21JbnB1dD17PERhdGVQaWNrZXJUZXh0RmllbGQgey4uLmN1c3RvbUlucHV0UHJvcHN9IGVycm9yPXtlcnJvcn0gYXV0b0NvbXBsZXRlPXthdXRvQ29tcGxldGV9Lz59IHBsYWNlaG9sZGVyVGV4dD17cGxhY2Vob2xkZXJ9IGN1c3RvbUlucHV0UmVmPVwiaW5wdXRSZWZcIiBtb250aHM9e21vbnRoc30gd2Vla0RheXM9e3dlZWtEYXlzfSB2YWx1ZT17dmFsdWV9IHNlbGVjdGVkPXtkYXRlfSB7Li4uZGF0ZVBpY2tlclByb3BzfSBvcGVuPXtvcGVufSBvbkNoYW5nZT17dGhpcy5jaGFuZ2VWYWx1ZX0gb25DaGFuZ2VSYXc9e3RoaXMuY2hhbmdlSW5wdXR9IG9uQ2xpY2tPdXRzaWRlPXt0aGlzLm9uQ2xpY2tPdXRzaWRlfSBvbkZvY3VzPXt0aGlzLm9uRm9jdXN9IG9uQmx1cj17dGhpcy5vbkJsdXJ9Lz4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBDdXN0b21SZWFjdERhdGVwaWNrZXIoKSB7IHJldHVybiBDdXN0b21SZWFjdERhdGVwaWNrZXIgYXMgdHlwZW9mIEN1c3RvbVJlYWN0RGF0ZXBpY2tlcjsgfVxuICAgIH07XG59XG5leHBvcnQgY29uc3QgRGF0ZUZpZWxkID0gd2l0aEZvcm1Db250ZXh0KERhdGVGaWVsZEludCk7XG5EYXRlRmllbGQuZGlzcGxheU5hbWUgPSAnRGF0ZUZpZWxkJztcbiJdfQ==