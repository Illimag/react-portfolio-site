"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var icons = require("../Icon/icons");
var styled_1 = require("../../utils/styled");
var withFormContext_1 = require("../../hoc/withFormContext");
var colors_1 = require("../../colors");
var distance_1 = require("../../distance");
var RatingContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  display: inline-block;\n"], ["\n  display: inline-block;\n"])));
var SetAnimation = styled_1.keyframes(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  0% {\n    transform: scale(1);\n  }\n  25% {\n    transform: scale(1.5);\n  }\n  50% {\n    transform: scale(0.9);\n  }\n  75% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n  }\n"], ["\n  0% {\n    transform: scale(1);\n  }\n  25% {\n    transform: scale(1.5);\n  }\n  50% {\n    transform: scale(0.9);\n  }\n  75% {\n    transform: scale(1.2);\n  }\n  100% {\n    transform: scale(1);\n  }\n"])));
var RatingElement = styled_1.default.span(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  display: inline-block;\n  cursor: ", ";\n\n  & + & {\n    padding-left: ", ";\n  }\n"], ["\n  display: inline-block;\n  cursor: ", ";\n\n  & + & {\n    padding-left: ", ";\n  }\n"])), function (props) { return (props.disabled ? 'not-allowed' : 'pointer'); }, function (props) { return (props.size === 'medium' ? distance_1.distance.small : distance_1.distance.xsmall); });
function getColor(theme, disabled, i, value, hover) {
    if (!disabled) {
        if (hover !== -1) {
            if (i < hover) {
                return theme.ui0;
            }
            else if (i === hover) {
                return colors_1.ocean;
            }
        }
        else if (i < value) {
            return theme.ui5;
        }
        return theme.ui4;
    }
    else if (i < value) {
        return theme.ui4;
    }
    return theme.ui3;
}
function getAnimation(i, value) {
    if (i + 1 === value) {
        return styled_1.css(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n      ", " 0.5s ease-in-out\n    "], ["\n      ", " 0.5s ease-in-out\n    "])), SetAnimation);
    }
    return 'none';
}
var RatingIconInt = function (_a) {
    var disabled = _a.disabled, index = _a.index, value = _a.value, hover = _a.hover, size = _a.size, props = __rest(_a, ["disabled", "index", "value", "hover", "size"]);
    return (React.createElement(icons.Star, __assign({}, props)));
};
var RatingIcon = styled_1.default(RatingIconInt)(function (_a) {
    var theme = _a.theme, disabled = _a.disabled, index = _a.index, value = _a.value, hover = _a.hover, size = _a.size;
    return styled_1.css(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n    fill: ", ";\n    animation: ", ";\n    width: ", ";\n    height: ", ";\n  "], ["\n    fill: ", ";\n    animation: ", ";\n    width: ", ";\n    height: ", ";\n  "])), getColor(theme, disabled, index, value, hover), getAnimation(index, value), size, size);
});
var RatingInt = /** @class */ (function (_super) {
    __extends(RatingInt, _super);
    function RatingInt(props) {
        var _this = _super.call(this, props) || this;
        _this.hoverVoid = function () {
            _this.setState({
                hover: -1,
            });
        };
        var value = props.value, defaultValue = props.defaultValue, _a = props.levels, levels = _a === void 0 ? 5 : _a;
        var changers = [];
        var hovers = [];
        var _loop_1 = function (i) {
            changers.push(function () { return _this.updateValue(i + 1); });
            hovers.push(function () { return _this.hoverValue(i); });
        };
        for (var i = 0; i < levels; i++) {
            _loop_1(i);
        }
        _this.state = {
            controlled: value !== undefined,
            value: value || defaultValue || 0,
            error: props.error,
            hover: -1,
            changers: changers,
            hovers: hovers,
        };
        return _this;
    }
    RatingInt.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {
        if (this.state.controlled) {
            this.setState({
                value: nextProps.value || 0,
                error: nextProps.error,
            });
        }
    };
    RatingInt.prototype.componentDidMount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    RatingInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    RatingInt.prototype.updateValue = function (value) {
        var _a = this.props, onChange = _a.onChange, _b = _a.name, name = _b === void 0 ? '' : _b, form = _a.form;
        if (!this.state.controlled) {
            if (form) {
                form.change({
                    name: name,
                    value: value,
                });
            }
            else {
                this.setState({
                    value: value,
                });
            }
        }
        if (typeof onChange === 'function') {
            onChange({
                value: value,
            });
        }
    };
    RatingInt.prototype.hoverValue = function (value) {
        this.setState({
            hover: value,
        });
    };
    RatingInt.prototype.render = function () {
        var _this = this;
        var _a = this.props, _0 = _a.levels, _1 = _a.name, _2 = _a.value, _3 = _a.defaultValue, _4 = _a.onChange, _5 = _a.onInput, disabled = _a.disabled, _b = _a.size, size = _b === void 0 ? 'medium' : _b, _c = _a.icon, icon = _c === void 0 ? 'Star' : _c, props = __rest(_a, ["levels", "name", "value", "defaultValue", "onChange", "onInput", "disabled", "size", "icon"]);
        var _d = this.state, value = _d.value, changers = _d.changers, hover = _d.hover, hovers = _d.hovers;
        var dim = size === 'medium' ? '32px' : '22px';
        return (React.createElement(RatingContainer, __assign({}, props), changers.map(function (changer, i) { return (React.createElement(RatingElement, { key: i, size: size, onClick: changer, disabled: disabled, onMouseEnter: hovers[i], onMouseLeave: _this.hoverVoid },
            React.createElement(RatingIcon, { index: i, disabled: disabled, value: value, hover: hover, size: dim, as: icons[icon] }))); })));
    };
    RatingInt.inner = {
        get RatingContainer() { return RatingContainer; },
        get RatingElement() { return RatingElement; },
        get RatingIcon() { return RatingIcon; }
    };
    return RatingInt;
}(React.Component));
/**
 * An input control for providing user ratings.
 */
exports.Rating = withFormContext_1.withFormContext(RatingInt);
exports.Rating.displayName = 'Rating';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9SYXRpbmcvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQixxQ0FBdUM7QUFDdkMsNkNBQTREO0FBRzVELDZEQUE4RTtBQUM5RSx1Q0FBeUQ7QUFDekQsMkNBQTBDO0FBOEIxQyxJQUFNLGVBQWUsR0FBRyxnQkFBTSxDQUFDLEdBQUcsaUdBQUMsOEJBRWxDLElBQUEsQ0FBQztBQUtGLElBQU0sWUFBWSxHQUFHLGtCQUFTLHFSQUFDLGtOQWdCOUIsSUFBQSxDQUFDO0FBQ0YsSUFBTSxhQUFhLEdBQUcsZ0JBQU0sQ0FBQyxJQUFJLDZKQUFxQix3Q0FFMUMsRUFBcUQsb0NBRzdDLEVBQXFFLFVBRXhGLEtBTFcsVUFBQSxLQUFLLElBQUksT0FBQSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLEVBQTVDLENBQTRDLEVBRzdDLFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsbUJBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLG1CQUFRLENBQUMsTUFBTSxDQUFDLEVBQTVELENBQTRELENBRXhGLENBQUM7QUFDRixTQUFTLFFBQVEsQ0FBQyxLQUFtQixFQUFFLFFBQTZCLEVBQUUsQ0FBUyxFQUFFLEtBQWEsRUFBRSxLQUFhO0lBQ3pHLElBQUksQ0FBQyxRQUFRLEVBQUU7UUFDWCxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNkLElBQUksQ0FBQyxHQUFHLEtBQUssRUFBRTtnQkFDWCxPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDcEI7aUJBQ0ksSUFBSSxDQUFDLEtBQUssS0FBSyxF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QUFxQyxDQUFDLENBQUMsQ0FBQztRQUNyRSxJQUFJLFVBQVUsS0FBSyxPQUFPLFVBQStCLENBQUMsQ0FBQyxDQUFDO0tBQy9ELENBQUM7SUFDTixnQkFBQztDQUFBLEFBdkZELENBQXdCLEtBQUssQ0FBQyxTQUFTLEdBdUZ0QztBQUNEOztHQUVHO0FBQ1UsUUFBQSxNQUFNLEdBQUcsaUNBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNqRCxjQUFNLENBQUMsV0FBVyxHQUFHLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCAqIGFzIGljb25zIGZyb20gJy4uL0ljb24vaWNvbnMnO1xuaW1wb3J0IHN0eWxlZCwgeyBrZXlmcmFtZXMsIGNzcyB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBJY29uTmFtZSB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgSW5wdXRQcm9wcywgUHJlY2lzZVRoZW1lIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IHdpdGhGb3JtQ29udGV4dCwgRm9ybUNvbnRleHRQcm9wcyB9IGZyb20gJy4uLy4uL2hvYy93aXRoRm9ybUNvbnRleHQnO1xuaW1wb3J0IHsgYnJpZ2h0TGVtb24sIHdoaXRlLCBvY2VhbiB9IGZyb20gJy4uLy4uL2NvbG9ycyc7XG5pbXBvcnQgeyBkaXN0YW5jZSB9IGZyb20gJy4uLy4uL2Rpc3RhbmNlJztcbmV4cG9ydCBpbnRlcmZhY2UgUmF0aW5nUHJvcHMgZXh0ZW5kcyBJbnB1dFByb3BzPG51bWJlcj4ge1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGljb24gdG8gYmUgdXNlZC5cbiAgICAgKiBAZGVmYXVsdCBGYXZvcml0ZVxuICAgICAqL1xuICAgIGljb24/OiBJY29uTmFtZTtcbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIGxldmVscyBmb3IgdGhlIHJhdGluZy4gQnkgZGVmYXVsdCA1LlxuICAgICAqIEBkZWZhdWx0IDVcbiAgICAgKi9cbiAgICBsZXZlbHM/OiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgc2l6ZSBvZiB0aGUgc3RhcnMuXG4gICAgICogQGRlZmF1bHQgXCJtZWRpdW1cIlxuICAgICAqL1xuICAgIHNpemU/OiAnc21hbGwnIHwgJ21lZGl1bSc7XG4gICAgLyoqXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGNoaWxkcmVuPzogdm9pZDtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUmF0aW5nU3RhdGUge1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgICBlcnJvcj86IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgaG92ZXI6IG51bWJlcjtcbiAgICBjaGFuZ2VyczogQXJyYXk8KCkgPT4gdm9pZD47XG4gICAgaG92ZXJzOiBBcnJheTwoKSA9PiB2b2lkPjtcbn1cbmNvbnN0IFJhdGluZ0NvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG5gO1xuaW50ZXJmYWNlIFJhdGluZ0VsZW1lbnRQcm9wcyB7XG4gICAgc2l6ZTogJ21lZGl1bScgfCAnc21hbGwnO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbn1cbmNvbnN0IFNldEFuaW1hdGlvbiA9IGtleWZyYW1lcyBgXG4gIDAlIHtcbiAgICB0cmFuc2Zvcm06IHNjYWxlKDEpO1xuICB9XG4gIDI1JSB7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgxLjUpO1xuICB9XG4gIDUwJSB7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgwLjkpO1xuICB9XG4gIDc1JSB7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgxLjIpO1xuICB9XG4gIDEwMCUge1xuICAgIHRyYW5zZm9ybTogc2NhbGUoMSk7XG4gIH1cbmA7XG5jb25zdCBSYXRpbmdFbGVtZW50ID0gc3R5bGVkLnNwYW48UmF0aW5nRWxlbWVudFByb3BzPiBgXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgY3Vyc29yOiAke3Byb3BzID0+IChwcm9wcy5kaXNhYmxlZCA/ICdub3QtYWxsb3dlZCcgOiAncG9pbnRlcicpfTtcblxuICAmICsgJiB7XG4gICAgcGFkZGluZy1sZWZ0OiAke3Byb3BzID0+IChwcm9wcy5zaXplID09PSAnbWVkaXVtJyA/IGRpc3RhbmNlLnNtYWxsIDogZGlzdGFuY2UueHNtYWxsKX07XG4gIH1cbmA7XG5mdW5jdGlvbiBnZXRDb2xvcih0aGVtZTogUHJlY2lzZVRoZW1lLCBkaXNhYmxlZDogYm9vbGVhbiB8IHVuZGVmaW5lZCwgaTogbnVtYmVyLCB2YWx1ZTogbnVtYmVyLCBob3ZlcjogbnVtYmVyKSB7XG4gICAgaWYgKCFkaXNhYmxlZCkge1xuICAgICAgICBpZiAoaG92ZXIgIT09IC0xKSB7XG4gICAgICAgICAgICBpZiAoaSA8IGhvdmVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoZW1lLnVpMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGkgPT09IGhvdmVyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9jZWFuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGkgPCB2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoZW1lLnVpNTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhlbWUudWk0O1xuICAgIH1cbiAgICBlbHNlIGlmIChpIDwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoZW1lLnVpNDtcbiAgICB9XG4gICAgcmV0dXJuIHRoZW1lLnVpMztcbn1cbmZ1bmN0aW9uIGdldEFuaW1hdGlvbihpOiBudW1iZXIsIHZhbHVlOiBudW1iZXIpIHtcbiAgICBpZiAoaSArIDEgPT09IHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBjc3MgYFxuICAgICAgJHtTZXRBbmltYXRpb259IDAuNXMgZWFzZS1pbi1vdXRcbiAgICBgO1xuICAgIH1cbiAgICByZXR1cm4gJ25vbmUnO1xufVxuaW50ZXJmYWNlIFJhdGluZ0ljb25Qcm9wcyB7XG4gICAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICAgIGluZGV4OiBudW1iZXI7XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgICBob3ZlcjogbnVtYmVyO1xuICAgIHNpemU6IHN0cmluZztcbn1cbmNvbnN0IFJhdGluZ0ljb25JbnQ6IFJlYWN0LkZDPFJhdGluZ0ljb25Qcm9wcz4gPSAoeyBkaXNhYmxlZCwgaW5kZXgsIHZhbHVlLCBob3Zlciwgc2l6ZSwgLi4ucHJvcHMgfSkgPT4gKDxpY29ucy5TdGFyIHsuLi5wcm9wc30vPik7XG5jb25zdCBSYXRpbmdJY29uID0gc3R5bGVkKFJhdGluZ0ljb25JbnQpKCh7IHRoZW1lLCBkaXNhYmxlZCwgaW5kZXgsIHZhbHVlLCBob3Zlciwgc2l6ZSB9KSA9PiBjc3MgYFxuICAgIGZpbGw6ICR7Z2V0Q29sb3IodGhlbWUsIGRpc2FibGVkLCBpbmRleCwgdmFsdWUsIGhvdmVyKX07XG4gICAgYW5pbWF0aW9uOiAke2dldEFuaW1hdGlvbihpbmRleCwgdmFsdWUpfTtcbiAgICB3aWR0aDogJHtzaXplfTtcbiAgICBoZWlnaHQ6ICR7c2l6ZX07XG4gIGApO1xuY2xhc3MgUmF0aW5nSW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFJhdGluZ1Byb3BzICYgRm9ybUNvbnRleHRQcm9wcywgUmF0aW5nU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogUmF0aW5nUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBkZWZhdWx0VmFsdWUsIGxldmVscyA9IDUgfSA9IHByb3BzO1xuICAgICAgICBjb25zdCBjaGFuZ2VyczogQXJyYXk8KCkgPT4gdm9pZD4gPSBbXTtcbiAgICAgICAgY29uc3QgaG92ZXJzOiBBcnJheTwoKSA9PiB2b2lkPiA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxldmVsczsgaSsrKSB7XG4gICAgICAgICAgICBjaGFuZ2Vycy5wdXNoKCgpID0+IHRoaXMudXBkYXRlVmFsdWUoaSArIDEpKTtcbiAgICAgICAgICAgIGhvdmVycy5wdXNoKCgpID0+IHRoaXMuaG92ZXJWYWx1ZShpKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHZhbHVlICE9PSB1bmRlZmluZWQsXG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUgfHwgZGVmYXVsdFZhbHVlIHx8IDAsXG4gICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IsXG4gICAgICAgICAgICBob3ZlcjogLTEsXG4gICAgICAgICAgICBjaGFuZ2VycyxcbiAgICAgICAgICAgIGhvdmVycyxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBSYXRpbmdQcm9wcykge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5jb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogbmV4dFByb3BzLnZhbHVlIHx8IDAsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5leHRQcm9wcy5lcnJvcixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSB1cGRhdGVWYWx1ZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgb25DaGFuZ2UsIG5hbWUgPSAnJywgZm9ybSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIGlmIChmb3JtKSB7XG4gICAgICAgICAgICAgICAgZm9ybS5jaGFuZ2Uoe1xuICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIG9uQ2hhbmdlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGhvdmVyVm9pZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBob3ZlcjogLTEsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBob3ZlclZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBob3ZlcjogdmFsdWUsXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgbGV2ZWxzOiBfMCwgbmFtZTogXzEsIHZhbHVlOiBfMiwgZGVmYXVsdFZhbHVlOiBfMywgb25DaGFuZ2U6IF80LCBvbklucHV0OiBfNSwgZGlzYWJsZWQsIHNpemUgPSAnbWVkaXVtJywgaWNvbiA9ICdTdGFyJywgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIGNoYW5nZXJzLCBob3ZlciwgaG92ZXJzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBkaW0gPSBzaXplID09PSAnbWVkaXVtJyA/ICczMnB4JyA6ICcyMnB4JztcbiAgICAgICAgcmV0dXJuICg8UmF0aW5nQ29udGFpbmVyIHsuLi5wcm9wc30+XG4gICAgICAgIHtjaGFuZ2Vycy5tYXAoKGNoYW5nZXIsIGkpID0+ICg8UmF0aW5nRWxlbWVudCBrZXk9e2l9IHNpemU9e3NpemV9IG9uQ2xpY2s9e2NoYW5nZXJ9IGRpc2FibGVkPXtkaXNhYmxlZH0gb25Nb3VzZUVudGVyPXtob3ZlcnNbaV19IG9uTW91c2VMZWF2ZT17dGhpcy5ob3ZlclZvaWR9PlxuICAgICAgICAgICAgPFJhdGluZ0ljb24gaW5kZXg9e2l9IGRpc2FibGVkPXtkaXNhYmxlZH0gdmFsdWU9e3ZhbHVlfSBob3Zlcj17aG92ZXJ9IHNpemU9e2RpbX0gYXM9e2ljb25zW2ljb25dfS8+XG4gICAgICAgICAgPC9SYXRpbmdFbGVtZW50PikpfVxuICAgICAgPC9SYXRpbmdDb250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgUmF0aW5nQ29udGFpbmVyKCkgeyByZXR1cm4gUmF0aW5nQ29udGFpbmVyIGFzIHR5cGVvZiBSYXRpbmdDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBSYXRpbmdFbGVtZW50KCkgeyByZXR1cm4gUmF0aW5nRWxlbWVudCBhcyB0eXBlb2YgUmF0aW5nRWxlbWVudDsgfSxcbiAgICAgICAgZ2V0IFJhdGluZ0ljb24oKSB7IHJldHVybiBSYXRpbmdJY29uIGFzIHR5cGVvZiBSYXRpbmdJY29uOyB9XG4gICAgfTtcbn1cbi8qKlxuICogQW4gaW5wdXQgY29udHJvbCBmb3IgcHJvdmlkaW5nIHVzZXIgcmF0aW5ncy5cbiAqL1xuZXhwb3J0IGNvbnN0IFJhdGluZyA9IHdpdGhGb3JtQ29udGV4dChSYXRpbmdJbnQpO1xuUmF0aW5nLmRpc3BsYXlOYW1lID0gJ1JhdGluZyc7XG4iXX0=