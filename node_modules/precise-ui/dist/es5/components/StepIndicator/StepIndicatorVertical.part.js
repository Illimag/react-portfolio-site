"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var StepIndicatorShared_part_1 = require("./StepIndicatorShared.part");
var distance_1 = require("../../distance");
var textStyles_1 = require("../../textStyles");
var StyledProgressContent = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  min-height: ", ";\n"], ["\n  min-height: ", ";\n"])), distance_1.distance.xxxlarge);
var StyledProgressStep = styled_1.default.li(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  display: block;\n  position: relative;\n  padding-left: 40px;\n  color: ", ";\n\n  &:before {\n    content: '';\n    display: block;\n    border-radius: 50%;\n    width: ", ";\n    height: ", ";\n    position: absolute;\n    top: ", ";\n    left: ", ";\n    z-index: 1;\n    background-color: ", ";\n  }\n\n  &:not(:last-child):after {\n    content: '';\n    position: absolute;\n    top: ", ";\n    left: 11px;\n    width: 2px;\n    height: 100%;\n    background-color: ", ";\n  }\n\n  &.step-active {\n    ", "\n    \n    color: ", ";\n\n    ~ li {\n      color: ", ";\n\n      &:before {\n        background-color: ", ";\n      }\n\n      &:after {\n        background-color: ", ";\n      }\n    }\n\n    &:after {\n      background-color: ", ";\n    }\n\n    &:before {\n      background-color: ", ";\n      border: 0.5em solid ", ";\n      left: 0;\n      top: 0;\n    }\n  }\n"], ["\n  display: block;\n  position: relative;\n  padding-left: 40px;\n  color: ", ";\n\n  &:before {\n    content: '';\n    display: block;\n    border-radius: 50%;\n    width: ", ";\n    height: ", ";\n    position: absolute;\n    top: ", ";\n    left: ", ";\n    z-index: 1;\n    background-color: ", ";\n  }\n\n  &:not(:last-child):after {\n    content: '';\n    position: absolute;\n    top: ", ";\n    left: 11px;\n    width: 2px;\n    height: 100%;\n    background-color: ", ";\n  }\n\n  &.step-active {\n    ", "\n    \n    color: ", ";\n\n    ~ li {\n      color: ", ";\n\n      &:before {\n        background-color: ", ";\n      }\n\n      &:after {\n        background-color: ", ";\n      }\n    }\n\n    &:after {\n      background-color: ", ";\n    }\n\n    &:before {\n      background-color: ", ";\n      border: 0.5em solid ", ";\n      left: 0;\n      top: 0;\n    }\n  }\n"])), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), distance_1.distance.small, distance_1.distance.small, distance_1.distance.small, distance_1.distance.small, styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), distance_1.distance.small, styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), textStyles_1.getFontStyle({ weight: 'medium' }), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.ui1;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}));
var StyledProgressText = styled_1.default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  display: block;\n"], ["\n  display: block;\n"])));
var StyledProgressHost = styled_1.default.ol(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  width: 100%;\n  display: block;\n  padding: 0;\n  margin: 0;\n\n  & ", ":last-of-type ", " {\n    min-height: auto;\n  }\n"], ["\n  width: 100%;\n  display: block;\n  padding: 0;\n  margin: 0;\n\n  & ", ":last-of-type ", " {\n    min-height: auto;\n  }\n"])), StyledProgressStep, StyledProgressContent);
function createStep(header, content, i, active, numbered, theme) {
    return (React.createElement(StyledProgressStep, { theme: theme, key: i, className: active ? 'step-active' : '' },
        numbered && React.createElement(StepIndicatorShared_part_1.ListItemNumber, { theme: theme }, i + 1),
        React.createElement(StyledProgressText, { theme: theme }, header),
        React.createElement(StyledProgressContent, null, content)));
}
function getHeaders(steps, current, numbered, theme) {
    return steps.map(function (step, i) { return createStep(step, undefined, i, i === current, numbered, theme); });
}
function getContent(children, current, numbered, theme) {
    var items = [];
    React.Children.forEach(children, function (element, i) {
        if (element && React.isValidElement(element)) {
            var _a = element.props, header = _a.header, children_1 = _a.children;
            items.push(createStep(header, children_1, i, i === current, numbered, theme));
        }
    });
    return items;
}
exports.StepIndicatorVertical = Object.assign((function (_a) {
    var theme = _a.theme, steps = _a.steps, _b = _a.current, current = _b === void 0 ? 0 : _b, numbered = _a.numbered, children = _a.children;
    var items = steps !== undefined ? getHeaders(steps, current, numbered, theme) : getContent(children, current, numbered, theme);
    return React.createElement(StyledProgressHost, null, items);
}), { inner: {
        get StyledProgressHost() { return StyledProgressHost; }
    } });
var templateObject_1, templateObject_2, templateObject_3, templateObject_4;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RlcEluZGljYXRvclZlcnRpY2FsLnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TdGVwSW5kaWNhdG9yL1N0ZXBJbmRpY2F0b3JWZXJ0aWNhbC5wYXJ0LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQW9EO0FBRXBELHVFQUE0RDtBQUM1RCwyQ0FBMEM7QUFFMUMsK0NBQWdEO0FBQ2hELElBQU0scUJBQXFCLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLDRGQUFDLGtCQUN6QixFQUFpQixLQUNoQyxLQURlLG1CQUFRLENBQUMsUUFBUSxDQUNoQyxDQUFDO0FBQ0YsSUFBTSxrQkFBa0IsR0FBRyxnQkFBTSxDQUFDLEVBQUUsMjdCQUFDLDhFQUkxQixFQUFrQyxnR0FNaEMsRUFBYyxpQkFDYixFQUFjLHVDQUVqQixFQUFjLGVBQ2IsRUFBYyw0Q0FFRixFQUFrQyw4RkFNL0MsRUFBYyxnRkFJRCxFQUFrQyxtQ0FJcEQsRUFBa0MscUJBRTNCLEVBQWtDLGdDQUdoQyxFQUFrQyxtREFHckIsRUFBa0MsMkRBSWxDLEVBQWtDLDhEQUtwQyxFQUFrQyxzREFJbEMsRUFBZ0MsK0JBQzlCLEVBQWtDLGdEQUs3RCxLQXJEVSxlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLEVBTWhDLG1CQUFRLENBQUMsS0FBSyxFQUNiLG1CQUFRLENBQUMsS0FBSyxFQUVqQixtQkFBUSxDQUFDLEtBQUssRUFDYixtQkFBUSxDQUFDLEtBQUssRUFFRixlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLEVBTS9DLG1CQUFRLENBQUMsS0FBSyxFQUlELGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsS0FBSyxDQUFDLEtBQUs7QUFBWCxDQUFXLENBQUMsRUFJcEQseUJBQVksQ0FBQyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUUzQixlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLEVBR2hDLGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsS0FBSyxDQUFDLEtBQUs7QUFBWCxDQUFXLENBQUMsRUFHckIsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsS0FBSztBQUFYLENBQVcsQ0FBQyxFQUlsQyxlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLEVBS3BDLGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsS0FBSyxDQUFDLEtBQUs7QUFBWCxDQUFXLENBQUMsRUFJbEMsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsR0FBRztBQUFULENBQVMsQ0FBQyxFQUM5QixlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLENBSzdELENBQUM7QUFDRixJQUFNLGtCQUFrQixHQUFHLGdCQUFNLENBQUMsR0FBRywwRkFBQyx1QkFFckMsSUFBQSxDQUFDO0FBQ0YsSUFBTSxrQkFBa0IsR0FBRyxnQkFBTSxDQUFDLEVBQUUsbU1BQUMsMEVBTS9CLEVBQWtCLGdCQUFpQixFQUFxQixrQ0FHN0QsS0FISyxrQkFBa0IsRUFBaUIscUJBQXFCLENBRzdELENBQUM7QUFDRixTQUFTLFVBQVUsQ0FBQyxNQUF1QixFQUFFLE9BQXdCLEVBQUUsQ0FBUyxFQUFFLE1BQWUsRUFBRSxRQUFrQixFQUFFLEtBQW9CO0lBQ3ZJLE9BQU8sQ0FBQyxvQkFBQyxrQkFBa0IsSUFBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxFQUFFO1FBQ3JGLFFBQVEsSUFBSSxvQkFBQyx5Q0FBYyxJQUFDLEtBQUssRUFBRSxLQUFLLElBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBa0I7UUFDbkUsb0JBQUMsa0JBQWtCLElBQUMsS0FBSyxFQUFFLEtBQUssSUFBRyxNQUFNLENBQXNCO1FBQy9ELG9CQUFDLHFCQUFxQixRQUFFLE9BQU8sQ0FBeUIsQ0FDckMsQ0FBQyxDQUFDO0FBQzNCLENBQUM7QUFDRCxTQUFTLFVBQVUsQ0FBQyxLQUE2QixFQUFFLE9BQWUsRUFBRSxRQUFrQixFQUFFLEtBQW9CO0lBQ3hHLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksRUFBRSxDQUFDLElBQUssT0FBQSxVQUFVLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQTlELENBQThELENBQUMsQ0FBQztBQUNsRyxDQUFDO0FBQ0QsU0FBUyxVQUFVLENBQUMsUUFBeUIsRUFBRSxPQUFlLEVBQUUsUUFBa0IsRUFBRSxLQUFvQjtJQUNwRyxJQUFNLEtBQUssR0FBNEIsRUFBRSxDQUFDO0lBQzFDLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxVQUFDLE9BQW1ELEVBQUUsQ0FBQztRQUNwRixJQUFJLE9BQU8sSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ3BDLElBQUEsa0JBQW9DLEVBQWxDLGtCQUFNLEVBQUUsd0JBQTBCLENBQUM7WUFDM0MsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLFVBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxLQUFLLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUMvRTtJQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTyxLQUFLLENBQUM7QUFDakIsQ0FBQztBQUNZLFFBQUEscUJBQXFCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBRSxDQUFDLFVBQUMsRUFBa0Q7UUFBaEQsZ0JBQUssRUFBRSxnQkFBSyxFQUFFLGVBQVcsRUFBWCxnQ0FBVyxFQUFFLHNCQUFRLEVBQUUsc0JBQVE7SUFDakcsSUFBTSxLQUFLLEdBQUcsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDakksT0FBTyxvQkFBQyxrQkFBa0IsUUFBRSxLQUFLLENBQXNCLENBQUM7QUFDNUQsQ0FBQyxDQUFtQyxFQUFFLEVBQUUsS0FBSyxFQUFFO1FBQ3ZDLElBQUksa0JBQWtCLEtBQUssT0FBTyxrQkFBK0MsQ0FBQyxDQUFDLENBQUM7S0FDdkYsRUFBRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBTdGVwSW5kaWNhdG9yUHJvcHMsIFN0ZXBJbmRpY2F0b3JTdGVwUHJvcHMgfSBmcm9tICcuL1N0ZXBJbmRpY2F0b3IudHlwZXMucGFydCc7XG5pbXBvcnQgeyBMaXN0SXRlbU51bWJlciB9IGZyb20gJy4vU3RlcEluZGljYXRvclNoYXJlZC5wYXJ0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgUHJlY2lzZVRoZW1lIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IGdldEZvbnRTdHlsZSB9IGZyb20gJy4uLy4uL3RleHRTdHlsZXMnO1xuY29uc3QgU3R5bGVkUHJvZ3Jlc3NDb250ZW50ID0gc3R5bGVkLmRpdiBgXG4gIG1pbi1oZWlnaHQ6ICR7ZGlzdGFuY2UueHh4bGFyZ2V9O1xuYDtcbmNvbnN0IFN0eWxlZFByb2dyZXNzU3RlcCA9IHN0eWxlZC5saSBgXG4gIGRpc3BsYXk6IGJsb2NrO1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIHBhZGRpbmctbGVmdDogNDBweDtcbiAgY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQxKX07XG5cbiAgJjpiZWZvcmUge1xuICAgIGNvbnRlbnQ6ICcnO1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIGJvcmRlci1yYWRpdXM6IDUwJTtcbiAgICB3aWR0aDogJHtkaXN0YW5jZS5zbWFsbH07XG4gICAgaGVpZ2h0OiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgICBsZWZ0OiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgICB6LWluZGV4OiAxO1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQxKX07XG4gIH1cblxuICAmOm5vdCg6bGFzdC1jaGlsZCk6YWZ0ZXIge1xuICAgIGNvbnRlbnQ6ICcnO1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB0b3A6ICR7ZGlzdGFuY2Uuc21hbGx9O1xuICAgIGxlZnQ6IDExcHg7XG4gICAgd2lkdGg6IDJweDtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDEpfTtcbiAgfVxuXG4gICYuc3RlcC1hY3RpdmUge1xuICAgICR7Z2V0Rm9udFN0eWxlKHsgd2VpZ2h0OiAnbWVkaXVtJyB9KX1cbiAgICBcbiAgICBjb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDEpfTtcblxuICAgIH4gbGkge1xuICAgICAgY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQyKX07XG5cbiAgICAgICY6YmVmb3JlIHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDIpfTtcbiAgICAgIH1cblxuICAgICAgJjphZnRlciB7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQyKX07XG4gICAgICB9XG4gICAgfVxuXG4gICAgJjphZnRlciB7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS50ZXh0Mil9O1xuICAgIH1cblxuICAgICY6YmVmb3JlIHtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnVpMSl9O1xuICAgICAgYm9yZGVyOiAwLjVlbSBzb2xpZCAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS50ZXh0MSl9O1xuICAgICAgbGVmdDogMDtcbiAgICAgIHRvcDogMDtcbiAgICB9XG4gIH1cbmA7XG5jb25zdCBTdHlsZWRQcm9ncmVzc1RleHQgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogYmxvY2s7XG5gO1xuY29uc3QgU3R5bGVkUHJvZ3Jlc3NIb3N0ID0gc3R5bGVkLm9sIGBcbiAgd2lkdGg6IDEwMCU7XG4gIGRpc3BsYXk6IGJsb2NrO1xuICBwYWRkaW5nOiAwO1xuICBtYXJnaW46IDA7XG5cbiAgJiAke1N0eWxlZFByb2dyZXNzU3RlcH06bGFzdC1vZi10eXBlICR7U3R5bGVkUHJvZ3Jlc3NDb250ZW50fSB7XG4gICAgbWluLWhlaWdodDogYXV0bztcbiAgfVxuYDtcbmZ1bmN0aW9uIGNyZWF0ZVN0ZXAoaGVhZGVyOiBSZWFjdC5SZWFjdE5vZGUsIGNvbnRlbnQ6IFJlYWN0LlJlYWN0Tm9kZSwgaTogbnVtYmVyLCBhY3RpdmU6IGJvb2xlYW4sIG51bWJlcmVkPzogYm9vbGVhbiwgdGhlbWU/OiBQcmVjaXNlVGhlbWUpIHtcbiAgICByZXR1cm4gKDxTdHlsZWRQcm9ncmVzc1N0ZXAgdGhlbWU9e3RoZW1lfSBrZXk9e2l9IGNsYXNzTmFtZT17YWN0aXZlID8gJ3N0ZXAtYWN0aXZlJyA6ICcnfT5cbiAgICAgIHtudW1iZXJlZCAmJiA8TGlzdEl0ZW1OdW1iZXIgdGhlbWU9e3RoZW1lfT57aSArIDF9PC9MaXN0SXRlbU51bWJlcj59XG4gICAgICA8U3R5bGVkUHJvZ3Jlc3NUZXh0IHRoZW1lPXt0aGVtZX0+e2hlYWRlcn08L1N0eWxlZFByb2dyZXNzVGV4dD5cbiAgICAgIDxTdHlsZWRQcm9ncmVzc0NvbnRlbnQ+e2NvbnRlbnR9PC9TdHlsZWRQcm9ncmVzc0NvbnRlbnQ+XG4gICAgPC9TdHlsZWRQcm9ncmVzc1N0ZXA+KTtcbn1cbmZ1bmN0aW9uIGdldEhlYWRlcnMoc3RlcHM6IEFycmF5PFJlYWN0LlJlYWN0Tm9kZT4sIGN1cnJlbnQ6IG51bWJlciwgbnVtYmVyZWQ/OiBib29sZWFuLCB0aGVtZT86IFByZWNpc2VUaGVtZSkge1xuICAgIHJldHVybiBzdGVwcy5tYXAoKHN0ZXAsIGkpID0+IGNyZWF0ZVN0ZXAoc3RlcCwgdW5kZWZpbmVkLCBpLCBpID09PSBjdXJyZW50LCBudW1iZXJlZCwgdGhlbWUpKTtcbn1cbmZ1bmN0aW9uIGdldENvbnRlbnQoY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZSwgY3VycmVudDogbnVtYmVyLCBudW1iZXJlZD86IGJvb2xlYW4sIHRoZW1lPzogUHJlY2lzZVRoZW1lKSB7XG4gICAgY29uc3QgaXRlbXM6IEFycmF5PFJlYWN0LlJlYWN0Q2hpbGQ+ID0gW107XG4gICAgUmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbiwgKGVsZW1lbnQ6IFJlYWN0LlJlYWN0RWxlbWVudDxTdGVwSW5kaWNhdG9yU3RlcFByb3BzPiwgaSkgPT4ge1xuICAgICAgICBpZiAoZWxlbWVudCAmJiBSZWFjdC5pc1ZhbGlkRWxlbWVudChlbGVtZW50KSkge1xuICAgICAgICAgICAgY29uc3QgeyBoZWFkZXIsIGNoaWxkcmVuIH0gPSBlbGVtZW50LnByb3BzO1xuICAgICAgICAgICAgaXRlbXMucHVzaChjcmVhdGVTdGVwKGhlYWRlciwgY2hpbGRyZW4sIGksIGkgPT09IGN1cnJlbnQsIG51bWJlcmVkLCB0aGVtZSkpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGl0ZW1zO1xufVxuZXhwb3J0IGNvbnN0IFN0ZXBJbmRpY2F0b3JWZXJ0aWNhbCA9IE9iamVjdC5hc3NpZ24oKCgoeyB0aGVtZSwgc3RlcHMsIGN1cnJlbnQgPSAwLCBudW1iZXJlZCwgY2hpbGRyZW4sIH0pID0+IHtcbiAgICBjb25zdCBpdGVtcyA9IHN0ZXBzICE9PSB1bmRlZmluZWQgPyBnZXRIZWFkZXJzKHN0ZXBzLCBjdXJyZW50LCBudW1iZXJlZCwgdGhlbWUpIDogZ2V0Q29udGVudChjaGlsZHJlbiwgY3VycmVudCwgbnVtYmVyZWQsIHRoZW1lKTtcbiAgICByZXR1cm4gPFN0eWxlZFByb2dyZXNzSG9zdD57aXRlbXN9PC9TdHlsZWRQcm9ncmVzc0hvc3Q+O1xufSkgYXMgUmVhY3QuU0ZDPFN0ZXBJbmRpY2F0b3JQcm9wcz4pLCB7IGlubmVyOiB7XG4gICAgICAgIGdldCBTdHlsZWRQcm9ncmVzc0hvc3QoKSB7IHJldHVybiBTdHlsZWRQcm9ncmVzc0hvc3QgYXMgdHlwZW9mIFN0eWxlZFByb2dyZXNzSG9zdDsgfVxuICAgIH0gfSk7XG4iXX0=