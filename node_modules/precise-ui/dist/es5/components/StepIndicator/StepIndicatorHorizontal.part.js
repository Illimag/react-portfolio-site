"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var StepIndicatorShared_part_1 = require("./StepIndicatorShared.part");
var distance_1 = require("../../distance");
var textStyles_1 = require("../../textStyles");
var StyledProgressHost = styled_1.default.ol(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  width: 100%;\n  display: table;\n  table-layout: fixed;\n  padding: 0;\n  margin: 0;\n  height: 4em;\n  box-sizing: border-box;\n  padding-left: ", ";\n"], ["\n  width: 100%;\n  display: table;\n  table-layout: fixed;\n  padding: 0;\n  margin: 0;\n  height: 4em;\n  box-sizing: border-box;\n  padding-left: ", ";\n"])), distance_1.distance.medium);
var HorizontalNumber = styled_1.default(StepIndicatorShared_part_1.ListItemNumber)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  top: ", ";\n  left: -12px;\n"], ["\n  top: ", ";\n  left: -12px;\n"])), distance_1.distance.small);
var StyledProgressStep = styled_1.default.li(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  display: table-cell;\n  text-align: center;\n  vertical-align: top;\n  position: relative;\n  color: ", ";\n\n  &:before {\n    content: '';\n    display: block;\n    border-radius: 50%;\n    margin: 1em auto;\n    width: ", ";\n    height: ", ";\n    position: relative;\n    left: -50%;\n    z-index: 1;\n    background-color: ", ";\n  }\n\n  &:not(:first-child):after {\n    content: '';\n    position: absolute;\n    top: 19px;\n    left: -100%;\n    width: 100%;\n    height: 2px;\n    background-color: ", ";\n  }\n\n  &.step-active {\n    ", "\n    \n    color: ", ";\n\n    ~ li {\n      color: ", ";\n\n      &:before {\n        background-color: ", ";\n      }\n\n      &:after {\n        background-color: ", ";\n      }\n    }\n\n    &:before {\n      background-color: ", ";\n      border: 0.5em solid ", ";\n      margin: 0.5em auto;\n    }\n  }\n"], ["\n  display: table-cell;\n  text-align: center;\n  vertical-align: top;\n  position: relative;\n  color: ", ";\n\n  &:before {\n    content: '';\n    display: block;\n    border-radius: 50%;\n    margin: 1em auto;\n    width: ", ";\n    height: ", ";\n    position: relative;\n    left: -50%;\n    z-index: 1;\n    background-color: ", ";\n  }\n\n  &:not(:first-child):after {\n    content: '';\n    position: absolute;\n    top: 19px;\n    left: -100%;\n    width: 100%;\n    height: 2px;\n    background-color: ", ";\n  }\n\n  &.step-active {\n    ", "\n    \n    color: ", ";\n\n    ~ li {\n      color: ", ";\n\n      &:before {\n        background-color: ", ";\n      }\n\n      &:after {\n        background-color: ", ";\n      }\n    }\n\n    &:before {\n      background-color: ", ";\n      border: 0.5em solid ", ";\n      margin: 0.5em auto;\n    }\n  }\n"])), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), distance_1.distance.small, distance_1.distance.small, styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), textStyles_1.getFontStyle({ weight: 'medium' }), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.ui1;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text1;
}));
var StyledProgressText = styled_1.default.div(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  display: inline-block;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  position: absolute;\n  left: 0;\n  top: 2.5em;\n"], ["\n  display: inline-block;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  position: absolute;\n  left: 0;\n  top: 2.5em;\n"])));
function createStep(header, i, active, numbered, theme) {
    return (React.createElement(StyledProgressStep, { theme: theme, key: i, className: active ? 'step-active' : '' },
        numbered && React.createElement(HorizontalNumber, { theme: theme }, i + 1),
        React.createElement(StyledProgressText, { theme: theme }, header)));
}
function getHeaders(steps, current, numbered, theme) {
    var items = steps.map(function (step, i) { return createStep(step, i, i === current, numbered, theme); });
    return {
        items: items,
        content: undefined,
    };
}
function getContent(children, current, numbered, theme) {
    var items = [];
    var content = undefined;
    React.Children.forEach(children, function (element, i) {
        if (element && React.isValidElement(element)) {
            var _a = element.props, header = _a.header, children_1 = _a.children;
            var active = i === current;
            items.push(createStep(header, i, active, numbered, theme));
            if (active) {
                content = children_1;
            }
        }
    });
    return {
        items: items,
        content: content,
    };
}
exports.StepIndicatorHorizontal = Object.assign((function (_a) {
    var theme = _a.theme, steps = _a.steps, _b = _a.current, current = _b === void 0 ? 0 : _b, numbered = _a.numbered, children = _a.children, props = __rest(_a, ["theme", "steps", "current", "numbered", "children"]);
    var _c = steps !== undefined ? getHeaders(steps, current, numbered, theme) : getContent(children, current, numbered, theme), items = _c.items, content = _c.content;
    return (React.createElement("div", __assign({}, props),
        React.createElement(StyledProgressHost, { theme: theme }, items),
        content));
}), { inner: {
        get StyledProgressHost() { return StyledProgressHost; }
    } });
var templateObject_1, templateObject_2, templateObject_3, templateObject_4;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RlcEluZGljYXRvckhvcml6b250YWwucGFydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL1N0ZXBJbmRpY2F0b3IvU3RlcEluZGljYXRvckhvcml6b250YWwucGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQW9EO0FBRXBELHVFQUE0RDtBQUU1RCwyQ0FBMEM7QUFDMUMsK0NBQWdEO0FBQ2hELElBQU0sa0JBQWtCLEdBQUcsZ0JBQU0sQ0FBQyxFQUFFLGlPQUFDLHVKQVFuQixFQUFlLEtBQ2hDLEtBRGlCLG1CQUFRLENBQUMsTUFBTSxDQUNoQyxDQUFDO0FBQ0YsSUFBTSxnQkFBZ0IsR0FBRyxnQkFBTSxDQUFDLHlDQUFjLENBQUMscUdBQUMsV0FDdkMsRUFBYyxxQkFFdEIsS0FGUSxtQkFBUSxDQUFDLEtBQUssQ0FFdEIsQ0FBQztBQUNGLElBQU0sa0JBQWtCLEdBQUcsZ0JBQU0sQ0FBQyxFQUFFLHM2QkFBQywyR0FLMUIsRUFBa0MsdUhBT2hDLEVBQWMsaUJBQ2IsRUFBYyxzRkFJSixFQUFrQyxrTEFVbEMsRUFBa0MsbUNBSXBELEVBQWtDLHFCQUUzQixFQUFrQyxnQ0FHaEMsRUFBa0MsbURBR3JCLEVBQWtDLDJEQUlsQyxFQUFrQywrREFLcEMsRUFBZ0MsK0JBQzlCLEVBQWtDLDRDQUk3RCxLQWhEVSxlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLEVBT2hDLG1CQUFRLENBQUMsS0FBSyxFQUNiLG1CQUFRLENBQUMsS0FBSyxFQUlKLGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsS0FBSyxDQUFDLEtBQUs7QUFBWCxDQUFXLENBQUMsRUFVbEMsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsS0FBSztBQUFYLENBQVcsQ0FBQyxFQUlwRCx5QkFBWSxDQUFDLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBRTNCLGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsS0FBSyxDQUFDLEtBQUs7QUFBWCxDQUFXLENBQUMsRUFHaEMsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsS0FBSztBQUFYLENBQVcsQ0FBQyxFQUdyQixlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLEVBSWxDLGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsS0FBSyxDQUFDLEtBQUs7QUFBWCxDQUFXLENBQUMsRUFLcEMsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsR0FBRztBQUFULENBQVMsQ0FBQyxFQUM5QixlQUFNLENBQUMsVUFBQyxFQUFTO1FBQVAsZ0JBQUs7SUFBTyxPQUFBLEtBQUssQ0FBQyxLQUFLO0FBQVgsQ0FBVyxDQUFDLENBSTdELENBQUM7QUFDRixJQUFNLGtCQUFrQixHQUFHLGdCQUFNLENBQUMsR0FBRyw0TkFBQyx5SkFRckMsSUFBQSxDQUFDO0FBQ0YsU0FBUyxVQUFVLENBQUMsTUFBdUIsRUFBRSxDQUFTLEVBQUUsTUFBZSxFQUFFLFFBQWtCLEVBQUUsS0FBb0I7SUFDN0csT0FBTyxDQUFDLG9CQUFDLGtCQUFrQixJQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLEVBQUU7UUFDckYsUUFBUSxJQUFJLG9CQUFDLGdCQUFnQixJQUFDLEtBQUssRUFBRSxLQUFLLElBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBb0I7UUFDdkUsb0JBQUMsa0JBQWtCLElBQUMsS0FBSyxFQUFFLEtBQUssSUFBRyxNQUFNLENBQXNCLENBQzVDLENBQUMsQ0FBQztBQUMzQixDQUFDO0FBQ0QsU0FBUyxVQUFVLENBQUMsS0FBNkIsRUFBRSxPQUFlLEVBQUUsUUFBa0IsRUFBRSxLQUFvQjtJQUN4RyxJQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBSSxFQUFFLENBQUMsSUFBSyxPQUFBLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxPQUFPLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxFQUFuRCxDQUFtRCxDQUFDLENBQUM7SUFDMUYsT0FBTztRQUNILEtBQUssT0FBQTtRQUNMLE9BQU8sRUFBRSxTQUFTO0tBQ3JCLENBQUM7QUFDTixDQUFDO0FBQ0QsU0FBUyxVQUFVLENBQUMsUUFBeUIsRUFBRSxPQUFlLEVBQUUsUUFBa0IsRUFBRSxLQUFvQjtJQUNwRyxJQUFNLEtBQUssR0FBNEIsRUFBRSxDQUFDO0lBQzFDLElBQUksT0FBTyxHQUFvQixTQUFTLENBQUM7SUFDekMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLFVBQUMsT0FBbUQsRUFBRSxDQUFDO1FBQ3BGLElBQUksT0FBTyxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7WUFDcEMsSUFBQSxrQkFBb0MsRUFBbEMsa0JBQU0sRUFBRSx3QkFBMEIsQ0FBQztZQUMzQyxJQUFNLE1BQU0sR0FBRyxDQUFDLEtBQUssT0FBTyxDQUFDO1lBQzdCLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQzNELElBQUksTUFBTSxFQUFFO2dCQUNSLE9BQU8sR0FBRyxVQUFRLENBQUM7YUFDdEI7U0FDSjtJQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0gsT0FBTztRQUNILEtBQUssT0FBQTtRQUNMLE9BQU8sU0FBQTtLQUNWLENBQUM7QUFDTixDQUFDO0FBQ1ksUUFBQSx1QkFBdUIsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFFLENBQUMsVUFBQyxFQUEyRDtJQUF6RCxJQUFBLGdCQUFLLEVBQUUsZ0JBQUssRUFBRSxlQUFXLEVBQVgsZ0NBQVcsRUFBRSxzQkFBUSxFQUFFLHNCQUFRLEVBQUUseUVBQVE7SUFDdkcsSUFBQSx1SEFBdUksRUFBckksZ0JBQUssRUFBRSxvQkFBOEgsQ0FBQztJQUM5SSxPQUFPLENBQUMsd0NBQVMsS0FBSztRQUNwQixvQkFBQyxrQkFBa0IsSUFBQyxLQUFLLEVBQUUsS0FBSyxJQUFHLEtBQUssQ0FBc0I7UUFDN0QsT0FBTyxDQUNKLENBQUMsQ0FBQztBQUNaLENBQUMsQ0FBbUMsRUFBRSxFQUFFLEtBQUssRUFBRTtRQUN2QyxJQUFJLGtCQUFrQixLQUFLLE9BQU8sa0JBQStDLENBQUMsQ0FBQyxDQUFDO0tBQ3ZGLEVBQUUsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCwgeyB0aGVtZWQgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgU3RlcEluZGljYXRvclByb3BzLCBTdGVwSW5kaWNhdG9yU3RlcFByb3BzIH0gZnJvbSAnLi9TdGVwSW5kaWNhdG9yLnR5cGVzLnBhcnQnO1xuaW1wb3J0IHsgTGlzdEl0ZW1OdW1iZXIgfSBmcm9tICcuL1N0ZXBJbmRpY2F0b3JTaGFyZWQucGFydCc7XG5pbXBvcnQgeyBQcmVjaXNlVGhlbWUgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmNvbnN0IFN0eWxlZFByb2dyZXNzSG9zdCA9IHN0eWxlZC5vbCBgXG4gIHdpZHRoOiAxMDAlO1xuICBkaXNwbGF5OiB0YWJsZTtcbiAgdGFibGUtbGF5b3V0OiBmaXhlZDtcbiAgcGFkZGluZzogMDtcbiAgbWFyZ2luOiAwO1xuICBoZWlnaHQ6IDRlbTtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgcGFkZGluZy1sZWZ0OiAke2Rpc3RhbmNlLm1lZGl1bX07XG5gO1xuY29uc3QgSG9yaXpvbnRhbE51bWJlciA9IHN0eWxlZChMaXN0SXRlbU51bWJlcikgYFxuICB0b3A6ICR7ZGlzdGFuY2Uuc21hbGx9O1xuICBsZWZ0OiAtMTJweDtcbmA7XG5jb25zdCBTdHlsZWRQcm9ncmVzc1N0ZXAgPSBzdHlsZWQubGkgYFxuICBkaXNwbGF5OiB0YWJsZS1jZWxsO1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHZlcnRpY2FsLWFsaWduOiB0b3A7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQxKX07XG5cbiAgJjpiZWZvcmUge1xuICAgIGNvbnRlbnQ6ICcnO1xuICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIGJvcmRlci1yYWRpdXM6IDUwJTtcbiAgICBtYXJnaW46IDFlbSBhdXRvO1xuICAgIHdpZHRoOiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgICBoZWlnaHQ6ICR7ZGlzdGFuY2Uuc21hbGx9O1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICBsZWZ0OiAtNTAlO1xuICAgIHotaW5kZXg6IDE7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDEpfTtcbiAgfVxuXG4gICY6bm90KDpmaXJzdC1jaGlsZCk6YWZ0ZXIge1xuICAgIGNvbnRlbnQ6ICcnO1xuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICB0b3A6IDE5cHg7XG4gICAgbGVmdDogLTEwMCU7XG4gICAgd2lkdGg6IDEwMCU7XG4gICAgaGVpZ2h0OiAycHg7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDEpfTtcbiAgfVxuXG4gICYuc3RlcC1hY3RpdmUge1xuICAgICR7Z2V0Rm9udFN0eWxlKHsgd2VpZ2h0OiAnbWVkaXVtJyB9KX1cbiAgICBcbiAgICBjb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDEpfTtcblxuICAgIH4gbGkge1xuICAgICAgY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQyKX07XG5cbiAgICAgICY6YmVmb3JlIHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudGV4dDIpfTtcbiAgICAgIH1cblxuICAgICAgJjphZnRlciB7XG4gICAgICAgIGJhY2tncm91bmQtY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQyKX07XG4gICAgICB9XG4gICAgfVxuXG4gICAgJjpiZWZvcmUge1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUgfSkgPT4gdGhlbWUudWkxKX07XG4gICAgICBib3JkZXI6IDAuNWVtIHNvbGlkICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQxKX07XG4gICAgICBtYXJnaW46IDAuNWVtIGF1dG87XG4gICAgfVxuICB9XG5gO1xuY29uc3QgU3R5bGVkUHJvZ3Jlc3NUZXh0ID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgbGVmdDogMDtcbiAgdG9wOiAyLjVlbTtcbmA7XG5mdW5jdGlvbiBjcmVhdGVTdGVwKGhlYWRlcjogUmVhY3QuUmVhY3ROb2RlLCBpOiBudW1iZXIsIGFjdGl2ZTogYm9vbGVhbiwgbnVtYmVyZWQ/OiBib29sZWFuLCB0aGVtZT86IFByZWNpc2VUaGVtZSkge1xuICAgIHJldHVybiAoPFN0eWxlZFByb2dyZXNzU3RlcCB0aGVtZT17dGhlbWV9IGtleT17aX0gY2xhc3NOYW1lPXthY3RpdmUgPyAnc3RlcC1hY3RpdmUnIDogJyd9PlxuICAgICAge251bWJlcmVkICYmIDxIb3Jpem9udGFsTnVtYmVyIHRoZW1lPXt0aGVtZX0+e2kgKyAxfTwvSG9yaXpvbnRhbE51bWJlcj59XG4gICAgICA8U3R5bGVkUHJvZ3Jlc3NUZXh0IHRoZW1lPXt0aGVtZX0+e2hlYWRlcn08L1N0eWxlZFByb2dyZXNzVGV4dD5cbiAgICA8L1N0eWxlZFByb2dyZXNzU3RlcD4pO1xufVxuZnVuY3Rpb24gZ2V0SGVhZGVycyhzdGVwczogQXJyYXk8UmVhY3QuUmVhY3ROb2RlPiwgY3VycmVudDogbnVtYmVyLCBudW1iZXJlZD86IGJvb2xlYW4sIHRoZW1lPzogUHJlY2lzZVRoZW1lKSB7XG4gICAgY29uc3QgaXRlbXMgPSBzdGVwcy5tYXAoKHN0ZXAsIGkpID0+IGNyZWF0ZVN0ZXAoc3RlcCwgaSwgaSA9PT0gY3VycmVudCwgbnVtYmVyZWQsIHRoZW1lKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaXRlbXMsXG4gICAgICAgIGNvbnRlbnQ6IHVuZGVmaW5lZCxcbiAgICB9O1xufVxuZnVuY3Rpb24gZ2V0Q29udGVudChjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlLCBjdXJyZW50OiBudW1iZXIsIG51bWJlcmVkPzogYm9vbGVhbiwgdGhlbWU/OiBQcmVjaXNlVGhlbWUpIHtcbiAgICBjb25zdCBpdGVtczogQXJyYXk8UmVhY3QuUmVhY3RDaGlsZD4gPSBbXTtcbiAgICBsZXQgY29udGVudDogUmVhY3QuUmVhY3ROb2RlID0gdW5kZWZpbmVkO1xuICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIChlbGVtZW50OiBSZWFjdC5SZWFjdEVsZW1lbnQ8U3RlcEluZGljYXRvclN0ZXBQcm9wcz4sIGkpID0+IHtcbiAgICAgICAgaWYgKGVsZW1lbnQgJiYgUmVhY3QuaXNWYWxpZEVsZW1lbnQoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVhZGVyLCBjaGlsZHJlbiB9ID0gZWxlbWVudC5wcm9wcztcbiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZSA9IGkgPT09IGN1cnJlbnQ7XG4gICAgICAgICAgICBpdGVtcy5wdXNoKGNyZWF0ZVN0ZXAoaGVhZGVyLCBpLCBhY3RpdmUsIG51bWJlcmVkLCB0aGVtZSkpO1xuICAgICAgICAgICAgaWYgKGFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjaGlsZHJlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICAgIGl0ZW1zLFxuICAgICAgICBjb250ZW50LFxuICAgIH07XG59XG5leHBvcnQgY29uc3QgU3RlcEluZGljYXRvckhvcml6b250YWwgPSBPYmplY3QuYXNzaWduKCgoKHsgdGhlbWUsIHN0ZXBzLCBjdXJyZW50ID0gMCwgbnVtYmVyZWQsIGNoaWxkcmVuLCAuLi5wcm9wcyB9KSA9PiB7XG4gICAgY29uc3QgeyBpdGVtcywgY29udGVudCB9ID0gc3RlcHMgIT09IHVuZGVmaW5lZCA/IGdldEhlYWRlcnMoc3RlcHMsIGN1cnJlbnQsIG51bWJlcmVkLCB0aGVtZSkgOiBnZXRDb250ZW50KGNoaWxkcmVuLCBjdXJyZW50LCBudW1iZXJlZCwgdGhlbWUpO1xuICAgIHJldHVybiAoPGRpdiB7Li4ucHJvcHN9PlxuICAgICAgPFN0eWxlZFByb2dyZXNzSG9zdCB0aGVtZT17dGhlbWV9PntpdGVtc308L1N0eWxlZFByb2dyZXNzSG9zdD5cbiAgICAgIHtjb250ZW50fVxuICAgIDwvZGl2Pik7XG59KSBhcyBSZWFjdC5TRkM8U3RlcEluZGljYXRvclByb3BzPiksIHsgaW5uZXI6IHtcbiAgICAgICAgZ2V0IFN0eWxlZFByb2dyZXNzSG9zdCgpIHsgcmV0dXJuIFN0eWxlZFByb2dyZXNzSG9zdCBhcyB0eXBlb2YgU3R5bGVkUHJvZ3Jlc3NIb3N0OyB9XG4gICAgfSB9KTtcbiJdfQ==