"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var colors = require("../../colors");
var react_onclickoutside_1 = require("react-onclickoutside");
var styled_1 = require("../../utils/styled");
var Icon_1 = require("../Icon");
var InteractiveList_1 = require("../InteractiveList");
var distance_1 = require("../../distance");
var Flyout_1 = require("../Flyout");
var textStyles_1 = require("../../textStyles");
var RootContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n  margin-right: ", ";\n  &:last-child {\n    margin-right: 0;\n  }\n"], ["\n  position: relative;\n  margin-right: ", ";\n  &:last-child {\n    margin-right: 0;\n  }\n"])), distance_1.distance.xlarge);
var StyledInteractiveList = styled_1.default(InteractiveList_1.InteractiveList)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  position: static;\n  white-space: nowrap;\n\n  ul {\n    background: ", ";\n  }\n"], ["\n  position: static;\n  white-space: nowrap;\n\n  ul {\n    background: ", ";\n  }\n"])), styled_1.themed(function (props) { return props.theme.ui1; }));
var DropdownButton = styled_1.default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  color: ", ";\n  ", ";\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  span {\n    margin-left: ", ";\n  }\n  &:hover {\n    color: ", ";\n  }\n"], ["\n  color: ", ";\n  ", ";\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  span {\n    margin-left: ", ";\n  }\n  &:hover {\n    color: ", ";\n  }\n"])), function (props) { return (props.open ? colors.cyan : colors.grey2); }, function (_a) {
    var menuSize = _a.menuSize;
    return textStyles_1.getFontStyle({ size: menuSize });
}, distance_1.distance.small, colors.cyan);
var DropdownMenuInt = /** @class */ (function (_super) {
    __extends(DropdownMenuInt, _super);
    function DropdownMenuInt(props) {
        var _this = _super.call(this, props) || this;
        _this.handleClickOutside = function () {
            _this.container && _this.state.open && _this.toggleOpen();
        };
        _this.setContainer = function (el) {
            _this.container = el;
        };
        _this.handleKeyDown = function (e) {
            switch (e.keyCode) {
                case 32 /* space */:
                case 13 /* enter */:
                case 40 /* down */:
                    _this.toggleOpen();
                    break;
            }
        };
        _this.handleButtonMouseDown = function (e) {
            _this.toggleOpen();
            e.preventDefault();
        };
        _this.handleBlur = function () {
            _this.toggleOpen(false);
        };
        _this.handleChange = function (e) {
            var _a = _this.props, onChange = _a.onChange, keepOpen = _a.keepOpen;
            if (typeof onChange === 'function') {
                onChange({
                    indices: e.value,
                });
            }
            if (!keepOpen) {
                _this.toggleOpen(false);
            }
        };
        _this.state = {
            open: false,
        };
        return _this;
    }
    DropdownMenuInt.prototype.toggleOpen = function (force) {
        var _this = this;
        var open = this.state.open;
        var _a = this.props, items = _a.items, onToggle = _a.onToggle;
        var newState = force ? force : !open;
        this.setState({
            open: newState && !!items.length,
        }, function () {
            if (typeof onToggle === 'function') {
                onToggle({
                    open: _this.state.open,
                });
            }
        });
    };
    DropdownMenuInt.prototype.render = function () {
        var _a = this.props, _b = _a.items, items = _b === void 0 ? [] : _b, _c = _a.text, text = _c === void 0 ? '' : _c, icon = _a.icon, _0 = _a.onChange, _d = _a.menuSize, menuSize = _d === void 0 ? 'normal' : _d, _e = _a.iconSize, iconSize = _e === void 0 ? 1 : _e, rest = __rest(_a, ["items", "text", "icon", "onChange", "menuSize", "iconSize"]);
        var open = this.state.open;
        return (React.createElement(RootContainer, { ref: this.setContainer },
            React.createElement(Flyout_1.Flyout, { open: open, noGutter: true, content: React.createElement(StyledInteractiveList, { borderless: true, open: open, data: items, autoFocus: true, onBlur: this.handleBlur, onChange: this.handleChange }) },
                React.createElement(DropdownButton, __assign({ tabIndex: 0, onKeyDown: this.handleKeyDown, onMouseDown: this.handleButtonMouseDown, open: open, menuSize: menuSize }, rest),
                    icon && React.createElement(Icon_1.Icon, { name: icon, size: iconSize }),
                    React.createElement("span", null, text)))));
    };
    DropdownMenuInt.inner = {
        get RootContainer() { return RootContainer; },
        get Flyout() { return Flyout_1.Flyout; },
        get DropdownButton() { return DropdownButton; },
        get Icon() { return Icon_1.Icon; }
    };
    return DropdownMenuInt;
}(React.PureComponent));
/**
 * A dropdown menu for displaying menu items.
 */
exports.DropdownMenu = react_onclickoutside_1.default(DropdownMenuInt);
exports.DropdownMenu.displayName = 'DropdownMenu';
var templateObject_1, templateObject_2, templateObject_3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Ecm9wZG93bk1lbnUvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQixxQ0FBdUM7QUFDdkMsNkRBQXVFO0FBQ3ZFLDZDQUFvRDtBQUNwRCxnQ0FBeUM7QUFDekMsc0RBQXNHO0FBR3RHLDJDQUEwQztBQUMxQyxvQ0FBbUM7QUFDbkMsK0NBQTBEO0FBMkQxRCxJQUFNLGFBQWEsR0FBRyxnQkFBTSxDQUFDLEdBQUcsa0tBQUMsMkNBRWYsRUFBZSxrREFJaEMsS0FKaUIsbUJBQVEsQ0FBQyxNQUFNLENBSWhDLENBQUM7QUFDRixJQUFNLHFCQUFxQixHQUFHLGdCQUFNLENBQUMsaUNBQWUsQ0FBQywwSkFBQywyRUFLcEMsRUFBZ0MsVUFFakQsS0FGaUIsZUFBTSxDQUFDLFVBQUEsS0FBSyxJQUFJLE9BQUEsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQWYsQ0FBZSxDQUFDLENBRWpELENBQUM7QUFDRixJQUFNLGNBQWMsR0FBRyxnQkFBTSxDQUFDLEdBQUcseU9BQXNCLGFBQzVDLEVBQWtELE9BQ3pELEVBQWtELDhGQUtuQyxFQUFjLGtDQUdwQixFQUFXLFVBRXZCLEtBWFUsVUFBQSxLQUFLLElBQUksT0FBQSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBekMsQ0FBeUMsRUFDekQsVUFBQyxFQUFZO1FBQVYsc0JBQVE7SUFBTyxPQUFBLHlCQUFZLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7QUFBaEMsQ0FBZ0MsRUFLbkMsbUJBQVEsQ0FBQyxLQUFLLEVBR3BCLE1BQU0sQ0FBQyxJQUFJLENBRXZCLENB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QyxjQUFjLGFBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLHFCQUFxQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsSUFBTSxJQUFJO29CQUMxSSxJQUFJLElBQUksb0JBQUMsV0FBSSxJQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsR0FBRztvQkFDNUMsa0NBQU8sSUFBSSxDQUFRLENBQ0osQ0FDVixDQUNLLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBQ00scUJBQUssR0FBRztRQUNYLElBQUksYUFBYSxLQUFLLE9BQU8sYUFBcUMsQ0FBQyxDQUFDLENBQUM7UUFDckUsSUFBSSxNQUFNLEtBQUssT0FBTyxlQUF1QixDQUFDLENBQUMsQ0FBQztRQUNoRCxJQUFJLGNBQWMsS0FBSyxPQUFPLGNBQXVDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLElBQUksSUFBSSxLQUFLLE9BQU8sV0FBbUIsQ0FBQyxDQUFDLENBQUM7S0FDN0MsQ0FBQztJQUNOLHNCQUFDO0NBQUEsQUF6RUQsQ0FBOEIsS0FBSyxDQUFDLGFBQWEsR0F5RWhEO0FBQ0Q7O0dBRUc7QUFDVSxRQUFBLFlBQVksR0FBOEQsOEJBQWMsQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUN2SCxvQkFBWSxDQUFDLFdBQVcsR0FBRyxjQUFjLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgKiBhcyBjb2xvcnMgZnJvbSAnLi4vLi4vY29sb3JzJztcbmltcG9ydCBvbkNsaWNrT3V0c2lkZSwgeyBBZGRpdGlvbmFsUHJvcHMgfSBmcm9tICdyZWFjdC1vbmNsaWNrb3V0c2lkZSc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBJY29uLCBJY29uTmFtZSB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgSW50ZXJhY3RpdmVMaXN0LCBJbnRlcmFjdGl2ZUxpc3RJdGVtLCBJbnRlcmFjdGl2ZUxpc3RDaGFuZ2VFdmVudCB9IGZyb20gJy4uL0ludGVyYWN0aXZlTGlzdCc7XG5pbXBvcnQgeyBTdGFuZGFyZFByb3BzIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IEtleUNvZGVzIH0gZnJvbSAnLi4vLi4vdXRpbHMva2V5Q29kZXMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBGbHlvdXQgfSBmcm9tICcuLi9GbHlvdXQnO1xuaW1wb3J0IHsgRm9udFNpemUsIGdldEZvbnRTdHlsZSB9IGZyb20gJy4uLy4uL3RleHRTdHlsZXMnO1xuZXhwb3J0IGludGVyZmFjZSBEcm9wZG93bk1lbnVDaGFuZ2VFdmVudCB7XG4gICAgLyoqXG4gICAgICogVGhlIGluZGljZXMgb2YgdGhlIGl0ZW1zIHRoYXQgaGF2ZSBiZWVuIHNlbGVjdGVkLlxuICAgICAqL1xuICAgIGluZGljZXM6IEFycmF5PG51bWJlcj47XG59XG5leHBvcnQgaW50ZXJmYWNlIERyb3Bkb3duTWVudVRvZ2dsZUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBUaGUgbWVudSBpcyBjdXJyZW50bHkgY2xvc2VkIG9yIG9wZW5lZC5cbiAgICAgKi9cbiAgICBvcGVuOiBib29sZWFuO1xufVxuZXhwb3J0IGludGVyZmFjZSBEcm9wZG93bk1lbnVQcm9wcyBleHRlbmRzIFN0YW5kYXJkUHJvcHMge1xuICAgIC8qKlxuICAgICAqIFRoZSB0ZXh0IHRvIGRpc3BsYXkuXG4gICAgICovXG4gICAgdGV4dD86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBUaGUgb3B0aW9uYWwgaWNvbiAobmFtZSkgdG8gdXNlLlxuICAgICAqL1xuICAgIGljb24/OiBJY29uTmFtZTtcbiAgICAvKipcbiAgICAgKiBUaGUgaXRlbXMgb2YgdGhlIG1lbnUuXG4gICAgICovXG4gICAgaXRlbXM6IEFycmF5PEludGVyYWN0aXZlTGlzdEl0ZW0+O1xuICAgIC8qKlxuICAgICAqIERlZmluZXMgdGhlIHNpemUgb2YgdGhlIG1lbnUuXG4gICAgICogQGRlZmF1bHQgJ25vcm1hbFxuICAgICAqL1xuICAgIG1lbnVTaXplPzogRm9udFNpemU7XG4gICAgLyoqXG4gICAgICogU2hvdWxkIHRoZSBtZW51IGJlIGtlcHQgb3BlbiB3aGVuIGxvc2luZyBmb2N1cy5cbiAgICAgKi9cbiAgICBrZWVwT3Blbj86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRXZlbnQgZmlyZWQgd2hlbiB0aGUgc2VsZWN0ZWQgaXRlbSBjaGFuZ2VzLlxuICAgICAqL1xuICAgIG9uQ2hhbmdlPyhlOiBEcm9wZG93bk1lbnVDaGFuZ2VFdmVudCk6IHZvaWQ7XG4gICAgLyoqXG4gICAgICogVGhlIGljb24gc2l6ZSB0byB1c2UuXG4gICAgICovXG4gICAgaWNvblNpemU/OiBudW1iZXIgfCBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogRXZlbnQgZmlyZWQgd2hlbiBtZW51IG9wZW5lZCB8IGNsb3NlZC5cbiAgICAgKi9cbiAgICBvblRvZ2dsZT8oZTogRHJvcGRvd25NZW51VG9nZ2xlRXZlbnQpOiB2b2lkO1xuICAgIC8qKlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBjaGlsZHJlbj86IHZvaWQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIERyb3Bkb3duTWVudVN0YXRlIHtcbiAgICBvcGVuOiBib29sZWFuO1xufVxuaW50ZXJmYWNlIERyb3Bkb3duQnV0dG9uUHJvcHMge1xuICAgIG9wZW46IGJvb2xlYW47XG4gICAgbWVudVNpemU6IEZvbnRTaXplO1xufVxuY29uc3QgUm9vdENvbnRhaW5lciA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1hcmdpbi1yaWdodDogJHtkaXN0YW5jZS54bGFyZ2V9O1xuICAmOmxhc3QtY2hpbGQge1xuICAgIG1hcmdpbi1yaWdodDogMDtcbiAgfVxuYDtcbmNvbnN0IFN0eWxlZEludGVyYWN0aXZlTGlzdCA9IHN0eWxlZChJbnRlcmFjdGl2ZUxpc3QpIGBcbiAgcG9zaXRpb246IHN0YXRpYztcbiAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcblxuICB1bCB7XG4gICAgYmFja2dyb3VuZDogJHt0aGVtZWQocHJvcHMgPT4gcHJvcHMudGhlbWUudWkxKX07XG4gIH1cbmA7XG5jb25zdCBEcm9wZG93bkJ1dHRvbiA9IHN0eWxlZC5kaXY8RHJvcGRvd25CdXR0b25Qcm9wcz4gYFxuICBjb2xvcjogJHtwcm9wcyA9PiAocHJvcHMub3BlbiA/IGNvbG9ycy5jeWFuIDogY29sb3JzLmdyZXkyKX07XG4gICR7KHsgbWVudVNpemUgfSkgPT4gZ2V0Rm9udFN0eWxlKHsgc2l6ZTogbWVudVNpemUgfSl9O1xuICBjdXJzb3I6IHBvaW50ZXI7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIHNwYW4ge1xuICAgIG1hcmdpbi1sZWZ0OiAke2Rpc3RhbmNlLnNtYWxsfTtcbiAgfVxuICAmOmhvdmVyIHtcbiAgICBjb2xvcjogJHtjb2xvcnMuY3lhbn07XG4gIH1cbmA7XG5jbGFzcyBEcm9wZG93bk1lbnVJbnQgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50PERyb3Bkb3duTWVudVByb3BzLCBEcm9wZG93bk1lbnVTdGF0ZT4ge1xuICAgIHByaXZhdGUgY29udGFpbmVyOiBIVE1MRGl2RWxlbWVudCB8IG51bGw7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IERyb3Bkb3duTWVudVByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIG9wZW46IGZhbHNlLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBoYW5kbGVDbGlja091dHNpZGUgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyICYmIHRoaXMuc3RhdGUub3BlbiAmJiB0aGlzLnRvZ2dsZU9wZW4oKTtcbiAgICB9O1xuICAgIHByaXZhdGUgc2V0Q29udGFpbmVyID0gKGVsOiBIVE1MRGl2RWxlbWVudCkgPT4ge1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGVsO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVLZXlEb3duID0gKGU6IFJlYWN0LktleWJvYXJkRXZlbnQ8SFRNTERpdkVsZW1lbnQ+KSA9PiB7XG4gICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIEtleUNvZGVzLnNwYWNlOlxuICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZG93bjpcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZU9wZW4oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVCdXR0b25Nb3VzZURvd24gPSAoZTogUmVhY3QuTW91c2VFdmVudDxIVE1MRGl2RWxlbWVudD4gfCBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxEaXZFbGVtZW50PikgPT4ge1xuICAgICAgICB0aGlzLnRvZ2dsZU9wZW4oKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH07XG4gICAgcHJpdmF0ZSB0b2dnbGVPcGVuKGZvcmNlPzogYm9vbGVhbikge1xuICAgICAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaXRlbXMsIG9uVG9nZ2xlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IGZvcmNlID8gZm9yY2UgOiAhb3BlbjtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBvcGVuOiBuZXdTdGF0ZSAmJiAhIWl0ZW1zLmxlbmd0aCxcbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvblRvZ2dsZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uVG9nZ2xlKHtcbiAgICAgICAgICAgICAgICAgICAgb3BlbjogdGhpcy5zdGF0ZS5vcGVuLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcHJpdmF0ZSBoYW5kbGVCbHVyID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnRvZ2dsZU9wZW4oZmFsc2UpO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVDaGFuZ2UgPSAoZTogSW50ZXJhY3RpdmVMaXN0Q2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwga2VlcE9wZW4gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICBpbmRpY2VzOiBlLnZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFrZWVwT3Blbikge1xuICAgICAgICAgICAgdGhpcy50b2dnbGVPcGVuKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGl0ZW1zID0gW10sIHRleHQgPSAnJywgaWNvbiwgb25DaGFuZ2U6IF8wLCBtZW51U2l6ZSA9ICdub3JtYWwnIGFzIEZvbnRTaXplLCBpY29uU2l6ZSA9IDEsIC4uLnJlc3QgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgb3BlbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuICg8Um9vdENvbnRhaW5lciByZWY9e3RoaXMuc2V0Q29udGFpbmVyfT5cbiAgICAgICAgPEZseW91dCBvcGVuPXtvcGVufSBub0d1dHRlciBjb250ZW50PXs8U3R5bGVkSW50ZXJhY3RpdmVMaXN0IGJvcmRlcmxlc3Mgb3Blbj17b3Blbn0gZGF0YT17aXRlbXN9IGF1dG9Gb2N1cyBvbkJsdXI9e3RoaXMuaGFuZGxlQmx1cn0gb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhbmdlfS8+fT5cbiAgICAgICAgICA8RHJvcGRvd25CdXR0b24gdGFiSW5kZXg9ezB9IG9uS2V5RG93bj17dGhpcy5oYW5kbGVLZXlEb3dufSBvbk1vdXNlRG93bj17dGhpcy5oYW5kbGVCdXR0b25Nb3VzZURvd259IG9wZW49e29wZW59IG1lbnVTaXplPXttZW51U2l6ZX0gey4uLnJlc3R9PlxuICAgICAgICAgICAge2ljb24gJiYgPEljb24gbmFtZT17aWNvbn0gc2l6ZT17aWNvblNpemV9Lz59XG4gICAgICAgICAgICA8c3Bhbj57dGV4dH08L3NwYW4+XG4gICAgICAgICAgPC9Ecm9wZG93bkJ1dHRvbj5cbiAgICAgICAgPC9GbHlvdXQ+XG4gICAgICA8L1Jvb3RDb250YWluZXI+KTtcbiAgICB9XG4gICAgc3RhdGljIGlubmVyID0ge1xuICAgICAgICBnZXQgUm9vdENvbnRhaW5lcigpIHsgcmV0dXJuIFJvb3RDb250YWluZXIgYXMgdHlwZW9mIFJvb3RDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBGbHlvdXQoKSB7IHJldHVybiBGbHlvdXQgYXMgdHlwZW9mIEZseW91dDsgfSxcbiAgICAgICAgZ2V0IERyb3Bkb3duQnV0dG9uKCkgeyByZXR1cm4gRHJvcGRvd25CdXR0b24gYXMgdHlwZW9mIERyb3Bkb3duQnV0dG9uOyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH1cbiAgICB9O1xufVxuLyoqXG4gKiBBIGRyb3Bkb3duIG1lbnUgZm9yIGRpc3BsYXlpbmcgbWVudSBpdGVtcy5cbiAqL1xuZXhwb3J0IGNvbnN0IERyb3Bkb3duTWVudTogUmVhY3QuQ29tcG9uZW50Q2xhc3M8RHJvcGRvd25NZW51UHJvcHMgJiBBZGRpdGlvbmFsUHJvcHM+ID0gb25DbGlja091dHNpZGUoRHJvcGRvd25NZW51SW50KTtcbkRyb3Bkb3duTWVudS5kaXNwbGF5TmFtZSA9ICdEcm9wZG93bk1lbnUnO1xuIl19