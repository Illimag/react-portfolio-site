"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var InteractiveList_1 = require("../InteractiveList");
var Icon_1 = require("../Icon");
var colors_1 = require("../../colors");
var distance_1 = require("../../distance");
var react_onclickoutside_1 = require("react-onclickoutside");
var RootWrapper = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  color: ", ";\n  &:hover {\n    color: ", ";\n  }\n"], ["\n  color: ", ";\n  &:hover {\n    color: ", ";\n  }\n"])), colors_1.cyan, colors_1.skyBlue);
var ButtonWrapper = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  padding-left: ", ";\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n"], ["\n  padding-left: ", ";\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n"])), distance_1.distance.xsmall);
var StyledCustomWrapper = styled_1.default.div(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  position: absolute;\n  border: solid 1px #dfe3e6;\n  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.1);\n  position: absolute;\n  z-index: 2;\n  top: ", "px;\n  transform: translateY(", "%);\n  background: ", ";\n  border: 1px solid #dfe3e6;\n  max-height: 50vh;\n  overflow-y: auto;\n"], ["\n  position: absolute;\n  border: solid 1px #dfe3e6;\n  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.1);\n  position: absolute;\n  z-index: 2;\n  top: ", "px;\n  transform: translateY(", "%);\n  background: ", ";\n  border: 1px solid #dfe3e6;\n  max-height: 50vh;\n  overflow-y: auto;\n"])), function (props) { return (props.direction === InteractiveList_1.InteractiveListDirection.normal ? 8 : -30); }, function (props) { return (props.direction === InteractiveList_1.InteractiveListDirection.normal ? 0 : -100); }, colors_1.white);
var CustomWrapper = Object.assign((function (props) {
    return React.createElement(StyledCustomWrapper, __assign({}, props));
}), { inner: {
        get StyledCustomWrapper() { return StyledCustomWrapper; }
    } });
function renderValue(data, value) {
    for (var _i = 0, data_1 = data; _i < data_1.length; _i++) {
        var item = data_1[_i];
        if (typeof item !== 'string' && item.key === value) {
            return item.content || value;
        }
    }
    return value;
}
var SelectButtonInt = /** @class */ (function (_super) {
    __extends(SelectButtonInt, _super);
    function SelectButtonInt(props) {
        var _this = _super.call(this, props) || this;
        _this.handleMouseDown = function (e) {
            var open = _this.state.open;
            _this.setState({
                open: !open,
            });
            e.preventDefault();
        };
        _this.handleChange = function (e) {
            var _a = _this.props, onChange = _a.onChange, data = _a.data;
            var controlled = _this.state.controlled;
            var index = e.value.length ? e.value[0] : -1;
            var item = data[index];
            var value = item && (typeof item === 'string' ? item : item.key);
            if (!value) {
                return;
            }
            if (!controlled) {
                _this.setState({
                    open: false,
                    value: value,
                });
            }
            else {
                _this.setState({
                    open: false,
                });
            }
            if (typeof onChange === 'function') {
                onChange({
                    index: index,
                    value: value,
                });
            }
        };
        _this.handleBlur = function () {
            _this.setState({
                open: false,
            });
        };
        _this.handleClickOutside = _this.handleBlur;
        var controlled = props.value !== undefined;
        _this.state = {
            open: false,
            value: (controlled ? props.value : props.defaultValue) || '',
            controlled: controlled,
        };
        return _this;
    }
    SelectButtonInt.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {
        var controlled = this.state.controlled;
        if (controlled) {
            this.setState({
                value: nextProps.value || '',
            });
        }
    };
    SelectButtonInt.prototype.render = function () {
        var _a = this.props, _b = _a.data, data = _b === void 0 ? [] : _b, _0 = _a.onChange, _1 = _a.value, props = __rest(_a, ["data", "onChange", "value"]);
        var _c = this.state, open = _c.open, value = _c.value;
        return (React.createElement(RootWrapper, __assign({}, props),
            React.createElement(ButtonWrapper, { onMouseDown: this.handleMouseDown },
                renderValue(data, value),
                React.createElement(Icon_1.Icon, { name: "ArrowDropDown", size: 1.5 })),
            React.createElement(InteractiveList_1.InteractiveList, { data: data, open: open, onBlur: this.handleBlur, onChange: this.handleChange, customWrapper: CustomWrapper, value: value, onClickOutside: function () { }, autoPosition: true, autoFocus: true, showTick: true })));
    };
    SelectButtonInt.inner = {
        get RootWrapper() { return RootWrapper; },
        get ButtonWrapper() { return ButtonWrapper; },
        get Icon() { return Icon_1.Icon; },
        get InteractiveList() { return InteractiveList_1.InteractiveList; }
    };
    return SelectButtonInt;
}(React.PureComponent));
/**
 * Represents a select button, which is a kind of dropdown button.
 */
exports.SelectButton = react_onclickoutside_1.default(SelectButtonInt);
var templateObject_1, templateObject_2, templateObject_3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9TZWxlY3RCdXR0b24vaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBd0M7QUFDeEMsc0RBQThKO0FBQzlKLGdDQUErQjtBQUMvQix1Q0FBb0Q7QUFFcEQsMkNBQTBDO0FBQzFDLDZEQUE4QztBQXdDOUMsSUFBTSxXQUFXLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLDJIQUFDLGFBQ3BCLEVBQUksNkJBRUYsRUFBTyxVQUVuQixLQUpVLGFBQUksRUFFRixnQkFBTyxDQUVuQixDQUFDO0FBQ0YsSUFBTSxhQUFhLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLDRKQUFDLG9CQUNmLEVBQWUsbUVBSWhDLEtBSmlCLG1CQUFRLENBQUMsTUFBTSxDQUloQyxDQUFDO0FBQ0YsSUFBTSxtQkFBbUIsR0FBRyxnQkFBTSxDQUFDLEdBQUcsK1ZBQThCLHFKQU0zRCxFQUF3RSwrQkFDdkQsRUFBeUUscUJBQ25GLEVBQUssNkVBSXBCLEtBTlEsVUFBQSxLQUFLLElBQUksT0FBQSxDQUFDLEtBQUssQ0FBQyxTQUFTLEtBQUssMENBQXdCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQS9ELENBQStELEVBQ3ZELFVBQUEsS0FBSyxJQUFJLE9BQUEsQ0FBQyxLQUFLLENBQUMsU0FBUyxLQUFLLDBDQUF3QixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFoRSxDQUFnRSxFQUNuRixjQUFLLENBSXBCLENBQUM7QUFDRixJQUFNLGFBQWEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFFLENBQUMsVUFBQSxLQUFLO0lBQ3ZDLE9BQU8sb0JB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OEIsS0FBSyxDQUFDLGFBQWEsR0EyRWhEO0FBQ0Q7O0dBRUc7QUFDVSxRQUFBLFlBQVksR0FBRyw4QkFBVSxDQUFDLGVBQWUsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgSW50ZXJhY3RpdmVMaXN0LCBJbnRlcmFjdGl2ZUxpc3RDaGFuZ2VFdmVudCwgSW50ZXJhY3RpdmVMaXN0SXRlbSwgSW50ZXJhY3RpdmVMaXN0V3JhcHBlclByb3BzLCBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24sIH0gZnJvbSAnLi4vSW50ZXJhY3RpdmVMaXN0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9JY29uJztcbmltcG9ydCB7IHdoaXRlLCBjeWFuLCBza3lCbHVlIH0gZnJvbSAnLi4vLi4vY29sb3JzJztcbmltcG9ydCB7IFN0YW5kYXJkUHJvcHMgfSBmcm9tICcuLi8uLi9jb21tb24nO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgT25DbGlja091dCBmcm9tICdyZWFjdC1vbmNsaWNrb3V0c2lkZSc7XG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdEJ1dHRvbkNoYW5nZUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBUaGUgY3VycmVudGx5IHNlbGVjdGVkIGluZGV4LiBJbiBjYXNlIG5vbmUgaXNcbiAgICAgKiBjaG9zZW4gdGhlIHZhbHVlIC0xIGlzIGNvbW11bmljYXRlZC5cbiAgICAgKi9cbiAgICBpbmRleDogbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgdmFsdWUuIFVuZGVmaW5lZCBpZiBub25lXG4gICAgICogaXMgY2hvc2VuLlxuICAgICAqL1xuICAgIHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG59XG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdEJ1dHRvblByb3BzIGV4dGVuZHMgU3RhbmRhcmRQcm9wcyB7XG4gICAgLyoqXG4gICAgICogVGhlIGRhdGEgc291cmNlIG9mIHRoZSBlbGVtZW50cyB0byBzaG93LlxuICAgICAqL1xuICAgIGRhdGE6IEFycmF5PHN0cmluZyB8IEludGVyYWN0aXZlTGlzdEl0ZW0+O1xuICAgIC8qKlxuICAgICAqIFRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgdmFsdWUgaWYgYW55LiBQaWNraW5nIG9uZSBlbnRlcnMgdGhlIGNvbnRyb2xsZWQgbW9kZS5cbiAgICAgKi9cbiAgICB2YWx1ZT86IHN0cmluZztcbiAgICAvKipcbiAgICAgKiBUaGUgaW5pdGlhbCB2YWx1ZSBpZiBhbnkuIFBpY2tpbmcgb25lIGVudGVycyBtYW5hZ2VkIG1vZGUuXG4gICAgICovXG4gICAgZGVmYXVsdFZhbHVlPzogc3RyaW5nO1xuICAgIC8qKlxuICAgICAqIEV2ZW50IGZpcmVkIG9uY2UgdGhlIHNlbGVjdGVkIHZhbHVlIGNoYW5nZXMuXG4gICAgICovXG4gICAgb25DaGFuZ2U/KGU6IFNlbGVjdEJ1dHRvbkNoYW5nZUV2ZW50KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgY2hpbGRyZW4/OiB2b2lkO1xufVxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RCdXR0b25TdGF0ZSB7XG4gICAgb3BlbjogYm9vbGVhbjtcbiAgICB2YWx1ZTogc3RyaW5nO1xuICAgIGNvbnRyb2xsZWQ6IGJvb2xlYW47XG59XG5jb25zdCBSb290V3JhcHBlciA9IHN0eWxlZC5kaXYgYFxuICBjb2xvcjogJHtjeWFufTtcbiAgJjpob3ZlciB7XG4gICAgY29sb3I6ICR7c2t5Qmx1ZX07XG4gIH1cbmA7XG5jb25zdCBCdXR0b25XcmFwcGVyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmctbGVmdDogJHtkaXN0YW5jZS54c21hbGx9O1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBjdXJzb3I6IHBvaW50ZXI7XG5gO1xuY29uc3QgU3R5bGVkQ3VzdG9tV3JhcHBlciA9IHN0eWxlZC5kaXY8SW50ZXJhY3RpdmVMaXN0V3JhcHBlclByb3BzPiBgXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgYm9yZGVyOiBzb2xpZCAxcHggI2RmZTNlNjtcbiAgYm94LXNoYWRvdzogMCA0cHggOHB4IDAgcmdiYSgwLCAwLCAwLCAwLjEpO1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHotaW5kZXg6IDI7XG4gIHRvcDogJHtwcm9wcyA9PiAocHJvcHMuZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsID8gOCA6IC0zMCl9cHg7XG4gIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgke3Byb3BzID0+IChwcm9wcy5kaXJlY3Rpb24gPT09IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbi5ub3JtYWwgPyAwIDogLTEwMCl9JSk7XG4gIGJhY2tncm91bmQ6ICR7d2hpdGV9O1xuICBib3JkZXI6IDFweCBzb2xpZCAjZGZlM2U2O1xuICBtYXgtaGVpZ2h0OiA1MHZoO1xuICBvdmVyZmxvdy15OiBhdXRvO1xuYDtcbmNvbnN0IEN1c3RvbVdyYXBwZXIgPSBPYmplY3QuYXNzaWduKCgocHJvcHMgPT4ge1xuICAgIHJldHVybiA8U3R5bGVkQ3VzdG9tV3JhcHBlciB7Li4ucHJvcHN9Lz47XG59KSBhcyBSZWFjdC5TRkM8SW50ZXJhY3RpdmVMaXN0V3JhcHBlclByb3BzPiksIHsgaW5uZXI6IHtcbiAgICAgICAgZ2V0IFN0eWxlZEN1c3RvbVdyYXBwZXIoKSB7IHJldHVybiBTdHlsZWRDdXN0b21XcmFwcGVyIGFzIHR5cGVvZiBTdHlsZWRDdXN0b21XcmFwcGVyOyB9XG4gICAgfSB9KTtcbmZ1bmN0aW9uIHJlbmRlclZhbHVlKGRhdGE6IEFycmF5PHN0cmluZyB8IEludGVyYWN0aXZlTGlzdEl0ZW0+LCB2YWx1ZTogc3RyaW5nKSB7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGRhdGEpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtICE9PSAnc3RyaW5nJyAmJiBpdGVtLmtleSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmNvbnRlbnQgfHwgdmFsdWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuY2xhc3MgU2VsZWN0QnV0dG9uSW50IGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxTZWxlY3RCdXR0b25Qcm9wcywgU2VsZWN0QnV0dG9uU3RhdGU+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogU2VsZWN0QnV0dG9uUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCBjb250cm9sbGVkID0gcHJvcHMudmFsdWUgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIG9wZW46IGZhbHNlLFxuICAgICAgICAgICAgdmFsdWU6IChjb250cm9sbGVkID8gcHJvcHMudmFsdWUgOiBwcm9wcy5kZWZhdWx0VmFsdWUpIHx8ICcnLFxuICAgICAgICAgICAgY29udHJvbGxlZCxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBTZWxlY3RCdXR0b25Qcm9wcykge1xuICAgICAgICBjb25zdCB7IGNvbnRyb2xsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmIChjb250cm9sbGVkKSB7XG4gICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogbmV4dFByb3BzLnZhbHVlIHx8ICcnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBoYW5kbGVNb3VzZURvd24gPSAoZTogUmVhY3QuTW91c2VFdmVudDxIVE1MRGl2RWxlbWVudD4pID0+IHtcbiAgICAgICAgY29uc3QgeyBvcGVuIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIG9wZW46ICFvcGVuLFxuICAgICAgICB9KTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoYW5kbGVDaGFuZ2UgPSAoZTogSW50ZXJhY3RpdmVMaXN0Q2hhbmdlRXZlbnQpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgZGF0YSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBjb250cm9sbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBpbmRleCA9IGUudmFsdWUubGVuZ3RoID8gZS52YWx1ZVswXSA6IC0xO1xuICAgICAgICBjb25zdCBpdGVtID0gZGF0YVtpbmRleF07XG4gICAgICAgIGNvbnN0IHZhbHVlID0gaXRlbSAmJiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnID8gaXRlbSA6IGl0ZW0ua2V5KTtcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29udHJvbGxlZCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgb3BlbjogZmFsc2UsXG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIG9wZW46IGZhbHNlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBvbkNoYW5nZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DaGFuZ2Uoe1xuICAgICAgICAgICAgICAgIGluZGV4LFxuICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlQmx1ciA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBoYW5kbGVDbGlja091dHNpZGUgPSB0aGlzLmhhbmRsZUJsdXI7XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IGRhdGEgPSBbXSwgb25DaGFuZ2U6IF8wLCB2YWx1ZTogXzEsIC4uLnByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IG9wZW4sIHZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gKDxSb290V3JhcHBlciB7Li4ucHJvcHN9PlxuICAgICAgICA8QnV0dG9uV3JhcHBlciBvbk1vdXNlRG93bj17dGhpcy5oYW5kbGVNb3VzZURvd259PlxuICAgICAgICAgIHtyZW5kZXJWYWx1ZShkYXRhLCB2YWx1ZSl9XG4gICAgICAgICAgPEljb24gbmFtZT1cIkFycm93RHJvcERvd25cIiBzaXplPXsxLjV9Lz5cbiAgICAgICAgPC9CdXR0b25XcmFwcGVyPlxuICAgICAgICA8SW50ZXJhY3RpdmVMaXN0IGRhdGE9e2RhdGF9IG9wZW49e29wZW59IG9uQmx1cj17dGhpcy5oYW5kbGVCbHVyfSBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFuZ2V9IGN1c3RvbVdyYXBwZXI9e0N1c3RvbVdyYXBwZXJ9IHZhbHVlPXt2YWx1ZX0gb25DbGlja091dHNpZGU9eygpID0+IHsgfX0gYXV0b1Bvc2l0aW9uIGF1dG9Gb2N1cyBzaG93VGljay8+XG4gICAgICA8L1Jvb3RXcmFwcGVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFJvb3RXcmFwcGVyKCkgeyByZXR1cm4gUm9vdFdyYXBwZXIgYXMgdHlwZW9mIFJvb3RXcmFwcGVyOyB9LFxuICAgICAgICBnZXQgQnV0dG9uV3JhcHBlcigpIHsgcmV0dXJuIEJ1dHRvbldyYXBwZXIgYXMgdHlwZW9mIEJ1dHRvbldyYXBwZXI7IH0sXG4gICAgICAgIGdldCBJY29uKCkgeyByZXR1cm4gSWNvbiBhcyB0eXBlb2YgSWNvbjsgfSxcbiAgICAgICAgZ2V0IEludGVyYWN0aXZlTGlzdCgpIHsgcmV0dXJuIEludGVyYWN0aXZlTGlzdCBhcyB0eXBlb2YgSW50ZXJhY3RpdmVMaXN0OyB9XG4gICAgfTtcbn1cbi8qKlxuICogUmVwcmVzZW50cyBhIHNlbGVjdCBidXR0b24sIHdoaWNoIGlzIGEga2luZCBvZiBkcm9wZG93biBidXR0b24uXG4gKi9cbmV4cG9ydCBjb25zdCBTZWxlY3RCdXR0b24gPSBPbkNsaWNrT3V0KFNlbGVjdEJ1dHRvbkludCk7XG4iXX0=