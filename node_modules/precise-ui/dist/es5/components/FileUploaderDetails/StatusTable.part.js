"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var labels_1 = require("../../utils/labels");
var Icon_1 = require("../Icon");
var ProgressBar_1 = require("../ProgressBar");
var Table_1 = require("../Table");
var ActionIconContainer_part_1 = require("./ActionIconContainer.part");
var StatusIcon_part_1 = require("./StatusIcon.part");
var helpers_1 = require("./helpers");
var TextWrapBox = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  display: block;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"], ["\n  display: block;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n"])));
var StyledTable = styled_1.default(Table_1.Table)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  table-layout: fixed;\n"], ["\n  table-layout: fixed;\n"])));
var ProgressTableRow = styled_1.default.tr(styled_1.themed(function (_a) {
    var theme = _a.theme;
    return styled_1.css(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n      border-bottom: 1px solid ", ";\n      padding: 0;\n      &:hover {\n        background: ", ";\n      }\n    "], ["\n      border-bottom: 1px solid ", ";\n      padding: 0;\n      &:hover {\n        background: ", ";\n      }\n    "])), theme.ui4, theme.ui3);
}));
var ProgressTableCell = styled_1.default.td(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  padding: 0 !important;\n  &:hover {\n    background: ", ";\n  }\n"], ["\n  padding: 0 !important;\n  &:hover {\n    background: ", ";\n  }\n"])), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.ui3;
}));
var StyledProgressBar = styled_1.default(ProgressBar_1.ProgressBar)(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  border-radius: 0;\n  height: 2px;\n"], ["\n  border-radius: 0;\n  height: 2px;\n"])));
exports.StyledTableRow = styled_1.default.tr(styled_1.themed(function (_a) {
    var hasProgressBar = _a.hasProgressBar, theme = _a.theme;
    return styled_1.css(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n      border-bottom: ", "px solid ", ";\n      &:hover {\n        background: ", ";\n      }\n    "], ["\n      border-bottom: ", "px solid ", ";\n      &:hover {\n        background: ", ";\n      }\n    "])), hasProgressBar ? 0 : 1, theme.ui4, theme.ui4);
}));
exports.StatusTable = Object.assign((function (_a) {
    var theme = _a.theme, files = _a.files, onCancel = _a.onCancel, onDelete = _a.onDelete, props = __rest(_a, ["theme", "files", "onCancel", "onDelete"]);
    var columns = {
        name: {
            header: labels_1.getPropLabel(props, 'tableHeaderFileLabel'),
        },
        status: {
            header: labels_1.getPropLabel(props, 'tableHeaderStatusLabel'),
            width: '40%',
        },
        action: {
            header: '',
            width: '30px',
        },
    };
    var data = files.map(function (item) { return (__assign({}, item, { status: helpers_1.getStatus(item) })); });
    function rowRenderer(_a) {
        var cells = _a.cells, data = _a.data;
        var hasProgressBar = !(data.canceled || data.error || data.progress >= 100);
        return (React.createElement(React.Fragment, { key: data.fileId },
            React.createElement(exports.StyledTableRow, { hasProgressBar: hasProgressBar, theme: theme }, cells),
            hasProgressBar && (React.createElement(ProgressTableRow, { theme: theme },
                React.createElement(ProgressTableCell, { colSpan: 3 },
                    React.createElement(StyledProgressBar, { value: data.progress, animate: true }))))));
    }
    function cellRenderer(e) {
        var value = e.value;
        var fileData = e.data;
        if (e.key.toLowerCase() === 'action' && fileData) {
            var status_1 = helpers_1.getStatus(fileData);
            return status_1 === 'progress' || status_1 === 'scanning' ? (React.createElement(ActionIconContainer_part_1.ActionIconContainer, { onClick: function () { return onCancel({ files: [fileData] }); } },
                React.createElement(Icon_1.Icon, { name: "Close" }))) : status_1 === 'success' ? (React.createElement(ActionIconContainer_part_1.ActionIconContainer, { onClick: function () { return onDelete({ files: [fileData] }); } },
                React.createElement(Icon_1.Icon, { name: "Delete" }))) : (false);
        }
        if (e.key.toLowerCase() === 'status' && e.data) {
            var status_2 = helpers_1.getStatus(e.data);
            var error = status_2 === 'error' && e.data.error;
            return (React.createElement(TextWrapBox, null,
                React.createElement(StatusIcon_part_1.StatusIcon, { condensed: true, type: status_2, name: helpers_1.iconNames[value] }),
                labels_1.getPropLabel(props, status_2 + "TableUploadLabel", error)));
        }
        return React.createElement(TextWrapBox, null, value);
    }
    return (React.createElement(StyledTable, { data: data, theme: theme, columns: columns, rowRenderer: rowRenderer, cellRenderer: cellRenderer, mode: "table", condensed: true }));
}), { inner: {
        get StyledTableRow() { return exports.StyledTableRow; },
        get ProgressTableRow() { return ProgressTableRow; },
        get ProgressTableCell() { return ProgressTableCell; },
        get StyledProgressBar() { return StyledProgressBar; },
        get ActionIconContainer() { return ActionIconContainer_part_1.ActionIconContainer; },
        get Icon() { return Icon_1.Icon; },
        get TextWrapBox() { return TextWrapBox; },
        get StatusIcon() { return StatusIcon_part_1.StatusIcon; },
        get StyledTable() { return StyledTable; }
    } });
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU3RhdHVzVGFibGUucGFydC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0ZpbGVVcGxvYWRlckRldGFpbHMvU3RhdHVzVGFibGUucGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQXlEO0FBQ3pELDZDQUFxRTtBQUNyRSxnQ0FBK0I7QUFDL0IsOENBQTZDO0FBQzdDLGtDQUFnRTtBQUNoRSx1RUFBaUU7QUFFakUscURBQStDO0FBQy9DLHFDQUFpRDtBQUVqRCxJQUFNLFdBQVcsR0FBRyxnQkFBTSxDQUFDLEdBQUcsbUtBQUMsZ0dBSzlCLElBQUEsQ0FBQztBQUNGLElBQU0sV0FBVyxHQUFHLGdCQUFNLENBQUMsYUFBSyxDQUFDLCtGQUFDLDRCQUVqQyxJQUFBLENBQUM7QUFDRixJQUFNLGdCQUFnQixHQUFHLGdCQUFNLENBQUMsRUFBRSxDQUFDLGVBQU0sQ0FBQyxVQUFDLEVBQVM7UUFBUCxnQkFBSztJQUFPLE9BQUEsWUFBRyx5TEFBQyxtQ0FDNUIsRUFBUyw2REFHcEIsRUFBUyxrQkFFMUIsS0FMNEIsS0FBSyxDQUFDLEdBQUcsRUFHcEIsS0FBSyxDQUFDLEdBQUc7QUFKMEIsQ0FNcEQsQ0FBQyxDQUFDLENBQUM7QUFDUixJQUFNLGlCQUFpQixHQUFHLGdCQUFNLENBQUMsRUFBRSwwSUFBQywyREFHbEIsRUFBZ0MsVUFFakQsS0FGaUIsZUFBTSxDQUFDLFVBQUMsRUFBUztRQUFQLGdCQUFLO0lBQU8sT0FBQSxLQUFLLENBQUMsR0FBRztBQUFULENBQVMsQ0FBQyxDQUVqRCxDQUFDO0FBQ0YsSUFBTSxpQkFBaUIsR0FBRyxnQkFBTSxDQUFDLHlCQUFXLENBQUMsNEdBQUMseUNBRzdDLElBQUEsQ0FBQztBQUlXLFFBQUEsY0FBYyxHQUFHLGdCQUFNLENBQUMsRUFBRSxDQUFzQixlQUFNLENBQUMsVUFBQyxF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RixJQUFJLGlCQUFpQixLQUFLLE9BQU8saUJBQTZDLENBQUMsQ0FBQyxDQUFDO1FBQ2pGLElBQUksbUJBQW1CLEtBQUssT0FBTyw4Q0FBaUQsQ0FBQyxDQUFDLENBQUM7UUFDdkYsSUFBSSxJQUFJLEtBQUssT0FBTyxXQUFtQixDQUFDLENBQUMsQ0FBQztRQUMxQyxJQUFJLFdBQVcsS0FBSyxPQUFPLFdBQWlDLENBQUMsQ0FBQyxDQUFDO1FBQy9ELElBQUksVUFBVSxLQUFLLE9BQU8sNEJBQStCLENBQUMsQ0FBQyxDQUFDO1FBQzVELElBQUksV0FBVyxLQUFLLE9BQU8sV0FBaUMsQ0FBQyxDQUFDLENBQUM7S0FDbEUsRUFBRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCwgY3NzIH0gZnJvbSAnLi4vLi4vdXRpbHMvc3R5bGVkJztcbmltcG9ydCB7IGdldFByb3BMYWJlbCwgU3RhdHVzVGFibGVMYWJlbHMgfSBmcm9tICcuLi8uLi91dGlscy9sYWJlbHMnO1xuaW1wb3J0IHsgSWNvbiB9IGZyb20gJy4uL0ljb24nO1xuaW1wb3J0IHsgUHJvZ3Jlc3NCYXIgfSBmcm9tICcuLi9Qcm9ncmVzc0Jhcic7XG5pbXBvcnQgeyBUYWJsZSwgVGFibGVDZWxsRXZlbnQsIFRhYmxlUm93RXZlbnQgfSBmcm9tICcuLi9UYWJsZSc7XG5pbXBvcnQgeyBBY3Rpb25JY29uQ29udGFpbmVyIH0gZnJvbSAnLi9BY3Rpb25JY29uQ29udGFpbmVyLnBhcnQnO1xuaW1wb3J0IHsgRmlsZVByb2dyZXNzLCBGaWxlVXBsb2FkZXJEZXRhaWxzRXZlbnQgfSBmcm9tICcuL0ZpbGVVcGxvYWRlckRldGFpbHMudHlwZXMucGFydCc7XG5pbXBvcnQgeyBTdGF0dXNJY29uIH0gZnJvbSAnLi9TdGF0dXNJY29uLnBhcnQnO1xuaW1wb3J0IHsgZ2V0U3RhdHVzLCBpY29uTmFtZXMgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgU3RhbmRhcmRQcm9wcyB9IGZyb20gJy4uLy4uL2NvbW1vbic7XG5jb25zdCBUZXh0V3JhcEJveCA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBibG9jaztcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gIHdoaXRlLXNwYWNlOiBub3dyYXA7XG5gO1xuY29uc3QgU3R5bGVkVGFibGUgPSBzdHlsZWQoVGFibGUpIGBcbiAgdGFibGUtbGF5b3V0OiBmaXhlZDtcbmA7XG5jb25zdCBQcm9ncmVzc1RhYmxlUm93ID0gc3R5bGVkLnRyKHRoZW1lZCgoeyB0aGVtZSB9KSA9PiBjc3MgYFxuICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICR7dGhlbWUudWk0fTtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAmOmhvdmVyIHtcbiAgICAgICAgYmFja2dyb3VuZDogJHt0aGVtZS51aTN9O1xuICAgICAgfVxuICAgIGApKTtcbmNvbnN0IFByb2dyZXNzVGFibGVDZWxsID0gc3R5bGVkLnRkIGBcbiAgcGFkZGluZzogMCAhaW1wb3J0YW50O1xuICAmOmhvdmVyIHtcbiAgICBiYWNrZ3JvdW5kOiAke3RoZW1lZCgoeyB0aGVtZSB9KSA9PiB0aGVtZS51aTMpfTtcbiAgfVxuYDtcbmNvbnN0IFN0eWxlZFByb2dyZXNzQmFyID0gc3R5bGVkKFByb2dyZXNzQmFyKSBgXG4gIGJvcmRlci1yYWRpdXM6IDA7XG4gIGhlaWdodDogMnB4O1xuYDtcbmV4cG9ydCBpbnRlcmZhY2UgU3R5bGVkVGFibGVSb3dQcm9wcyB7XG4gICAgaGFzUHJvZ3Jlc3NCYXI6IGJvb2xlYW47XG59XG5leHBvcnQgY29uc3QgU3R5bGVkVGFibGVSb3cgPSBzdHlsZWQudHI8U3R5bGVkVGFibGVSb3dQcm9wcz4odGhlbWVkKCh7IGhhc1Byb2dyZXNzQmFyLCB0aGVtZSB9KSA9PiBjc3MgYFxuICAgICAgYm9yZGVyLWJvdHRvbTogJHtoYXNQcm9ncmVzc0JhciA/IDAgOiAxfXB4IHNvbGlkICR7dGhlbWUudWk0fTtcbiAgICAgICY6aG92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kOiAke3RoZW1lLnVpNH07XG4gICAgICB9XG4gICAgYCkpO1xuZXhwb3J0IGludGVyZmFjZSBTdGF0dXNUYWJsZVByb3BzIGV4dGVuZHMgU3RhbmRhcmRQcm9wcywgU3RhdHVzVGFibGVMYWJlbHMge1xuICAgIGZpbGVzOiBBcnJheTxGaWxlUHJvZ3Jlc3M+O1xuICAgIG9uQ2FuY2VsKGU6IEZpbGVVcGxvYWRlckRldGFpbHNFdmVudDxGaWxlUHJvZ3Jlc3M+KTogdm9pZDtcbiAgICBvbkRlbGV0ZShlOiBGaWxlVXBsb2FkZXJEZXRhaWxzRXZlbnQ8RmlsZVByb2dyZXNzPik6IHZvaWQ7XG59XG5leHBvcnQgY29uc3QgU3RhdHVzVGFibGUgPSBPYmplY3QuYXNzaWduKCgoKHsgdGhlbWUsIGZpbGVzLCBvbkNhbmNlbCwgb25EZWxldGUsIC4uLnByb3BzIH0pID0+IHtcbiAgICBjb25zdCBjb2x1bW5zID0ge1xuICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICBoZWFkZXI6IGdldFByb3BMYWJlbChwcm9wcywgJ3RhYmxlSGVhZGVyRmlsZUxhYmVsJyksXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgaGVhZGVyOiBnZXRQcm9wTGFiZWwocHJvcHMsICd0YWJsZUhlYWRlclN0YXR1c0xhYmVsJyksXG4gICAgICAgICAgICB3aWR0aDogJzQwJScsXG4gICAgICAgIH0sXG4gICAgICAgIGFjdGlvbjoge1xuICAgICAgICAgICAgaGVhZGVyOiAnJyxcbiAgICAgICAgICAgIHdpZHRoOiAnMzBweCcsXG4gICAgICAgIH0sXG4gICAgfTtcbiAgICBjb25zdCBkYXRhID0gZmlsZXMubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgLi4uaXRlbSxcbiAgICAgICAgc3RhdHVzOiBnZXRTdGF0dXMoaXRlbSksXG4gICAgfSkpO1xuICAgIGZ1bmN0aW9uIHJvd1JlbmRlcmVyKHsgY2VsbHMsIGRhdGEgfTogVGFibGVSb3dFdmVudDxGaWxlUHJvZ3Jlc3M+KSB7XG4gICAgICAgIGNvbnN0IGhhc1Byb2dyZXNzQmFyID0gIShkYXRhLmNhbmNlbGVkIHx8IGRhdGEuZXJyb3IgfHwgZGF0YS5wcm9ncmVzcyA+PSAxMDApO1xuICAgICAgICByZXR1cm4gKDxSZWFjdC5GcmFnbWVudCBrZXk9e2RhdGEuZmlsZUlkfT5cbiAgICAgICAgPFN0eWxlZFRhYmxlUm93IGhhc1Byb2dyZXNzQmFyPXtoYXNQcm9ncmVzc0Jhcn0gdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICB7Y2VsbHN9XG4gICAgICAgIDwvU3R5bGVkVGFibGVSb3c+XG4gICAgICAgIHtoYXNQcm9ncmVzc0JhciAmJiAoPFByb2dyZXNzVGFibGVSb3cgdGhlbWU9e3RoZW1lfT5cbiAgICAgICAgICAgIDxQcm9ncmVzc1RhYmxlQ2VsbCBjb2xTcGFuPXszfT5cbiAgICAgICAgICAgICAgPFN0eWxlZFByb2dyZXNzQmFyIHZhbHVlPXtkYXRhLnByb2dyZXNzfSBhbmltYXRlLz5cbiAgICAgICAgICAgIDwvUHJvZ3Jlc3NUYWJsZUNlbGw+XG4gICAgICAgICAgPC9Qcm9ncmVzc1RhYmxlUm93Pil9XG4gICAgICA8L1JlYWN0LkZyYWdtZW50Pik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNlbGxSZW5kZXJlcihlOiBUYWJsZUNlbGxFdmVudDxGaWxlUHJvZ3Jlc3M+KSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZS52YWx1ZTtcbiAgICAgICAgY29uc3QgZmlsZURhdGEgPSBlLmRhdGE7XG4gICAgICAgIGlmIChlLmtleS50b0xvd2VyQ2FzZSgpID09PSAnYWN0aW9uJyAmJiBmaWxlRGF0YSkge1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZ2V0U3RhdHVzKGZpbGVEYXRhKTtcbiAgICAgICAgICAgIHJldHVybiBzdGF0dXMgPT09ICdwcm9ncmVzcycgfHwgc3RhdHVzID09PSAnc2Nhbm5pbmcnID8gKDxBY3Rpb25JY29uQ29udGFpbmVyIG9uQ2xpY2s9eygpID0+IG9uQ2FuY2VsKHsgZmlsZXM6IFtmaWxlRGF0YV0gfSl9PlxuICAgICAgICAgIDxJY29uIG5hbWU9XCJDbG9zZVwiLz5cbiAgICAgICAgPC9BY3Rpb25JY29uQ29udGFpbmVyPikgOiBzdGF0dXMgPT09ICdzdWNjZXNzJyA/ICg8QWN0aW9uSWNvbkNvbnRhaW5lciBvbkNsaWNrPXsoKSA9PiBvbkRlbGV0ZSh7IGZpbGVzOiBbZmlsZURhdGFdIH0pfT5cbiAgICAgICAgICA8SWNvbiBuYW1lPVwiRGVsZXRlXCIvPlxuICAgICAgICA8L0FjdGlvbkljb25Db250YWluZXI+KSA6IChmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUua2V5LnRvTG93ZXJDYXNlKCkgPT09ICdzdGF0dXMnICYmIGUuZGF0YSkge1xuICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gZ2V0U3RhdHVzKGUuZGF0YSk7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IHN0YXR1cyA9PT0gJ2Vycm9yJyAmJiBlLmRhdGEuZXJyb3I7XG4gICAgICAgICAgICByZXR1cm4gKDxUZXh0V3JhcEJveD5cbiAgICAgICAgICA8U3RhdHVzSWNvbiBjb25kZW5zZWQgdHlwZT17c3RhdHVzfSBuYW1lPXtpY29uTmFtZXNbdmFsdWVdfS8+XG4gICAgICAgICAge2dldFByb3BMYWJlbChwcm9wcywgYCR7c3RhdHVzfVRhYmxlVXBsb2FkTGFiZWxgIGFzIGFueSwgZXJyb3IpfVxuICAgICAgICA8L1RleHRXcmFwQm94Pik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDxUZXh0V3JhcEJveD57dmFsdWV9PC9UZXh0V3JhcEJveD47XG4gICAgfVxuICAgIHJldHVybiAoPFN0eWxlZFRhYmxlIGRhdGE9e2RhdGF9IHRoZW1lPXt0aGVtZX0gY29sdW1ucz17Y29sdW1uc30gcm93UmVuZGVyZXI9e3Jvd1JlbmRlcmVyfSBjZWxsUmVuZGVyZXI9e2NlbGxSZW5kZXJlcn0gbW9kZT1cInRhYmxlXCIgY29uZGVuc2VkLz4pO1xufSkgYXMgUmVhY3QuU0ZDPFN0YXR1c1RhYmxlUHJvcHM+KSwgeyBpbm5lcjoge1xuICAgICAgICBnZXQgU3R5bGVkVGFibGVSb3coKSB7IHJldHVybiBTdHlsZWRUYWJsZVJvdyBhcyB0eXBlb2YgU3R5bGVkVGFibGVSb3c7IH0sXG4gICAgICAgIGdldCBQcm9ncmVzc1RhYmxlUm93KCkgeyByZXR1cm4gUHJvZ3Jlc3NUYWJsZVJvdyBhcyB0eXBlb2YgUHJvZ3Jlc3NUYWJsZVJvdzsgfSxcbiAgICAgICAgZ2V0IFByb2dyZXNzVGFibGVDZWxsKCkgeyByZXR1cm4gUHJvZ3Jlc3NUYWJsZUNlbGwgYXMgdHlwZW9mIFByb2dyZXNzVGFibGVDZWxsOyB9LFxuICAgICAgICBnZXQgU3R5bGVkUHJvZ3Jlc3NCYXIoKSB7IHJldHVybiBTdHlsZWRQcm9ncmVzc0JhciBhcyB0eXBlb2YgU3R5bGVkUHJvZ3Jlc3NCYXI7IH0sXG4gICAgICAgIGdldCBBY3Rpb25JY29uQ29udGFpbmVyKCkgeyByZXR1cm4gQWN0aW9uSWNvbkNvbnRhaW5lciBhcyB0eXBlb2YgQWN0aW9uSWNvbkNvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IEljb24oKSB7IHJldHVybiBJY29uIGFzIHR5cGVvZiBJY29uOyB9LFxuICAgICAgICBnZXQgVGV4dFdyYXBCb3goKSB7IHJldHVybiBUZXh0V3JhcEJveCBhcyB0eXBlb2YgVGV4dFdyYXBCb3g7IH0sXG4gICAgICAgIGdldCBTdGF0dXNJY29uKCkgeyByZXR1cm4gU3RhdHVzSWNvbiBhcyB0eXBlb2YgU3RhdHVzSWNvbjsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZFRhYmxlKCkgeyByZXR1cm4gU3R5bGVkVGFibGUgYXMgdHlwZW9mIFN0eWxlZFRhYmxlOyB9XG4gICAgfSB9KTtcbiJdfQ==