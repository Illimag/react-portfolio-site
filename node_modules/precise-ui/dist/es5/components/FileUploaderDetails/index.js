"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var eventManager_1 = require("../../utils/eventManager");
var FileUploaderDetails_types_part_1 = require("./FileUploaderDetails.types.part");
exports.FileUploadActions = FileUploaderDetails_types_part_1.FileUploadActions;
var UploaderProgressBar_part_1 = require("./UploaderProgressBar.part");
var UploaderProgressDetails_part_1 = require("./UploaderProgressDetails.part");
var helpers_1 = require("./helpers");
var distance_1 = require("../../distance");
var initialState = {
    files: [],
    showDetails: false,
    showUploader: false,
};
var StyledUploaderHost = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  z-index: 10001;\n  width: 100%;\n  position: fixed;\n  left: 0;\n  bottom: ", ";\n  height: 0px;\n  overflow: visible;\n  display: flex;\n  align-items: flex-end;\n"], ["\n  z-index: 10001;\n  width: 100%;\n  position: fixed;\n  left: 0;\n  bottom: ", ";\n  height: 0px;\n  overflow: visible;\n  display: flex;\n  align-items: flex-end;\n"])), distance_1.distance.large);
var StyledDetailsHost = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  // We override the 'z-index' of the styled component 'FixedContainer' of 'Blocker' (which is called by 'Modal').\n  // This fixes the problem of showing 'UploadProgressDetails' behind modal in IE.\n  & > div:first-child {\n    z-index: 10001;\n  }\n"], ["\n  // We override the 'z-index' of the styled component 'FixedContainer' of 'Blocker' (which is called by 'Modal').\n  // This fixes the problem of showing 'UploadProgressDetails' behind modal in IE.\n  & > div:first-child {\n    z-index: 10001;\n  }\n"])));
/**
 * The host element for global async file upload process. Use as a singleton only.
 */
var FileUploaderDetails = /** @class */ (function (_super) {
    __extends(FileUploaderDetails, _super);
    function FileUploaderDetails(props) {
        var _this = _super.call(this, props) || this;
        _this.onStart = function (e) {
            _this.props.onUpload(e);
            _this.setState({
                showUploader: true,
            });
        };
        _this.onChange = function (_a) {
            var files = _a.files;
            var currentFiles = _this.state.files;
            _this.setState({
                files: helpers_1.mergeData(files, currentFiles),
            });
        };
        _this.onCancel = function (_a) {
            var files = _a.files;
            var onCancel = _this.props.onCancel;
            if (typeof onCancel === 'function') {
                onCancel({
                    files: files.filter(function (item) { return item.progress < 100 && !item.canceled && !item.error; }),
                });
            }
        };
        _this.onDelete = function (_a) {
            var files = _a.files;
            var onDelete = _this.props.onDelete;
            if (typeof onDelete === 'function') {
                onDelete({
                    files: files.filter(function (item) { return item.progress >= 100 && !item.canceled && !item.error; }),
                });
            }
        };
        _this.onClear = function (uploaderId) {
            var currentFiles = _this.state.files;
            var newFiles = currentFiles.filter(function (item) { return item.uploaderId !== uploaderId; });
            var oldFiles = currentFiles.filter(function (item) { return item.uploaderId === uploaderId; });
            _this.setState({
                files: newFiles,
            }, function () {
                _this.onCancel({
                    files: oldFiles,
                });
            });
        };
        _this.closeUploader = function () {
            var onClose = _this.props.onClose;
            if (typeof onClose === 'function') {
                onClose();
            }
            _this.setState(__assign({}, initialState));
        };
        _this.hideDetails = function () {
            _this.setState({
                showDetails: false,
            });
        };
        _this.showDetails = function () {
            _this.setState({
                showDetails: true,
            });
        };
        var events = props.events;
        _this.eventManager = events || eventManager_1.eventManagers[0];
        _this.state = __assign({}, initialState);
        return _this;
    }
    FileUploaderDetails.prototype.componentDidMount = function () {
        var em = this.eventManager;
        em.on(FileUploaderDetails_types_part_1.FileUploadActions.startUpload, this.onStart);
        em.on(FileUploaderDetails_types_part_1.FileUploadActions.cancelUpload, this.onCancel);
        em.on(FileUploaderDetails_types_part_1.FileUploadActions.uploadProgress, this.onChange);
        em.on(FileUploaderDetails_types_part_1.FileUploadActions.uploadFailure, this.onChange);
        em.on(FileUploaderDetails_types_part_1.FileUploadActions.showUploads, this.showDetails);
        em.on(FileUploaderDetails_types_part_1.FileUploadActions.clearUploads, this.onClear);
        em.on(FileUploaderDetails_types_part_1.FileUploadActions.deleteUploads, this.onDelete);
        eventManager_1.eventManagers.push(em);
    };
    FileUploaderDetails.prototype.componentWillUnmount = function () {
        var em = this.eventManager;
        em.off(FileUploaderDetails_types_part_1.FileUploadActions.startUpload, this.onStart);
        em.off(FileUploaderDetails_types_part_1.FileUploadActions.cancelUpload, this.onCancel);
        em.off(FileUploaderDetails_types_part_1.FileUploadActions.uploadProgress, this.onChange);
        em.off(FileUploaderDetails_types_part_1.FileUploadActions.uploadFailure, this.onChange);
        em.off(FileUploaderDetails_types_part_1.FileUploadActions.showUploads, this.showDetails);
        em.off(FileUploaderDetails_types_part_1.FileUploadActions.clearUploads, this.onClear);
        em.off(FileUploaderDetails_types_part_1.FileUploadActions.deleteUploads, this.onDelete);
        eventManager_1.eventManagers.splice(eventManager_1.eventManagers.lastIndexOf(em), 1);
    };
    FileUploaderDetails.prototype.render = function () {
        var _a = this.props, events = _a.events, onCancel = _a.onCancel, onClose = _a.onClose, onDelete = _a.onDelete, onUpload = _a.onUpload, props = __rest(_a, ["events", "onCancel", "onClose", "onDelete", "onUpload"]);
        var _b = this.state, showDetails = _b.showDetails, showUploader = _b.showUploader, files = _b.files;
        var inprogressFiles = files.filter(function (item) { return !(item.canceled || item.error); }).map(function (item) { return item.progress; });
        var errorFiles = files.filter(function (item) { return item.canceled || item.error; });
        var totalProgress = inprogressFiles.length > 0 ? inprogressFiles.reduce(function (acc, curr) { return acc + curr; }, 0) / inprogressFiles.length : 100;
        var scanning = files.filter(function (item) { return item.scanning && !item.canceled; }).length > 0;
        var show = showUploader && files.length > 0;
        return (show && (React.createElement(React.Fragment, null,
            React.createElement(StyledDetailsHost, null,
                React.createElement(UploaderProgressDetails_part_1.UploaderProgressDetails, __assign({}, props, { open: showDetails, files: files, onCancel: this.onCancel, onDelete: this.onDelete, onHide: this.hideDetails, progressValue: totalProgress }))),
            !showDetails && (React.createElement(StyledUploaderHost, null,
                React.createElement(UploaderProgressBar_part_1.UploaderProgressBar, __assign({}, props, { scanning: scanning, progressValue: totalProgress, inProgress: inprogressFiles.length, errors: errorFiles.length, total: files.length, onShow: this.showDetails, onClose: this.closeUploader })))))));
    };
    FileUploaderDetails.inner = {
        get StyledDetailsHost() { return StyledDetailsHost; },
        get UploaderProgressDetails() { return UploaderProgressDetails_part_1.UploaderProgressDetails; },
        get StyledUploaderHost() { return StyledUploaderHost; },
        get UploaderProgressBar() { return UploaderProgressBar_part_1.UploaderProgressBar; }
    };
    return FileUploaderDetails;
}(React.Component));
exports.FileUploaderDetails = FileUploaderDetails;
var templateObject_1, templateObject_2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9GaWxlVXBsb2FkZXJEZXRhaWxzL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQXdDO0FBRXhDLHlEQUF1RTtBQUN2RSxtRkFBa0k7QUFLekgsNEJBTGtDLGtEQUFpQixDQUtsQztBQUoxQix1RUFBaUU7QUFDakUsK0VBQXlFO0FBQ3pFLHFDQUFzQztBQUN0QywyQ0FBMEM7QUE2QjFDLElBQU0sWUFBWSxHQUE2QjtJQUMzQyxLQUFLLEVBQUUsRUFBRTtJQUNULFdBQVcsRUFBRSxLQUFLO0lBQ2xCLFlBQVksRUFBRSxLQUFLO0NBQ3RCLENBQUM7QUFDRixJQUFNLGtCQUFrQixHQUFHLGdCQUFNLENBQUMsR0FBRyw2T0FBQyxpRkFLMUIsRUFBYyx1RkFLekIsS0FMVyxtQkFBUSxDQUFDLEtBQUssQ0FLekIsQ0FBQztBQUNGLElBQU0saUJBQWlCLEdBQUcsZ0JBQU0sQ0FBQyxHQUFHLGtVQUFDLCtQQU1wQyxJQUFBLENBQUM7QUFDRjs7R0FFRztBQUNIO0lBQXlDLHVDQUFtRTtJQUV4Ryw2QkFBWSxLQUErQjtRQUEzQyxZQUNJLGtCQUFNLEtBQUssQ0FBQyxTQU1mO1FBdUJPLGFBQU8sR0FBRyxVQUFDLENBQXFDO1lBQ3BELEtBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLEtBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQ1YsWUFBWSxFQUFFLElBQUk7YUFDckIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDO1FBQ00sY0FBUSxHQUFHLFVBQUMsRUFBaUQ7Z0JBQS9DLGdCQUFLO1lBQ2YsSUFBQSxnQ0FBbUIsQ0FBZ0I7WUFDM0MsS0FBSSxDQUFDLFFBQVEsQ0FBQztnQkFDVixLQUFLLEVBQUUs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TiwwQkFBQztDQUFBLEFBbEhELENBQXlDLEtBQUssQ0FBQyxTQUFTLEdBa0h2RDtBQWxIWSxrREFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBVcGxvYWRQcm9ncmVzc0RldGFpbHNMYWJlbHMsIFVwbG9hZGVyUHJvZ3Jlc3NCYXJMYWJlbHMgfSBmcm9tICcuLi8uLi91dGlscy9sYWJlbHMnO1xuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyLCBldmVudE1hbmFnZXJzIH0gZnJvbSAnLi4vLi4vdXRpbHMvZXZlbnRNYW5hZ2VyJztcbmltcG9ydCB7IEZpbGVCYXNlLCBGaWxlSXRlbSwgRmlsZVByb2dyZXNzLCBGaWxlVXBsb2FkQWN0aW9ucywgRmlsZVVwbG9hZGVyRGV0YWlsc0V2ZW50LCB9IGZyb20gJy4vRmlsZVVwbG9hZGVyRGV0YWlscy50eXBlcy5wYXJ0JztcbmltcG9ydCB7IFVwbG9hZGVyUHJvZ3Jlc3NCYXIgfSBmcm9tICcuL1VwbG9hZGVyUHJvZ3Jlc3NCYXIucGFydCc7XG5pbXBvcnQgeyBVcGxvYWRlclByb2dyZXNzRGV0YWlscyB9IGZyb20gJy4vVXBsb2FkZXJQcm9ncmVzc0RldGFpbHMucGFydCc7XG5pbXBvcnQgeyBtZXJnZURhdGEgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5leHBvcnQgeyBGaWxlVXBsb2FkQWN0aW9ucywgRmlsZUl0ZW0sIEZpbGVQcm9ncmVzcywgRmlsZUJhc2UsIEZpbGVVcGxvYWRlckRldGFpbHNFdmVudCB9O1xuZXhwb3J0IGludGVyZmFjZSBGaWxlVXBsb2FkZXJEZXRhaWxzUHJvcHMgZXh0ZW5kcyBVcGxvYWRQcm9ncmVzc0RldGFpbHNMYWJlbHMsIFVwbG9hZGVyUHJvZ3Jlc3NCYXJMYWJlbHMge1xuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIGV2ZW50IG1hbmFnZXIgdG8gdXNlLiBCeSBkZWZhdWx0IGEgc3RhbmRhcmQgZXZlbnQgbWFuYWdlciBpcyB1c2VkLlxuICAgICAqL1xuICAgIGV2ZW50cz86IEV2ZW50TWFuYWdlcjtcbiAgICAvKipcbiAgICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gZmlsZXMgdG8gdXBsb2FkIGFyZSBzZWxlY3RlZC5cbiAgICAgKi9cbiAgICBvblVwbG9hZChlOiBGaWxlVXBsb2FkZXJEZXRhaWxzRXZlbnQ8RmlsZUl0ZW0+KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gZmlsZSB1cGxvYWQgaGFzIGJlZW4gY2FuY2VsZWQuXG4gICAgICovXG4gICAgb25DYW5jZWw/KGU6IEZpbGVVcGxvYWRlckRldGFpbHNFdmVudDxGaWxlUHJvZ3Jlc3M+KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gZmlsZSB1cGxvYWQgc2hvdWxkIGJlIGRlbGV0ZWQuXG4gICAgICovXG4gICAgb25EZWxldGU/KGU6IEZpbGVVcGxvYWRlckRldGFpbHNFdmVudDxGaWxlUHJvZ3Jlc3M+KTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBFdmVudCBlbWl0dGVkIHdoZW4gdG90YWwgcHJvZ3Jlc3Mgb3ZlcmxheSBpcyBjbG9zZWQuXG4gICAgICovXG4gICAgb25DbG9zZT8oKTogdm9pZDtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgRmlsZVVwbG9hZGVyRGV0YWlsc1N0YXRlIHtcbiAgICBmaWxlczogQXJyYXk8RmlsZVByb2dyZXNzPjtcbiAgICBzaG93RGV0YWlsczogYm9vbGVhbjtcbiAgICBzaG93VXBsb2FkZXI6IGJvb2xlYW47XG59XG5jb25zdCBpbml0aWFsU3RhdGU6IEZpbGVVcGxvYWRlckRldGFpbHNTdGF0ZSA9IHtcbiAgICBmaWxlczogW10sXG4gICAgc2hvd0RldGFpbHM6IGZhbHNlLFxuICAgIHNob3dVcGxvYWRlcjogZmFsc2UsXG59O1xuY29uc3QgU3R5bGVkVXBsb2FkZXJIb3N0ID0gc3R5bGVkLmRpdiBgXG4gIHotaW5kZXg6IDEwMDAxO1xuICB3aWR0aDogMTAwJTtcbiAgcG9zaXRpb246IGZpeGVkO1xuICBsZWZ0OiAwO1xuICBib3R0b206ICR7ZGlzdGFuY2UubGFyZ2V9O1xuICBoZWlnaHQ6IDBweDtcbiAgb3ZlcmZsb3c6IHZpc2libGU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBmbGV4LWVuZDtcbmA7XG5jb25zdCBTdHlsZWREZXRhaWxzSG9zdCA9IHN0eWxlZC5kaXYgYFxuICAvLyBXZSBvdmVycmlkZSB0aGUgJ3otaW5kZXgnIG9mIHRoZSBzdHlsZWQgY29tcG9uZW50ICdGaXhlZENvbnRhaW5lcicgb2YgJ0Jsb2NrZXInICh3aGljaCBpcyBjYWxsZWQgYnkgJ01vZGFsJykuXG4gIC8vIFRoaXMgZml4ZXMgdGhlIHByb2JsZW0gb2Ygc2hvd2luZyAnVXBsb2FkUHJvZ3Jlc3NEZXRhaWxzJyBiZWhpbmQgbW9kYWwgaW4gSUUuXG4gICYgPiBkaXY6Zmlyc3QtY2hpbGQge1xuICAgIHotaW5kZXg6IDEwMDAxO1xuICB9XG5gO1xuLyoqXG4gKiBUaGUgaG9zdCBlbGVtZW50IGZvciBnbG9iYWwgYXN5bmMgZmlsZSB1cGxvYWQgcHJvY2Vzcy4gVXNlIGFzIGEgc2luZ2xldG9uIG9ubHkuXG4gKi9cbmV4cG9ydCBjbGFzcyBGaWxlVXBsb2FkZXJEZXRhaWxzIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PEZpbGVVcGxvYWRlckRldGFpbHNQcm9wcywgRmlsZVVwbG9hZGVyRGV0YWlsc1N0YXRlPiB7XG4gICAgcHJpdmF0ZSBldmVudE1hbmFnZXI6IEV2ZW50TWFuYWdlcjtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogRmlsZVVwbG9hZGVyRGV0YWlsc1Byb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgY29uc3QgeyBldmVudHMgfSA9IHByb3BzO1xuICAgICAgICB0aGlzLmV2ZW50TWFuYWdlciA9IGV2ZW50cyB8fCBldmVudE1hbmFnZXJzWzBdO1xuICAgICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICAgICAgLi4uaW5pdGlhbFN0YXRlLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgICAgY29uc3QgZW0gPSB0aGlzLmV2ZW50TWFuYWdlcjtcbiAgICAgICAgZW0ub24oRmlsZVVwbG9hZEFjdGlvbnMuc3RhcnRVcGxvYWQsIHRoaXMub25TdGFydCk7XG4gICAgICAgIGVtLm9uKEZpbGVVcGxvYWRBY3Rpb25zLmNhbmNlbFVwbG9hZCwgdGhpcy5vbkNhbmNlbCk7XG4gICAgICAgIGVtLm9uKEZpbGVVcGxvYWRBY3Rpb25zLnVwbG9hZFByb2dyZXNzLCB0aGlzLm9uQ2hhbmdlKTtcbiAgICAgICAgZW0ub24oRmlsZVVwbG9hZEFjdGlvbnMudXBsb2FkRmFpbHVyZSwgdGhpcy5vbkNoYW5nZSk7XG4gICAgICAgIGVtLm9uKEZpbGVVcGxvYWRBY3Rpb25zLnNob3dVcGxvYWRzLCB0aGlzLnNob3dEZXRhaWxzKTtcbiAgICAgICAgZW0ub24oRmlsZVVwbG9hZEFjdGlvbnMuY2xlYXJVcGxvYWRzLCB0aGlzLm9uQ2xlYXIpO1xuICAgICAgICBlbS5vbihGaWxlVXBsb2FkQWN0aW9ucy5kZWxldGVVcGxvYWRzLCB0aGlzLm9uRGVsZXRlKTtcbiAgICAgICAgZXZlbnRNYW5hZ2Vycy5wdXNoKGVtKTtcbiAgICB9XG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICAgIGNvbnN0IGVtID0gdGhpcy5ldmVudE1hbmFnZXI7XG4gICAgICAgIGVtLm9mZihGaWxlVXBsb2FkQWN0aW9ucy5zdGFydFVwbG9hZCwgdGhpcy5vblN0YXJ0KTtcbiAgICAgICAgZW0ub2ZmKEZpbGVVcGxvYWRBY3Rpb25zLmNhbmNlbFVwbG9hZCwgdGhpcy5vbkNhbmNlbCk7XG4gICAgICAgIGVtLm9mZihGaWxlVXBsb2FkQWN0aW9ucy51cGxvYWRQcm9ncmVzcywgdGhpcy5vbkNoYW5nZSk7XG4gICAgICAgIGVtLm9mZihGaWxlVXBsb2FkQWN0aW9ucy51cGxvYWRGYWlsdXJlLCB0aGlzLm9uQ2hhbmdlKTtcbiAgICAgICAgZW0ub2ZmKEZpbGVVcGxvYWRBY3Rpb25zLnNob3dVcGxvYWRzLCB0aGlzLnNob3dEZXRhaWxzKTtcbiAgICAgICAgZW0ub2ZmKEZpbGVVcGxvYWRBY3Rpb25zLmNsZWFyVXBsb2FkcywgdGhpcy5vbkNsZWFyKTtcbiAgICAgICAgZW0ub2ZmKEZpbGVVcGxvYWRBY3Rpb25zLmRlbGV0ZVVwbG9hZHMsIHRoaXMub25EZWxldGUpO1xuICAgICAgICBldmVudE1hbmFnZXJzLnNwbGljZShldmVudE1hbmFnZXJzLmxhc3RJbmRleE9mKGVtKSwgMSk7XG4gICAgfVxuICAgIHByaXZhdGUgb25TdGFydCA9IChlOiBGaWxlVXBsb2FkZXJEZXRhaWxzRXZlbnQ8RmlsZUl0ZW0+KSA9PiB7XG4gICAgICAgIHRoaXMucHJvcHMub25VcGxvYWQoZSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgc2hvd1VwbG9hZGVyOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHByaXZhdGUgb25DaGFuZ2UgPSAoeyBmaWxlcyB9OiBGaWxlVXBsb2FkZXJEZXRhaWxzRXZlbnQ8RmlsZVByb2dyZXNzPikgPT4ge1xuICAgICAgICBjb25zdCB7IGZpbGVzOiBjdXJyZW50RmlsZXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZmlsZXM6IG1lcmdlRGF0YShmaWxlcywgY3VycmVudEZpbGVzKSxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBwcml2YXRlIG9uQ2FuY2VsID0gKHsgZmlsZXMgfTogRmlsZVVwbG9hZGVyRGV0YWlsc0V2ZW50PEZpbGVQcm9ncmVzcz4pID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkNhbmNlbCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNhbmNlbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DYW5jZWwoe1xuICAgICAgICAgICAgICAgIGZpbGVzOiBmaWxlcy5maWx0ZXIoaXRlbSA9PiBpdGVtLnByb2dyZXNzIDwgMTAwICYmICFpdGVtLmNhbmNlbGVkICYmICFpdGVtLmVycm9yKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBwcml2YXRlIG9uRGVsZXRlID0gKHsgZmlsZXMgfTogRmlsZVVwbG9hZGVyRGV0YWlsc0V2ZW50PEZpbGVQcm9ncmVzcz4pID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkRlbGV0ZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiBvbkRlbGV0ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25EZWxldGUoe1xuICAgICAgICAgICAgICAgIGZpbGVzOiBmaWxlcy5maWx0ZXIoaXRlbSA9PiBpdGVtLnByb2dyZXNzID49IDEwMCAmJiAhaXRlbS5jYW5jZWxlZCAmJiAhaXRlbS5lcnJvciksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBvbkNsZWFyID0gKHVwbG9hZGVySWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCB7IGZpbGVzOiBjdXJyZW50RmlsZXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IG5ld0ZpbGVzID0gY3VycmVudEZpbGVzLmZpbHRlcihpdGVtID0+IGl0ZW0udXBsb2FkZXJJZCAhPT0gdXBsb2FkZXJJZCk7XG4gICAgICAgIGNvbnN0IG9sZEZpbGVzID0gY3VycmVudEZpbGVzLmZpbHRlcihpdGVtID0+IGl0ZW0udXBsb2FkZXJJZCA9PT0gdXBsb2FkZXJJZCk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgZmlsZXM6IG5ld0ZpbGVzLFxuICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uQ2FuY2VsKHtcbiAgICAgICAgICAgICAgICBmaWxlczogb2xkRmlsZXMsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNsb3NlVXBsb2FkZXIgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25DbG9zZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKHR5cGVvZiBvbkNsb3NlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvbkNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAuLi5pbml0aWFsU3RhdGUsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBoaWRlRGV0YWlscyA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzaG93RGV0YWlsczogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcHJpdmF0ZSBzaG93RGV0YWlscyA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBzaG93RGV0YWlsczogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgZXZlbnRzLCBvbkNhbmNlbCwgb25DbG9zZSwgb25EZWxldGUsIG9uVXBsb2FkLCAuLi5wcm9wcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBzaG93RGV0YWlscywgc2hvd1VwbG9hZGVyLCBmaWxlcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgaW5wcm9ncmVzc0ZpbGVzID0gZmlsZXMuZmlsdGVyKGl0ZW0gPT4gIShpdGVtLmNhbmNlbGVkIHx8IGl0ZW0uZXJyb3IpKS5tYXAoaXRlbSA9PiBpdGVtLnByb2dyZXNzKTtcbiAgICAgICAgY29uc3QgZXJyb3JGaWxlcyA9IGZpbGVzLmZpbHRlcihpdGVtID0+IGl0ZW0uY2FuY2VsZWQgfHwgaXRlbS5lcnJvcik7XG4gICAgICAgIGNvbnN0IHRvdGFsUHJvZ3Jlc3MgPSBpbnByb2dyZXNzRmlsZXMubGVuZ3RoID4gMCA/IGlucHJvZ3Jlc3NGaWxlcy5yZWR1Y2UoKGFjYywgY3VycikgPT4gYWNjICsgY3VyciwgMCkgLyBpbnByb2dyZXNzRmlsZXMubGVuZ3RoIDogMTAwO1xuICAgICAgICBjb25zdCBzY2FubmluZyA9IGZpbGVzLmZpbHRlcihpdGVtID0+IGl0ZW0uc2Nhbm5pbmcgJiYgIWl0ZW0uY2FuY2VsZWQpLmxlbmd0aCA+IDA7XG4gICAgICAgIGNvbnN0IHNob3cgPSBzaG93VXBsb2FkZXIgJiYgZmlsZXMubGVuZ3RoID4gMDtcbiAgICAgICAgcmV0dXJuIChzaG93ICYmICg8PlxuICAgICAgICAgIDxTdHlsZWREZXRhaWxzSG9zdD5cbiAgICAgICAgICAgIDxVcGxvYWRlclByb2dyZXNzRGV0YWlscyB7Li4ucHJvcHN9IG9wZW49e3Nob3dEZXRhaWxzfSBmaWxlcz17ZmlsZXN9IG9uQ2FuY2VsPXt0aGlzLm9uQ2FuY2VsfSBvbkRlbGV0ZT17dGhpcy5vbkRlbGV0ZX0gb25IaWRlPXt0aGlzLmhpZGVEZXRhaWxzfSBwcm9ncmVzc1ZhbHVlPXt0b3RhbFByb2dyZXNzfS8+XG4gICAgICAgICAgPC9TdHlsZWREZXRhaWxzSG9zdD5cbiAgICAgICAgICB7IXNob3dEZXRhaWxzICYmICg8U3R5bGVkVXBsb2FkZXJIb3N0PlxuICAgICAgICAgICAgICA8VXBsb2FkZXJQcm9ncmVzc0JhciB7Li4ucHJvcHN9IHNjYW5uaW5nPXtzY2FubmluZ30gcHJvZ3Jlc3NWYWx1ZT17dG90YWxQcm9ncmVzc30gaW5Qcm9ncmVzcz17aW5wcm9ncmVzc0ZpbGVzLmxlbmd0aH0gZXJyb3JzPXtlcnJvckZpbGVzLmxlbmd0aH0gdG90YWw9e2ZpbGVzLmxlbmd0aH0gb25TaG93PXt0aGlzLnNob3dEZXRhaWxzfSBvbkNsb3NlPXt0aGlzLmNsb3NlVXBsb2FkZXJ9Lz5cbiAgICAgICAgICAgIDwvU3R5bGVkVXBsb2FkZXJIb3N0Pil9XG4gICAgICAgIDwvPikpO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWREZXRhaWxzSG9zdCgpIHsgcmV0dXJuIFN0eWxlZERldGFpbHNIb3N0IGFzIHR5cGVvZiBTdHlsZWREZXRhaWxzSG9zdDsgfSxcbiAgICAgICAgZ2V0IFVwbG9hZGVyUHJvZ3Jlc3NEZXRhaWxzKCkgeyByZXR1cm4gVXBsb2FkZXJQcm9ncmVzc0RldGFpbHMgYXMgdHlwZW9mIFVwbG9hZGVyUHJvZ3Jlc3NEZXRhaWxzOyB9LFxuICAgICAgICBnZXQgU3R5bGVkVXBsb2FkZXJIb3N0KCkgeyByZXR1cm4gU3R5bGVkVXBsb2FkZXJIb3N0IGFzIHR5cGVvZiBTdHlsZWRVcGxvYWRlckhvc3Q7IH0sXG4gICAgICAgIGdldCBVcGxvYWRlclByb2dyZXNzQmFyKCkgeyByZXR1cm4gVXBsb2FkZXJQcm9ncmVzc0JhciBhcyB0eXBlb2YgVXBsb2FkZXJQcm9ncmVzc0JhcjsgfVxuICAgIH07XG59XG4iXX0=