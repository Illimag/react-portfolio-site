"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var types_1 = require("./types");
var eventManager_1 = require("../../utils/eventManager");
var text_1 = require("../../utils/text");
var ToastNotification_part_1 = require("./ToastNotification.part");
var types_2 = require("./types");
exports.NotificationAction = types_2.NotificationAction;
var notifier_1 = require("./notifier");
exports.notify = notifier_1.notify;
var defaultProps = {
    width: 320,
};
var getNotificationPositionStyle = function (pos) {
    var positionStyle = pos.split('-')[0] + ":1rem;";
    if (pos.indexOf('center') !== -1) {
        positionStyle += "left:50%;transform:translateX(-50%);";
    }
    else {
        positionStyle += pos.split('-')[1] + ":1rem;";
    }
    return positionStyle;
};
var AbsoluteContainer = styled_1.css(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  z-index: 10001;\n  position: fixed;\n  ", ";\n  width: ", "px;\n  @media (max-width: 480px) {\n    width: 100vw;\n    padding: 0;\n    right: 0;\n    margin: 0;\n    position: fixed;\n    ", ";\n  }\n"], ["\n  z-index: 10001;\n  position: fixed;\n  ", ";\n  width: ", "px;\n  @media (max-width: 480px) {\n    width: 100vw;\n    padding: 0;\n    right: 0;\n    margin: 0;\n    position: fixed;\n    ", ";\n  }\n"])), function (props) { return getNotificationPositionStyle(props.position); }, function (props) { return (props.width ? props.width : defaultProps.width); }, function (props) { return (props.position.substring(0, 3) === 'top' ? 'top: 0' : 'bottom: 0'); });
var StyledNotifications = styled_1.default.div(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  box-sizing: border-box;\n  width: ", ";\n  ", ";\n  @media (max-width: 480px) {\n    padding: 0;\n    margin: 0;\n  }\n  ", ";\n"], ["\n  box-sizing: border-box;\n  width: ", ";\n  ", ";\n  @media (max-width: 480px) {\n    padding: 0;\n    margin: 0;\n  }\n  ", ";\n"])), function (props) { return (!props.width ? 'auto' : props.width + "px"); }, function (props) { return (props.disablePointer ? "pointer-events: none" : ""); }, function (props) { return (props.position !== 'relative' ? AbsoluteContainer : ''); });
/**
 * The host element for arbitrary notifications. Use as a singleton only.
 */
var Notifications = /** @class */ (function (_super) {
    __extends(Notifications, _super);
    function Notifications(props) {
        var _this = _super.call(this, props) || this;
        _this.collection = [];
        _this.hide = function (id) {
            if (typeof id === 'string') {
                _this.removeNotification(id);
            }
            else {
                _this.clearNotifications();
            }
        };
        _this.show = function (payload) {
            var content = payload.content, _a = payload.options, options = _a === void 0 ? {} : _a;
            var _b = _this.props, position = _b.position, autoClose = _b.autoClose;
            var notifications = _this.state.notifications;
            var id = options.id || "" + ~~(Math.random() * 1000000);
            var opts = {
                id: id,
                type: options.type || 'none',
                onClose: function () { return _this.removeNotification(id); },
                position: options.position || position,
                title: options.title || text_1.capitalizeFirst(options.type || ''),
                actionRenderer: options.actionRenderer,
                autoClose: typeof options.autoClose === 'number' ? options.autoClose : autoClose,
            };
            _this.collection.push({
                name: id,
                options: opts,
                content: _this.getNotificationContent(content, opts.onClose),
            });
            _this.setState({
                notifications: notifications.concat([id]),
            });
        };
        var events = props.events;
        _this.eventManager = events || eventManager_1.eventManagers[0];
        _this.state = {
            notifications: [],
        };
        return _this;
    }
    Notifications.prototype.componentDidMount = function () {
        var em = this.eventManager;
        em.on(types_1.NotificationAction.showNotification, this.show);
        em.on(types_1.NotificationAction.clearNotification, this.hide);
        eventManager_1.eventManagers.push(em);
    };
    Notifications.prototype.componentWillUnmount = function () {
        var em = this.eventManager;
        em.off(types_1.NotificationAction.showNotification, this.show);
        em.off(types_1.NotificationAction.clearNotification, this.hide);
        eventManager_1.eventManagers.splice(eventManager_1.eventManagers.lastIndexOf(em), 1);
    };
    Notifications.prototype.removeNotification = function (id) {
        this.setState({
            notifications: this.state.notifications.filter(function (v) { return v !== id; }),
        });
    };
    Notifications.prototype.clearNotifications = function () {
        this.setState({
            notifications: [],
        });
    };
    Notifications.prototype.getNotificationContent = function (content, onClose) {
        if (React.isValidElement(content)) {
            return React.cloneElement(content, { onClose: onClose });
        }
        else if (typeof content === 'function') {
            return content({ onClose: onClose });
        }
        return content;
    };
    Notifications.prototype.defaultNotificationRenderer = function (payload) {
        var content = payload.content, _a = payload.options, options = _a === void 0 ? {} : _a;
        return (React.createElement(ToastNotification_part_1.ToastNotification, __assign({}, options, { title: options.title, key: "notification-" + options.id }), content));
    };
    Notifications.prototype.makeNotification = function (payload) {
        var notificationRenderer = this.props.notificationRenderer;
        var renderer = notificationRenderer || this.defaultNotificationRenderer;
        return renderer(payload);
    };
    Notifications.prototype.render = function () {
        var _this = this;
        var _a = this.props, _b = _a.position, position = _b === void 0 ? 'relative' : _b, width = _a.width, _c = _a.newestOnTop, newestOnTop = _c === void 0 ? false : _c;
        var notifications = this.state.notifications;
        var notificationsToRender = {};
        var collection = this.collection.map(function (item, i) { return ({
            id: item.name,
            item: item,
            index: i,
        }); });
        if (newestOnTop) {
            collection.reverse();
        }
        collection.forEach(function (_a) {
            var id = _a.id, item = _a.item, index = _a.index;
            var options = item.options || {};
            var itemPosition = options.position || position;
            notificationsToRender[itemPosition] || (notificationsToRender[itemPosition] = []);
            if (notifications.indexOf(id) !== -1) {
                notificationsToRender[itemPosition].push(_this.makeNotification(item));
            }
            else {
                notificationsToRender[itemPosition].push(undefined);
                _this.collection.splice(index, 1);
            }
        });
        return (React.createElement("div", null, Object.keys(notificationsToRender).map(function (position) {
            var disablePointer = notificationsToRender[position].length === 1 && notificationsToRender[position][0] === null;
            return (React.createElement(StyledNotifications, { key: "notification-container-" + position, width: width, position: position, disablePointer: disablePointer }, notificationsToRender[position]));
        })));
    };
    Notifications.inner = {
        get ToastNotification() { return ToastNotification_part_1.ToastNotification; },
        get StyledNotifications() { return StyledNotifications; }
    };
    return Notifications;
}(React.Component));
exports.Notifications = Notifications;
var templateObject_1, templateObject_2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9Ob3RpZmljYXRpb25zL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2QkFBK0I7QUFDL0IsNkNBQWlEO0FBQ2pELGlDQUFzSjtBQUN0Six5REFBdUU7QUFDdkUseUNBQW1EO0FBQ25ELG1FQUE2RDtBQUM3RCxpQ0FBZ0k7QUFBckMscUNBQUEsa0JBQWtCLENBQUE7QUFDN0csdUNBQW9DO0FBQTNCLDRCQUFBLE1BQU0sQ0FBQTtBQW9EZixJQUFNLFlBQVksR0FBRztJQUNqQixLQUFLLEVBQUUsR0FBRztDQUNiLENBQUM7QUFDRixJQUFNLDRCQUE0QixHQUFHLFVBQUMsR0FBMEI7SUFDNUQsSUFBSSxhQUFhLEdBQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBUSxDQUFDO0lBQ2pELElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtRQUM5QixhQUFhLElBQUksc0NBQXNDLENBQUM7S0FDM0Q7U0FDSTtRQUNELGFBQWEsSUFBTyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFRLENBQUM7S0FDakQ7SUFDRCxPQUFPLGFBQWEsQ0FBQztBQUN6QixDQUFDLENBQUM7QUFDRixJQUFNLGlCQUFpQixHQUFHLFlBQUcsaVJBQXlCLDZDQUdsRCxFQUFxRCxjQUM5QyxFQUF5RCxtSUFPOUQsRUFBNEUsVUFFakYsS0FWRyxVQUFBLEtBQUssSUFBSSxPQUFBLDRCQUE0QixDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBNUMsQ0FBNEMsRUFDOUMsVUFBQSxLQUFLLElBQUksT0FBQSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUss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cUJBQXFCLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQyxRQUErQjtZQUNwRSxJQUFNLGNBQWMsR0FBRyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQztZQUNuSCxPQUFPLENBQUMsb0JBQUMsbUJBQW1CLElBQUMsR0FBRyxFQUFFLDRCQUEwQixRQUFVLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLGNBQWMsRUFBRSxjQUFjLElBQ3JJLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUNaLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUMsQ0FDRSxDQUFDLENBQUM7SUFDVixDQUFDO0lBQ00sbUJBQUssR0FBRztRQUNYLElBQUksaUJBQWlCLEtBQUssT0FBTywwQ0FBNkMsQ0FBQyxDQUFDLENBQUM7UUFDakYsSUFBSSxtQkFBbUIsS0FBSyxPQUFPLG1CQUFpRCxDQUFDLENBQUMsQ0FBQztLQUMxRixDQUFDO0lBQ04sb0JBQUM7Q0FBQSxBQXpIRCxDQUFtQyxLQUFLLENBQUMsU0FBUyxHQXlIakQ7QUF6SFksc0NBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IGNzcyB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBOb3RpZmljYXRpb25PcHRpb24sIE5vdGlmaWNhdGlvblByb3BzLCBOb3RpZmljYXRpb25zUG9zaXRpb24sIE5vdGlmaWNhdGlvbkFjdGlvbiwgTm90aWZpY2F0aW9uT3B0aW9ucywgTm90aWZpY2F0aW9uQ29udGVudCwgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IEV2ZW50TWFuYWdlciwgZXZlbnRNYW5hZ2VycyB9IGZyb20gJy4uLy4uL3V0aWxzL2V2ZW50TWFuYWdlcic7XG5pbXBvcnQgeyBjYXBpdGFsaXplRmlyc3QgfSBmcm9tICcuLi8uLi91dGlscy90ZXh0JztcbmltcG9ydCB7IFRvYXN0Tm90aWZpY2F0aW9uIH0gZnJvbSAnLi9Ub2FzdE5vdGlmaWNhdGlvbi5wYXJ0JztcbmV4cG9ydCB7IE5vdGlmaWNhdGlvbnNQb3NpdGlvbiwgTm90aWZpY2F0aW9uT3B0aW9uLCBOb3RpZmljYXRpb25UeXBlLCBOb3RpZmljYXRpb25PcHRpb25zLCBOb3RpZmljYXRpb25BY3Rpb24sIH0gZnJvbSAnLi90eXBlcyc7XG5leHBvcnQgeyBub3RpZnkgfSBmcm9tICcuL25vdGlmaWVyJztcbmV4cG9ydCBpbnRlcmZhY2UgTm90aWZpY2F0aW9uc1Byb3BzIHtcbiAgICAvKipcbiAgICAgKiBDdXN0b20gbm90aWZpY2F0aW9uIHJlbmRlcmVyIGNvbXBvbmVudC5cbiAgICAgKi9cbiAgICBub3RpZmljYXRpb25SZW5kZXJlcj8oZTogTm90aWZpY2F0aW9uT3B0aW9ucyk6IFJlYWN0LlJlYWN0Q2hpbGQ7XG4gICAgLyoqXG4gICAgICogVGhlIGRlZmF1bHQgcG9zaXRpb24gZm9yIG5ldyBub3RpZmljYXRpb25zLiBCeSBkZWZhdWx0IHJlbGF0aXZlLlxuICAgICAqIEBkZWZhdWx0IHJlbGF0aXZlXG4gICAgICovXG4gICAgcG9zaXRpb24/OiBOb3RpZmljYXRpb25zUG9zaXRpb247XG4gICAgLyoqXG4gICAgICogRGlzYWJsZSB0aGUgcG9pbnRlciBzeW1ib2wuIEJ5IGRlZmF1bHQgZW5hYmxlZC5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIGRpc2FibGVQb2ludGVyPzogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBUaGUgd2lkdGggdG8gYmUgdXNlZCwgYnkgZGVmYXVsdCBhdXRvLlxuICAgICAqIEBkZWZhdWx0IGF1dG9cbiAgICAgKi9cbiAgICB3aWR0aD86IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBBdXRvbWF0aWNhbGx5IGNsb3NlcyBub3RpZmljYXRpb25zIGFmdGVyIGEgY2VydGFpbiB0aW1lLiBCeSBkZWZhdWx0XG4gICAgICogdGhlIG5vdGlmaWNhdGlvbnMgYXJlIG5vdCBjbG9zZWQuXG4gICAgICogQGRlZmF1bHQgZmFsc2VcbiAgICAgKi9cbiAgICBhdXRvQ2xvc2U/OiBmYWxzZSB8IG51bWJlcjtcbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBsYXRlc3Qgb24gdG9wLiBCeSBkZWZhdWx0IGxhdGVzdCBub3RpZmljYXRpb25zIGFyZSBzaG93biBiZWxvdy5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIG5ld2VzdE9uVG9wPzogYm9vbGVhbjtcbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBldmVudCBtYW5hZ2VyIHRvIHVzZS4gQnkgZGVmYXVsdCBhIHN0YW5kYXJkIGV2ZW50IG1hbmFnZXIgaXMgdXNlZC5cbiAgICAgKi9cbiAgICBldmVudHM/OiBFdmVudE1hbmFnZXI7XG59XG5leHBvcnQgaW50ZXJmYWNlIE5vdGlmaWNhdGlvbnNTdGF0ZSB7XG4gICAgbm90aWZpY2F0aW9uczogQXJyYXk8c3RyaW5nPjtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgU3R5bGVkTm90aWZpY2F0aW9uc1Byb3BzIHtcbiAgICBwb3NpdGlvbj86IE5vdGlmaWNhdGlvbnNQb3NpdGlvbjtcbiAgICBkaXNhYmxlUG9pbnRlcj86IGJvb2xlYW47XG4gICAgd2lkdGg/OiBudW1iZXI7XG59XG5leHBvcnQgaW50ZXJmYWNlIEFic29sdXRlQ29udGFpbmVyUHJvcHMge1xuICAgIHBvc2l0aW9uOiBOb3RpZmljYXRpb25zUG9zaXRpb247XG4gICAgd2lkdGg6IG51bWJlcjtcbn1cbmludGVyZmFjZSBOb3RpZmljYXRpb25FbnRyeSBleHRlbmRzIE5vdGlmaWNhdGlvbk9wdGlvbnMge1xuICAgIG5hbWU6IHN0cmluZztcbn1cbmNvbnN0IGRlZmF1bHRQcm9wcyA9IHtcbiAgICB3aWR0aDogMzIwLFxufTtcbmNvbnN0IGdldE5vdGlmaWNhdGlvblBvc2l0aW9uU3R5bGUgPSAocG9zOiBOb3RpZmljYXRpb25zUG9zaXRpb24pID0+IHtcbiAgICBsZXQgcG9zaXRpb25TdHlsZSA9IGAke3Bvcy5zcGxpdCgnLScpWzBdfToxcmVtO2A7XG4gICAgaWYgKHBvcy5pbmRleE9mKCdjZW50ZXInKSAhPT0gLTEpIHtcbiAgICAgICAgcG9zaXRpb25TdHlsZSArPSBgbGVmdDo1MCU7dHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTUwJSk7YDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHBvc2l0aW9uU3R5bGUgKz0gYCR7cG9zLnNwbGl0KCctJylbMV19OjFyZW07YDtcbiAgICB9XG4gICAgcmV0dXJuIHBvc2l0aW9uU3R5bGU7XG59O1xuY29uc3QgQWJzb2x1dGVDb250YWluZXIgPSBjc3M8QWJzb2x1dGVDb250YWluZXJQcm9wcz4gYFxuICB6LWluZGV4OiAxMDAwMTtcbiAgcG9zaXRpb246IGZpeGVkO1xuICAke3Byb3BzID0+IGdldE5vdGlmaWNhdGlvblBvc2l0aW9uU3R5bGUocHJvcHMucG9zaXRpb24pfTtcbiAgd2lkdGg6ICR7cHJvcHMgPT4gKHByb3BzLndpZHRoID8gcHJvcHMud2lkdGggOiBkZWZhdWx0UHJvcHMud2lkdGgpfXB4O1xuICBAbWVkaWEgKG1heC13aWR0aDogNDgwcHgpIHtcbiAgICB3aWR0aDogMTAwdnc7XG4gICAgcGFkZGluZzogMDtcbiAgICByaWdodDogMDtcbiAgICBtYXJnaW46IDA7XG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgICR7cHJvcHMgPT4gKHByb3BzLnBvc2l0aW9uLnN1YnN0cmluZygwLCAzKSA9PT0gJ3RvcCcgPyAndG9wOiAwJyA6ICdib3R0b206IDAnKX07XG4gIH1cbmA7XG5jb25zdCBTdHlsZWROb3RpZmljYXRpb25zID0gc3R5bGVkLmRpdjxTdHlsZWROb3RpZmljYXRpb25zUHJvcHM+IGBcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgd2lkdGg6ICR7cHJvcHMgPT4gKCFwcm9wcy53aWR0aCA/ICdhdXRvJyA6IGAke3Byb3BzLndpZHRofXB4YCl9O1xuICAke3Byb3BzID0+IChwcm9wcy5kaXNhYmxlUG9pbnRlciA/IGBwb2ludGVyLWV2ZW50czogbm9uZWAgOiBgYCl9O1xuICBAbWVkaWEgKG1heC13aWR0aDogNDgwcHgpIHtcbiAgICBwYWRkaW5nOiAwO1xuICAgIG1hcmdpbjogMDtcbiAgfVxuICAke3Byb3BzID0+IChwcm9wcy5wb3NpdGlvbiAhPT0gJ3JlbGF0aXZlJyA/IEFic29sdXRlQ29udGFpbmVyIDogJycpfTtcbmA7XG5pbnRlcmZhY2UgTm90aWZpY2F0aW9uQ2xvc2Uge1xuICAgICgpOiB2b2lkO1xufVxuLyoqXG4gKiBUaGUgaG9zdCBlbGVtZW50IGZvciBhcmJpdHJhcnkgbm90aWZpY2F0aW9ucy4gVXNlIGFzIGEgc2luZ2xldG9uIG9ubHkuXG4gKi9cbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25zIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PE5vdGlmaWNhdGlvbnNQcm9wcywgTm90aWZpY2F0aW9uc1N0YXRlPiB7XG4gICAgcHJpdmF0ZSBjb2xsZWN0aW9uOiBBcnJheTxOb3RpZmljYXRpb25FbnRyeT4gPSBbXTtcbiAgICBwcml2YXRlIGV2ZW50TWFuYWdlcjogRXZlbnRNYW5hZ2VyO1xuICAgIGNvbnN0cnVjdG9yKHByb3BzOiBOb3RpZmljYXRpb25zUHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB7IGV2ZW50cyB9ID0gcHJvcHM7XG4gICAgICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRzIHx8IGV2ZW50TWFuYWdlcnNbMF07XG4gICAgICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAgICAgICBub3RpZmljYXRpb25zOiBbXSxcbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICAgIGNvbnN0IGVtID0gdGhpcy5ldmVudE1hbmFnZXI7XG4gICAgICAgIGVtLm9uKE5vdGlmaWNhdGlvbkFjdGlvbi5zaG93Tm90aWZpY2F0aW9uLCB0aGlzLnNob3cpO1xuICAgICAgICBlbS5vbihOb3RpZmljYXRpb25BY3Rpb24uY2xlYXJOb3RpZmljYXRpb24sIHRoaXMuaGlkZSk7XG4gICAgICAgIGV2ZW50TWFuYWdlcnMucHVzaChlbSk7XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCBlbSA9IHRoaXMuZXZlbnRNYW5hZ2VyO1xuICAgICAgICBlbS5vZmYoTm90aWZpY2F0aW9uQWN0aW9uLnNob3dOb3RpZmljYXRpb24sIHRoaXMuc2hvdyk7XG4gICAgICAgIGVtLm9mZihOb3RpZmljYXRpb25BY3Rpb24uY2xlYXJOb3RpZmljYXRpb24sIHRoaXMuaGlkZSk7XG4gICAgICAgIGV2ZW50TWFuYWdlcnMuc3BsaWNlKGV2ZW50TWFuYWdlcnMubGFzdEluZGV4T2YoZW0pLCAxKTtcbiAgICB9XG4gICAgcHJpdmF0ZSByZW1vdmVOb3RpZmljYXRpb24oaWQ6IHN0cmluZykge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbnM6IHRoaXMuc3RhdGUubm90aWZpY2F0aW9ucy5maWx0ZXIodiA9PiB2ICE9PSBpZCksXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwcml2YXRlIGNsZWFyTm90aWZpY2F0aW9ucygpIHtcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBub3RpZmljYXRpb25zOiBbXSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHByaXZhdGUgZ2V0Tm90aWZpY2F0aW9uQ29udGVudChjb250ZW50OiBOb3RpZmljYXRpb25Db250ZW50LCBvbkNsb3NlPzogTm90aWZpY2F0aW9uQ2xvc2UpIHtcbiAgICAgICAgaWYgKFJlYWN0LmlzVmFsaWRFbGVtZW50KGNvbnRlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGNvbnRlbnQsIHsgb25DbG9zZSB9IGFzIE5vdGlmaWNhdGlvblByb3BzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgY29udGVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQoeyBvbkNsb3NlIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb250ZW50O1xuICAgIH1cbiAgICBwcml2YXRlIGhpZGUgPSAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIGlkID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpcy5yZW1vdmVOb3RpZmljYXRpb24oaWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jbGVhck5vdGlmaWNhdGlvbnMoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBzaG93ID0gKHBheWxvYWQ6IE5vdGlmaWNhdGlvbk9wdGlvbnMpID0+IHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50LCBvcHRpb25zID0ge30gfSA9IHBheWxvYWQ7XG4gICAgICAgIGNvbnN0IHsgcG9zaXRpb24sIGF1dG9DbG9zZSB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyBub3RpZmljYXRpb25zIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBpZCA9IG9wdGlvbnMuaWQgfHwgYCR7fn4oTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApfWA7XG4gICAgICAgIGNvbnN0IG9wdHM6IE5vdGlmaWNhdGlvbk9wdGlvbiA9IHtcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgdHlwZTogb3B0aW9ucy50eXBlIHx8ICdub25lJyxcbiAgICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHRoaXMucmVtb3ZlTm90aWZpY2F0aW9uKGlkKSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiBvcHRpb25zLnBvc2l0aW9uIHx8IHBvc2l0aW9uLFxuICAgICAgICAgICAgdGl0bGU6IG9wdGlvbnMudGl0bGUgfHwgY2FwaXRhbGl6ZUZpcnN0KG9wdGlvbnMudHlwZSB8fCAnJyksXG4gICAgICAgICAgICBhY3Rpb25SZW5kZXJlcjogb3B0aW9ucy5hY3Rpb25SZW5kZXJlcixcbiAgICAgICAgICAgIGF1dG9DbG9zZTogdHlwZW9mIG9wdGlvbnMuYXV0b0Nsb3NlID09PSAnbnVtYmVyJyA/IG9wdGlvbnMuYXV0b0Nsb3NlIDogYXV0b0Nsb3NlLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb24ucHVzaCh7XG4gICAgICAgICAgICBuYW1lOiBpZCxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdHMsXG4gICAgICAgICAgICBjb250ZW50OiB0aGlzLmdldE5vdGlmaWNhdGlvbkNvbnRlbnQoY29udGVudCwgb3B0cy5vbkNsb3NlKSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uczogWy4uLm5vdGlmaWNhdGlvbnMsIGlkXSxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBwcml2YXRlIGRlZmF1bHROb3RpZmljYXRpb25SZW5kZXJlcihwYXlsb2FkOiBOb3RpZmljYXRpb25PcHRpb25zKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudCwgb3B0aW9ucyA9IHt9IH0gPSBwYXlsb2FkO1xuICAgICAgICByZXR1cm4gKDxUb2FzdE5vdGlmaWNhdGlvbiB7Li4ub3B0aW9uc30gdGl0bGU9e29wdGlvbnMudGl0bGV9IGtleT17YG5vdGlmaWNhdGlvbi0ke29wdGlvbnMuaWR9YH0+XG4gICAgICAgIHtjb250ZW50fVxuICAgICAgPC9Ub2FzdE5vdGlmaWNhdGlvbj4pO1xuICAgIH1cbiAgICBwcml2YXRlIG1ha2VOb3RpZmljYXRpb24ocGF5bG9hZDogTm90aWZpY2F0aW9uT3B0aW9ucykge1xuICAgICAgICBjb25zdCB7IG5vdGlmaWNhdGlvblJlbmRlcmVyIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCByZW5kZXJlciA9IG5vdGlmaWNhdGlvblJlbmRlcmVyIHx8IHRoaXMuZGVmYXVsdE5vdGlmaWNhdGlvblJlbmRlcmVyO1xuICAgICAgICByZXR1cm4gcmVuZGVyZXIocGF5bG9hZCk7XG4gICAgfVxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgY29uc3QgeyBwb3NpdGlvbiA9ICdyZWxhdGl2ZScsIHdpZHRoLCBuZXdlc3RPblRvcCA9IGZhbHNlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IG5vdGlmaWNhdGlvbnMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IG5vdGlmaWNhdGlvbnNUb1JlbmRlciA9IHt9O1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gdGhpcy5jb2xsZWN0aW9uLm1hcCgoaXRlbSwgaSkgPT4gKHtcbiAgICAgICAgICAgIGlkOiBpdGVtLm5hbWUsXG4gICAgICAgICAgICBpdGVtOiBpdGVtLFxuICAgICAgICAgICAgaW5kZXg6IGksXG4gICAgICAgIH0pKTtcbiAgICAgICAgaWYgKG5ld2VzdE9uVG9wKSB7XG4gICAgICAgICAgICBjb2xsZWN0aW9uLnJldmVyc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBjb2xsZWN0aW9uLmZvckVhY2goKHsgaWQsIGl0ZW0sIGluZGV4IH0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBpdGVtLm9wdGlvbnMgfHwge307XG4gICAgICAgICAgICBjb25zdCBpdGVtUG9zaXRpb24gPSBvcHRpb25zLnBvc2l0aW9uIHx8IHBvc2l0aW9uO1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uc1RvUmVuZGVyW2l0ZW1Qb3NpdGlvbl0gfHwgKG5vdGlmaWNhdGlvbnNUb1JlbmRlcltpdGVtUG9zaXRpb25dID0gW10pO1xuICAgICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbnMuaW5kZXhPZihpZCkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uc1RvUmVuZGVyW2l0ZW1Qb3NpdGlvbl0ucHVzaCh0aGlzLm1ha2VOb3RpZmljYXRpb24oaXRlbSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uc1RvUmVuZGVyW2l0ZW1Qb3NpdGlvbl0ucHVzaCh1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbi5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuICg8ZGl2PlxuICAgICAgICB7T2JqZWN0LmtleXMobm90aWZpY2F0aW9uc1RvUmVuZGVyKS5tYXAoKHBvc2l0aW9uOiBOb3RpZmljYXRpb25zUG9zaXRpb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRpc2FibGVQb2ludGVyID0gbm90aWZpY2F0aW9uc1RvUmVuZGVyW3Bvc2l0aW9uXS5sZW5ndGggPT09IDEgJiYgbm90aWZpY2F0aW9uc1RvUmVuZGVyW3Bvc2l0aW9uXVswXSA9PT0gbnVsbDtcbiAgICAgICAgICAgIHJldHVybiAoPFN0eWxlZE5vdGlmaWNhdGlvbnMga2V5PXtgbm90aWZpY2F0aW9uLWNvbnRhaW5lci0ke3Bvc2l0aW9ufWB9IHdpZHRoPXt3aWR0aH0gcG9zaXRpb249e3Bvc2l0aW9ufSBkaXNhYmxlUG9pbnRlcj17ZGlzYWJsZVBvaW50ZXJ9PlxuICAgICAgICAgICAgICB7bm90aWZpY2F0aW9uc1RvUmVuZGVyW3Bvc2l0aW9uXX1cbiAgICAgICAgICAgIDwvU3R5bGVkTm90aWZpY2F0aW9ucz4pO1xuICAgICAgICB9KX1cbiAgICAgIDwvZGl2Pik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFRvYXN0Tm90aWZpY2F0aW9uKCkgeyByZXR1cm4gVG9hc3ROb3RpZmljYXRpb24gYXMgdHlwZW9mIFRvYXN0Tm90aWZpY2F0aW9uOyB9LFxuICAgICAgICBnZXQgU3R5bGVkTm90aWZpY2F0aW9ucygpIHsgcmV0dXJuIFN0eWxlZE5vdGlmaWNhdGlvbnMgYXMgdHlwZW9mIFN0eWxlZE5vdGlmaWNhdGlvbnM7IH1cbiAgICB9O1xufVxuIl19