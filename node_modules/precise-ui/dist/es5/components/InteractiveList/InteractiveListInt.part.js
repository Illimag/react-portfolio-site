"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var InteractiveList_types_part_1 = require("./InteractiveList.types.part");
var Icon_1 = require("../Icon");
var Checkbox_1 = require("../Checkbox");
var colors_1 = require("../../colors");
var distance_1 = require("../../distance");
var textStyles_1 = require("../../textStyles");
var InteractiveListContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n  outline: none;\n"], ["\n  position: relative;\n  outline: none;\n"])));
var ListWrapper = styled_1.default('ul')(styled_1.themed(function (_a) {
    var open = _a.open, border = _a.border, direction = _a.direction, ui4 = _a.theme.ui4;
    return styled_1.css(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n      display: ", ";\n      list-style: none;\n      width: 100%;\n      position: relative;\n      transform: translateY(", "%);\n      box-sizing: border-box;\n      box-shadow: none;\n      margin: 0;\n      padding: 0;\n      background: ", ";\n      border: 1px solid ", ";\n      ", ";\n      max-height: 100%;\n      overflow-y: auto;\n      z-index: 100;\n    "], ["\n      display: ", ";\n      list-style: none;\n      width: 100%;\n      position: relative;\n      transform: translateY(", "%);\n      box-sizing: border-box;\n      box-shadow: none;\n      margin: 0;\n      padding: 0;\n      background: ", ";\n      border: 1px solid ", ";\n      ", ";\n      max-height: 100%;\n      overflow-y: auto;\n      z-index: 100;\n    "])), open ? 'block' : 'none', direction === InteractiveList_types_part_1.InteractiveListDirection.normal ? 0 : -100, colors_1.transparent, border === 0 /* none */ ? colors_1.transparent : ui4, direction === InteractiveList_types_part_1.InteractiveListDirection.normal ? 'border-top: none' : 'border-bottom: none');
}));
var ListItem = styled_1.default.li(styled_1.themed(function (_a) {
    var hovered = _a.hovered, _b = _a.theme, ui3 = _b.ui3, text2 = _b.text2, disabled = _a.disabled;
    return styled_1.css(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n      ", "\n      \n      background: ", ";\n      color: ", ";\n      list-style: none;\n      box-sizing: border-box;\n      opacity: ", ";\n      cursor: ", ";\n      display: block;\n      width: 100%;\n      height: auto;\n      position: relative;\n\n      a {\n        color: inherit;\n        display: block;\n        text-decoration: none;\n\n        &:hover {\n          text-decoration: none;\n        }\n      }\n    "], ["\n      ", "\n      \n      background: ", ";\n      color: ", ";\n      list-style: none;\n      box-sizing: border-box;\n      opacity: ", ";\n      cursor: ", ";\n      display: block;\n      width: 100%;\n      height: auto;\n      position: relative;\n\n      a {\n        color: inherit;\n        display: block;\n        text-decoration: none;\n\n        &:hover {\n          text-decoration: none;\n        }\n      }\n    "])), textStyles_1.getFontStyle({ size: 'medium' }), hovered ? ui3 : colors_1.transparent, text2, disabled ? '0.5' : '1.0', disabled ? 'not-allowed' : 'pointer');
}));
var ListItemInnerContainer = styled_1.default.div(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  display: flex;\n  align-items: center;\n"], ["\n  display: flex;\n  align-items: center;\n"])));
var ListItemContent = styled_1.default.div(templateObject_5 || (templateObject_5 = __makeTemplateObject(["\n  width: 100%;\n"], ["\n  width: 100%;\n"])));
var ListItemContentPadding = styled_1.default('div')(templateObject_6 || (templateObject_6 = __makeTemplateObject(["\n  padding: ", ";\n  ", ";\n"], ["\n  padding: ", ";\n  ", ";\n"])), function (props) { return (props.condensed ? distance_1.distance.small + " " + distance_1.distance.medium : distance_1.distance.medium); }, function (props) { return (props.showTick ? 'padding-right: 0;' : ''); });
var ListItemContentComponentPadding = styled_1.default('div')(templateObject_7 || (templateObject_7 = __makeTemplateObject(["\n  > * {\n    padding: ", ";\n    ", ";\n  }\n"], ["\n  > * {\n    padding: ", ";\n    ", ";\n  }\n"])), function (props) { return (props.condensed ? distance_1.distance.small + " " + distance_1.distance.medium : distance_1.distance.medium); }, function (props) { return (props.showTick ? 'padding-right: 0;' : ''); });
var StyledCheckbox = styled_1.default(Checkbox_1.Checkbox)(templateObject_8 || (templateObject_8 = __makeTemplateObject(["\n  display: block;\n"], ["\n  display: block;\n"])));
var ListItemIconPadding = styled_1.default('div')(templateObject_9 || (templateObject_9 = __makeTemplateObject(["\n  padding: 0 ", ";\n\n  i {\n    display: block;\n  }\n"], ["\n  padding: 0 ", ";\n\n  i {\n    display: block;\n  }\n"])), distance_1.distance.medium);
var ListDivider = styled_1.default.hr(templateObject_10 || (templateObject_10 = __makeTemplateObject(["\n  margin: ", " ", ";\n  border: none;\n  border-top: 1px solid ", ";\n"], ["\n  margin: ", " ", ";\n  border: none;\n  border-top: 1px solid ", ";\n"])), distance_1.distance.xsmall, distance_1.distance.small, styled_1.themed(function (props) { return props.theme.textDisabled; }));
var ListHeader = styled_1.default.span(templateObject_11 || (templateObject_11 = __makeTemplateObject(["\n  ", "\n  \n  padding: ", " ", ";\n  width: 100%;\n  display: block;\n  height: auto;\n  min-height: 1em;\n  box-sizing: border-box;\n  color: ", ";\n"], ["\n  ", "\n  \n  padding: ", " ", ";\n  width: 100%;\n  display: block;\n  height: auto;\n  min-height: 1em;\n  box-sizing: border-box;\n  color: ", ";\n"])), textStyles_1.getFontStyle({ size: 'medium' }), distance_1.distance.medium, distance_1.distance.small, styled_1.themed(function (props) { return props.theme.primary; }));
function getChosen(selected, multiple) {
    if (multiple) {
        return Array.isArray(selected) ? selected : [selected];
    }
    else {
        return [Array.isArray(selected) ? selected[0] : selected];
    }
}
function getIndices(data, selected, multiple) {
    var chosen = getChosen(selected, multiple);
    var indices = [];
    for (var i = 0; i < data.length; i++) {
        var item = data[i];
        if (!item) {
            continue;
        }
        var key = typeof item === 'string' ? item : item.key;
        if (chosen.indexOf(key) !== -1) {
            indices.push(i);
        }
    }
    if (!multiple && indices.length > 1) {
        indices.splice(1);
    }
    return indices;
}
function autoSelect(element) {
    var child = element && element.querySelector('a');
    if (child) {
        child.click();
    }
}
var InteractiveListInt = /** @class */ (function (_super) {
    __extends(InteractiveListInt, _super);
    function InteractiveListInt(props) {
        var _this = _super.call(this, props) || this;
        _this.selects = [];
        _this.elements = [];
        _this.defaultHandleClickOutside = function () {
            var _a = _this.props, open = _a.open, onBlur = _a.onBlur;
            if (open) {
                if (typeof onBlur === 'function') {
                    onBlur();
                }
                _this.setState({
                    selected: undefined,
                });
            }
        };
        _this.handleClickOutside = function () {
            if (_this.props.open) {
                _this.props.onClickOutside ? _this.props.onClickOutside() : _this.defaultHandleClickOutside();
            }
        };
        _this.control = function (e) {
            var _a = _this.props, data = _a.data, onBlur = _a.onBlur, disabled = _a.disabled, onKeyDown = _a.onKeyDown;
            if (!disabled) {
                var selected = _this.state.selected;
                if (typeof onKeyDown === 'function') {
                    onKeyDown(e);
                }
                switch (e.keyCode) {
                    case 40 /* down */:
                        _this.setState({
                            selected: _this.getNext(selected === undefined ? 0 : (selected + 1) % data.length, 1),
                        });
                        break;
                    case 38 /* up */:
                        _this.setState({
                            selected: _this.getNext(((selected || data.length) - 1) % data.length, -1),
                        });
                        break;
                    case 36 /* home */:
                        _this.setState({
                            selected: _this.getNext(0, 1),
                        });
                        break;
                    case 35 /* end */:
                        _this.setState({
                            selected: _this.getNext(data.length - 1, -1),
                        });
                        break;
                    case 13 /* enter */:
                    case 32 /* space */:
                        if (typeof selected === 'number') {
                            autoSelect(_this.elements[selected]);
                        }
                        _this.done();
                        break;
                    case 27 /* escape */:
                        if (typeof onBlur === 'function') {
                            onBlur();
                        }
                        break;
                    default:
                        _this.jumpTo(e.key.toLowerCase());
                        return;
                }
            }
            e.stopPropagation();
            e.preventDefault();
        };
        _this.getItemDetails = function (item) {
            var key = '';
            var content;
            if (typeof item === 'string') {
                key = item;
                content = item;
            }
            else {
                key = item.key;
                content = item.content || item.key;
            }
            return {
                key: key,
                content: content,
            };
        };
        _this.createSingleItem = function (item, index) {
            var _a = _this.getItemDetails(item), key = _a.key, content = _a.content;
            return _this.createItem(key, index, content);
        };
        _this.createMultipleItem = function (item, index) {
            var disabledItems = _this.props.disabledItems;
            var value = _this.state.value;
            var _a = _this.getItemDetails(item), key = _a.key, content = _a.content;
            var isItemDisabled = disabledItems && disabledItems.indexOf(key) !== -1;
            var newContent = (React.createElement(StyledCheckbox, { value: value.indexOf(index) >= 0, disabled: isItemDisabled }, content));
            return _this.createItem(key, index, newContent);
        };
        _this.done = function () {
            var _a = _this.props, multiple = _a.multiple, onChange = _a.onChange, disabled = _a.disabled, data = _a.data, _b = _a.disabledItems, disabledItems = _b === void 0 ? [] : _b;
            var _c = _this.state, value = _c.value, controlled = _c.controlled, selected = _c.selected;
            var item = data && selected !== undefined && data[selected];
            var key = item && _this.getItemDetails(item).key;
            var isItemDisabled = key && disabledItems.indexOf(key) !== -1;
            if (!disabled && !isItemDisabled && selected !== undefined) {
                var newValue = multiple
                    ? value.indexOf(selected) === -1
                        ? value.concat([selected]) : value.filter(function (i) { return i !== selected; })
                    : [selected];
                if (!controlled) {
                    _this.setState({
                        value: newValue,
                    });
                }
                if (typeof onChange === 'function') {
                    onChange({
                        value: newValue,
                    });
                }
            }
        };
        _this.setNode = function (ref) {
            _this.interactiveList = ref;
        };
        var value = props.value || props.defaultValue || [];
        _this.state = {
            value: props.indices || getIndices(props.data || [], value, props.multiple),
            controlled: props.indices !== undefined || props.value !== undefined,
            selected: undefined,
            direction: props.direction || InteractiveList_types_part_1.InteractiveListDirection.normal,
        };
        return _this;
    }
    InteractiveListInt.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {
        var _a = this.props, open = _a.open, autoPosition = _a.autoPosition, focus = _a.focus;
        if (this.state.controlled) {
            var indices = nextProps.indices, value = nextProps.value, _b = nextProps.data, data = _b === void 0 ? [] : _b, multiple = nextProps.multiple;
            this.setState({
                value: indices || getIndices(data, value || [], multiple),
            });
        }
        var componentIsNotFocused = nextProps.focus !== focus || (this.interactiveList && document.activeElement !== this.interactiveList);
        if (componentIsNotFocused && nextProps.focus) {
            if (open && nextProps.open) {
                this.interactiveList && this.interactiveList.focus();
                this.setState({
                    selected: 0,
                });
            }
        }
        if (autoPosition && !open && nextProps.open && this.interactiveList) {
            var windowHeight = window.innerHeight;
            var top_1 = this.interactiveList.getBoundingClientRect().top;
            if (top_1 > windowHeight / 2) {
                this.setState(function () { return ({
                    direction: InteractiveList_types_part_1.InteractiveListDirection.reverse,
                }); });
            }
            else {
                this.setState(function () { return ({
                    direction: InteractiveList_types_part_1.InteractiveListDirection.normal,
                }); });
            }
        }
    };
    InteractiveListInt.prototype.componentDidUpdate = function () {
        var _a = this.props, open = _a.open, autoFocus = _a.autoFocus;
        if (open && autoFocus && this.interactiveList) {
            this.interactiveList.focus();
        }
    };
    InteractiveListInt.prototype.getNext = function (proposed, dir) {
        var data = this.props.data;
        var max = data.length;
        for (var i = 0; i < max; i++) {
            var item = data[proposed];
            if (!item) {
                continue;
            }
            if (typeof item === 'string' || (item.type !== 'divider' && item.type !== 'header')) {
                return proposed;
            }
            proposed += dir;
            if (proposed < 0) {
                proposed = max - 1;
            }
            else if (proposed === max) {
                proposed = 0;
            }
        }
        return 0;
    };
    InteractiveListInt.prototype.jumpTo = function (part) {
        var data = this.props.data;
        var selected = this.state.selected;
        var start = selected ? (selected === data.length - 1 ? 0 : selected) : 0;
        var index = start;
        for (var i = start; i < start + data.length; i++, index = i === data.length ? 0 : index + 1) {
            var item = data[index];
            if (!item) {
                continue;
            }
            var lookup = typeof item === 'string' ? item : item.searchText || item.content || item.key;
            if (typeof lookup === 'string' && lookup.substr(0, part.length).toLowerCase() === part && selected !== index) {
                this.setState({
                    selected: index,
                });
                break;
            }
        }
    };
    InteractiveListInt.prototype.createItem = function (key, index, content) {
        var _this = this;
        var _a = this.state, value = _a.value, selected = _a.selected;
        var _b = this.props, disabled = _b.disabled, _c = _b.showTick, showTick = _c === void 0 ? false : _c, _d = _b.multiple, multiple = _d === void 0 ? false : _d, _e = _b.condensed, condensed = _e === void 0 ? false : _e, disabledItems = _b.disabledItems;
        var isItemDisabled = disabledItems && disabledItems.indexOf(key) !== -1;
        var isHovered = !disabled && selected === index;
        var isSelected = value.indexOf(index) >= 0;
        var selects = this.selects;
        var ContentWrapper = typeof content === 'string' ? ListItemContentPadding : ListItemContentComponentPadding;
        if (selects[index] === undefined) {
            selects[index] = function () { return _this.select(index); };
        }
        return (React.createElement(ListItem, { key: key + "-" + index, onClick: this.done, onMouseMove: selects[index], selected: isSelected, hovered: isHovered, disabled: isItemDisabled, ref: function (node) {
                _this.elements[index] = node;
                if (isHovered && node) {
                    var parent_1 = node.parentElement;
                    if (parent_1) {
                        var height = parent_1.clientHeight;
                        var position = parent_1.scrollTop;
                        var y0 = node.offsetTop - position;
                        var y1 = y0 + node.offsetHeight - height;
                        if (y0 < 0) {
                            parent_1.scrollTop = node.offsetTop;
                        }
                        else if (y1 > 0) {
                            parent_1.scrollTop += y1;
                        }
                    }
                }
            } },
            React.createElement(ListItemInnerContainer, null,
                React.createElement(ListItemContent, null,
                    React.createElement(ContentWrapper, { condensed: condensed, showTick: isSelected && showTick }, content)),
                isSelected && !multiple && showTick && (React.createElement(ListItemIconPadding, { condensed: condensed },
                    React.createElement(Icon_1.Icon, { name: "Check", color: colors_1.pacificBlue, size: 1.375 }))))));
    };
    InteractiveListInt.prototype.select = function (index) {
        var disabled = this.props.disabled;
        if (!disabled && this.state.selected !== index) {
            this.setState({
                selected: index,
            });
        }
    };
    InteractiveListInt.prototype.render = function () {
        var _a = this.props, _0 = _a.onChange, _1 = _a.indices, _2 = _a.disabled, _3 = _a.onKeyDown, _4 = _a.onClickOutside, _b = _a.data, data = _b === void 0 ? [] : _b, theme = _a.theme, _c = _a.borderless, borderless = _c === void 0 ? false : _c, children = _a.children, _d = _a.multiple, multiple = _d === void 0 ? false : _d, _e = _a.open, open = _e === void 0 ? false : _e, onBlur = _a.onBlur, customWrapper = _a.customWrapper, onClick = _a.onClick, props = __rest(_a, ["onChange", "indices", "disabled", "onKeyDown", "onClickOutside", "data", "theme", "borderless", "children", "multiple", "open", "onBlur", "customWrapper", "onClick"]);
        var border = borderless ? 0 /* none */ : 1 /* normal */;
        var createItem = multiple ? this.createMultipleItem : this.createSingleItem;
        var Wrapper = customWrapper || ListWrapper;
        return (React.createElement(InteractiveListContainer, __assign({ ref: this.setNode }, (open ? { tabIndex: 0 } : undefined), { onKeyDown: this.control }, props),
            React.createElement(Wrapper, { open: open, border: border, direction: this.state.direction, onClick: onClick }, open &&
                data.map(function (item, index) {
                    if (item) {
                        if (typeof item !== 'string') {
                            switch (item.type) {
                                case 'divider':
                                    return React.createElement(ListDivider, { key: item.key });
                                case 'header':
                                    return React.createElement(ListHeader, { key: item.key }, item.content || item.key);
                            }
                        }
                        return createItem(item, index);
                    }
                    return undefined;
                }))));
    };
    InteractiveListInt.inner = {
        get StyledCheckbox() { return StyledCheckbox; },
        get ListItem() { return ListItem; },
        get ListItemInnerContainer() { return ListItemInnerContainer; },
        get ListItemContent() { return ListItemContent; },
        get ListItemIconPadding() { return ListItemIconPadding; },
        get Icon() { return Icon_1.Icon; },
        get InteractiveListContainer() { return InteractiveListContainer; },
        get ListDivider() { return ListDivider; },
        get ListHeader() { return ListHeader; }
    };
    return InteractiveListInt;
}(React.PureComponent));
exports.InteractiveListInt = InteractiveListInt;
var templateObject_1, templateObject_2, templateObject_3, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10, templateObject_11;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZXJhY3RpdmVMaXN0SW50LnBhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9JbnRlcmFjdGl2ZUxpc3QvSW50ZXJhY3RpdmVMaXN0SW50LnBhcnQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBeUQ7QUFDekQsMkVBQWtNO0FBQ2xNLGdDQUErQjtBQUMvQix3Q0FBdUM7QUFFdkMsdUNBQXdEO0FBQ3hELDJDQUEwQztBQUMxQywrQ0FBZ0Q7QUFlaEQsSUFBTSx3QkFBd0IsR0FBRyxnQkFBTSxDQUFDLEdBQUcsZ0hBQUMsNkNBRzNDLElBQUEsQ0FBQztBQUNGLElBQU0sV0FBVyxHQUFHLGdCQUFNLENBQUMsSUFBSSxDQUFDLENBQThCLGVBQU0sQ0FBQyxVQUFDLEVBQTJDO1FBQXpDLGNBQUksRUFBRSxrQkFBTSxFQUFFLHdCQUFTLEVBQVcsa0JBQUc7SUFBUyxPQUFBLFlBQUcsdWJBQUMsbUJBQ3pHLEVBQXVCLHlHQUlWLEVBQXdELHNIQUtsRSxFQUFXLDZCQUNMLEVBQTZELFdBQy9FLEVBQTBGLGdGQUk3RixLQWZZLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBSVYsU0FBUyxLQUFLLHFEQUF3QixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFLbEUsb0JBQVcsRUFDTCxNQUFNLGlCQUFtQyxDQUFDLENBQUMsQ0FBQyxvQkFBVyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQy9FLFNBQVMsS0FBSyxxREFBd0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxxQkFBcUI7QUFab0IsQ0FnQmpILENBQUMsQ0FBQyxDQUFDO0FBQ1IsSUFBTSxRQUFRLEdBQUcs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VUFBK0IsQ0FBQyxDQUFDLENBQUM7S0FDL0QsQ0FBQztJQUNOLHlCQUFDO0NBQUEsQUExU0QsQ0FBd0MsS0FBSyxDQUFDLGFBQWEsR0EwUzFEO0FBMVNZLGdEQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQsIHsgdGhlbWVkLCBjc3MgfSBmcm9tICcuLi8uLi91dGlscy9zdHlsZWQnO1xuaW1wb3J0IHsgSW50ZXJhY3RpdmVMaXN0V3JhcHBlclByb3BzLCBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24sIEludGVyYWN0aXZlTGlzdEJvcmRlclR5cGUsIEludGVyYWN0aXZlTGlzdEl0ZW0sIEludGVyYWN0aXZlTGlzdFByb3BzLCBJbnRlcmFjdGl2ZUxpc3RTdGF0ZSwgfSBmcm9tICcuL0ludGVyYWN0aXZlTGlzdC50eXBlcy5wYXJ0JztcbmltcG9ydCB7IEljb24gfSBmcm9tICcuLi9JY29uJztcbmltcG9ydCB7IENoZWNrYm94IH0gZnJvbSAnLi4vQ2hlY2tib3gnO1xuaW1wb3J0IHsgS2V5Q29kZXMgfSBmcm9tICcuLi8uLi91dGlscy9rZXlDb2Rlcyc7XG5pbXBvcnQgeyBwYWNpZmljQmx1ZSwgdHJhbnNwYXJlbnQgfSBmcm9tICcuLi8uLi9jb2xvcnMnO1xuaW1wb3J0IHsgZGlzdGFuY2UgfSBmcm9tICcuLi8uLi9kaXN0YW5jZSc7XG5pbXBvcnQgeyBnZXRGb250U3R5bGUgfSBmcm9tICcuLi8uLi90ZXh0U3R5bGVzJztcbmludGVyZmFjZSBMaXN0SXRlbVByb3BzIHtcbiAgICBzZWxlY3RlZDogYm9vbGVhbjtcbiAgICBob3ZlcmVkOiBib29sZWFuO1xuICAgIGRpc2FibGVkPzogYm9vbGVhbjtcbiAgICBvbkNsaWNrPyhlOiBSZWFjdC5Nb3VzZUV2ZW50KTogdm9pZDtcbiAgICBvbk1vdXNlTW92ZT8oZTogUmVhY3QuTW91c2VFdmVudCk6IHZvaWQ7XG59XG5pbnRlcmZhY2UgTGlzdEl0ZW1Db250ZW50UHJvcHMge1xuICAgIGNvbmRlbnNlZDogYm9vbGVhbjtcbiAgICBzaG93VGljazogYm9vbGVhbjtcbn1cbmludGVyZmFjZSBMaXN0SXRlbUljb25Qcm9wcyB7XG4gICAgY29uZGVuc2VkOiBib29sZWFuO1xufVxuY29uc3QgSW50ZXJhY3RpdmVMaXN0Q29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgb3V0bGluZTogbm9uZTtcbmA7XG5jb25zdCBMaXN0V3JhcHBlciA9IHN0eWxlZCgndWwnKTxJbnRlcmFjdGl2ZUxpc3RXcmFwcGVyUHJvcHM+KHRoZW1lZCgoeyBvcGVuLCBib3JkZXIsIGRpcmVjdGlvbiwgdGhlbWU6IHsgdWk0IH0gfSkgPT4gY3NzIGBcbiAgICAgIGRpc3BsYXk6ICR7b3BlbiA/ICdibG9jaycgOiAnbm9uZSd9O1xuICAgICAgbGlzdC1zdHlsZTogbm9uZTtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKCR7ZGlyZWN0aW9uID09PSBJbnRlcmFjdGl2ZUxpc3REaXJlY3Rpb24ubm9ybWFsID8gMCA6IC0xMDB9JSk7XG4gICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgYm94LXNoYWRvdzogbm9uZTtcbiAgICAgIG1hcmdpbjogMDtcbiAgICAgIHBhZGRpbmc6IDA7XG4gICAgICBiYWNrZ3JvdW5kOiAke3RyYW5zcGFyZW50fTtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICR7Ym9yZGVyID09PSBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlLm5vbmUgPyB0cmFuc3BhcmVudCA6IHVpNH07XG4gICAgICAke2RpcmVjdGlvbiA9PT0gSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLm5vcm1hbCA/ICdib3JkZXItdG9wOiBub25lJyA6ICdib3JkZXItYm90dG9tOiBub25lJ307XG4gICAgICBtYXgtaGVpZ2h0OiAxMDAlO1xuICAgICAgb3ZlcmZsb3cteTogYXV0bztcbiAgICAgIHotaW5kZXg6IDEwMDtcbiAgICBgKSk7XG5jb25zdCBMaXN0SXRlbSA9IHN0eWxlZC5saTxMaXN0SXRlbVByb3BzPih0aGVtZWQoKHsgaG92ZXJlZCwgdGhlbWU6IHsgdWkzLCB0ZXh0MiB9LCBkaXNhYmxlZCB9KSA9PiBjc3MgYFxuICAgICAgJHtnZXRGb250U3R5bGUoeyBzaXplOiAnbWVkaXVtJyB9KX1cbiAgICAgIFxuICAgICAgYmFja2dyb3VuZDogJHtob3ZlcmVkID8gdWkzIDogdHJhbnNwYXJlbnR9O1xuICAgICAgY29sb3I6ICR7dGV4dDJ9O1xuICAgICAgbGlzdC1zdHlsZTogbm9uZTtcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gICAgICBvcGFjaXR5OiAke2Rpc2FibGVkID8gJzAuNScgOiAnMS4wJ307XG4gICAgICBjdXJzb3I6ICR7ZGlzYWJsZWQgPyAnbm90LWFsbG93ZWQnIDogJ3BvaW50ZXInfTtcbiAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IGF1dG87XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG5cbiAgICAgIGEge1xuICAgICAgICBjb2xvcjogaW5oZXJpdDtcbiAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcblxuICAgICAgICAmOmhvdmVyIHtcbiAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBgKSk7XG5jb25zdCBMaXN0SXRlbUlubmVyQ29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5gO1xuY29uc3QgTGlzdEl0ZW1Db250ZW50ID0gc3R5bGVkLmRpdiBgXG4gIHdpZHRoOiAxMDAlO1xuYDtcbmNvbnN0IExpc3RJdGVtQ29udGVudFBhZGRpbmcgPSBzdHlsZWQoJ2RpdicpPExpc3RJdGVtQ29udGVudFByb3BzPiBgXG4gIHBhZGRpbmc6ICR7cHJvcHMgPT4gKHByb3BzLmNvbmRlbnNlZCA/IGAke2Rpc3RhbmNlLnNtYWxsfSAke2Rpc3RhbmNlLm1lZGl1bX1gIDogZGlzdGFuY2UubWVkaXVtKX07XG4gICR7cHJvcHMgPT4gKHByb3BzLnNob3dUaWNrID8gJ3BhZGRpbmctcmlnaHQ6IDA7JyA6ICcnKX07XG5gO1xuY29uc3QgTGlzdEl0ZW1Db250ZW50Q29tcG9uZW50UGFkZGluZyA9IHN0eWxlZCgnZGl2Jyk8TGlzdEl0ZW1Db250ZW50UHJvcHM+IGBcbiAgPiAqIHtcbiAgICBwYWRkaW5nOiAke3Byb3BzID0+IChwcm9wcy5jb25kZW5zZWQgPyBgJHtkaXN0YW5jZS5zbWFsbH0gJHtkaXN0YW5jZS5tZWRpdW19YCA6IGRpc3RhbmNlLm1lZGl1bSl9O1xuICAgICR7cHJvcHMgPT4gKHByb3BzLnNob3dUaWNrID8gJ3BhZGRpbmctcmlnaHQ6IDA7JyA6ICcnKX07XG4gIH1cbmA7XG5jb25zdCBTdHlsZWRDaGVja2JveCA9IHN0eWxlZChDaGVja2JveCkgYFxuICBkaXNwbGF5OiBibG9jaztcbmA7XG5jb25zdCBMaXN0SXRlbUljb25QYWRkaW5nID0gc3R5bGVkKCdkaXYnKTxMaXN0SXRlbUljb25Qcm9wcz4gYFxuICBwYWRkaW5nOiAwICR7ZGlzdGFuY2UubWVkaXVtfTtcblxuICBpIHtcbiAgICBkaXNwbGF5OiBibG9jaztcbiAgfVxuYDtcbmNvbnN0IExpc3REaXZpZGVyID0gc3R5bGVkLmhyIGBcbiAgbWFyZ2luOiAke2Rpc3RhbmNlLnhzbWFsbH0gJHtkaXN0YW5jZS5zbWFsbH07XG4gIGJvcmRlcjogbm9uZTtcbiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICR7dGhlbWVkKHByb3BzID0+IHByb3BzLnRoZW1lLnRleHREaXNhYmxlZCl9O1xuYDtcbmNvbnN0IExpc3RIZWFkZXIgPSBzdHlsZWQuc3BhbiBgXG4gICR7Z2V0Rm9udFN0eWxlKHsgc2l6ZTogJ21lZGl1bScgfSl9XG4gIFxuICBwYWRkaW5nOiAke2Rpc3RhbmNlLm1lZGl1bX0gJHtkaXN0YW5jZS5zbWFsbH07XG4gIHdpZHRoOiAxMDAlO1xuICBkaXNwbGF5OiBibG9jaztcbiAgaGVpZ2h0OiBhdXRvO1xuICBtaW4taGVpZ2h0OiAxZW07XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGNvbG9yOiAke3RoZW1lZChwcm9wcyA9PiBwcm9wcy50aGVtZS5wcmltYXJ5KX07XG5gO1xuZnVuY3Rpb24gZ2V0Q2hvc2VuKHNlbGVjdGVkOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBtdWx0aXBsZT86IGJvb2xlYW4pIHtcbiAgICBpZiAobXVsdGlwbGUpIHtcbiAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoc2VsZWN0ZWQpID8gc2VsZWN0ZWQgOiBbc2VsZWN0ZWRdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFtBcnJheS5pc0FycmF5KHNlbGVjdGVkKSA/IHNlbGVjdGVkWzBdIDogc2VsZWN0ZWRdO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldEluZGljZXMoZGF0YTogQXJyYXk8SW50ZXJhY3RpdmVMaXN0SXRlbSB8IHVuZGVmaW5lZD4sIHNlbGVjdGVkOiBzdHJpbmcgfCBBcnJheTxzdHJpbmc+LCBtdWx0aXBsZT86IGJvb2xlYW4pIHtcbiAgICBjb25zdCBjaG9zZW4gPSBnZXRDaG9zZW4oc2VsZWN0ZWQsIG11bHRpcGxlKTtcbiAgICBjb25zdCBpbmRpY2VzOiBBcnJheTxudW1iZXI+ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2ldO1xuICAgICAgICBpZiAoIWl0ZW0pIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGtleSA9IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyA/IGl0ZW0gOiBpdGVtLmtleTtcbiAgICAgICAgaWYgKGNob3Nlbi5pbmRleE9mKGtleSkgIT09IC0xKSB7XG4gICAgICAgICAgICBpbmRpY2VzLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFtdWx0aXBsZSAmJiBpbmRpY2VzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgaW5kaWNlcy5zcGxpY2UoMSk7XG4gICAgfVxuICAgIHJldHVybiBpbmRpY2VzO1xufVxuZnVuY3Rpb24gYXV0b1NlbGVjdChlbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgIGNvbnN0IGNoaWxkID0gZWxlbWVudCAmJiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ2EnKTtcbiAgICBpZiAoY2hpbGQpIHtcbiAgICAgICAgY2hpbGQuY2xpY2soKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgSW50ZXJhY3RpdmVMaXN0SW50IGV4dGVuZHMgUmVhY3QuUHVyZUNvbXBvbmVudDxJbnRlcmFjdGl2ZUxpc3RQcm9wcywgSW50ZXJhY3RpdmVMaXN0U3RhdGU+IHtcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNlbGVjdHM6IEFycmF5PCgpID0+IHZvaWQ+ID0gW107XG4gICAgcHJpdmF0ZSByZWFkb25seSBlbGVtZW50czogQXJyYXk8SFRNTEVsZW1lbnQ+ID0gW107XG4gICAgcHJpdmF0ZSBpbnRlcmFjdGl2ZUxpc3Q6IEhUTUxFbGVtZW50IHwgbnVsbDtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wczogSW50ZXJhY3RpdmVMaXN0UHJvcHMpIHtcbiAgICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHByb3BzLnZhbHVlIHx8IHByb3BzLmRlZmF1bHRWYWx1ZSB8fCBbXTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy5pbmRpY2VzIHx8IGdldEluZGljZXMocHJvcHMuZGF0YSB8fCBbXSwgdmFsdWUsIHByb3BzLm11bHRpcGxlKSxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLmluZGljZXMgIT09IHVuZGVmaW5lZCB8fCBwcm9wcy52YWx1ZSAhPT0gdW5kZWZpbmVkLFxuICAgICAgICAgICAgc2VsZWN0ZWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIGRpcmVjdGlvbjogcHJvcHMuZGlyZWN0aW9uIHx8IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbi5ub3JtYWwsXG4gICAgICAgIH07XG4gICAgfVxuICAgIHByaXZhdGUgZGVmYXVsdEhhbmRsZUNsaWNrT3V0c2lkZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvcGVuLCBvbkJsdXIgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChvcGVuKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uQmx1ciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG9uQmx1cigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBoYW5kbGVDbGlja091dHNpZGUgPSAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnByb3BzLm9wZW4pIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHMub25DbGlja091dHNpZGUgPyB0aGlzLnByb3BzLm9uQ2xpY2tPdXRzaWRlKCkgOiB0aGlzLmRlZmF1bHRIYW5kbGVDbGlja091dHNpZGUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzOiBJbnRlcmFjdGl2ZUxpc3RQcm9wcykge1xuICAgICAgICBjb25zdCB7IG9wZW4sIGF1dG9Qb3NpdGlvbiwgZm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaW5kaWNlcywgdmFsdWUsIGRhdGEgPSBbXSwgbXVsdGlwbGUgfSA9IG5leHRQcm9wcztcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBpbmRpY2VzIHx8IGdldEluZGljZXMoZGF0YSwgdmFsdWUgfHwgW10sIG11bHRpcGxlKSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudElzTm90Rm9jdXNlZCA9IG5leHRQcm9wcy5mb2N1cyAhPT0gZm9jdXMgfHwgKHRoaXMuaW50ZXJhY3RpdmVMaXN0ICYmIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRoaXMuaW50ZXJhY3RpdmVMaXN0KTtcbiAgICAgICAgaWYgKGNvbXBvbmVudElzTm90Rm9jdXNlZCAmJiBuZXh0UHJvcHMuZm9jdXMpIHtcbiAgICAgICAgICAgIGlmIChvcGVuICYmIG5leHRQcm9wcy5vcGVuKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbnRlcmFjdGl2ZUxpc3QgJiYgdGhpcy5pbnRlcmFjdGl2ZUxpc3QuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IDAsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGF1dG9Qb3NpdGlvbiAmJiAhb3BlbiAmJiBuZXh0UHJvcHMub3BlbiAmJiB0aGlzLmludGVyYWN0aXZlTGlzdCkge1xuICAgICAgICAgICAgY29uc3Qgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICAgICAgY29uc3QgeyB0b3AgfSA9IHRoaXMuaW50ZXJhY3RpdmVMaXN0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAgICAgaWYgKHRvcCA+IHdpbmRvd0hlaWdodCAvIDIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKCgpID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogSW50ZXJhY3RpdmVMaXN0RGlyZWN0aW9uLnJldmVyc2UsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSgoKSA9PiAoe1xuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246IEludGVyYWN0aXZlTGlzdERpcmVjdGlvbi5ub3JtYWwsXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgICAgY29uc3QgeyBvcGVuLCBhdXRvRm9jdXMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGlmIChvcGVuICYmIGF1dG9Gb2N1cyAmJiB0aGlzLmludGVyYWN0aXZlTGlzdCkge1xuICAgICAgICAgICAgdGhpcy5pbnRlcmFjdGl2ZUxpc3QuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGdldE5leHQocHJvcG9zZWQ6IG51bWJlciwgZGlyOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBtYXggPSBkYXRhLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRhdGFbcHJvcG9zZWRdO1xuICAgICAgICAgICAgaWYgKCFpdGVtKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnIHx8IChpdGVtLnR5cGUgIT09ICdkaXZpZGVyJyAmJiBpdGVtLnR5cGUgIT09ICdoZWFkZXInKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wb3NlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHByb3Bvc2VkICs9IGRpcjtcbiAgICAgICAgICAgIGlmIChwcm9wb3NlZCA8IDApIHtcbiAgICAgICAgICAgICAgICBwcm9wb3NlZCA9IG1heCAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwcm9wb3NlZCA9PT0gbWF4KSB7XG4gICAgICAgICAgICAgICAgcHJvcG9zZWQgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBwcml2YXRlIGp1bXBUbyhwYXJ0OiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCB7IHNlbGVjdGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBzdGFydCA9IHNlbGVjdGVkID8gKHNlbGVjdGVkID09PSBkYXRhLmxlbmd0aCAtIDEgPyAwIDogc2VsZWN0ZWQpIDogMDtcbiAgICAgICAgbGV0IGluZGV4ID0gc3RhcnQ7XG4gICAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8IHN0YXJ0ICsgZGF0YS5sZW5ndGg7IGkrKywgaW5kZXggPSBpID09PSBkYXRhLmxlbmd0aCA/IDAgOiBpbmRleCArIDEpIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkYXRhW2luZGV4XTtcbiAgICAgICAgICAgIGlmICghaXRlbSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbG9va3VwID0gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnID8gaXRlbSA6IGl0ZW0uc2VhcmNoVGV4dCB8fCBpdGVtLmNvbnRlbnQgfHwgaXRlbS5rZXk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGxvb2t1cCA9PT0gJ3N0cmluZycgJiYgbG9va3VwLnN1YnN0cigwLCBwYXJ0Lmxlbmd0aCkudG9Mb3dlckNhc2UoKSA9PT0gcGFydCAmJiBzZWxlY3RlZCAhPT0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGluZGV4LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgY29udHJvbCA9IChlOiBSZWFjdC5LZXlib2FyZEV2ZW50PEhUTUxFbGVtZW50PikgPT4ge1xuICAgICAgICBjb25zdCB7IGRhdGEsIG9uQmx1ciwgZGlzYWJsZWQsIG9uS2V5RG93biB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkaXNhYmxlZCkge1xuICAgICAgICAgICAgY29uc3QgeyBzZWxlY3RlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25LZXlEb3duID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb25LZXlEb3duKGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLmRvd246XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRoaXMuZ2V0TmV4dChzZWxlY3RlZCA9PT0gdW5kZWZpbmVkID8gMCA6IChzZWxlY3RlZCArIDEpICUgZGF0YS5sZW5ndGgsIDEpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy51cDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhpcy5nZXROZXh0KCgoc2VsZWN0ZWQgfHwgZGF0YS5sZW5ndGgpIC0gMSkgJSBkYXRhLmxlbmd0aCwgLTEpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5ob21lOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiB0aGlzLmdldE5leHQoMCwgMSksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLmVuZDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZDogdGhpcy5nZXROZXh0KGRhdGEubGVuZ3RoIC0gMSwgLTEpLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBLZXlDb2Rlcy5lbnRlcjpcbiAgICAgICAgICAgICAgICBjYXNlIEtleUNvZGVzLnNwYWNlOlxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHNlbGVjdGVkID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b1NlbGVjdCh0aGlzLmVsZW1lbnRzW3NlbGVjdGVkXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgS2V5Q29kZXMuZXNjYXBlOlxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9uQmx1ciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgb25CbHVyKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5qdW1wVG8oZS5rZXkudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGdldEl0ZW1EZXRhaWxzID0gKGl0ZW06IEludGVyYWN0aXZlTGlzdEl0ZW0pID0+IHtcbiAgICAgICAgbGV0IGtleSA9ICcnO1xuICAgICAgICBsZXQgY29udGVudDogUmVhY3QuUmVhY3RDaGlsZDtcbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAga2V5ID0gaXRlbTtcbiAgICAgICAgICAgIGNvbnRlbnQgPSBpdGVtO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAga2V5ID0gaXRlbS5rZXk7XG4gICAgICAgICAgICBjb250ZW50ID0gaXRlbS5jb250ZW50IHx8IGl0ZW0ua2V5O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICB9O1xuICAgIH07XG4gICAgcHJpdmF0ZSBjcmVhdGVTaW5nbGVJdGVtID0gKGl0ZW06IEludGVyYWN0aXZlTGlzdEl0ZW0sIGluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgeyBrZXksIGNvbnRlbnQgfSA9IHRoaXMuZ2V0SXRlbURldGFpbHMoaXRlbSk7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUl0ZW0oa2V5LCBpbmRleCwgY29udGVudCk7XG4gICAgfTtcbiAgICBwcml2YXRlIGNyZWF0ZU11bHRpcGxlSXRlbSA9IChpdGVtOiBJbnRlcmFjdGl2ZUxpc3RJdGVtLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZGlzYWJsZWRJdGVtcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBrZXksIGNvbnRlbnQgfSA9IHRoaXMuZ2V0SXRlbURldGFpbHMoaXRlbSk7XG4gICAgICAgIGNvbnN0IGlzSXRlbURpc2FibGVkID0gZGlzYWJsZWRJdGVtcyAmJiBkaXNhYmxlZEl0ZW1zLmluZGV4T2Yoa2V5KSAhPT0gLTE7XG4gICAgICAgIGNvbnN0IG5ld0NvbnRlbnQgPSAoPFN0eWxlZENoZWNrYm94IHZhbHVlPXt2YWx1ZS5pbmRleE9mKGluZGV4KSA+PSAwfSBkaXNhYmxlZD17aXNJdGVtRGlzYWJsZWR9PlxuICAgICAgICB7Y29udGVudH1cbiAgICAgIDwvU3R5bGVkQ2hlY2tib3g+KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlSXRlbShrZXksIGluZGV4LCBuZXdDb250ZW50KTtcbiAgICB9O1xuICAgIHByaXZhdGUgZG9uZSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBtdWx0aXBsZSwgb25DaGFuZ2UsIGRpc2FibGVkLCBkYXRhLCBkaXNhYmxlZEl0ZW1zID0gW10gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIGNvbnRyb2xsZWQsIHNlbGVjdGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBpdGVtID0gZGF0YSAmJiBzZWxlY3RlZCAhPT0gdW5kZWZpbmVkICYmIGRhdGFbc2VsZWN0ZWRdO1xuICAgICAgICBjb25zdCBrZXkgPSBpdGVtICYmIHRoaXMuZ2V0SXRlbURldGFpbHMoaXRlbSkua2V5O1xuICAgICAgICBjb25zdCBpc0l0ZW1EaXNhYmxlZCA9IGtleSAmJiBkaXNhYmxlZEl0ZW1zLmluZGV4T2Yoa2V5KSAhPT0gLTE7XG4gICAgICAgIGlmICghZGlzYWJsZWQgJiYgIWlzSXRlbURpc2FibGVkICYmIHNlbGVjdGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld1ZhbHVlID0gbXVsdGlwbGVcbiAgICAgICAgICAgICAgICA/IHZhbHVlLmluZGV4T2Yoc2VsZWN0ZWQpID09PSAtMVxuICAgICAgICAgICAgICAgICAgICA/IFsuLi52YWx1ZSwgc2VsZWN0ZWRdXG4gICAgICAgICAgICAgICAgICAgIDogdmFsdWUuZmlsdGVyKGkgPT4gaSAhPT0gc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgOiBbc2VsZWN0ZWRdO1xuICAgICAgICAgICAgaWYgKCFjb250cm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBuZXdWYWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICBvbkNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBuZXdWYWx1ZSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBjcmVhdGVJdGVtKGtleTogc3RyaW5nLCBpbmRleDogbnVtYmVyLCBjb250ZW50OiBSZWFjdC5SZWFjdENoaWxkKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUsIHNlbGVjdGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGRpc2FibGVkLCBzaG93VGljayA9IGZhbHNlLCBtdWx0aXBsZSA9IGZhbHNlLCBjb25kZW5zZWQgPSBmYWxzZSwgZGlzYWJsZWRJdGVtcyB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgY29uc3QgaXNJdGVtRGlzYWJsZWQgPSBkaXNhYmxlZEl0ZW1zICYmIGRpc2FibGVkSXRlbXMuaW5kZXhPZihrZXkpICE9PSAtMTtcbiAgICAgICAgY29uc3QgaXNIb3ZlcmVkID0gIWRpc2FibGVkICYmIHNlbGVjdGVkID09PSBpbmRleDtcbiAgICAgICAgY29uc3QgaXNTZWxlY3RlZCA9IHZhbHVlLmluZGV4T2YoaW5kZXgpID49IDA7XG4gICAgICAgIGNvbnN0IHNlbGVjdHMgPSB0aGlzLnNlbGVjdHM7XG4gICAgICAgIGNvbnN0IENvbnRlbnRXcmFwcGVyID0gdHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnID8gTGlzdEl0ZW1Db250ZW50UGFkZGluZyA6IExpc3RJdGVtQ29udGVudENvbXBvbmVudFBhZGRpbmc7XG4gICAgICAgIGlmIChzZWxlY3RzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzZWxlY3RzW2luZGV4XSA9ICgpID0+IHRoaXMuc2VsZWN0KGluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxMaXN0SXRlbSBrZXk9e2Ake2tleX0tJHtpbmRleH1gfSBvbkNsaWNrPXt0aGlzLmRvbmV9IG9uTW91c2VNb3ZlPXtzZWxlY3RzW2luZGV4XX0gc2VsZWN0ZWQ9e2lzU2VsZWN0ZWR9IGhvdmVyZWQ9e2lzSG92ZXJlZH0gZGlzYWJsZWQ9e2lzSXRlbURpc2FibGVkfSByZWY9eyhub2RlOiBIVE1MTElFbGVtZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnRzW2luZGV4XSA9IG5vZGU7XG4gICAgICAgICAgICBpZiAoaXNIb3ZlcmVkICYmIG5vZGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBub2RlLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBwYXJlbnQuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHBhcmVudC5zY3JvbGxUb3A7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHkwID0gbm9kZS5vZmZzZXRUb3AgLSBwb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeTEgPSB5MCArIG5vZGUub2Zmc2V0SGVpZ2h0IC0gaGVpZ2h0O1xuICAgICAgICAgICAgICAgICAgICBpZiAoeTAgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wID0gbm9kZS5vZmZzZXRUb3A7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoeTEgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQuc2Nyb2xsVG9wICs9IHkxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9fT5cbiAgICAgICAgPExpc3RJdGVtSW5uZXJDb250YWluZXI+XG4gICAgICAgICAgPExpc3RJdGVtQ29udGVudD5cbiAgICAgICAgICAgIDxDb250ZW50V3JhcHBlciBjb25kZW5zZWQ9e2NvbmRlbnNlZH0gc2hvd1RpY2s9e2lzU2VsZWN0ZWQgJiYgc2hvd1RpY2t9PlxuICAgICAgICAgICAgICB7Y29udGVudH1cbiAgICAgICAgICAgIDwvQ29udGVudFdyYXBwZXI+XG4gICAgICAgICAgPC9MaXN0SXRlbUNvbnRlbnQ+XG4gICAgICAgICAge2lzU2VsZWN0ZWQgJiYgIW11bHRpcGxlICYmIHNob3dUaWNrICYmICg8TGlzdEl0ZW1JY29uUGFkZGluZyBjb25kZW5zZWQ9e2NvbmRlbnNlZH0+XG4gICAgICAgICAgICAgIDxJY29uIG5hbWU9XCJDaGVja1wiIGNvbG9yPXtwYWNpZmljQmx1ZX0gc2l6ZT17MS4zNzV9Lz5cbiAgICAgICAgICAgIDwvTGlzdEl0ZW1JY29uUGFkZGluZz4pfVxuICAgICAgICA8L0xpc3RJdGVtSW5uZXJDb250YWluZXI+XG4gICAgICA8L0xpc3RJdGVtPik7XG4gICAgfVxuICAgIHByaXZhdGUgc2VsZWN0KGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBkaXNhYmxlZCB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgaWYgKCFkaXNhYmxlZCAmJiB0aGlzLnN0YXRlLnNlbGVjdGVkICE9PSBpbmRleCkge1xuICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGluZGV4LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBzZXROb2RlID0gKHJlZjogSFRNTEVsZW1lbnQgfCBudWxsKSA9PiB7XG4gICAgICAgIHRoaXMuaW50ZXJhY3RpdmVMaXN0ID0gcmVmO1xuICAgIH07XG4gICAgcmVuZGVyKCkge1xuICAgICAgICBjb25zdCB7IG9uQ2hhbmdlOiBfMCwgaW5kaWNlczogXzEsIGRpc2FibGVkOiBfMiwgb25LZXlEb3duOiBfMywgb25DbGlja091dHNpZGU6IF80LCBkYXRhID0gW10sIHRoZW1lLCBib3JkZXJsZXNzID0gZmFsc2UsIGNoaWxkcmVuLCBtdWx0aXBsZSA9IGZhbHNlLCBvcGVuID0gZmFsc2UsIG9uQmx1ciwgY3VzdG9tV3JhcHBlciwgb25DbGljaywgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IGJvcmRlciA9IGJvcmRlcmxlc3MgPyBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlLm5vbmUgOiBJbnRlcmFjdGl2ZUxpc3RCb3JkZXJUeXBlLm5vcm1hbDtcbiAgICAgICAgY29uc3QgY3JlYXRlSXRlbSA9IG11bHRpcGxlID8gdGhpcy5jcmVhdGVNdWx0aXBsZUl0ZW0gOiB0aGlzLmNyZWF0ZVNpbmdsZUl0ZW07XG4gICAgICAgIGNvbnN0IFdyYXBwZXIgPSBjdXN0b21XcmFwcGVyIHx8IExpc3RXcmFwcGVyO1xuICAgICAgICByZXR1cm4gKDxJbnRlcmFjdGl2ZUxpc3RDb250YWluZXIgcmVmPXt0aGlzLnNldE5vZGV9IHsuLi4ob3BlbiA/IHsgdGFiSW5kZXg6IDAgfSA6IHVuZGVmaW5lZCl9IG9uS2V5RG93bj17dGhpcy5jb250cm9sfSB7Li4ucHJvcHN9PlxuICAgICAgICA8V3JhcHBlciBvcGVuPXtvcGVufSBib3JkZXI9e2JvcmRlcn0gZGlyZWN0aW9uPXt0aGlzLnN0YXRlLmRpcmVjdGlvbn0gb25DbGljaz17b25DbGlja30+XG4gICAgICAgICAge29wZW4gJiZcbiAgICAgICAgICAgIGRhdGEubWFwKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaXRlbS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZGl2aWRlcic6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA8TGlzdERpdmlkZXIga2V5PXtpdGVtLmtleX0vPjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdoZWFkZXInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPExpc3RIZWFkZXIga2V5PXtpdGVtLmtleX0+e2l0ZW0uY29udGVudCB8fCBpdGVtLmtleX08L0xpc3RIZWFkZXI+O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVJdGVtKGl0ZW0sIGluZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0pfVxuICAgICAgICA8L1dyYXBwZXI+XG4gICAgICA8L0ludGVyYWN0aXZlTGlzdENvbnRhaW5lcj4pO1xuICAgIH1cbiAgICBzdGF0aWMgaW5uZXIgPSB7XG4gICAgICAgIGdldCBTdHlsZWRDaGVja2JveCgpIHsgcmV0dXJuIFN0eWxlZENoZWNrYm94IGFzIHR5cGVvZiBTdHlsZWRDaGVja2JveDsgfSxcbiAgICAgICAgZ2V0IExpc3RJdGVtKCkgeyByZXR1cm4gTGlzdEl0ZW0gYXMgdHlwZW9mIExpc3RJdGVtOyB9LFxuICAgICAgICBnZXQgTGlzdEl0ZW1Jbm5lckNvbnRhaW5lcigpIHsgcmV0dXJuIExpc3RJdGVtSW5uZXJDb250YWluZXIgYXMgdHlwZW9mIExpc3RJdGVtSW5uZXJDb250YWluZXI7IH0sXG4gICAgICAgIGdldCBMaXN0SXRlbUNvbnRlbnQoKSB7IHJldHVybiBMaXN0SXRlbUNvbnRlbnQgYXMgdHlwZW9mIExpc3RJdGVtQ29udGVudDsgfSxcbiAgICAgICAgZ2V0IExpc3RJdGVtSWNvblBhZGRpbmcoKSB7IHJldHVybiBMaXN0SXRlbUljb25QYWRkaW5nIGFzIHR5cGVvZiBMaXN0SXRlbUljb25QYWRkaW5nOyB9LFxuICAgICAgICBnZXQgSWNvbigpIHsgcmV0dXJuIEljb24gYXMgdHlwZW9mIEljb247IH0sXG4gICAgICAgIGdldCBJbnRlcmFjdGl2ZUxpc3RDb250YWluZXIoKSB7IHJldHVybiBJbnRlcmFjdGl2ZUxpc3RDb250YWluZXIgYXMgdHlwZW9mIEludGVyYWN0aXZlTGlzdENvbnRhaW5lcjsgfSxcbiAgICAgICAgZ2V0IExpc3REaXZpZGVyKCkgeyByZXR1cm4gTGlzdERpdmlkZXIgYXMgdHlwZW9mIExpc3REaXZpZGVyOyB9LFxuICAgICAgICBnZXQgTGlzdEhlYWRlcigpIHsgcmV0dXJuIExpc3RIZWFkZXIgYXMgdHlwZW9mIExpc3RIZWFkZXI7IH1cbiAgICB9O1xufVxuIl19