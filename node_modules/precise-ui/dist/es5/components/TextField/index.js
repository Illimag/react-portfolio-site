"use strict";
var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var styled_1 = require("../../utils/styled");
var StackPanel_1 = require("../StackPanel");
var colors_1 = require("../../colors");
var InputIcon_1 = require("../InputIcon");
var withFormContext_1 = require("../../hoc/withFormContext");
var input_1 = require("../../utils/input");
var distance_1 = require("../../distance");
var quarks_1 = require("../../quarks");
var textStyles_1 = require("../../textStyles");
var TextFieldContainer = styled_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject(["\n  position: relative;\n"], ["\n  position: relative;\n"])));
var TextFieldWrapper = styled_1.default(StackPanel_1.StackPanel)(templateObject_2 || (templateObject_2 = __makeTemplateObject(["\n  display: flex;\n"], ["\n  display: flex;\n"])));
var TextFieldArea = styled_1.default.textarea(templateObject_3 || (templateObject_3 = __makeTemplateObject(["\n  ::-ms-clear { display: none; }\n\n  white-space: pre-wrap;\n  word-break: break-word;\n\n  ", "\n  color: ", ";\n  border-radius: 0;\n  font-family: inherit;\n  padding: ", ";\n  box-sizing: border-box;\n  box-shadow: none;\n  resize: ", ";\n  margin: 0;\n  width: 100%;\n  cursor: ", ";\n  border: none;\n  border-bottom: 1px solid\n    ", ";\n  background: ", ";\n\n  &::placeholder {\n    color: ", ";\n    opacity: ", ";\n    transition: inherit;\n  }\n\n  &:focus {\n    outline: none;\n\n    &::placeholder {\n      opacity: 1;\n    }\n  }\n"], ["\n  ::-ms-clear { display: none; }\n\n  white-space: pre-wrap;\n  word-break: break-word;\n\n  ", "\n  color: ", ";\n  border-radius: 0;\n  font-family: inherit;\n  padding: ", ";\n  box-sizing: border-box;\n  box-shadow: none;\n  resize: ", ";\n  margin: 0;\n  width: 100%;\n  cursor: ", ";\n  border: none;\n  border-bottom: 1px solid\n    ", ";\n  background: ", ";\n\n  &::placeholder {\n    color: ", ";\n    opacity: ", ";\n    transition: inherit;\n  }\n\n  &:focus {\n    outline: none;\n\n    &::placeholder {\n      opacity: 1;\n    }\n  }\n"])), textStyles_1.getFontSize('medium'), styled_1.themed(function (_a) {
    var theme = _a.theme, disabled = _a.disabled;
    return (disabled ? theme.text3 : theme.text2);
}), function (props) { return (props.labelShown ? distance_1.distance.large + " " + distance_1.distance.medium + " " + distance_1.distance.small : distance_1.distance.medium); }, function (props) { return props.resizable || 'none'; }, function (props) { return (props.disabled ? 'not-allowed' : 'auto'); }, styled_1.themed(function (_a) {
    var theme = _a.theme, border = _a.border;
    return (border === 3 /* error */ ? colors_1.purpleRed : theme.ui4);
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.ui2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme, disabled = _a.disabled;
    return (disabled ? theme.text3 : theme.text2);
}), function (props) { return (props.labelShown ? '0' : '1'); });
var TextFieldElement = styled_1.default.div(templateObject_4 || (templateObject_4 = __makeTemplateObject(["\n  ", "\n\n  display: flex;\n  align-items: center;\n  padding: ", ";\n  color: ", ";\n  background: ", ";\n"], ["\n  ", "\n\n  display: flex;\n  align-items: center;\n  padding: ", ";\n  color: ", ";\n  background: ", ";\n"])), textStyles_1.getFontSize('medium'), distance_1.distance.medium, styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.text2;
}), styled_1.themed(function (_a) {
    var theme = _a.theme;
    return theme.ui3;
}));
var TextFieldInt = /** @class */ (function (_super) {
    __extends(TextFieldInt, _super);
    function TextFieldInt(props) {
        var _this = _super.call(this, props) || this;
        _this.changeValue = function (e) {
            _this.updateValue(e.target.value, e);
        };
        _this.changeHeight = function () {
            var resizable = _this.props.resizable;
            var element = _this._element;
            if (resizable === 'auto' && element) {
                element.style.height = '1px';
                element.style.height = element.scrollHeight + "px";
            }
        };
        _this.setTextFieldNode = function (node) {
            _this._element = node;
            var inputRef = _this.props.inputRef;
            if (typeof inputRef === 'function') {
                inputRef(node);
            }
        };
        _this.setFocus = function () {
            var onFocus = _this.props.onFocus;
            _this.setState({
                focused: true,
            }, onFocus);
        };
        _this.unsetFocus = function () {
            var onBlur = _this.props.onBlur;
            _this.setState({
                focused: false,
            }, onBlur);
        };
        _this.handleReset = function () {
            var onClear = _this.props.onClear;
            _this.updateValue('');
            if (typeof onClear === 'function') {
                onClear();
            }
        };
        _this.state = {
            focused: false,
            reveal: false,
            controlled: props.value !== undefined,
            value: props.value || props.defaultValue || '',
            error: props.error,
        };
        return _this;
    }
    TextFieldInt.prototype.UNSAFE_componentWillReceiveProps = function (_a) {
        var _b = _a.value, value = _b === void 0 ? '' : _b, error = _a.error;
        if (this.state.controlled) {
            this.setState({ value: value });
        }
        this.setState({ error: error });
    };
    TextFieldInt.prototype.componentDidMount = function () {
        this.changeHeight();
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.subscribe(this);
        }
    };
    TextFieldInt.prototype.componentWillUnmount = function () {
        var form = this.props.form;
        var controlled = this.state.controlled;
        if (!controlled && form) {
            form.unsubscribe(this);
        }
    };
    TextFieldInt.prototype.updateValue = function (value, e) {
        var _a = this.props, onChange = _a.onChange, _b = _a.name, name = _b === void 0 ? '' : _b, form = _a.form;
        if (!this.state.controlled) {
            if (form) {
                form.change({
                    name: name,
                    value: value,
                });
            }
            else {
                this.setState({
                    value: value,
                });
            }
        }
        if (typeof onChange === 'function') {
            onChange({
                value: value,
                originalEvent: e,
            });
        }
    };
    TextFieldInt.prototype.render = function () {
        var _this = this;
        var _a = this.props, theme = _a.theme, borderless = _a.borderless, prefix = _a.prefix, suffix = _a.suffix, multiline = _a.multiline, _b = _a.resizable, resizable = _b === void 0 ? false : _b, disabled = _a.disabled, placeholder = _a.placeholder, info = _a.info, label = _a.label, clearable = _a.clearable, onClear = _a.onClear, icon = _a.icon, _0 = _a.onChange, _1 = _a.defaultValue, _2 = _a.value, _3 = _a.form, _4 = _a.onFocus, _5 = _a.onBlur, _6 = _a.inputRef, _7 = _a.onInput, rest = __rest(_a, ["theme", "borderless", "prefix", "suffix", "multiline", "resizable", "disabled", "placeholder", "info", "label", "clearable", "onClear", "icon", "onChange", "defaultValue", "value", "form", "onFocus", "onBlur", "inputRef", "onInput"]);
        var _c = this.state, focused = _c.focused, value = _c.value, error = _c.error;
        var rows = typeof multiline === 'number' ? multiline : undefined;
        var border = quarks_1.getTextFieldBorderType(borderless, !!error, focused);
        var hasValue = !!value;
        var input = rows !== undefined || multiline ? (React.createElement(TextFieldArea, __assign({ ref: this.setTextFieldNode, onInput: this.changeHeight, border: border, rows: rows, resizable: typeof resizable === 'string' ? resizable : resizable ? 'auto' : undefined, disabled: disabled, labelShown: label !== undefined, placeholder: placeholder, onFocus: this.setFocus, onBlur: this.unsetFocus, value: value, onChange: this.changeValue }, rest))) : (React.createElement(quarks_1.StyledInput, __assign({ ref: function (el) { return _this.setTextFieldNode(el); }, theme: theme, disabled: disabled, labelShown: label !== undefined, placeholder: placeholder, onFocus: this.setFocus, onBlur: this.unsetFocus, value: value, onChange: this.changeValue }, rest)));
        var textFieldWrapper = (React.createElement(quarks_1.StyledInputRow, { error: !!error, focused: focused, hasValue: hasValue, label: label, placeholder: placeholder, multiline: rows !== undefined || multiline !== undefined }, input));
        return (React.createElement(TextFieldContainer, null,
            rows !== undefined || multiline ? (textFieldWrapper) : (React.createElement(TextFieldWrapper, null,
                prefix && React.createElement(TextFieldElement, null, prefix),
                React.createElement(quarks_1.StyledInputBox, { border: border, disabled: disabled, focused: focused, hasValue: hasValue },
                    textFieldWrapper,
                    React.createElement(InputIcon_1.InputIcon, { disabled: disabled, defaultIcon: icon, theme: theme, error: error, hasValue: hasValue, clearable: clearable, onClear: this.handleReset, onClick: function () { return _this._element && _this._element.focus(); } })),
                suffix && React.createElement(TextFieldElement, null, suffix))),
            input_1.showInputInfo(error, info)));
    };
    TextFieldInt.inner = {
        get TextFieldArea() { return TextFieldArea; },
        get StyledInput() { return quarks_1.StyledInput; },
        get StyledInputRow() { return quarks_1.StyledInputRow; },
        get TextFieldContainer() { return TextFieldContainer; },
        get TextFieldWrapper() { return TextFieldWrapper; },
        get TextFieldElement() { return TextFieldElement; },
        get StyledInputBox() { return quarks_1.StyledInputBox; },
        get InputIcon() { return InputIcon_1.InputIcon; }
    };
    return TextFieldInt;
}(React.Component));
/**
 * A text field for custom user input.
 */
exports.TextField = withFormContext_1.withFormContext(TextFieldInt);
exports.TextField.displayName = 'TextField';
var templateObject_1, templateObject_2, templateObject_3, templateObject_4;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy9UZXh0RmllbGQvaW5kZXgudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZCQUErQjtBQUMvQiw2Q0FBb0Q7QUFDcEQsNENBQTJDO0FBQzNDLHVDQUF5QztBQUN6QywwQ0FBeUM7QUFFekMsNkRBQThFO0FBQzlFLDJDQUFrRDtBQUNsRCwyQ0FBMEM7QUFDMUMsdUNBQXdIO0FBQ3hILCtDQUErQztBQWdEL0MsSUFBTSxrQkFBa0IsR0FBRyxnQkFBTSxDQUFDLEdBQUcsOEZBQUMsMkJBRXJDLElBQUEsQ0FBQztBQUNGLElBQU0sZ0JBQWdCLEdBQUcsZ0JBQU0sQ0FBQyx1QkFBVSxDQUFDLHlGQUFDLHNCQUUzQyxJQUFBLENBQUM7QUFDRixJQUFNLGFBQWEsR0FBRyxnQkFBTSxDQUFDLFFBQVEsNG1CQUFxQixpR0FNdEQsRUFBcUIsYUFDZCxFQUF1RSw4REFHckUsRUFBd0csK0RBR3pHLEVBQWtDLDZDQUdsQyxFQUFrRCxzREFHeEQsRUFBNkYsbUJBQ25GLEVBQWdDLHNDQUduQyxFQUF1RSxrQkFDckUsRUFBdUMsOEhBV3JELEtBN0JHLHdCQUFXLENBQUMsUUFBUSxDQUFDLEVBQ2QsZUFBTSxDQUFDLFVBQUMsRUFBbUI7UUFBakIsZ0JBQUssRUFBRSxzQkFBUTtJQUFPLE9BQUEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7QUFBdEMsQ0FBc0MsQ0FBQyxFQUdyRSxVQUFBLEtBQUssSUFBSSxPQUFBLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUksbUJBQVEsQ0FBQyxLQUFLLFNBQUksbUJBQVEsQ0FBQyxNQUFNLFNBQUksbUJBQVEsQ0FBQyxLQUFPLENBQUMsQ0FB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Q0FBQyxLQUFLLEVBQUUsRUFBdEMsQ0FBc0MsR0FBRyxDQUM1TDtnQkFDaEIsTUFBTSxJQUFJLG9CQUFDLGdCQUFnQixRQUFFLE1BQU0sQ0FBb0IsQ0FDdkMsQ0FBQztZQUNyQixxQkFBYSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FDUixDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNNLGtCQUFLLEdBQUc7UUFDWCxJQUFJLGFBQWEsS0FBSyxPQUFPLGFBQXFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JFLElBQUksV0FBVyxLQUFLLE9BQU8sb0JBQWlDLENBQUMsQ0FBQyxDQUFDO1FBQy9ELElBQUksY0FBYyxLQUFLLE9BQU8sdUJBQXVDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLElBQUksa0JBQWtCLEtBQUssT0FBTyxrQkFBK0MsQ0FBQyxDQUFDLENBQUM7UUFDcEYsSUFBSSxnQkFBZ0IsS0FBSyxPQUFPLGdCQUEyQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxJQUFJLGdCQUFnQixLQUFLLE9BQU8sZ0JBQTJDLENBQUMsQ0FBQyxDQUFDO1FBQzlFLElBQUksY0FBYyxLQUFLLE9BQU8sdUJBQXVDLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLElBQUksU0FBUyxLQUFLLE9BQU8scUJBQTZCLENBQUMsQ0FBQyxDQUFDO0tBQzVELENBQUM7SUFDTixtQkFBQztDQUFBLEFBNUhELENBQTJCLEtBQUssQ0FBQyxTQUFTLEdBNEh6QztBQUNEOztHQUVHO0FBQ1UsUUFBQSxTQUFTLEdBQUcsaUNBQWUsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUN2RCxpQkFBUyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkLCB7IHRoZW1lZCB9IGZyb20gJy4uLy4uL3V0aWxzL3N0eWxlZCc7XG5pbXBvcnQgeyBTdGFja1BhbmVsIH0gZnJvbSAnLi4vU3RhY2tQYW5lbCc7XG5pbXBvcnQgeyBwdXJwbGVSZWQgfSBmcm9tICcuLi8uLi9jb2xvcnMnO1xuaW1wb3J0IHsgSW5wdXRJY29uIH0gZnJvbSAnLi4vSW5wdXRJY29uJztcbmltcG9ydCB7IElucHV0Q2hhbmdlRXZlbnQsIFRleHRJbnB1dFByb3BzIH0gZnJvbSAnLi4vLi4vY29tbW9uJztcbmltcG9ydCB7IEZvcm1Db250ZXh0UHJvcHMsIHdpdGhGb3JtQ29udGV4dCB9IGZyb20gJy4uLy4uL2hvYy93aXRoRm9ybUNvbnRleHQnO1xuaW1wb3J0IHsgc2hvd0lucHV0SW5mbyB9IGZyb20gJy4uLy4uL3V0aWxzL2lucHV0JztcbmltcG9ydCB7IGRpc3RhbmNlIH0gZnJvbSAnLi4vLi4vZGlzdGFuY2UnO1xuaW1wb3J0IHsgU3R5bGVkSW5wdXRSb3csIFN0eWxlZElucHV0LCBUZXh0RmllbGRCb3JkZXJUeXBlLCBTdHlsZWRJbnB1dEJveCwgZ2V0VGV4dEZpZWxkQm9yZGVyVHlwZSB9IGZyb20gJy4uLy4uL3F1YXJrcyc7XG5pbXBvcnQgeyBnZXRGb250U2l6ZSB9IGZyb20gJy4uLy4uL3RleHRTdHlsZXMnO1xuZXhwb3J0IHR5cGUgVGV4dEZpZWxkQ2hhbmdlRXZlbnQgPSBJbnB1dENoYW5nZUV2ZW50PHN0cmluZz47XG50eXBlIFRleHRGaWVsZElucHV0Tm9kZVR5cGUgPSBIVE1MVGV4dEFyZWFFbGVtZW50IHwgSFRNTElucHV0RWxlbWVudDtcbmV4cG9ydCBpbnRlcmZhY2UgVGV4dEZpZWxkUHJvcHMgZXh0ZW5kcyBUZXh0SW5wdXRQcm9wcyB7XG4gICAgLyoqXG4gICAgICogQWxsb3dzIG11bHRpLWxpbmUgaW5wdXQgZnJvbSB0aGUgdXNlci4gRWl0aGVyIGEgYm9vbGVhblxuICAgICAqIG9yIGEgbnVtYmVyIHNwZWNpZnlpbmcgdGhlIGFtb3VudCBvZiByb3dzIHRvIHNob3cuXG4gICAgICogQGRlZmF1bHQgZmFsc2VcbiAgICAgKi9cbiAgICBtdWx0aWxpbmU/OiBib29sZWFuIHwgbnVtYmVyO1xuICAgIC8qKlxuICAgICAqIEFsbG93cyByZXNpemluZyB0aGUgdGV4dCBmaWVsZCBpZiBiZWluZyB1c2VkIGFzIGEgbXVsdGktbGluZSBpbnB1dC5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIHJlc2l6YWJsZT86IGJvb2xlYW4gfCAnYXV0bycgfCAndmVydGljYWwnIHwgJ2hvcml6b250YWwnO1xuICAgIC8qKlxuICAgICAqIFNob3dzIGEgY2xlYXJpbmcgaWNvbiB3aGljaCByZXNldHMgdGhlIGlucHV0IHRvIGFuIGVtcHR5IHN0cmluZy5cbiAgICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgICAqL1xuICAgIGNsZWFyYWJsZT86IGJvb2xlYW47XG4gICAgLyoqXG4gICAgICogRXZlbnQgZW1pdHRlZCB3aGVuIHRoZSBjbGVhciBidXR0b24gd2FzIHByZXNzZWQuIFdpbGwgYWx3YXlzIGJlIGZpcmVkIGFmdGVyXG4gICAgICogdGhlIG9uQ2hhbmdlIGV2ZW50LCBpLmUuLCBhZnRlciB0aGUgdmFsdWUgd2FzIHNldCAvIHByb3Bvc2VkLlxuICAgICAqL1xuICAgIG9uQ2xlYXI/KCk6IHZvaWQ7XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgcmVmZXJlbmNlIHRvIHRoZSB1bmRlcmx5aW5nIGlucHV0IG9yIHRleHRhcmVhIGVsZW1lbnQuXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIGlucHV0UmVmPyhpbnN0YW5jZTogSFRNTEVsZW1lbnQgfCBudWxsKTogdm9pZDtcbiAgICAvKipcbiAgICAgKiBAaWdub3JlXG4gICAgICovXG4gICAgY2hpbGRyZW4/OiB2b2lkO1xufVxuZXhwb3J0IGludGVyZmFjZSBUZXh0RmllbGRTdGF0ZSB7XG4gICAgY29udHJvbGxlZDogYm9vbGVhbjtcbiAgICBmb2N1c2VkOiBib29sZWFuO1xuICAgIHJldmVhbDogYm9vbGVhbjtcbiAgICB2YWx1ZTogc3RyaW5nO1xuICAgIGVycm9yPzogUmVhY3QuUmVhY3RDaGlsZDtcbn1cbmludGVyZmFjZSBUZXh0RmllbGRBcmVhUHJvcHMge1xuICAgIGJvcmRlcjogVGV4dEZpZWxkQm9yZGVyVHlwZTtcbiAgICBkaXNhYmxlZD86IGJvb2xlYW47XG4gICAgcmVzaXphYmxlPzogc3RyaW5nO1xuICAgIGxhYmVsU2hvd246IGJvb2xlYW47XG59XG5jb25zdCBUZXh0RmllbGRDb250YWluZXIgPSBzdHlsZWQuZGl2IGBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuYDtcbmNvbnN0IFRleHRGaWVsZFdyYXBwZXIgPSBzdHlsZWQoU3RhY2tQYW5lbCkgYFxuICBkaXNwbGF5OiBmbGV4O1xuYDtcbmNvbnN0IFRleHRGaWVsZEFyZWEgPSBzdHlsZWQudGV4dGFyZWE8VGV4dEZpZWxkQXJlYVByb3BzPiBgXG4gIDo6LW1zLWNsZWFyIHsgZGlzcGxheTogbm9uZTsgfVxuXG4gIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDtcbiAgd29yZC1icmVhazogYnJlYWstd29yZDtcblxuICAke2dldEZvbnRTaXplKCdtZWRpdW0nKX1cbiAgY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lLCBkaXNhYmxlZCB9KSA9PiAoZGlzYWJsZWQgPyB0aGVtZS50ZXh0MyA6IHRoZW1lLnRleHQyKSl9O1xuICBib3JkZXItcmFkaXVzOiAwO1xuICBmb250LWZhbWlseTogaW5oZXJpdDtcbiAgcGFkZGluZzogJHtwcm9wcyA9PiAocHJvcHMubGFiZWxTaG93biA/IGAke2Rpc3RhbmNlLmxhcmdlfSAke2Rpc3RhbmNlLm1lZGl1bX0gJHtkaXN0YW5jZS5zbWFsbH1gIDogZGlzdGFuY2UubWVkaXVtKX07XG4gIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gIGJveC1zaGFkb3c6IG5vbmU7XG4gIHJlc2l6ZTogJHtwcm9wcyA9PiBwcm9wcy5yZXNpemFibGUgfHwgJ25vbmUnfTtcbiAgbWFyZ2luOiAwO1xuICB3aWR0aDogMTAwJTtcbiAgY3Vyc29yOiAke3Byb3BzID0+IChwcm9wcy5kaXNhYmxlZCA/ICdub3QtYWxsb3dlZCcgOiAnYXV0bycpfTtcbiAgYm9yZGVyOiBub25lO1xuICBib3JkZXItYm90dG9tOiAxcHggc29saWRcbiAgICAke3RoZW1lZCgoeyB0aGVtZSwgYm9yZGVyIH0pID0+IChib3JkZXIgPT09IFRleHRGaWVsZEJvcmRlclR5cGUuZXJyb3IgPyBwdXJwbGVSZWQgOiB0aGVtZS51aTQpKX07XG4gIGJhY2tncm91bmQ6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnVpMil9O1xuXG4gICY6OnBsYWNlaG9sZGVyIHtcbiAgICBjb2xvcjogJHt0aGVtZWQoKHsgdGhlbWUsIGRpc2FibGVkIH0pID0+IChkaXNhYmxlZCA/IHRoZW1lLnRleHQzIDogdGhlbWUudGV4dDIpKX07XG4gICAgb3BhY2l0eTogJHtwcm9wcyA9PiAocHJvcHMubGFiZWxTaG93biA/ICcwJyA6ICcxJyl9O1xuICAgIHRyYW5zaXRpb246IGluaGVyaXQ7XG4gIH1cblxuICAmOmZvY3VzIHtcbiAgICBvdXRsaW5lOiBub25lO1xuXG4gICAgJjo6cGxhY2Vob2xkZXIge1xuICAgICAgb3BhY2l0eTogMTtcbiAgICB9XG4gIH1cbmA7XG5jb25zdCBUZXh0RmllbGRFbGVtZW50ID0gc3R5bGVkLmRpdiBgXG4gICR7Z2V0Rm9udFNpemUoJ21lZGl1bScpfVxuXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIHBhZGRpbmc6ICR7ZGlzdGFuY2UubWVkaXVtfTtcbiAgY29sb3I6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnRleHQyKX07XG4gIGJhY2tncm91bmQ6ICR7dGhlbWVkKCh7IHRoZW1lIH0pID0+IHRoZW1lLnVpMyl9O1xuYDtcbmNsYXNzIFRleHRGaWVsZEludCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudDxUZXh0RmllbGRQcm9wcyAmIEZvcm1Db250ZXh0UHJvcHMsIFRleHRGaWVsZFN0YXRlPiB7XG4gICAgcHJpdmF0ZSBfZWxlbWVudDogVGV4dEZpZWxkSW5wdXROb2RlVHlwZSB8IG51bGw7XG4gICAgY29uc3RydWN0b3IocHJvcHM6IFRleHRGaWVsZFByb3BzKSB7XG4gICAgICAgIHN1cGVyKHByb3BzKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICAgICAgIGZvY3VzZWQ6IGZhbHNlLFxuICAgICAgICAgICAgcmV2ZWFsOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZWQ6IHByb3BzLnZhbHVlICE9PSB1bmRlZmluZWQsXG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMudmFsdWUgfHwgcHJvcHMuZGVmYXVsdFZhbHVlIHx8ICcnLFxuICAgICAgICAgICAgZXJyb3I6IHByb3BzLmVycm9yLFxuICAgICAgICB9O1xuICAgIH1cbiAgICBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyh7IHZhbHVlID0gJycsIGVycm9yIH06IFRleHRGaWVsZFByb3BzKSB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmNvbnRyb2xsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3IgfSk7XG4gICAgfVxuICAgIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgICAgICB0aGlzLmNoYW5nZUhlaWdodCgpO1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0uc3Vic2NyaWJlKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgICAgICBjb25zdCB7IGZvcm0gfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgY29udHJvbGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFjb250cm9sbGVkICYmIGZvcm0pIHtcbiAgICAgICAgICAgIGZvcm0udW5zdWJzY3JpYmUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBjaGFuZ2VWYWx1ZSA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50IHwgSFRNTFRleHRBcmVhRWxlbWVudD4pID0+IHtcbiAgICAgICAgdGhpcy51cGRhdGVWYWx1ZShlLnRhcmdldC52YWx1ZSwgZSk7XG4gICAgfTtcbiAgICBwcml2YXRlIHVwZGF0ZVZhbHVlKHZhbHVlOiBzdHJpbmcsIGU/OiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50IHwgSFRNTFRleHRBcmVhRWxlbWVudD4pIHtcbiAgICAgICAgY29uc3QgeyBvbkNoYW5nZSwgbmFtZSA9ICcnLCBmb3JtIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuY29udHJvbGxlZCkge1xuICAgICAgICAgICAgaWYgKGZvcm0pIHtcbiAgICAgICAgICAgICAgICBmb3JtLmNoYW5nZSh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygb25DaGFuZ2UgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uQ2hhbmdlKHtcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEV2ZW50OiBlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHJpdmF0ZSBjaGFuZ2VIZWlnaHQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcmVzaXphYmxlIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5fZWxlbWVudDtcbiAgICAgICAgaWYgKHJlc2l6YWJsZSA9PT0gJ2F1dG8nICYmIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJzFweCc7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke2VsZW1lbnQuc2Nyb2xsSGVpZ2h0fXB4YDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBzZXRUZXh0RmllbGROb2RlID0gKG5vZGU6IFRleHRGaWVsZElucHV0Tm9kZVR5cGUgfCBudWxsKSA9PiB7XG4gICAgICAgIHRoaXMuX2VsZW1lbnQgPSBub2RlO1xuICAgICAgICBjb25zdCB7IGlucHV0UmVmIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICBpZiAodHlwZW9mIGlucHV0UmVmID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBpbnB1dFJlZihub2RlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcHJpdmF0ZSBzZXRGb2N1cyA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyBvbkZvY3VzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICAgIGZvY3VzZWQ6IHRydWUsXG4gICAgICAgIH0sIG9uRm9jdXMpO1xuICAgIH07XG4gICAgcHJpdmF0ZSB1bnNldEZvY3VzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IG9uQmx1ciB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBmb2N1c2VkOiBmYWxzZSxcbiAgICAgICAgfSwgb25CbHVyKTtcbiAgICB9O1xuICAgIHByaXZhdGUgaGFuZGxlUmVzZXQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgb25DbGVhciB9ID0gdGhpcy5wcm9wcztcbiAgICAgICAgdGhpcy51cGRhdGVWYWx1ZSgnJyk7XG4gICAgICAgIGlmICh0eXBlb2Ygb25DbGVhciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb25DbGVhcigpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGNvbnN0IHsgdGhlbWUsIGJvcmRlcmxlc3MsIHByZWZpeCwgc3VmZml4LCBtdWx0aWxpbmUsIHJlc2l6YWJsZSA9IGZhbHNlLCBkaXNhYmxlZCwgcGxhY2Vob2xkZXIsIGluZm8sIGxhYmVsLCBjbGVhcmFibGUsIG9uQ2xlYXIsIGljb24sIG9uQ2hhbmdlOiBfMCwgZGVmYXVsdFZhbHVlOiBfMSwgdmFsdWU6IF8yLCBmb3JtOiBfMywgb25Gb2N1czogXzQsIG9uQmx1cjogXzUsIGlucHV0UmVmOiBfNiwgb25JbnB1dDogXzcsIC4uLnJlc3QgfSA9IHRoaXMucHJvcHM7XG4gICAgICAgIGNvbnN0IHsgZm9jdXNlZCwgdmFsdWUsIGVycm9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCByb3dzID0gdHlwZW9mIG11bHRpbGluZSA9PT0gJ251bWJlcicgPyBtdWx0aWxpbmUgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IGJvcmRlciA9IGdldFRleHRGaWVsZEJvcmRlclR5cGUoYm9yZGVybGVzcywgISFlcnJvciwgZm9jdXNlZCk7XG4gICAgICAgIGNvbnN0IGhhc1ZhbHVlID0gISF2YWx1ZTtcbiAgICAgICAgY29uc3QgaW5wdXQgPSByb3dzICE9PSB1bmRlZmluZWQgfHwgbXVsdGlsaW5lID8gKDxUZXh0RmllbGRBcmVhIHJlZj17dGhpcy5zZXRUZXh0RmllbGROb2RlfSBvbklucHV0PXt0aGlzLmNoYW5nZUhlaWdodH0gYm9yZGVyPXtib3JkZXJ9IHJvd3M9e3Jvd3N9IHJlc2l6YWJsZT17dHlwZW9mIHJlc2l6YWJsZSA9PT0gJ3N0cmluZycgPyByZXNpemFibGUgOiByZXNpemFibGUgPyAnYXV0bycgOiB1bmRlZmluZWR9IGRpc2FibGVkPXtkaXNhYmxlZH0gbGFiZWxTaG93bj17bGFiZWwgIT09IHVuZGVmaW5lZH0gcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfSBvbkZvY3VzPXt0aGlzLnNldEZvY3VzfSBvbkJsdXI9e3RoaXMudW5zZXRGb2N1c30gdmFsdWU9e3ZhbHVlfSBvbkNoYW5nZT17dGhpcy5jaGFuZ2VWYWx1ZX0gey4uLnJlc3R9Lz4pIDogKDxTdHlsZWRJbnB1dCByZWY9e2VsID0+IHRoaXMuc2V0VGV4dEZpZWxkTm9kZShlbCBhcyBUZXh0RmllbGRJbnB1dE5vZGVUeXBlKX0gdGhlbWU9e3RoZW1lfSBkaXNhYmxlZD17ZGlzYWJsZWR9IGxhYmVsU2hvd249e2xhYmVsICE9PSB1bmRlZmluZWR9IHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn0gb25Gb2N1cz17dGhpcy5zZXRGb2N1c30gb25CbHVyPXt0aGlzLnVuc2V0Rm9jdXN9IHZhbHVlPXt2YWx1ZX0gb25DaGFuZ2U9e3RoaXMuY2hhbmdlVmFsdWV9IHsuLi5yZXN0fS8+KTtcbiAgICAgICAgY29uc3QgdGV4dEZpZWxkV3JhcHBlciA9ICg8U3R5bGVkSW5wdXRSb3cgZXJyb3I9eyEhZXJyb3J9IGZvY3VzZWQ9e2ZvY3VzZWR9IGhhc1ZhbHVlPXtoYXNWYWx1ZX0gbGFiZWw9e2xhYmVsfSBwbGFjZWhvbGRlcj17cGxhY2Vob2xkZXJ9IG11bHRpbGluZT17cm93cyAhPT0gdW5kZWZpbmVkIHx8IG11bHRpbGluZSAhPT0gdW5kZWZpbmVkfT5cbiAgICAgICAge2lucHV0fVxuICAgICAgPC9TdHlsZWRJbnB1dFJvdz4pO1xuICAgICAgICByZXR1cm4gKDxUZXh0RmllbGRDb250YWluZXI+XG4gICAgICAgIHtyb3dzICE9PSB1bmRlZmluZWQgfHwgbXVsdGlsaW5lID8gKHRleHRGaWVsZFdyYXBwZXIpIDogKDxUZXh0RmllbGRXcmFwcGVyPlxuICAgICAgICAgICAge3ByZWZpeCAmJiA8VGV4dEZpZWxkRWxlbWVudD57cHJlZml4fTwvVGV4dEZpZWxkRWxlbWVudD59XG4gICAgICAgICAgICA8U3R5bGVkSW5wdXRCb3ggYm9yZGVyPXtib3JkZXJ9IGRpc2FibGVkPXtkaXNhYmxlZH0gZm9jdXNlZD17Zm9jdXNlZH0gaGFzVmFsdWU9e2hhc1ZhbHVlfT5cbiAgICAgICAgICAgICAge3RleHRGaWVsZFdyYXBwZXJ9XG4gICAgICAgICAgICAgIDxJbnB1dEljb24gZGlzYWJsZWQ9e2Rpc2FibGVkfSBkZWZhdWx0SWNvbj17aWNvbn0gdGhlbWU9e3RoZW1lfSBlcnJvcj17ZXJyb3J9IGhhc1ZhbHVlPXtoYXNWYWx1ZX0gY2xlYXJhYmxlPXtjbGVhcmFibGV9IG9uQ2xlYXI9e3RoaXMuaGFuZGxlUmVzZXR9IG9uQ2xpY2s9eygpID0+IHRoaXMuX2VsZW1lbnQgJiYgdGhpcy5fZWxlbWVudC5mb2N1cygpfS8+XG4gICAgICAgICAgICA8L1N0eWxlZElucHV0Qm94PlxuICAgICAgICAgICAge3N1ZmZpeCAmJiA8VGV4dEZpZWxkRWxlbWVudD57c3VmZml4fTwvVGV4dEZpZWxkRWxlbWVudD59XG4gICAgICAgICAgPC9UZXh0RmllbGRXcmFwcGVyPil9XG4gICAgICAgIHtzaG93SW5wdXRJbmZvKGVycm9yLCBpbmZvKX1cbiAgICAgIDwvVGV4dEZpZWxkQ29udGFpbmVyPik7XG4gICAgfVxuICAgIHN0YXRpYyBpbm5lciA9IHtcbiAgICAgICAgZ2V0IFRleHRGaWVsZEFyZWEoKSB7IHJldHVybiBUZXh0RmllbGRBcmVhIGFzIHR5cGVvZiBUZXh0RmllbGRBcmVhOyB9LFxuICAgICAgICBnZXQgU3R5bGVkSW5wdXQoKSB7IHJldHVybiBTdHlsZWRJbnB1dCBhcyB0eXBlb2YgU3R5bGVkSW5wdXQ7IH0sXG4gICAgICAgIGdldCBTdHlsZWRJbnB1dFJvdygpIHsgcmV0dXJuIFN0eWxlZElucHV0Um93IGFzIHR5cGVvZiBTdHlsZWRJbnB1dFJvdzsgfSxcbiAgICAgICAgZ2V0IFRleHRGaWVsZENvbnRhaW5lcigpIHsgcmV0dXJuIFRleHRGaWVsZENvbnRhaW5lciBhcyB0eXBlb2YgVGV4dEZpZWxkQ29udGFpbmVyOyB9LFxuICAgICAgICBnZXQgVGV4dEZpZWxkV3JhcHBlcigpIHsgcmV0dXJuIFRleHRGaWVsZFdyYXBwZXIgYXMgdHlwZW9mIFRleHRGaWVsZFdyYXBwZXI7IH0sXG4gICAgICAgIGdldCBUZXh0RmllbGRFbGVtZW50KCkgeyByZXR1cm4gVGV4dEZpZWxkRWxlbWVudCBhcyB0eXBlb2YgVGV4dEZpZWxkRWxlbWVudDsgfSxcbiAgICAgICAgZ2V0IFN0eWxlZElucHV0Qm94KCkgeyByZXR1cm4gU3R5bGVkSW5wdXRCb3ggYXMgdHlwZW9mIFN0eWxlZElucHV0Qm94OyB9LFxuICAgICAgICBnZXQgSW5wdXRJY29uKCkgeyByZXR1cm4gSW5wdXRJY29uIGFzIHR5cGVvZiBJbnB1dEljb247IH1cbiAgICB9O1xufVxuLyoqXG4gKiBBIHRleHQgZmllbGQgZm9yIGN1c3RvbSB1c2VyIGlucHV0LlxuICovXG5leHBvcnQgY29uc3QgVGV4dEZpZWxkID0gd2l0aEZvcm1Db250ZXh0KFRleHRGaWVsZEludCk7XG5UZXh0RmllbGQuZGlzcGxheU5hbWUgPSAnVGV4dEZpZWxkJztcbiJdfQ==